import{d as Q,am as X,p as W,D as $,u as Z,an as ee,q as m,aF as te,ar as oe,x as ae,C as le,l as z,aG as D,v as V,aH as f,aI as se,aJ as h,az as E,F as ie,o as ne,c as re,a as x,i as s,H as c,R as ue,aC as de,L as y,S as he,aK as R,b as a,aL as U,aM as ce,Y as pe,J as ve,$ as ge,a0 as me,a1 as fe}from"./index-DB0cKmnR.js";import{g as B}from"./index-ZORhgBxb.js";import{V as we,a as be,b as Ce,c as Ve}from"./VExpansionPanel-DFi0RVMB.js";const I=g=>(ge("data-v-49edb97a"),g=g(),me(),g),xe={class:"main"},Pe=["width","height"],Se=I(()=>x("span",null,"Distance between pitch lines",-1)),Te=I(()=>x("span",null,"Center circle radius",-1)),Ae=Q({__name:"Attitude",props:{widget:{}},setup(g){const P=X();W.registerUsage($.roll),W.registerUsage($.pitch);const w=Z(),t=ee(g).widget,b=m(),S=m(),C=m(0),T=m(0),L=[-90,-70,-45,-30,-10,0,10,30,45,70,90],p=te({rollDegrees:0,pitchLinesHeights:{}}),k=m([["#FFFFFF"],["#FF2D2D"],["#0ADB0ACC"]]);oe(()=>{Object.keys(t.value.options).length===0&&(t.value.options={showCenterAim:!0,showPitchLines:!0,showRollPitchValues:!0,desiredAimRadius:150,pitchHeightFactor:300,hudColor:k.value[0][0]})}),ae(()=>{L.forEach(e=>p.pitchLinesHeights[e]=5*e),M()});const{width:O,height:j}=le(),r=z(()=>({width:t.value.size.width*O.value,height:t.value.size.height*j.value})),i=z(()=>D(t.value.options.desiredAimRadius,35,.2*r.value.width));let _,H;V(w.attitude,e=>{const o=Math.abs(f(e.roll-(_||0))),l=Math.abs(f(e.pitch-(H||0)));o>.1&&(_=e.roll,C.value=f(w.attitude.roll)),l>.1&&(H=e.pitch,T.value=f(w.attitude.pitch))});const G=e=>t.value.options.pitchHeightFactor*h(e)/Math.cos(h(e)),M=()=>{if(b.value===void 0||b.value===null)return;if(S.value===void 0){console.debug("Canvas context undefined!"),S.value=b.value.getContext("2d");return}const e=S.value;se(e);const o=.5*r.value.width,l=.5*r.value.height,J=12,A=22,v=2;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${J}px Arial`,e.fillStyle="white";const u=2*i.value;e.translate(o,l),e.rotate(h(p.rollDegrees));for(const[d,n]of Object.entries(p.pitchLinesHeights)){e.beginPath();const Y=Number(d)===0?1:.7,q=Number(d)===0?[]:[5,2],K=Number(d)===0?3:2;if(e.lineWidth=K,e.setLineDash(q),t.value.options.showPitchLines){const N=u+Y*(o-u);e.moveTo(-N+v,n),e.lineTo(-u,n),e.lineTo(-u+5,n+15),e.fillText(Number(d),-u-4*v,n-3*v),e.moveTo(+N-v,n),e.lineTo(u,n),e.lineTo(u-5,n+15),e.fillText(Number(d),u+4*v,n-3*v),e.stroke()}}if(e.lineWidth=3,e.setLineDash([]),e.font=`bold ${A}px Arial`,t.value.options.showCenterAim&&(e.beginPath(),e.moveTo(-i.value,0),e.lineTo(-1.5*i.value,0),e.stroke(),e.beginPath(),e.arc(0,0,i.value,h(135),h(225)),e.stroke(),e.beginPath(),e.moveTo(i.value,0),e.lineTo(1.5*i.value,0),e.stroke(),e.beginPath(),e.arc(0,0,i.value,h(-45),h(45)),e.stroke()),t.value.options.showRollPitchValues){const d=`r: ${Number(C.value).toFixed(2)}`,n=`p: ${Number(T.value).toFixed(2)}`;e.rotate(h(-p.rollDegrees)),i.value<200?(e.fillText(d,0,D(-1.5*i.value,-.8*l,0)),e.fillText(n,0,D(1.5*i.value,0,.8*l))):(e.textAlign="start",e.fillText(d,-i.value+A,-30),e.fillText(n,-i.value+A,30)),e.stroke()}e.translate(-o,-l),e.globalCompositeOperation="source-in";const F=e.createLinearGradient(0,0,r.value.width,r.value.height);F.addColorStop(0,t.value.options.hudColor),F.addColorStop(1,t.value.options.hudColor),e.fillStyle=F,e.fillRect(0,0,r.value.width,r.value.height)};return V(T,()=>{L.forEach(e=>{const o=-E(G(e-f(w.attitude.pitch)),2);B.to(p.pitchLinesHeights,.1,{[e]:o})})}),V(C,()=>{B.to(p,.1,{rollDegrees:-E(C.value,2)})}),V([p,r,t.value.options],()=>{P.isWidgetVisible(t.value)&&ie(()=>M())}),(e,o)=>(ne(),re(ve,null,[x("div",xe,[x("canvas",{ref_key:"canvasRef",ref:b,width:r.value.width,height:r.value.height},null,8,Pe)]),s(pe,{modelValue:a(P).widgetManagerVars(a(t).hash).configMenuOpen,"onUpdate:modelValue":o[6]||(o[6]=l=>a(P).widgetManagerVars(a(t).hash).configMenuOpen=l),"min-width":"400","max-width":"35%"},{default:c(()=>[s(ue,{class:"pa-2"},{default:c(()=>[s(de,null,{default:c(()=>[y("Attitude widget config")]),_:1}),s(he,null,{default:c(()=>[s(R,{class:"ma-1",label:"Show roll/pitch values","model-value":a(t).options.showRollPitchValues,color:a(t).options.showRollPitchValues?"rgb(0, 20, 80)":void 0,"hide-details":"",onChange:o[0]||(o[0]=l=>a(t).options.showRollPitchValues=!a(t).options.showRollPitchValues)},null,8,["model-value","color"]),s(R,{class:"ma-1",label:"Show center aim","model-value":a(t).options.showCenterAim,color:a(t).options.showCenterAim?"rgb(0, 20, 80)":void 0,"hide-details":"",onChange:o[1]||(o[1]=l=>a(t).options.showCenterAim=!a(t).options.showCenterAim)},null,8,["model-value","color"]),s(R,{class:"ma-1",label:"Show pitch lines","model-value":a(t).options.showPitchLines,color:a(t).options.showPitchLines?"rgb(0, 20, 80)":void 0,"hide-details":"",onChange:o[2]||(o[2]=l=>a(t).options.showPitchLines=!a(t).options.showPitchLines)},null,8,["model-value","color"]),Se,s(U,{modelValue:a(t).options.pitchHeightFactor,"onUpdate:modelValue":o[3]||(o[3]=l=>a(t).options.pitchHeightFactor=l),label:"Pitch lines gain factor",min:1,max:2500,"thumb-label":""},null,8,["modelValue"]),Te,s(U,{modelValue:a(t).options.desiredAimRadius,"onUpdate:modelValue":o[4]||(o[4]=l=>a(t).options.desiredAimRadius=l),label:"Center circle radius",min:10,max:300,"thumb-label":""},null,8,["modelValue"]),s(we,null,{default:c(()=>[s(be,null,{default:c(()=>[s(Ce,null,{default:c(()=>[y("Color")]),_:1}),s(Ve,{class:"pa-2"},{default:c(()=>[s(ce,{modelValue:a(t).options.hudColor,"onUpdate:modelValue":o[5]||(o[5]=l=>a(t).options.hudColor=l),swatches:k.value,"show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),ke=fe(Ae,[["__scopeId","data-v-49edb97a"]]);export{ke as default};
