import{bE as z,d as B,a_ as A,b as o,p as H,F as O,C as L,a4 as W,a6 as Y,a5 as q,v as V,a9 as G,ab as J,I as K,x as I,l as g,o as d,c as u,a as l,t as h,L as b,M as N,N as f,i,J as m,T as Q,K as X,ak as Z,U as ee,ad as M,at as $,R as C,_ as te,a1 as ae,a2 as oe,a3 as le}from"./index-Dnoh0Quy.js";const se=z("v-banner-text"),r=y=>(ae("data-v-9aa88fa6"),y=y(),oe(),y),ne={ref:"videoWidget",class:"video-widget"},ie={key:0,class:"no-video-alert"},re=r(()=>l("span",null,"No video stream selected.",-1)),de=[re],ue={key:1,class:"no-video-alert"},ce=r(()=>l("br",null,null,-1)),pe=r(()=>l("p",null," This can happen if you changed vehicles and the stream name in the new one is different from the former, or if the source is not available at all. ",-1)),me=r(()=>l("br",null,null,-1)),ve=r(()=>l("p",null," Please open this video player configuration and select a new stream from the ones available, or check your source for issues. ",-1)),fe={key:2,class:"no-video-alert"},ye={class:"no-video-alert"},ge=r(()=>l("span",{class:"text-xl font-bold"},"Server status: ",-1)),he=r(()=>l("br",null,null,-1)),Se=r(()=>l("span",{class:"text-xl font-bold"},"Stream status: ",-1)),_e=r(()=>l("br",null,null,-1)),Ve={key:3,class:"no-video-alert"},we=r(()=>l("p",null,"Loading stream...",-1)),be=[we],xe={class:"flex-wrap justify-center d-flex ga-5"},ke=B({__name:"VideoPlayer",props:{widget:{}},setup(y){A(s=>({"3cf7acce":o(e).options.videoFitStyle,"87c3aa06":D.value}));const F=H(),{showDialog:U}=O(),c=L(),x=W(),{namesAvailableStreams:p}=Y(c),e=q(y).widget,n=V(),S=V(),v=V(),w=V(!1);G(()=>{const s={videoFitStyle:"cover",flipHorizontally:!1,flipVertically:!1,rotationAngle:0,streamName:void 0};e.value.options=Object.assign({},s,e.value.options),n.value=e.value.options.streamName});const R=setInterval(()=>{var a;e.value.options.streamName===void 0&&!p.value.isEmpty()&&(e.value.options.streamName=p.value[0],n.value=e.value.options.streamName,p.value.length>1&&U({maxWidth:600,title:"Multiple streams detected",message:`You have multiple streams available, so we chose one randomly to start with.
        If you want to change it, please open the widget configuration on the edit-menu.`,variant:"info"}));const s=c.getMediaStream(e.value.options.streamName);J(s,v.value)||(v.value=s);const t=((a=c.getStreamData(e.value.options.streamName))==null?void 0:a.connected)??!1;t!==w.value&&(w.value=t)},1e3);K(()=>clearInterval(R)),I(n,()=>{e.value.options.streamName=n.value,v.value=void 0}),I(v,()=>{!S.value||!v.value||(S.value.srcObject=v.value,S.value.play().then(()=>console.log("[VideoPlayer] Stream is playing")).catch(s=>{const t=`Failed to play stream. Reason: ${s}`;console.error(`[VideoPlayer] ${t}`)}))});const k=s=>{e.value.options.rotationAngle+=s},P=g(()=>`scale(${e.value.options.flipHorizontally?-1:1}, ${e.value.options.flipVertically?-1:1})`),j=g(()=>`rotate(${e.value.options.rotationAngle??0}deg)`),D=g(()=>`${P.value} ${j.value}`),E=g(()=>{var s;return n.value===void 0?"Unknown.":((s=c.getStreamData(n.value))==null?void 0:s.webRtcManager.signallerStatus)??"Unknown."}),T=g(()=>{var t;if(n.value===void 0)return"Unknown.";const s=c.availableIceIps;return!s.isEmpty()&&!s.find(a=>c.allowedIceIps.includes(a))?`Stream is coming from IPs [${s.join(", ")}], which are not in the list of allowed sources
      [${c.allowedIceIps.join(", ")}].\\n Please check your configuration.`:((t=c.getStreamData(n.value))==null?void 0:t.webRtcManager.streamStatus)??"Unknown."});return(s,t)=>(d(),u(b,null,[l("div",ne,[n.value===void 0?(d(),u("div",ie,de)):!o(p).isEmpty()&&!o(p).includes(n.value)?(d(),u("div",ue,[l("p",null,'The selected stream "'+h(n.value)+'" is not available.',1),l("p",null,"Available ones are: "+h(o(p).map(a=>`"${a}"`).join(", "))+".",1),ce,pe,me,ve])):w.value?(d(),u("div",Ve,be)):(d(),u("div",fe,[l("div",ye,[l("p",null,[ge,(d(!0),u(b,null,N(E.value.toString().split("\\n"),(a,_)=>(d(),u("span",{key:_},[f(h(a)+" ",1),he]))),128))]),l("p",null,[Se,(d(!0),u(b,null,N(T.value.toString().split("\\n"),(a,_)=>(d(),u("span",{key:_},[f(h(a)+" ",1),_e]))),128))])])])),l("video",{id:"mainDisplayStream",ref_key:"videoElement",ref:S,muted:"",autoplay:"",playsinline:"",disablePictureInPicture:""}," Your browser does not support the video tag. ",512)],512),i(te,{modelValue:o(x).widgetManagerVars(o(e).hash).configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=a=>o(x).widgetManagerVars(o(e).hash).configMenuOpen=a),width:"auto"},{default:m(()=>[i(Q,{class:"pa-4 text-white",style:X([{"border-radius":"15px"},o(F).globalGlassMenuStyles])},{default:m(()=>[i(Z,{class:"text-center"},{default:m(()=>[f("Video widget config")]),_:1}),i(ee,{class:"flex flex-col gap-y-4"},{default:m(()=>[i(M,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=a=>n.value=a),label:"Stream name",class:"my-3",items:o(p),"item-title":"name",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue","items"]),i(M,{modelValue:o(e).options.videoFitStyle,"onUpdate:modelValue":t[1]||(t[1]=a=>o(e).options.videoFitStyle=a),label:"Fit style",class:"my-3",items:["cover","fill","contain"],"item-title":"style",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue"]),i(se,null,{default:m(()=>[f('Saved stream name: "'+h(o(e).options.streamName)+'"',1)]),_:1}),i($,{modelValue:o(e).options.flipHorizontally,"onUpdate:modelValue":t[2]||(t[2]=a=>o(e).options.flipHorizontally=a),class:"my-1",label:"Flip horizontally",color:o(e).options.flipHorizontally?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),i($,{modelValue:o(e).options.flipVertically,"onUpdate:modelValue":t[3]||(t[3]=a=>o(e).options.flipVertically=a),class:"my-1",label:"Flip vertically",color:o(e).options.flipVertically?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),l("div",xe,[i(C,{"prepend-icon":"mdi-file-rotate-left",variant:"outlined",onClick:t[4]||(t[4]=a=>k(-90))},{default:m(()=>[f(" Rotate Left")]),_:1}),i(C,{"prepend-icon":"mdi-file-rotate-right",variant:"outlined",onClick:t[5]||(t[5]=a=>k(90))},{default:m(()=>[f(" Rotate Right")]),_:1})])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),Me=le(ke,[["__scopeId","data-v-9aa88fa6"]]);export{Me as default};
