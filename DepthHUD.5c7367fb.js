import{d as R,S as j,j as $,D as G,u as q,U as I,k as _,an as Z,i as v,bf as J,Z as K,q as Q,ao as X,m as Y,ae as y,ar as ee,at as te,o as ae,c as oe,a as M,f as s,a2 as r,ah as le,aj as se,a3 as U,au as ne,av as ie,b as d,a7 as ue,a4 as re,ap as de,ab as he}from"./index.e70afa68.js";import{w as ce}from"./index.72130098.js";import{g as k}from"./index.26c17e5e.js";import{V as pe,a as ve,b as fe,c as ge,d as me}from"./VExpansionPanel.cd2b10c3.js";const xe={class:"main"},Ve=["width","height"],we=R({__name:"DepthHUD",props:{widget:{}},setup(H){const W=j();$.registerUsage(G.depth);const z=q(),a=I(H).widget,E=_([["#FF2D2D"],["#0ADB0ACC"],["#FFFFFF"]]),n=Z({depthLinesY:{},indicatorY:0}),x=_(Array(10).fill(0)),V=v(()=>x.value[x.value.length-1]),A=v(()=>x.value.slice(-10)),P=v(()=>Math.max(...A.value)),g=v(()=>1.3*P.value>10?1.3*P.value:10),w=v(()=>J(0,g.value+1)),B=v(()=>Math.max(...w.value));K(()=>{Object.keys(a.value.options).length===0&&(a.value.options={showDepthValue:!0,hudColor:E.value[2][0]})}),Q(()=>{w.value.forEach(e=>n.depthLinesY[e]=b(e)),L()});const{height:N}=X(),u=v(()=>({width:128,height:a.value.size.height*N.value}));Y(()=>z.altitude.msl,e=>{const t=-1*de(e,e,0);Math.abs(t-(V.value||0))>.1&&x.value.push(t)});const b=e=>{const t=e,l=u.value.height/B.value;return y(l*t)},D=_(),S=_(),L=()=>{if(D.value===void 0||D.value===null)return;if(S.value===void 0){console.debug("Canvas context undefined!"),S.value=D.value.getContext("2d");return}const e=S.value,t=u.value.width,l=u.value.height;ee(e);const h=12,c=16,p=10,o=1,O=5,i=10*o;e.textAlign="left",e.textBaseline="middle",e.font=`bold ${h}px Arial`,e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor;let f=[1,5];g.value>25&&(f=[2,10]),g.value>125&&(f=[5,25]),g.value>250&&(f=[10,50]),g.value>500&&(f=[20,100]);for(const[F,m]of Object.entries(n.depthLinesY))Number(F)%f[0]===0&&(e.beginPath(),e.moveTo(t-o-3.3*h-O,m+i),e.lineTo(o+3.9*c+p,m+i),e.lineWidth="1"),Number(F)%f[1]===0&&(e.lineWidth="2",e.moveTo(t-o-3.3*h,m+i),e.lineTo(o+3.9*c+p,m+i),e.fillText(`${F} m`,t-o-3*h,m+i)),e.stroke();const C=Math.max(n.indicatorY,0);e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor,a.value.options.showDepthValue&&(e.textAlign="right",e.font=`bold ${c}px Arial`,e.fillText(`${V.value.toFixed(1)} m`,o+4.3*c-p-o,C+i)),e.beginPath(),e.moveTo(o+4.3*c+o,C+i),e.lineTo(o+4.3*c+o-p,C-p/2+i),e.lineTo(o+4.3*c+o-p,C+p/2+i),e.closePath(),e.fill(),e.globalCompositeOperation="source-in";const T=e.createLinearGradient(t/2,0,t/2,l);T.addColorStop(.95,a.value.options.hudColor),T.addColorStop(1,ce(a.value.options.hudColor).alpha(0).toRgbString()),e.fillStyle=T,e.fillRect(0,0,t,l)};return Y(V,()=>{w.value.forEach(t=>{var l,h;(h=(l=n.depthLinesY)[t])!=null||(l[t]=y(u.value.height+100)),k.to(n.depthLinesY,.5,{[t]:b(t)})}),Object.keys(n.depthLinesY).filter(t=>!w.value.includes(Number(t))).forEach(t=>{k.to(n.depthLinesY,.5,{[t]:y(u.value.height+100)})}),k.to(n,.5,{indicatorY:b(V.value)})}),Y([n,u,a.value.options],()=>{!W.isWidgetVisible(a.value)||te(()=>L())}),(e,t)=>(ae(),oe(re,null,[M("div",xe,[M("canvas",{ref_key:"canvasRef",ref:D,width:u.value.width,height:u.value.height},null,8,Ve)]),s(ue,{modelValue:d(a).managerVars.configMenuOpen,"onUpdate:modelValue":t[2]||(t[2]=l=>d(a).managerVars.configMenuOpen=l),"min-width":"400","max-width":"35%"},{default:r(()=>[s(le,{class:"pa-2"},{default:r(()=>[s(se,null,{default:r(()=>[U("Depth HUD config")]),_:1}),s(ne,null,{default:r(()=>[s(ie,{class:"ma-1",label:"Show height value","model-value":d(a).options.showDepthValue,color:d(a).options.showDepthValue?"rgb(0, 20, 80)":void 0,"hide-details":"",onChange:t[0]||(t[0]=l=>d(a).options.showDepthValue=!d(a).options.showDepthValue)},null,8,["model-value","color"]),s(pe,null,{default:r(()=>[s(ve,null,{default:r(()=>[s(fe,null,{default:r(()=>[U("Color")]),_:1}),s(ge,null,{default:r(()=>[s(me,{modelValue:d(a).options.hudColor,"onUpdate:modelValue":t[1]||(t[1]=l=>d(a).options.hudColor=l),class:"ma-2",swatches:E.value,"show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});const Te=he(we,[["__scopeId","data-v-f13c44bf"]]);export{Te as default};
