import{bI as B,d as P,b4 as T,b as a,z,am as j,ao as D,an as E,q as S,ar as H,at as O,au as A,G as L,v as x,l as v,o as f,c as y,a as o,t as g,i,H as u,R as Y,aC as q,L as V,S as K,av as N,aK as k,P as C,Y as W,J as G,$ as J,a0 as Q,a1 as X}from"./index-DB0cKmnR.js";const Z=B("v-banner-text"),r=m=>(J("data-v-7ca04455"),m=m(),Q(),m),ee={ref:"videoWidget",class:"video-widget"},te={key:0,class:"no-video-alert"},ae=r(()=>o("span",null,"No video stream selected.",-1)),oe=[ae],le={key:1,class:"no-video-alert"},se=r(()=>o("br",null,null,-1)),ne=r(()=>o("p",null," This can happen if you changed vehicles and the stream name in the new one is different from the former, or if the source is not available at all. ",-1)),ie=r(()=>o("br",null,null,-1)),re=r(()=>o("p",null," Please open this video player configuration and select a new stream from the ones available, or check your source for issues. ",-1)),de={key:2,class:"no-video-alert"},ue={class:"no-video-alert"},ce=r(()=>o("span",{class:"text-xl font-bold"},"Server status: ",-1)),me=r(()=>o("span",{class:"text-xl font-bold"},"Stream status: ",-1)),pe={key:3,class:"no-video-alert"},ve=r(()=>o("p",null,"Loading stream...",-1)),fe=[ve],ye={class:"flex-wrap justify-center d-flex ga-5"},ge=P({__name:"VideoPlayer",props:{widget:{}},setup(m){T(l=>({"5ac3d852":a(e).options.videoFitStyle,"688f2176":R.value}));const p=z(),b=j(),{namesAvailableStreams:d}=D(p),e=E(m).widget,n=S(),h=S(),c=S(),_=S(!1);H(()=>{const l={videoFitStyle:"cover",flipHorizontally:!1,flipVertically:!1,rotationAngle:0,streamName:void 0};e.value.options=Object.assign({},l,e.value.options),n.value=e.value.options.streamName});const M=setInterval(()=>{var s;e.value.options.streamName===void 0&&!d.value.isEmpty()&&(e.value.options.streamName=d.value[0],n.value=e.value.options.streamName,d.value.length>1&&O.fire({title:"Multiple streams detected",text:`You have multiple streams available, so we chose one randomly to start with.
        If you want to change it, please open the widget configuration on the edit-menu.`,icon:"info",confirmButtonText:"OK"}));const l=p.getMediaStream(e.value.options.streamName);A(l,c.value)||(c.value=l);const t=((s=p.getStreamData(e.value.options.streamName))==null?void 0:s.connected)??!1;t!==_.value&&(_.value=t)},1e3);L(()=>clearInterval(M)),x(n,()=>{e.value.options.streamName=n.value,c.value=void 0}),x(c,()=>{!h.value||!c.value||(h.value.srcObject=c.value,h.value.play().then(()=>console.log("[VideoPlayer] Stream is playing")).catch(l=>{const t=`Failed to play stream. Reason: ${l}`;console.error(`[VideoPlayer] ${t}`)}))});const w=l=>{e.value.options.rotationAngle+=l},$=v(()=>`scale(${e.value.options.flipHorizontally?-1:1}, ${e.value.options.flipVertically?-1:1})`),F=v(()=>`rotate(${e.value.options.rotationAngle??0}deg)`),R=v(()=>`${$.value} ${F.value}`),U=v(()=>{var l;return n.value===void 0?"Unknown.":((l=p.getStreamData(n.value))==null?void 0:l.webRtcManager.signallerStatus)??"Unknown."}),I=v(()=>{var l;return n.value===void 0?"Unknown.":((l=p.getStreamData(n.value))==null?void 0:l.webRtcManager.streamStatus)??"Unknown."});return(l,t)=>(f(),y(G,null,[o("div",ee,[n.value===void 0?(f(),y("div",te,oe)):!a(d).isEmpty()&&!a(d).includes(n.value)?(f(),y("div",le,[o("p",null,'The selected stream "'+g(n.value)+'" is not available.',1),o("p",null,"Available ones are: "+g(a(d).map(s=>`"${s}"`).join(", "))+".",1),se,ne,ie,re])):_.value?(f(),y("div",pe,fe)):(f(),y("div",de,[o("div",ue,[o("p",null,[ce,o("span",null,g(U.value),1)]),o("p",null,[me,o("span",null,g(I.value),1)])])])),o("video",{id:"mainDisplayStream",ref_key:"videoElement",ref:h,muted:"",autoplay:"",playsinline:"",disablePictureInPicture:""}," Your browser does not support the video tag. ",512)],512),i(W,{modelValue:a(b).widgetManagerVars(a(e).hash).configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=s=>a(b).widgetManagerVars(a(e).hash).configMenuOpen=s),width:"auto"},{default:u(()=>[i(Y,{class:"pa-2"},{default:u(()=>[i(q,null,{default:u(()=>[V("Video widget config")]),_:1}),i(K,null,{default:u(()=>[i(N,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=s=>n.value=s),label:"Stream name",class:"my-3",items:a(d),"item-title":"name",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue","items"]),i(N,{modelValue:a(e).options.videoFitStyle,"onUpdate:modelValue":t[1]||(t[1]=s=>a(e).options.videoFitStyle=s),label:"Fit style",class:"my-3",items:["cover","fill","contain"],"item-title":"style",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue"]),i(Z,null,{default:u(()=>[V('Saved stream name: "'+g(a(e).options.streamName)+'"',1)]),_:1}),i(k,{modelValue:a(e).options.flipHorizontally,"onUpdate:modelValue":t[2]||(t[2]=s=>a(e).options.flipHorizontally=s),class:"my-1",label:"Flip horizontally",color:a(e).options.flipHorizontally?"rgb(0, 20, 80)":void 0,"hide-details":""},null,8,["modelValue","color"]),i(k,{modelValue:a(e).options.flipVertically,"onUpdate:modelValue":t[3]||(t[3]=s=>a(e).options.flipVertically=s),class:"my-1",label:"Flip vertically",color:a(e).options.flipVertically?"rgb(0, 20, 80)":void 0,"hide-details":""},null,8,["modelValue","color"]),o("div",ye,[i(C,{"prepend-icon":"mdi-file-rotate-left",variant:"outlined",onClick:t[4]||(t[4]=s=>w(-90))},{default:u(()=>[V(" Rotate Left")]),_:1}),i(C,{"prepend-icon":"mdi-file-rotate-right",variant:"outlined",onClick:t[5]||(t[5]=s=>w(90))},{default:u(()=>[V(" Rotate Right")]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),_e=X(ge,[["__scopeId","data-v-7ca04455"]]);export{_e as default};
