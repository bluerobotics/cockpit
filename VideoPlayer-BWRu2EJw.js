import{bG as B,d as M,bk as T,b as s,a5 as j,aD as D,aC as P,q as _,aG as z,aI as E,aJ as O,a7 as A,v as w,l as v,o as f,c as y,a,t as g,i,a1 as u,ad as H,aS as q,a4 as h,ae as G,aK as x,a$ as k,a2 as N,aj as K,a8 as L,am as Y,an as J,ao as W}from"./index-CknxIVJT.js";const Q=B("v-banner-text"),r=m=>(Y("data-v-1b1ef616"),m=m(),J(),m),X={ref:"videoWidget",class:"video-widget"},Z={key:0,class:"no-video-alert"},ee=r(()=>a("span",null,"No video stream selected.",-1)),te=[ee],ae={key:1,class:"no-video-alert"},oe=r(()=>a("br",null,null,-1)),le=r(()=>a("p",null," This can happen if you changed vehicles and the stream name in the new one is different from the former, or if the source is not available at all. ",-1)),se=r(()=>a("br",null,null,-1)),ne=r(()=>a("p",null," Please open this video player configuration and select a new stream from the ones available, or check your source for issues. ",-1)),ie={key:2,class:"no-video-alert"},re={class:"no-video-alert"},de=r(()=>a("span",{class:"text-xl font-bold"},"Server status: ",-1)),ue=r(()=>a("span",{class:"text-xl font-bold"},"Stream status: ",-1)),ce={key:3,class:"no-video-alert"},me=r(()=>a("p",null,"Loading stream...",-1)),pe=[me],ve={class:"flex-wrap justify-center d-flex ga-5"},fe=M({__name:"VideoPlayer",props:{widget:{}},setup(m){T(o=>({"87ffa65e":s(e).options.videoFitStyle,"3427b035":U.value}));const p=j(),{namesAvailableStreams:d}=D(p),e=P(m).widget,n=_(),V=_(),c=_(),S=_(!1);z(()=>{const o={videoFitStyle:"cover",flipHorizontally:!1,flipVertically:!1,rotationAngle:0,streamName:void 0};e.value.options=Object.assign({},o,e.value.options),n.value=e.value.options.streamName});const C=setInterval(()=>{var l;e.value.options.streamName===void 0&&!d.value.isEmpty()&&(e.value.options.streamName=d.value[0],n.value=e.value.options.streamName,d.value.length>1&&E.fire({title:"Multiple streams detected",text:`You have multiple streams available, so we chose one randomly to start with.
        If you want to change it, please open the widget configuration on the edit-menu.`,icon:"info",confirmButtonText:"OK"}));const o=p.getMediaStream(e.value.options.streamName);O(o,c.value)||(c.value=o);const t=((l=p.getStreamData(e.value.options.streamName))==null?void 0:l.connected)??!1;t!==S.value&&(S.value=t)},1e3);A(()=>clearInterval(C)),w(n,()=>{e.value.options.streamName=n.value,c.value=void 0}),w(c,()=>{!V.value||!c.value||(V.value.srcObject=c.value,V.value.play().then(()=>console.log("[VideoPlayer] Stream is playing")).catch(o=>{const t=`Failed to play stream. Reason: ${o}`;console.error(`[VideoPlayer] ${t}`)}))});const b=o=>{e.value.options.rotationAngle+=o},$=v(()=>`scale(${e.value.options.flipHorizontally?-1:1}, ${e.value.options.flipVertically?-1:1})`),F=v(()=>`rotate(${e.value.options.rotationAngle??0}deg)`),U=v(()=>`${$.value} ${F.value}`),I=v(()=>{var o;return n.value===void 0?"Unknown.":((o=p.getStreamData(n.value))==null?void 0:o.webRtcManager.signallerStatus)??"Unknown."}),R=v(()=>{var o;return n.value===void 0?"Unknown.":((o=p.getStreamData(n.value))==null?void 0:o.webRtcManager.streamStatus)??"Unknown."});return(o,t)=>(f(),y(L,null,[a("div",X,[n.value===void 0?(f(),y("div",Z,te)):!s(d).isEmpty()&&!s(d).includes(n.value)?(f(),y("div",ae,[a("p",null,'The selected stream "'+g(n.value)+'" is not available.',1),a("p",null,"Available ones are: "+g(s(d).map(l=>`"${l}"`).join(", "))+".",1),oe,le,se,ne])):S.value?(f(),y("div",ce,pe)):(f(),y("div",ie,[a("div",re,[a("p",null,[de,a("span",null,g(I.value),1)]),a("p",null,[ue,a("span",null,g(R.value),1)])])])),a("video",{id:"mainDisplayStream",ref_key:"videoElement",ref:V,muted:"",autoplay:"",playsinline:"",disablePictureInPicture:""}," Your browser does not support the video tag. ",512)],512),i(K,{modelValue:s(e).managerVars.configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=l=>s(e).managerVars.configMenuOpen=l),width:"auto"},{default:u(()=>[i(H,{class:"pa-2"},{default:u(()=>[i(q,null,{default:u(()=>[h("Video widget config")]),_:1}),i(G,null,{default:u(()=>[i(x,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=l=>n.value=l),label:"Stream name",class:"my-3",items:s(d),"item-title":"name",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue","items"]),i(x,{modelValue:s(e).options.videoFitStyle,"onUpdate:modelValue":t[1]||(t[1]=l=>s(e).options.videoFitStyle=l),label:"Fit style",class:"my-3",items:["cover","fill","contain"],"item-title":"style",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue"]),i(Q,null,{default:u(()=>[h('Saved stream name: "'+g(s(e).options.streamName)+'"',1)]),_:1}),i(k,{modelValue:s(e).options.flipHorizontally,"onUpdate:modelValue":t[2]||(t[2]=l=>s(e).options.flipHorizontally=l),class:"my-1",label:"Flip horizontally",color:s(e).options.flipHorizontally?"rgb(0, 20, 80)":void 0,"hide-details":""},null,8,["modelValue","color"]),i(k,{modelValue:s(e).options.flipVertically,"onUpdate:modelValue":t[3]||(t[3]=l=>s(e).options.flipVertically=l),class:"my-1",label:"Flip vertically",color:s(e).options.flipVertically?"rgb(0, 20, 80)":void 0,"hide-details":""},null,8,["modelValue","color"]),a("div",ve,[i(N,{"prepend-icon":"mdi-file-rotate-left",variant:"outlined",onClick:t[4]||(t[4]=l=>b(-90))},{default:u(()=>[h(" Rotate Left")]),_:1}),i(N,{"prepend-icon":"mdi-file-rotate-right",variant:"outlined",onClick:t[5]||(t[5]=l=>b(90))},{default:u(()=>[h(" Rotate Right")]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),_e=W(fe,[["__scopeId","data-v-1b1ef616"]]);export{_e as default};
