import{d as B,aD as M,q as g,y as O,v as m,o as U,j as $,a as d,Z as L,b7 as H,b8 as z,aC as q,p as F,D as Z,u as G,aH as X,b9 as Y,l as J,a_ as K,a$ as u,ba as Q,aZ as W,aW as ee,a0 as te,c as ae,i as P,a2 as se,aO as oe,b as v,a9 as ne,an as le,ao as ie,ap as re}from"./index-CWD4-L5g.js";import{g as p}from"./index-ZORhgBxb.js";const de=B({__name:"Dialog",props:{show:Boolean},emits:["update:show"],setup(o,{emit:k}){const f=o,h=k,c=M(f).show,n=g(c.value),r=g(),w=g();return O(()=>{r.value.addEventListener("click",a=>{!a.target||a.target instanceof HTMLElement&&!a.target.closest(".action-button")&&a.target.nodeName!=="DIALOG"||(n.value=!1)}),document.addEventListener("keydown",a=>{n.value&&a.key==="Escape"&&(a.preventDefault(),a.stopImmediatePropagation(),n.value=!1)},{passive:!1})}),m(c,()=>n.value=c.value),m(n,()=>{n.value?r.value.showModal():(r.value.setAttribute("closing",""),r.value.addEventListener("animationend",()=>{r.value.removeAttribute("closing"),r.value.close()},{once:!0})),h("update:show",n.value)}),(a,l)=>(U(),$(z,{to:"body"},[d("dialog",{ref_key:"dialogRef",ref:r,class:"modal"},[d("div",L({ref_key:"dialogContentRef",ref:w},a.$attrs,{class:"flex flex-col items-center justify-center w-full h-full p-5 backdrop-blur-sm"}),[H(a.$slots,"default")],16)],512)]))}}),ce=o=>(le("data-v-bd381fdb"),o=o(),ie(),o),ue=["height","width"],ge={class:"w-full h-full"},fe={class:"flex flex-col items-center justify-around"},ve={class:"flex items-center justify-between w-full my-1"},pe=ce(()=>d("span",{class:"mr-1 text-slate-100"},"Heading style",-1)),me={class:"w-40"};var j=(o=>(o.NORTH_UP="North Up",o.HEAD_UP="Head Up",o))(j||{});const he=B({__name:"Compass",props:{widget:{}},setup(o){const k=q();F.registerUsage(Z.heading);const f=G(),h=g(),c=g(),n=g(),r={0:"N",45:"NE",90:"E",135:"SE",180:"S",225:"SW",270:"W",315:"NW"},w=Object.values(j),l=M(o).widget;X(()=>{Object.keys(l.value.options).length===0&&(l.value.options={headingStyle:w[0]})}),O(()=>{V(),N()});const{width:T,height:C}=Y(h),y=J(()=>T.value<C.value?T.value:C.value),N=()=>{if(c.value===void 0||c.value===null)return;n.value===void 0&&(n.value=c.value.getContext("2d"));const e=n.value;K(e);const t=.5*y.value,i=.13*y.value,D=.03*t;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${i}px Arial`,e.fillStyle="white",e.lineWidth=D,e.textBaseline="middle";const A=.7*t,R=.4*t,E=.55*t;e.translate(t,t),e.font=`bold ${i}px Arial`,e.fillText(`${s.yawAngleDegrees.toFixed(0)}Â°`,.15*i,0),e.rotate(u(-90)),l.value.options.headingStyle=="Head Up"&&e.rotate(u(s.yawAngleDegrees));for(const[x,I]of Object.entries(r))e.save(),e.rotate(u(Number(x))),e.beginPath(),e.moveTo(E,0),e.lineTo(A,0),e.textBaseline="bottom",e.font=`bold ${.7*i}px Arial`,e.translate(A*1.025,0),e.rotate(u(90)),e.fillText(I,0,0),e.stroke(),e.restore();for(const x of Q(360))x%9===0&&(e.save(),e.lineWidth=.25*D,e.rotate(u(Number(x))),e.beginPath(),e.moveTo(1.1*E,0),e.lineTo(A,0),e.stroke(),e.restore());e.beginPath(),e.arc(0,0,A,0,u(360)),e.stroke(),l.value.options.headingStyle=="North Up"?e.rotate(u(s.yawAngleDegrees)):e.rotate(-u(s.yawAngleDegrees)),e.beginPath(),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red";const S=.05*t;e.moveTo(R,S),e.lineTo(E-.5*S,0),e.lineTo(R,-S),e.lineTo(R,S),e.closePath(),e.fill(),e.stroke()},b=g(.01);let _;m(f.attitude,e=>{if(_===void 0){b.value=W(f.attitude.yaw),_=e.yaw;return}Math.abs(W(e.yaw-_))>.1&&(_=e.yaw,b.value=W(f.attitude.yaw))});const s=ee({yawAngleDegrees:0}),V=()=>{const e=b.value,t=e<0?e+360:e,i=s.yawAngleDegrees>270&&t<90,D=s.yawAngleDegrees<90&&t>270;i?(p.to(s,.05,{yawAngleDegrees:0}),p.fromTo(s,.05,{yawAngleDegrees:0},{yawAngleDegrees:t})):D?(p.to(s,.05,{yawAngleDegrees:360}),p.fromTo(s,.05,{yawAngleDegrees:360},{yawAngleDegrees:t})):p.to(s,.1,{yawAngleDegrees:t})};return m(b,()=>V()),m([s,T,C],()=>{k.isWidgetVisible(l.value)&&te(()=>N())}),(e,t)=>(U(),ae(ne,null,[d("div",{ref_key:"compassRoot",ref:h,class:"compass"},[d("canvas",{ref_key:"canvasRef",ref:c,height:y.value,width:y.value,class:"rounded-[15%] bg-slate-950/70"},null,8,ue)],512),P(de,{show:v(l).managerVars.configMenuOpen,"onUpdate:show":t[1]||(t[1]=i=>v(l).managerVars.configMenuOpen=i),class:"w-72"},{default:se(()=>[d("div",ge,[d("div",fe,[d("div",ve,[pe,d("div",me,[P(oe,{modelValue:v(l).options.headingStyle,"onUpdate:modelValue":t[0]||(t[0]=i=>v(l).options.headingStyle=i),options:v(w)},null,8,["modelValue","options"])])])])])]),_:1},8,["show"])],64))}}),be=re(he,[["__scopeId","data-v-bd381fdb"]]);export{be as default};
