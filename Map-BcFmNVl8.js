import{bd as Te,be as Ee,bf as Ae,bg as W,f as Ve,bh as de,bi as Oe,bj as De,c as He,b7 as Le,S as Ne,J as _e,P as Re,u as ze,ab as Ue,r as f,k as R,K as ve,L as me,W as $e,bk as v,j as Fe,w as b,o as Pe,bl as y,Z as Be,bm as Xe,as as We,bn as Ye,bo as fe,ap as Ge,Q as Ze,l as O,m as pe,n as Y,q as ge,T as he,H as z,x as be,s as u,am as D,a6 as G,v as N,a4 as ye,G as U,$ as Z,ad as je,ae as qe,a0 as Ke,af as Je,ax as Qe,a7 as eo,bp as oo,F as to,z as ao,B as no,E as io}from"./index-Cqkq84yU.js";function ke(n,c){if(n==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var i in c)Object.prototype.hasOwnProperty.call(c,i)&&(n[i]=c[i]);return n}function lo(n){return ke({},n)}var Me=1440,so=2520,ne=43200,ro=86400;function uo(n,c,i){var E,g;Te(2,arguments);var s=De(),l=(E=(g=i==null?void 0:i.locale)!==null&&g!==void 0?g:s.locale)!==null&&E!==void 0?E:Ee;if(!l.formatDistance)throw new RangeError("locale must contain formatDistance property");var o=Ae(n,c);if(isNaN(o))throw new RangeError("Invalid time value");var r=ke(lo(i),{addSuffix:!!(i!=null&&i.addSuffix),comparison:o}),M,m;o>0?(M=W(c),m=W(n)):(M=W(n),m=W(c));var k=Ve(m,M),w=(de(m)-de(M))/1e3,d=Math.round((k-w)/60),x;if(d<2)return i!=null&&i.includeSeconds?k<5?l.formatDistance("lessThanXSeconds",5,r):k<10?l.formatDistance("lessThanXSeconds",10,r):k<20?l.formatDistance("lessThanXSeconds",20,r):k<40?l.formatDistance("halfAMinute",0,r):k<60?l.formatDistance("lessThanXMinutes",1,r):l.formatDistance("xMinutes",1,r):d===0?l.formatDistance("lessThanXMinutes",1,r):l.formatDistance("xMinutes",d,r);if(d<45)return l.formatDistance("xMinutes",d,r);if(d<90)return l.formatDistance("aboutXHours",1,r);if(d<Me){var j=Math.round(d/60);return l.formatDistance("aboutXHours",j,r)}else{if(d<so)return l.formatDistance("xDays",1,r);if(d<ne){var $=Math.round(d/Me);return l.formatDistance("xDays",$,r)}else if(d<ro)return x=Math.round(d/ne),l.formatDistance("aboutXMonths",x,r)}if(x=Oe(m,M),x<12){var F=Math.round(d/ne);return l.formatDistance("xMonths",F,r)}else{var _=x%12,H=Math.floor(x/12);return _<3?l.formatDistance("aboutXYears",H,r):_<9?l.formatDistance("overXYears",H,r):l.formatDistance("almostXYears",H+1,r)}}function co(n,c){return Te(1,arguments),uo(n,Date.now(),c)}(function(n){let c;if(typeof define=="function"&&define.amd)define(["leaflet"],n);else if(typeof module=="object"&&typeof module.exports=="object")c=require("leaflet"),module.exports=n(c);else{if(typeof window.L>"u")throw"Leaflet must be loaded first";n(window.L)}})(function(n){const c=n.Marker.prototype._initIcon,i=n.Marker.prototype._setPos,E=n.DomUtil.TRANSFORM==="msTransform";n.Marker.addInitHook(function(){let s=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;s&&(s=s[0]+"px "+s[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||s||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(l){l.target._applyRotation()})}),n.Marker.include({_initIcon:function(){c.call(this)},_setPos:function(g){i.call(this,g),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[n.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,E?this._icon.style[n.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[n.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(g){return this.options.rotationAngle=g,this.update(),this},setRotationOrigin:function(g){return this.options.rotationOrigin=g,this.update(),this}})});const vo=""+new URL("blueboat-marker-DyHmCFOq.png",import.meta.url).href,mo=""+new URL("brov2-marker-CBzp11FX.png",import.meta.url).href,fo=""+new URL("generic-vehicle-marker-SovxT5Tc.png",import.meta.url).href,po=["id"],ho=He({__name:"Map",props:{widget:{}},setup(n){var ce;Le(e=>({"5346e721":Se.value}));const c=n,i=Ne(c).widget,E=_e(),{showDialog:g}=Re(),s=ze(),l=Ue(),o=f(),r=f(15),M=f([-27.5935,-48.55854]),m=f(),k=R(()=>`map-${i.value.hash}`),w=f(!1);ve.registerUsage(me.latitude),ve.registerUsage(me.longitude),$e(()=>{Object.keys(i.value.options).length===0&&(i.value.options={showVehiclePath:!0}),h.enableAutoUpdate()});const d=v.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"© OpenStreetMap"}),x=v.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri World Imagery"}),j={OpenStreetMap:d,"Esri World Imagery":x},$=f(),F=Fe($),_=v.control.zoom({position:"bottomright"}),H=v.control.layers(j);b(w,()=>{o.value!==void 0&&(w.value?(o.value.addControl(_),o.value.addControl(H)):(o.value.removeControl(_),o.value.removeControl(H)))}),b(F,()=>{w.value=F.value}),Pe(async()=>{o.value=v.map(k.value,{layers:[d,x],attributionControl:!1}).setView(M.value,r.value),o.value.removeControl(o.value.zoomControl),o.value.on("moveend",()=>{if(o.value===void 0)return;let{lat:e,lng:t}=o.value.getCenter();e&&t&&(M.value=[e,t])}),o.value.on("zoomend",()=>{var e;o.value!==void 0&&(r.value=((e=o.value)==null?void 0:e.getZoom())??M.value)}),o.value.on("click",()=>{o.value!==void 0&&o.value.on("click",se)}),o.value.on("contextmenu",()=>{re()}),h.enableAutoUpdate(),window.addEventListener("keydown",ue),p.value?h.goToTarget(y.VEHICLE):h.goToTarget(y.HOME)}),Be(()=>{h.disableAutoUpdate(),window.removeEventListener("keydown",ue),o.value&&(o.value.off("click",se),o.value.off("contextmenu"))}),b(M,(e,t)=>{var a,T,S;e.toString()!==t.toString()&&((a=o.value)==null||a.panTo(e),(S=(T=A.value)==null?void 0:T.getTooltip())==null||S.setContent(`Home: ${e[0].toFixed(6)}, ${e[1].toFixed(6)}`))}),b(o,(e,t)=>{o.value!==void 0&&(e==null?void 0:e.options)===void 0&&(o.value=t)}),b(r,(e,t)=>{var a;e!==t&&((a=o.value)==null||a.setZoom(r.value))}),b(c.widget,()=>{var e;(e=o.value)==null||e.invalidateSize()});const P=f(void 0),h=new Xe(e=>P.value=e,e=>M.value=e);h.setTrackableTarget(y.VEHICLE,()=>p.value),h.setTrackableTarget(y.HOME,()=>m.value);const p=R(()=>s.coordinates.latitude?[s.coordinates.latitude,s.coordinates.longitude]:void 0),q=R(()=>{var e;return s.attitude.yaw?We((e=s.attitude)==null?void 0:e.yaw):0}),ie=R(()=>{const e=s.lastHeartbeat;return e?`${co(e??0,{includeSeconds:!0})} ago`:"never"}),{history:we}=Ye(p);(ce=navigator==null?void 0:navigator.geolocation)==null||ce.watchPosition(e=>m.value=[e.coords.latitude,e.coords.longitude],e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let le=!0;b([m,o],async()=>{m.value===M.value||!o.value||!le||(h.goToTarget(y.HOME),le=!1)});const I=f();b(s.coordinates,()=>{if(!(!o.value||!p.value)){if(I.value===void 0){I.value=v.marker(p.value);let e=fo;s.vehicleType===fe.MAV_TYPE_SURFACE_BOAT?e=vo:s.vehicleType===fe.MAV_TYPE_SUBMARINE&&(e=mo);const t=new v.Icon({iconUrl:e,iconSize:[64,64],iconAnchor:[32,32]});I.value.setIcon(t);const a=v.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[64,-12]});I.value.bindTooltip(a),o.value.addLayer(I.value)}I.value.setLatLng(p.value)}}),b(p,()=>{P.value===y.VEHICLE||p.value===void 0||h.follow(y.VEHICLE)}),b([p,q,ie,()=>s.isArmed],()=>{var e,t,a,T;I.value!==void 0&&((T=I.value.getTooltip())==null||T.setContent(`
    <p>Coordinates: ${(e=p.value)==null?void 0:e[0].toFixed(6)}, ${(t=p.value)==null?void 0:t[1].toFixed(6)}</p>
    <p>Velocity: ${((a=s.velocity.ground)==null?void 0:a.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${q.value.toFixed(2)}°</p>
    <p>${s.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${ie.value}</p>
  `),I.value.setRotationAngle(q.value))});const A=f();b(m,()=>{if(o.value===void 0)return;const e=m.value;if(e!==void 0){if(A.value===void 0){A.value=v.marker(e);const t=v.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16],html:"H"});A.value.setIcon(t);const a=v.tooltip({content:"No data available",className:"waypoint-tooltip"});A.value.bindTooltip(a),o.value.addLayer(A.value)}A.value.setLatLng(m.value)}});const K=f();b(l.currentPlanningWaypoints,e=>{if(o.value!==void 0){if(K.value===void 0){const t=e.map(a=>a.coordinates);K.value=v.polyline(t,{color:"#358AC3"}).addTo(o.value)}K.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,a)=>{var C;const T=v.marker(t.coordinates),S=v.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16],html:`${a}`});T.setIcon(S),(C=o.value)==null||C.addLayer(T)})}});const J=f();b(we,e=>{if(o.value===void 0||e===void 0)return;J.value===void 0&&(J.value=v.polyline([],{color:"#358AC3"}).addTo(o.value));const t=e.filter(a=>a.snapshot!==void 0).map(a=>a.snapshot);J.value.setLatLngs(t)});const B=f(!1),L=f(null),X=Ge({top:"0px",left:"0px"}),V=f(),se=e=>{var t,a,T,S;if(V.value!==void 0&&o.value!==void 0&&((t=V.value)==null||t.removeFrom(o.value)),((a=e==null?void 0:e.latlng)==null?void 0:a.lat)!=null&&((T=e==null?void 0:e.latlng)==null?void 0:T.lng)!=null){L.value=[e.latlng.lat,e.latlng.lng],B.value=!0;const C=(S=o.value)==null?void 0:S.getContainer();if(C){const{x:te,y:ae}=C.getBoundingClientRect();X.left=`${e.originalEvent.clientX-te}px`,X.top=`${e.originalEvent.clientY-ae}px`}}else console.error("Invalid event structure:",e);if(o.value!==void 0){V.value=v.marker(L.value);const C=v.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16]});V.value.setIcon(C),o.value.addLayer(V.value)}},xe=e=>{switch(e){case"goto":if(L.value){const C=s.coordinates.altitude??0,te=L.value[0],ae=L.value[1];ao(()=>{s.goTo(0,0,0,0,te,ae,C)},{command:"GoTo"},no(io.GOTO))}break;default:console.warn("Unknown menu option selected:",e)}B.value=!1},re=()=>{B.value=!1,L.value=null,o.value!==void 0&&V.value!==void 0&&o.value.removeLayer(V.value)},ue=e=>{e.key==="Escape"&&re()},Q=f(!1),ee=f(0),Ie=async()=>{for(Q.value=!0,ee.value=0;l.currentPlanningWaypoints.length>0;)l.currentPlanningWaypoints.pop();const e=async t=>{ee.value=t};try{(await s.fetchMission(e)).forEach(a=>{l.currentPlanningWaypoints.push(a),g({variant:"success",message:"Mission download succeed!",timer:2e3})})}catch(t){g({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{Q.value=!1}},Ce=()=>{s.startMission()},oe=Ze(),Se=R(()=>`${Math.max(-oe.widgetClearanceForVisibleArea(i.value).bottom,0)}px`);return(e,t)=>(O(),pe(to,null,[Y("div",{ref_key:"mapBase",ref:$,class:"page-base"},[Y("div",{id:k.value,ref_key:"map",ref:o,class:"map"},[w.value?ge((O(),z(G,{key:0,class:be(["absolute left-0 m-3 bottom-button bg-slate-50",m.value?"":"active-events-on-disabled"]),color:P.value==u(y).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-map-marker",size:"x-small",disabled:!m.value,onClick:t[0]||(t[0]=D(a=>u(h).goToTarget(u(y).HOME,!0),["stop"])),onDblclick:t[1]||(t[1]=D(a=>u(h).follow(u(y).HOME),["stop"]))},null,8,["class","color","disabled"])),[[he,m.value?"Center map on home position.":"Home position is currently undefined."]]):N("",!0),w.value?ge((O(),z(G,{key:1,class:be(["absolute m-3 bottom-button left-10 bg-slate-50",p.value?"":"active-events-on-disabled"]),color:P.value==u(y).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!p.value,onClick:t[2]||(t[2]=D(a=>u(h).goToTarget(u(y).VEHICLE,!0),["stop"])),onDblclick:t[3]||(t[3]=D(a=>u(h).follow(u(y).VEHICLE),["stop"]))},null,8,["class","color","disabled"])),[[he,p.value?"Center map on vehicle position.":"Vehicle position is currently undefined."]]):N("",!0),w.value?(O(),z(G,{key:2,class:"absolute m-3 bottom-button left-20 bg-slate-50",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:D(Ie,["stop"])})):N("",!0),w.value?(O(),z(G,{key:3,class:"absolute mb-3 ml-1 bottom-button left-32 bg-slate-50",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:D(Ce,["stop"])})):N("",!0)],8,po)],512),B.value?(O(),pe("div",{key:0,class:"context-menu",style:ye({top:X.top,left:X.left})},[Y("ul",{onClick:t[5]||(t[5]=D(()=>{},["stop"]))},[Y("li",{onClick:t[4]||(t[4]=a=>xe("goto"))},"GoTo")])],4)):N("",!0),U(eo,{modelValue:u(oe).widgetManagerVars(u(i).hash).configMenuOpen,"onUpdate:modelValue":t[7]||(t[7]=a=>u(oe).widgetManagerVars(u(i).hash).configMenuOpen=a),width:"auto"},{default:Z(()=>[U(je,{class:"pa-2",style:ye(u(E).globalGlassMenuStyles)},{default:Z(()=>[U(qe,{class:"text-center"},{default:Z(()=>[Ke("Map widget settings")]),_:1}),U(Je,null,{default:Z(()=>[U(Qe,{modelValue:u(i).options.showVehiclePath,"onUpdate:modelValue":t[6]||(t[6]=a=>u(i).options.showVehiclePath=a),class:"my-1",label:"Show vehicle path",color:u(i).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Q.value?(O(),z(oo,{key:1,"model-value":ee.value,height:"10",absolute:"",bottom:"",color:"white"},null,8,["model-value"])):N("",!0)],64))}});export{ho as default};
