import{bw as T,c as h,b9 as D,s as o,K as O,a8 as H,J as L,a9 as W,I as G,r as b,L as q,k as c,w as x,ac as J,ad as K,l as d,m,n as s,t as g,F as I,p as C,Q as y,G as r,N as f,V as Q,O as Y,P as X,R as Z,ah as R,a4 as $,a5 as F,W as _,_ as ee}from"./index-BBnA6cql.js";const te=T("v-banner-text"),ae={ref:"videoWidget",class:"video-widget"},le={key:0,class:"no-video-alert"},oe={key:1,class:"no-video-alert"},ne={key:2,class:"no-video-alert"},se={class:"no-video-alert"},ie={key:3,class:"no-video-alert"},re={class:"flex-wrap justify-center d-flex ga-5"},ue=h({__name:"VideoPlayer",props:{widget:{}},setup(M){D(l=>({"1dc7ed3a":o(a).options.videoFitStyle,"05151447":A.value}));const P=O(),i=H(),k=L(),{namessAvailableAbstractedStreams:u}=W(i),a=G(M).widget,n=b(),V=b(),v=b(),w=b(!1);q(()=>{const l={videoFitStyle:"cover",flipHorizontally:!1,flipVertically:!1,rotationAngle:0,internalStreamName:void 0};a.value.options=Object.assign({},l,a.value.options),n.value=a.value.options.internalStreamName});const p=c(()=>n.value?i.externalStreamId(n.value):void 0);x(()=>i.streamsCorrespondency,()=>{if(v.value=void 0,!n.value)return;const l=i.externalStreamId(n.value);if(!l)return;const e=i.streamsCorrespondency.find(S=>S.externalId===l);if(!e)return;const t=e.name;n.value!==t&&(n.value=t,a.value.options.internalStreamName=t)},{deep:!0});const U=setInterval(()=>{var l;if(a.value.options.internalStreamName===void 0&&!u.value.isEmpty()&&(a.value.options.internalStreamName=u.value[0],n.value=a.value.options.internalStreamName),p.value!==void 0){const e=i.getMediaStream(p.value);J(e,v.value)||(v.value=e);const t=((l=i.getStreamData(p.value))==null?void 0:l.connected)??!1;t!==w.value&&(w.value=t)}if(!u.value.isEmpty()&&!u.value.includes(n.value)){if(i.lastRenamedStreamName!==""){n.value=i.lastRenamedStreamName;return}n.value=u.value[0]}},1e3);K(()=>clearInterval(U)),x(n,()=>{a.value.options.internalStreamName=n.value,v.value=void 0}),x(v,()=>{!V.value||!v.value||(V.value.srcObject=v.value,V.value.play().then(()=>console.log("[VideoPlayer] Stream is playing")).catch(l=>{const e=`Failed to play stream. Reason: ${l}`;console.error(`[VideoPlayer] ${e}`)}))});const N=l=>{a.value.options.rotationAngle+=l},E=c(()=>`scale(${a.value.options.flipHorizontally?-1:1}, ${a.value.options.flipVertically?-1:1})`),j=c(()=>`rotate(${a.value.options.rotationAngle??0}deg)`),A=c(()=>`${E.value} ${j.value}`),z=c(()=>{var l;return p.value===void 0?"Unknown.":((l=i.getStreamData(p.value))==null?void 0:l.webRtcManager.signallerStatus)??"Unknown."}),B=c(()=>{var e;if(p.value===void 0)return"Unknown.";const l=i.availableIceIps;return!l.isEmpty()&&!l.find(t=>i.allowedIceIps.includes(t))?`Stream is coming from IPs [${l.join(", ")}], which are not in the list of allowed sources
      [${i.allowedIceIps.join(", ")}].\\n Please check your configuration.`:((e=i.getStreamData(p.value))==null?void 0:e.webRtcManager.streamStatus)??"Unknown."});return(l,e)=>(d(),m(I,null,[s("div",ae,[n.value===void 0?(d(),m("div",le,e[7]||(e[7]=[s("span",null,"No video stream selected.",-1)]))):!o(u).isEmpty()&&!o(u).includes(n.value)?(d(),m("div",oe,[s("p",null,'The selected stream "'+g(n.value)+'" is not available.',1),s("p",null,"Available ones are: "+g(o(u).map(t=>`"${t}"`).join(", "))+".",1),e[8]||(e[8]=s("br",null,null,-1)),e[9]||(e[9]=s("p",null," This can happen if you changed vehicles and the stream name in the new one is different from the former, or if the source is not available at all. ",-1)),e[10]||(e[10]=s("br",null,null,-1)),e[11]||(e[11]=s("p",null," Please open this video player configuration and select a new stream from the ones available, or check your source for issues. ",-1))])):w.value?(d(),m("div",ie,e[16]||(e[16]=[s("p",null,"Loading stream...",-1)]))):(d(),m("div",ne,[s("div",se,[s("p",null,[e[13]||(e[13]=s("span",{class:"text-xl font-bold"},"Server status: ",-1)),(d(!0),m(I,null,C(z.value.toString().split("\\n"),(t,S)=>(d(),m("span",{key:S},[y(g(t)+" ",1),e[12]||(e[12]=s("br",null,null,-1))]))),128))]),s("p",null,[e[15]||(e[15]=s("span",{class:"text-xl font-bold"},"Stream status: ",-1)),(d(!0),m(I,null,C(B.value.toString().split("\\n"),(t,S)=>(d(),m("span",{key:S},[y(g(t)+" ",1),e[14]||(e[14]=s("br",null,null,-1))]))),128))])])])),s("video",{id:"mainDisplayStream",ref_key:"videoElement",ref:V,muted:"",autoplay:"",playsinline:"",disablePictureInPicture:""}," Your browser does not support the video tag. ",512)],512),r(_,{modelValue:o(k).widgetManagerVars(o(a).hash).configMenuOpen,"onUpdate:modelValue":e[6]||(e[6]=t=>o(k).widgetManagerVars(o(a).hash).configMenuOpen=t),width:"auto"},{default:f(()=>[r(Q,{class:"pa-4 text-white",style:Y([{"border-radius":"15px"},o(P).globalGlassMenuStyles])},{default:f(()=>[r(X,{class:"text-center"},{default:f(()=>e[17]||(e[17]=[y("Video widget config")])),_:1}),r(Z,{class:"flex flex-col gap-y-4"},{default:f(()=>[r(R,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value=t),label:"Stream name",class:"my-3",items:o(u),"item-title":"name",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue","items"]),r(R,{modelValue:o(a).options.videoFitStyle,"onUpdate:modelValue":e[1]||(e[1]=t=>o(a).options.videoFitStyle=t),label:"Fit style",class:"my-3",items:["cover","fill","contain"],"item-title":"style",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue"]),r(te,null,{default:f(()=>[y('Saved stream name: "'+g(o(a).options.internalStreamName)+'"',1)]),_:1}),r($,{modelValue:o(a).options.flipHorizontally,"onUpdate:modelValue":e[2]||(e[2]=t=>o(a).options.flipHorizontally=t),class:"my-1",label:"Flip horizontally",color:o(a).options.flipHorizontally?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),r($,{modelValue:o(a).options.flipVertically,"onUpdate:modelValue":e[3]||(e[3]=t=>o(a).options.flipVertically=t),class:"my-1",label:"Flip vertically",color:o(a).options.flipVertically?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),s("div",re,[r(F,{"prepend-icon":"mdi-file-rotate-left",variant:"outlined",onClick:e[4]||(e[4]=t=>N(-90))},{default:f(()=>e[18]||(e[18]=[y(" Rotate Left")])),_:1}),r(F,{"prepend-icon":"mdi-file-rotate-right",variant:"outlined",onClick:e[5]||(e[5]=t=>N(90))},{default:f(()=>e[19]||(e[19]=[y(" Rotate Right")])),_:1})])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),ve=ee(ue,[["__scopeId","data-v-db1d9ab5"]]);export{ve as default};
