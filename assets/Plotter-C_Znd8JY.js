import{c as pe,R as me,e as ve,t as fe,r as C,W as be,o as Ve,aN as xe,aH as ce,aM as he,j as ge,c8 as we,h as W,w as L,ag as Me,aU as ke,aY as Se,a_ as ye,aX as Ce,m as R,n as E,q as i,z as o,p as d,E as s,V as Le,G as h,y as De,bN as D,a1 as g,as as Ye,a0 as m,af as X,a$ as K,P as Q,x as Z,J as Te,F as Ue,ac as _,_ as Fe}from"./index-rpQtpGrz.js";const Ie={key:0,class:"w-full h-full flex items-center justify-center text-center text-white text-h5 font-weight-bold p-4 overflow-hidden"},Ne={key:1,class:"main"},Pe=["width","height"],Oe={class:"py-2"},Ae={class:"flex flex-wrap gap-x-8 gap-y-2 py-2"},$e={class:"py-2"},ze={class:"flex flex-wrap gap-x-8 gap-y-2"},Be={class:"flex flex-wrap gap-x-6 py-2"},We={class:"flex items-center gap-x-4 py-2 mb-2"},Re={class:"flex w-full justify-end my-2"},Ee=pe({__name:"Plotter",props:{widget:{}},setup(ee){const w=me(),Y=ve(),a=fe(ee).widget,T=C([]);let M,U;be(()=>{const t={backgroundColor:"rgba(0, 0, 0, 0.7)",lineColor:"rgba(255, 0, 0, 1.0)",dataLakeVariableId:void 0,maxSamples:1e3,limitSamples:!0,lineThickness:1,decimalPlaces:2,showTitle:!0,updateOnConstantValue:!0,useFixedMinY:!1,useFixedMaxY:!1,fixedMinY:0,fixedMaxY:100,showCurrent:!0,showMin:!0,showMax:!0,showAvg:!0,showMedian:!0,showStdDev:!0};a.value.options={...t,...a.value.options}}),Ve(()=>{if(I(a.value.options.dataLakeVariableId),T.value=Object.values(xe()),U=ce(t=>{T.value=Object.values(t)}),n.length===0){const t=he(a.value.options.dataLakeVariableId);t&&j(t)}}),ge(()=>{U&&we(U),M&&_(a.value.options.dataLakeVariableId,M)});const ae=W(()=>T.value.filter(t=>t.type==="number")),F=C(""),f=C(!1);L(()=>a.value.options.dataLakeVariableId,()=>f.value=!1);const te=W(()=>{const t=(F.value||"").toLowerCase();return ae.value.filter(e=>e.name.toLowerCase().includes(t))}),H=()=>{a.value.options.limitSamples&&(n.length===a.value.options.maxSamples+1?n.shift():n.length>a.value.options.maxSamples&&n.splice(0,n.length-a.value.options.maxSamples))},j=t=>{n.push(t),H(),P()},I=(t,e)=>{if(t===void 0){console.error("No data lake variable ID provided!");return}e!==void 0&&M&&_(e,M),M=Me(t,l=>j(l),{notifyOnTimestampChange:a.value.options.updateOnConstantValue})};L(()=>a.value.options.dataLakeVariableId,(t,e)=>{I(t,e),n.length=0}),L(()=>a.value.options.updateOnConstantValue,()=>{const t=a.value.options.dataLakeVariableId;t&&I(t,t)});const{width:le,height:oe}=ke(),k=W(()=>({width:a.value.size.width*le.value,height:a.value.size.height*oe.value})),S=C(),N=C(),b=(t,e,l,r)=>{const v=t.measureText(e),u=4;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(l-u,r-16-u,v.width+u*2,16+u*2),t.fillStyle=a.value.options.lineColor,t.fillText(e,l,r)},P=()=>{if(S.value===void 0||S.value===null)return;if(N.value===void 0){console.debug("Canvas context undefined!"),N.value=S.value.getContext("2d");return}const t=N.value,e=k.value.width,l=k.value.height;Se(t),t.clearRect(0,0,e,l),t.fillStyle=a.value.options.backgroundColor,t.fillRect(0,0,e,l),t.strokeStyle=a.value.options.lineColor,t.lineWidth=Math.max(a.value.options.lineThickness,1);try{O=Math.max(...n),A=Math.min(...n),q=ie(n),$=J(n),G=ne(n,$);const r=a.value.options.useFixedMinY?a.value.options.fixedMinY:A,v=a.value.options.useFixedMaxY?a.value.options.fixedMaxY:O,u=.05*(v!=r?v-r:1),V=a.value.options.useFixedMinY?a.value.options.fixedMinY:r-u,z=a.value.options.useFixedMaxY?a.value.options.fixedMaxY:v+u,de=n[n.length-1];if(V<=0&&z>=0){const x=l-(0-V)/(z-V)*l;t.beginPath(),t.setLineDash([5,5]),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=1,t.moveTo(0,x),t.lineTo(e,x),t.stroke(),t.strokeStyle=a.value.options.lineColor,t.lineWidth=Math.max(a.value.options.lineThickness,1)}if(t.beginPath(),t.moveTo(0,l/2),t.setLineDash([]),n.length===0?(t.beginPath(),t.arc(0,l/2,7,0,2*Math.PI),t.stroke()):n.length===1?(t.fillStyle=a.value.options.lineColor,t.beginPath(),t.arc(0,l/2,7,0,2*Math.PI),t.fill(),t.beginPath(),t.setLineDash([5,5]),t.moveTo(0,l/2),t.lineTo(50,l/2),t.stroke()):(t.setLineDash([]),n.forEach((x,B)=>{const re=B*(e/n.length),ue=l-(x-V)/(z-V)*l;t.lineTo(re,ue)})),t.stroke(),t.font="14px monospace",t.textBaseline="bottom",a.value.options.showTitle&&a.value.options.dataLakeVariableId){const x=T.value.find(B=>B.id===a.value.options.dataLakeVariableId);x&&(b(t,x.name,10,26),t.textBaseline="bottom")}const c=a.value.options.decimalPlaces,y=20;let p=10;a.value.options.showStdDev&&(b(t,`Std Dev: ${Number(G).toFixed(c)}`,10,l-p),p+=y),a.value.options.showMax&&(b(t,`Max: ${Number(O).toFixed(c)}`,10,l-p),p+=y),a.value.options.showAvg&&(b(t,`Avg: ${Number($).toFixed(c)}`,10,l-p),p+=y),a.value.options.showMedian&&(b(t,`Median: ${Number(q).toFixed(c)}`,10,l-p),p+=y),a.value.options.showMin&&(b(t,`Min: ${Number(A).toFixed(c)}`,10,l-p),p+=y),a.value.options.showCurrent&&b(t,`Current: ${Number(de).toFixed(c)}`,10,l-p)}catch(r){console.error("Error drawing graph:",r)}},n=[];let O=0,A=0,q=0,$=0,G=0;const ie=t=>{if(t.length===0)return NaN;if(t.length===1)return t[0];const e=[...t].sort((r,v)=>r-v),l=Math.floor(e.length/2);return e.length%2===0?(e[l-1]+e[l])/2:e[l]},J=t=>t.length===0?NaN:t.reduce((e,l)=>e+l,0)/t.length,ne=(t,e)=>{if(t.length===0)return NaN;if(t.length===1)return 0;const l=e!==void 0?e:J(t),v=t.map(u=>Math.pow(u-l,2)).reduce((u,V)=>u+V,0)/t.length;return Math.sqrt(v)};L([k,a],()=>{Y.isWidgetVisible(a.value)&&(H(),ye(()=>P()))},{deep:!0});const se=Ce(S);return L(se,(t,e)=>{t&&!e&&P()}),(t,e)=>(E(),R(Ue,null,[o(a).options.dataLakeVariableId?(E(),R("div",Ne,[d("canvas",{ref_key:"canvasRef",ref:S,width:k.value.width,height:k.value.height},null,8,Pe)])):(E(),R("p",Ie," Please open the Plotter widget configuration menu to select a variable to be plotted. ")),i(Te,{modelValue:o(Y).widgetManagerVars(o(a).hash).configMenuOpen,"onUpdate:modelValue":e[25]||(e[25]=l=>o(Y).widgetManagerVars(o(a).hash).configMenuOpen=l),title:"Plotter config",variant:"text-only"},{content:s(()=>[d("div",{class:De(["max-h-[85vh] overflow-y-auto -mr-2 -mt-12",o(w).isOnSmallScreen?"max-w-[85vw]":"max-w-[50vw]"])},[i(D,{"no-top-divider":"","no-bottom-divider":"","is-expanded":"",compact:""},{title:s(()=>e[26]||(e[26]=[h("Data Source")])),content:s(()=>[d("div",Oe,[i(g,{modelValue:F.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>F.value=l),e[1]||(e[1]=l=>f.value=!0)],density:"compact",variant:"filled",theme:"dark",type:"text",placeholder:"Search variables...",class:"mb-4",clearable:"","onClick:clear":e[2]||(e[2]=l=>f.value=!1),"onUpdate:focused":e[3]||(e[3]=l=>f.value=l)},null,8,["modelValue"]),i(Ye,{modelValue:o(a).options.dataLakeVariableId,"onUpdate:modelValue":e[4]||(e[4]=l=>o(a).options.dataLakeVariableId=l),items:te.value,"item-title":"name","item-value":"id",label:"Data Lake variable",hint:"Select a variable to be plotted","persistent-hint":"",theme:"dark",variant:"outlined",density:"comfortable","menu-props":{modelValue:f.value},onClick:e[5]||(e[5]=l=>f.value=!f.value)},null,8,["modelValue","items","menu-props"])])]),_:1}),i(D,{"no-top-divider":"","no-bottom-divider":"",compact:"","is-expanded":!o(w).isOnSmallScreen},{title:s(()=>e[27]||(e[27]=[h("Appearance")])),content:s(()=>[d("div",Ae,[i(m,{modelValue:o(a).options.showTitle,"onUpdate:modelValue":e[6]||(e[6]=l=>o(a).options.showTitle=l),label:"Show title","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(X,{"close-on-content-click":!1},{activator:s(({props:l})=>[d("div",Q(l,{class:"flex cursor-pointer"}),[e[28]||(e[28]=d("span",{class:"mt-3"},"Background color",-1)),d("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:Z({backgroundColor:o(a).options.backgroundColor})},null,4)],16)]),default:s(()=>[i(K,{modelValue:o(a).options.backgroundColor,"onUpdate:modelValue":e[7]||(e[7]=l=>o(a).options.backgroundColor=l),label:"Background","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),i(X,{"close-on-content-click":!1},{activator:s(({props:l})=>[d("div",Q(l,{class:"flex cursor-pointer"}),[e[29]||(e[29]=d("span",{class:"mt-3"},"Line color",-1)),d("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:Z({backgroundColor:o(a).options.lineColor})},null,4)],16)]),default:s(()=>[i(K,{modelValue:o(a).options.lineColor,"onUpdate:modelValue":e[8]||(e[8]=l=>o(a).options.lineColor=l),label:"Line","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),i(g,{modelValue:o(a).options.lineThickness,"onUpdate:modelValue":e[9]||(e[9]=l=>o(a).options.lineThickness=l),modelModifiers:{number:!0},type:"number",label:"Line thickness",variant:"outlined",density:"compact",rules:[l=>l>0||"Must be greater than 0"],width:"140px","hide-details":""},null,8,["modelValue","rules"])])]),_:1},8,["is-expanded"]),i(D,{"no-top-divider":"","no-bottom-divider":"",compact:"","is-expanded":!o(w).isOnSmallScreen},{title:s(()=>e[30]||(e[30]=[h("Data Points")])),content:s(()=>[d("div",$e,[d("div",ze,[i(g,{modelValue:o(a).options.decimalPlaces,"onUpdate:modelValue":e[10]||(e[10]=l=>o(a).options.decimalPlaces=l),modelModifiers:{number:!0},type:"number",label:"Decimal places",variant:"outlined",density:"comfortable",rules:[l=>l>=0||"Must be 0 or greater"],hint:"Number of decimal places to be displayed",width:"100px"},null,8,["modelValue","rules"]),i(m,{modelValue:o(a).options.limitSamples,"onUpdate:modelValue":e[11]||(e[11]=l=>o(a).options.limitSamples=l),label:"Limit number of samples"},null,8,["modelValue"]),i(g,{modelValue:o(a).options.maxSamples,"onUpdate:modelValue":e[12]||(e[12]=l=>o(a).options.maxSamples=l),modelModifiers:{number:!0},type:"number",label:"Maximum samples",variant:"outlined",density:"comfortable",disabled:!o(a).options.limitSamples,rules:[l=>l>0||"Must be greater than 0"],hint:"Higher values will show more history but may impact performance",width:"150px"},null,8,["modelValue","disabled","rules"])]),i(m,{modelValue:o(a).options.updateOnConstantValue,"onUpdate:modelValue":e[13]||(e[13]=l=>o(a).options.updateOnConstantValue=l),label:"Update on constant value",hint:"Advance graph when value is unchanged (shows horizontal lines for constant values)","persistent-hint":""},null,8,["modelValue"])])]),_:1},8,["is-expanded"]),i(D,{"no-top-divider":"","no-bottom-divider":"",compact:"","is-expanded":!o(w).isOnSmallScreen},{title:s(()=>e[31]||(e[31]=[h("Statistics Display")])),content:s(()=>[d("div",Be,[i(m,{modelValue:o(a).options.showCurrent,"onUpdate:modelValue":e[14]||(e[14]=l=>o(a).options.showCurrent=l),label:"Current","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(m,{modelValue:o(a).options.showMin,"onUpdate:modelValue":e[15]||(e[15]=l=>o(a).options.showMin=l),label:"Min","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(m,{modelValue:o(a).options.showMedian,"onUpdate:modelValue":e[16]||(e[16]=l=>o(a).options.showMedian=l),label:"Median","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(m,{modelValue:o(a).options.showAvg,"onUpdate:modelValue":e[17]||(e[17]=l=>o(a).options.showAvg=l),label:"Avg","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(m,{modelValue:o(a).options.showMax,"onUpdate:modelValue":e[18]||(e[18]=l=>o(a).options.showMax=l),label:"Max","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(m,{modelValue:o(a).options.showStdDev,"onUpdate:modelValue":e[19]||(e[19]=l=>o(a).options.showStdDev=l),label:"Std Dev","hide-details":"",class:"-mt-1"},null,8,["modelValue"])])]),_:1},8,["is-expanded"]),i(D,{"no-top-divider":"","no-bottom-divider":"",compact:"","is-expanded":!o(w).isOnSmallScreen},{title:s(()=>e[32]||(e[32]=[h("Vertical Range")])),content:s(()=>[d("div",We,[i(m,{modelValue:o(a).options.useFixedMinY,"onUpdate:modelValue":e[20]||(e[20]=l=>o(a).options.useFixedMinY=l),label:"Fixed minimum","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(g,{modelValue:o(a).options.fixedMinY,"onUpdate:modelValue":e[21]||(e[21]=l=>o(a).options.fixedMinY=l),modelModifiers:{number:!0},type:"number",label:"Min value",variant:"outlined",density:"compact",disabled:!o(a).options.useFixedMinY,width:"100px","hide-details":""},null,8,["modelValue","disabled"]),e[33]||(e[33]=d("div",{class:"h-12 border-l border-slate-500"},null,-1)),i(m,{modelValue:o(a).options.useFixedMaxY,"onUpdate:modelValue":e[22]||(e[22]=l=>o(a).options.useFixedMaxY=l),label:"Fixed maximum","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(g,{modelValue:o(a).options.fixedMaxY,"onUpdate:modelValue":e[23]||(e[23]=l=>o(a).options.fixedMaxY=l),modelModifiers:{number:!0},type:"number",label:"Max value",variant:"outlined",density:"compact",disabled:!o(a).options.useFixedMaxY,width:"100px","hide-details":""},null,8,["modelValue","disabled"])])]),_:1},8,["is-expanded"])],2)]),actions:s(()=>[d("div",Re,[i(Le,{onClick:e[24]||(e[24]=l=>o(Y).widgetManagerVars(o(a).hash).configMenuOpen=!1)},{default:s(()=>e[34]||(e[34]=[h("Close")])),_:1,__:[34]})])]),_:1},8,["modelValue"])],64))}}),qe=Fe(Ee,[["__scopeId","data-v-8c996bd1"]]);export{qe as default};
