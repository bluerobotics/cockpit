import{c as ee,bs as te,bt as se,bu as ne,K as oe,y as ae,J as le,r as x,k as F,L as re,o as ie,ae as ue,D as de,l as H,m as N,n as i,H as t,N as s,V as ce,O as V,q as h,af as b,Q as c,P as fe,R as pe,b5 as me,s as ge,bv as he,a6 as w,W as ve,F as xe,bw as we,bx as v,by as k,_ as Ce}from"./index-CT9iBj1f.js";import{V as ye,a as U,b as A,c as D}from"./VExpansionPanels-qM2JPtod.js";function Ve(d){return new Worker(""+new URL("css.worker-Xlwe2hWs.js",import.meta.url).href,{name:d==null?void 0:d.name})}function be(d){return new Worker(""+new URL("html.worker-BvRU5B8F.js",import.meta.url).href,{name:d==null?void 0:d.name})}function ke(d){return new Worker(""+new URL("json.worker-CpyesD6f.js",import.meta.url).href,{name:d==null?void 0:d.name})}const je={class:"main"},Ee=["innerHTML"],Se={key:0,class:"help-panel mb-4 p-4 rounded bg-white/5"},_e={class:"flex justify-between items-center px-4 w-full h-full"},We={class:"flex gap-x-3"},z=50,Me=ee({__name:"DoItYourself",props:{widget:{}},setup(d){te(l=>({"0e363850":y.value})),self.MonacoEnvironment={getWorker(l,e){return e==="json"?new ke:e==="css"||e==="scss"||e==="less"?new Ve:e==="html"||e==="handlebars"||e==="razor"?new be:e==="typescript"||e==="javascript"?new se:new ne}};const I=oe(),j=ae(),r=le(d).widget,E=x(null),S=x(null),_=x(null),W=x(!1),M=x(["html","css","js"]);let n=null,o=null,a=null;const p={html:`<!-- Write your HTML code here -->
<div id="diy-container">
  <span>Create your own widget!</span>
</div>`,css:`/* Write your CSS code here */
#diy-container {
  width: 100%;
  height: 100%;
  padding: 1rem;
  background-color: white;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  text-align: center;
  font-family: 'Roboto', sans-serif;
  font-weight: 500;
}`,js:`// Write your JavaScript code here
document.addEventListener('DOMContentLoaded', () => {
  // Your code here
});`},P=F(()=>{const l=r.value.options.html||p.html,e=r.value.options.css||p.css,u=r.value.options.js||p.js;return`${l}
<style>
${e}
</style>
<script>
${u}
<\/script>`}),L=(l,e,u)=>we.create(l,{value:u,language:e,theme:"vs-dark",minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0,tabSize:2,wordWrap:"on",padding:{top:12,bottom:12}}),T=l=>{l.addCommand(v.CtrlCmd|k.Enter,()=>C()),l.addCommand(v.CtrlCmd|k.KeyS,()=>C()),l.addCommand(v.CtrlCmd|v.Alt|k.UpArrow,()=>{n&&n.hasTextFocus()&&o?o.focus():a&&a.hasTextFocus()&&n?n.focus():o&&o.hasTextFocus()&&a&&a.focus()}),l.addCommand(v.CtrlCmd|v.Alt|k.DownArrow,()=>{n&&n.hasTextFocus()&&a?a.focus():a&&a.hasTextFocus()&&o?o.focus():o&&o.hasTextFocus()&&n&&n.focus()})},Y=async()=>{n||!E.value||a||!_.value||o||!S.value||(n=L(E.value,"html",r.value.options.html||p.html),a=L(_.value,"javascript",r.value.options.js||p.js),o=L(S.value,"css",r.value.options.css||p.css),n&&T(n),a&&T(a),o&&T(o))},J=async()=>{await Y()},K=async()=>{O()},C=()=>{!n||!o||!a||(r.value.options.html=n.getValue(),r.value.options.css=o.getValue(),r.value.options.js=a.getValue(),B())},B=()=>{var f;const l=r.value.options.js||"",e=`diy-script-${r.value.hash}`;(f=document.getElementById(e))==null||f.remove();const u=document.createElement("script");u.type="text/javascript",u.textContent=l,u.id=e,document.body.appendChild(u)},q=()=>{!n||!o||!a||(n.setValue(r.value.options.html||p.html),o.setValue(r.value.options.css||p.css),a.setValue(r.value.options.js||p.js))},O=()=>{n&&(n.dispose(),n=null),o&&(o.dispose(),o=null),a&&(a.dispose(),a=null)},G=()=>{j.widgetManagerVars(r.value.hash).configMenuOpen=!1,O()},Q=()=>{if(!n||!o||!a)return;const l={html:n.getValue(),css:o.getValue(),js:a.getValue()},e=JSON.stringify(l,null,2),u=new Blob([e],{type:"application/json"}),f=URL.createObjectURL(u),m=document.createElement("a");m.href=f,m.download="diy-widget-config.json",document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(f)},X=()=>{const l=document.createElement("input");l.type="file",l.onchange=e=>{const u=e.target;if(!u.files||!u.files[0]||!n||!o||!a)return;const f=u.files[0],m=new FileReader;m.onload=Z=>{var $;try{const R=($=Z.target)==null?void 0:$.result,g=JSON.parse(R);if(!g.html||!g.css||!g.js)throw new Error("Invalid configuration file");n&&n.setValue(g.html),o&&o.setValue(g.css),a&&a.setValue(g.js),C()}catch(R){console.error("Error importing configuration:",R),alert("Invalid configuration file")}},m.readAsText(f)},document.body.appendChild(l),l.click(),document.body.removeChild(l)},y=F(()=>{const l=M.value.length;return l===0?`${z}vh`:`${Math.round(z/l)}vh`});return re(()=>{r.value.options=Object.assign({},p,r.value.options)}),ie(()=>{B()}),ue(()=>{O()}),(l,e)=>{const u=de("vue-draggable-resizable");return H(),N(xe,null,[i("div",je,[i("div",{class:"w-full h-full",innerHTML:P.value},null,8,Ee)]),t(ve,{modelValue:h(j).widgetManagerVars(h(r).hash).configMenuOpen,"onUpdate:modelValue":e[2]||(e[2]=f=>h(j).widgetManagerVars(h(r).hash).configMenuOpen=f),"max-width":h(I).isOnSmallScreen?"100%":"800px",onAfterEnter:J,onAfterLeave:K},{default:s(()=>[t(u,{"drag-handle":".drag-handle",w:"auto",h:"auto",handles:["tm","mr","bm","ml"]},{default:s(()=>[t(ce,{class:"pa-2",style:V(h(I).globalGlassMenuStyles)},{default:s(()=>[t(b,{class:"drag-handle absolute top-[12px] left-[12px] cursor-grab"},{default:s(()=>e[3]||(e[3]=[c("mdi-drag")])),_:1}),t(b,{class:"absolute top-[12px] right-[12px] cursor-pointer",onClick:e[0]||(e[0]=f=>W.value=!W.value)},{default:s(()=>e[4]||(e[4]=[c(" mdi-help-circle-outline ")])),_:1}),t(fe,{class:"w-full text-center mt-2 mb-2"},{default:s(()=>e[5]||(e[5]=[c("DIY widget configuration")])),_:1}),t(pe,{class:"mx-2 flex flex-col gap-y-3"},{default:s(()=>[t(me,null,{default:s(()=>[W.value?(H(),N("div",Se,e[6]||(e[6]=[i("h3",{class:"text-lg mb-2"},"Editor instructions",-1),i("ul",{class:"text-sm text-white/70 list-disc pl-4 space-y-1"},[i("li",null,"Use the HTML, CSS, and JS editors to create your custom widget"),i("li",null,"Changes are applied when you click Apply or press Cmd/Ctrl + Enter/S"),i("li",null,"Navigate between editors using Cmd/Ctrl + Option/Alt + ↑/↓"),i("li",null,"Reset to last saved state using the Reset button"),i("li",null,"Your code runs in the widget's context and has access to the DOM"),i("li",null,"You can use the console to debug your code"),i("li",null," You can use the data-lake system to inject or consume data from Cockpit. Check the docs for more information around this. "),i("li",null,"Click on each editor's header to expand it to full size")],-1)]))):ge("",!0)]),_:1}),t(ye,{modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=f=>M.value=f),class:"editors-container",multiple:""},{default:s(()=>[t(U,{value:"html"},{default:s(()=>[t(A,{static:"",height:"36px",class:"text-white/60"},{default:s(()=>e[7]||(e[7]=[c(" HTML ")])),_:1}),t(D,{eager:""},{default:s(()=>[i("div",{ref_key:"htmlEditorContainer",ref:E,class:"editor-container",style:V({height:y.value})},null,4)]),_:1})]),_:1}),t(U,{value:"js"},{default:s(()=>[t(A,{static:"",height:"36px",class:"text-white/60"},{default:s(()=>e[8]||(e[8]=[c(" JS ")])),_:1}),t(D,{eager:""},{default:s(()=>[i("div",{ref_key:"jsEditorContainer",ref:_,class:"editor-container",style:V({height:y.value})},null,4)]),_:1})]),_:1}),t(U,{value:"css"},{default:s(()=>[t(A,{static:"",height:"36px",class:"text-white/60"},{default:s(()=>e[9]||(e[9]=[c(" CSS ")])),_:1}),t(D,{eager:""},{default:s(()=>[i("div",{ref_key:"cssEditorContainer",ref:S,class:"editor-container",style:V({height:y.value})},null,4)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(he,null,{default:s(()=>[i("div",_e,[t(w,{class:"text-white/60",variant:"text",onClick:G},{default:s(()=>e[10]||(e[10]=[c("Close")])),_:1}),i("div",We,[t(w,{class:"text-white/60",variant:"text",title:"Export configuration",onClick:Q},{default:s(()=>[t(b,{class:"mr-1 mt-[2px]"},{default:s(()=>e[11]||(e[11]=[c("mdi-download")])),_:1}),e[12]||(e[12]=c(" Export "))]),_:1}),t(w,{class:"text-white/60 mr-10",variant:"text",title:"Import configuration",onClick:X},{default:s(()=>[t(b,{class:"mr-1 mt-[2px]"},{default:s(()=>e[13]||(e[13]=[c("mdi-upload")])),_:1}),e[14]||(e[14]=c(" Import "))]),_:1}),t(w,{class:"text-white/60",variant:"text",onClick:q},{default:s(()=>e[15]||(e[15]=[c("Reset")])),_:1}),t(w,{class:"text-white",variant:"text",onClick:C},{default:s(()=>e[16]||(e[16]=[c("Apply")])),_:1})])])]),_:1})]),_:1},8,["style"])]),_:1})]),_:1},8,["modelValue","max-width"])],64)}}}),Re=Ce(Me,[["__scopeId","data-v-8dfaa57b"]]);export{Re as default};
