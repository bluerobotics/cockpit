import{c as dt,K as vt,aq as mt,ax as Nt,r as c,k as E,w as y,aY as Ve,o as pt,ay as $,I as R,m as w,O as u,H as n,V as ft,N as ae,v as r,P as gt,n as Y,a7 as F,a6 as st,Q as D,R as ht,az as yt,l as W,F as xt,q as Ut,aA as Te,bO as Rt,a_ as Wt,x as Pe,t as De,S as it,s as U,U as Gt,aP as Zt,am as ze,bH as jt,W as bt,_ as kt,bD as Yt,J as qt,af as Kt,u as Qt,j as Jt,M as nt,Y as rt,L as Xt,bP as ea,bQ as Ce,bR as v,bS as C,al as ta,aU as aa,bT as oa,bU as la,bV as ct,bW as sa,bX as ia,bY as na,a0 as ra,y as ca,bj as ua,G as ut,a5 as ue,a$ as da,a8 as va,aG as te,a4 as Me,bZ as ma,ad as pa,b_ as fa,b$ as ga}from"./index-DYaVJi6Q.js";const ha={class:"flex justify-end"},ya={key:0,class:"fixed top-[80px] right-5"},xa={key:1,class:"flex w-full items-center"},ba={class:"flex justify-between w-full py-1 px-2 pt-3"},ka={class:"flex items-center"},wa=dt({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(Se,{emit:de}){const I=vt(),M=mt(),oe=Se,z=de,i=Nt("cockpit-pre-arm-checklist",[]),m=c({}),a=c(""),H=c(null),T=c(!1),x=E(()=>oe.modelValue),le=()=>{const f={};for(const l of i.value??[])f[l.id]=!1;m.value=f},L=E(()=>{if(!M.showChecklistBeforeArm)return!0;const f=i.value??[];return f.length>0&&f.every(l=>m.value[l.id]===!0)});y(()=>x.value,f=>{f?(le(),Ve(()=>{var l,d;return(d=(l=H.value)==null?void 0:l.focus)==null?void 0:d.call(l)})):(m.value={},T.value=!1)}),y(()=>i.value,f=>{if(!x.value)return;const l={...m.value},d={};for(const b of f??[])d[b.id]=!0,b.id in l||(l[b.id]=!1);for(const b of Object.keys(l)){const A=Number(b);d[A]||delete l[A]}m.value=l},{deep:!0});const q=async()=>{var d,b;const f=a.value.trim();if(!f)return;const l={id:Date.now(),text:f};i.value.push(l),x.value&&(m.value[l.id]=!1),a.value="",await Ve(),(b=(d=H.value)==null?void 0:d.focus)==null||b.call(d)},se=f=>{if(i.value=i.value.filter(l=>l.id!==f),f in m.value){const l={...m.value};delete l[f],m.value=l}},ie=()=>{z("dismissed"),z("update:modelValue",!1)},ne=()=>{z("confirmed",!0),z("update:modelValue",!1)};return pt(()=>{i.value.length===0&&(i.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),x.value&&le()}),y(()=>M.showChecklistBeforeArm,f=>{f||$({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(f,l)=>(w(),R(bt,{modelValue:x.value,"onUpdate:modelValue":l[4]||(l[4]=d=>x.value=d),"max-width":"600",scrollable:"",persistent:""},{default:u(()=>[n(ft,{style:ae(r(I).globalGlassMenuStyles),class:"rounded-lg"},{default:u(()=>[n(gt,{class:"text-center relative pt-3"},{default:u(()=>[l[6]||(l[6]=Y("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),n(F,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:ie},{default:u(()=>[n(st,null,{default:u(()=>l[5]||(l[5]=[D("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),n(ht,{class:"mt-[-10px]"},{default:u(()=>[n(yt,{lines:"one",theme:"dark",class:"bg-transparent"},{default:u(()=>[(w(!0),W(xt,null,Ut(r(i),d=>(w(),R(Te,{key:d.id,theme:"dark"},Rt({prepend:u(()=>[n(it,{modelValue:m.value[d.id],"onUpdate:modelValue":b=>m.value[d.id]=b,class:"mt-0","hide-details":"",density:"compact",disabled:!r(M).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:u(()=>[n(Wt,{class:Pe([{"line-through opacity-60":m.value[d.id]},{"opacity-50":!r(M).showChecklistBeforeArm}])},{default:u(()=>[D(De(d.text),1)]),_:2},1032,["class"])]),_:2},[T.value&&r(i).length>1?{name:"append",fn:u(()=>[n(F,{icon:"",variant:"text",disabled:!r(M).showChecklistBeforeArm,onClick:b=>se(d.id)},{default:u(()=>[n(st,null,{default:u(()=>l[7]||(l[7]=[D("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),Y("div",ha,[T.value?(w(),W("div",xa,[T.value?(w(),R(Gt,{key:0,ref_key:"newItemInput",ref:H,modelValue:a.value,"onUpdate:modelValue":l[1]||(l[1]=d=>a.value=d),disabled:!r(M).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:Zt(q,["enter"]),"onClick:appendInner":q},null,8,["modelValue","disabled"])):U("",!0),n(F,{"prepend-icon":"mdi-check",disabled:!r(M).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:l[2]||(l[2]=()=>{T.value=!1,q()})},{default:u(()=>l[9]||(l[9]=[D("Done")])),_:1,__:[9]},8,["disabled"])])):(w(),W("div",ya,[n(F,{"prepend-icon":"mdi-format-list-checks",disabled:!r(M).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:l[0]||(l[0]=d=>T.value=!0)},{default:u(()=>l[8]||(l[8]=[D(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),n(ze,{class:"flex center w-[80%]",inset:""}),n(jt,null,{default:u(()=>[Y("div",ba,[n(F,{variant:"text",onClick:ie},{default:u(()=>l[10]||(l[10]=[D("Cancel")])),_:1,__:[10]}),Y("div",ka,[n(it,{"model-value":!r(M).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":l[3]||(l[3]=d=>r(M).showChecklistBeforeArm=!d)},null,8,["model-value"]),l[11]||(l[11]=Y("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),n(F,{color:"#ffffff33",class:Pe({"opacity-30":!L.value}),variant:"flat",disabled:!L.value,onClick:ne},{default:u(()=>l[12]||(l[12]=[D("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),Ca=kt(wa,[["__scopeId","data-v-b0b8e43a"]]),Ma=["id"],Ta={key:0},Va=dt({__name:"Map",props:{widget:{}},setup(Se){var ot;Yt(e=>({"169ea90d":At.value}));const de=Se,I=qt(de).widget,M=vt(),{showDialog:oe,closeDialog:z}=Kt(),i=Qt(),m=mt(),a=c(),H=c(m.defaultMapZoom),T=c(m.defaultMapCenter),x=c(),le=E(()=>`map-${I.value.hash}`),L=E(()=>Ee.value||K.value),q=c(!1),se=c([]),ie=c(),ne=c(!1),f=c(!1),l=c(!1),d=c(!1),b=c(0),A=c(0),ve=c("");let me,pe,fe;const K=c(!1),wt=()=>{me==null||me.click(),K.value=!1},Ct=()=>{pe==null||pe.click(),K.value=!1},Mt=()=>{fe==null||fe.click(),K.value=!1};let He;const Be=e=>{e.touches.length>1&&(f.value=!0,N.value&&ke(),clearTimeout(He))},Ne=e=>{e.touches.length<=1&&(He=window.setTimeout(()=>f.value=!1,300))},Q=c(null),_=c({});nt.registerUsage(rt.latitude),nt.registerUsage(rt.longitude),Xt(()=>{Object.keys(I.value.options).length===0&&(I.value.options={showVehiclePath:!0}),V.enableAutoUpdate()});const ge=Ce.tileLayerOffline("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),he=Ce.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),ye=Ce.tileLayerOffline("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),Ue=v.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),Tt={OpenStreetMap:ge,"Esri World Imagery":he},Vt={Seamarks:ye,"Marine Profile":Ue},J=c(),Ee=Jt(J),Re=v.control.zoom({position:"bottomright"}),We=v.control.layers(Tt,Vt);y(L,()=>{a.value!==void 0&&(L.value?(a.value.addControl(Re),a.value.addControl(We)):(a.value.removeControl(Re),a.value.removeControl(We)))}),y(Ee,()=>{L.value=Ee.value}),pt(async()=>{var j,lt;(j=J.value)==null||j.addEventListener("touchstart",Be,{passive:!0}),(lt=J.value)==null||lt.addEventListener("touchend",Ne,{passive:!0}),a.value=v.map(le.value,{layers:[ge,he,ye,Ue],attributionControl:!1}).setView(T.value,H.value),a.value.removeControl(a.value.zoomControl),a.value.on("click",h=>{k.value=[h.latlng.lat,h.latlng.lng]}),a.value.on("moveend",()=>{if(a.value===void 0)return;let{lat:h,lng:P}=a.value.getCenter();h&&P&&(T.value=[h,P])});const e=Ie(he,"Esri",19),t=Ie(ge,"OSM",19),o=Ie(ye,"Seamarks",18);a.value&&(e.addTo(a.value),t.addTo(a.value),o.addTo(a.value));const s=h=>{var ce;const P=((ce=h.getContainer)==null?void 0:ce.call(h))??h._container;P&&(P.classList.add("hidden-savetiles"),P.style.display="none")};s(e),s(t),s(o),await Ve();const g=h=>{var ce;const P=((ce=h.getContainer)==null?void 0:ce.call(h))??h._container;return Array.from((P==null?void 0:P.querySelectorAll("a"))??[])},[p]=g(e),[O]=g(t),[Z]=g(o);me=p,pe=O,fe=Z,Oe(he,"Esri"),Oe(ge,"OSM"),Oe(ye,"Seamarks"),a.value.on("dragstart",()=>{ne.value=!0}),a.value.on("dragend",()=>{setTimeout(()=>ne.value=!1,200)}),a.value.on("zoomend",()=>{var h;N.value=!1,a.value!==void 0&&(H.value=((h=a.value)==null?void 0:h.getZoom())??T.value)}),a.value.on("contextmenu",h=>{k.value=[h.latlng.lat,h.latlng.lng]}),V.enableAutoUpdate(),window.addEventListener("keydown",qe),S.value?V.goToTarget(C.VEHICLE):V.goToTarget(C.HOME),!i.isVehicleOnline&&m.vehicleMission.length&&Fe(m.vehicleMission),q.value=!0,await Le()});const St=e=>(t,o)=>{oe({variant:"info",message:`Save ${t._tilesforSave.length} ${e} tiles for offline use?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:z},{text:"Save tiles",color:"white",action:()=>{o(),z()}}]})},Et=e=>(t,o)=>{oe({variant:"warning",message:`Remove all saved ${e} tiles for this layer?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:z},{text:"Remove tiles",color:"white",action:()=>{o(),z(),$({message:`${e} offline tiles removed`,variant:"info",duration:3e3})}}]})},Ie=(e,t,o)=>Ce.savetiles(e,{saveWhatYouSee:!0,maxZoom:o,alwaysDownload:!1,position:"topright",parallel:20,confirm:St(t),confirmRemoval:Et(t),saveText:`<i class="mdi mdi-download" title="Save ${t} tiles"></i>`,rmText:`<i class="mdi mdi-trash-can" title="Remove ${t} tiles"></i>`}),Oe=(e,t)=>{e.on("savestart",o=>{var s;b.value=0,A.value=((s=o==null?void 0:o._tilesforSave)==null?void 0:s.length)??0,ve.value=t,d.value=!0,$({message:`Saving ${A.value} ${t} tiles...`,variant:"info",duration:2e3})}),e.on("loadtileend",()=>{b.value+=1,A.value>0&&b.value>=A.value&&($({message:`${t} offline tiles saved!`,variant:"success",duration:3e3}),d.value=!1,ve.value="",b.value=0,A.value=0)})},It={open:e=>{if(!a.value||f.value||ne.value)return;e.preventDefault(),e.stopPropagation();const t=a.value.mouseEventToContainerPoint(e),o=a.value.containerPointToLatLng(t);k.value=[o.lat,o.lng],ie.value.openAt(e),N.value=!0},close:()=>{ke()}},Ge=()=>{var e;(e=a.value)==null||e.eachLayer(t=>{(t instanceof v.Marker||t instanceof v.Polyline&&t.options.color==="#358AC3")&&a.value.removeLayer(t)}),se.value=[],xe.value=void 0,G.value=void 0,ee.value=void 0,B.value=void 0},Le=async()=>{q.value&&(Ge(),i.isVehicleOnline?await Qe():m.vehicleMission.length&&Fe(m.vehicleMission))};y(()=>i.isVehicleOnline,()=>{Le()}),y(()=>m.vehicleMissionRevision,()=>{Le()}),ta(()=>{var e,t;V.disableAutoUpdate(),window.removeEventListener("keydown",qe),a.value&&(a.value.off("contextmenu"),Object.values(_.value).forEach(o=>o.remove()),_.value={}),(e=J.value)==null||e.removeEventListener("touchstart",Be),(t=J.value)==null||t.removeEventListener("touchend",Ne)}),y(T,(e,t)=>{var o;e.toString()!==t.toString()&&((o=a.value)==null||o.panTo(e))}),y(a,(e,t)=>{a.value!==void 0&&(e==null?void 0:e.options)===void 0&&(a.value=t)}),y(H,(e,t)=>{var o;e!==t&&(N.value=!1,(o=a.value)==null||o.setZoom(H.value))}),y(de.widget,()=>{var e;(e=a.value)==null||e.invalidateSize()});const X=c(void 0),V=new ea(e=>X.value=e,e=>T.value=e);V.setTrackableTarget(C.VEHICLE,()=>S.value),V.setTrackableTarget(C.HOME,()=>x.value);const S=E(()=>i.coordinates.latitude?[i.coordinates.latitude,i.coordinates.longitude]:void 0),_e=E(()=>{var e;return i.attitude.yaw?aa((e=i.attitude)==null?void 0:e.yaw):0}),Ze=E(()=>{const e=i.lastHeartbeat;return e?`${oa(e??0,{includeSeconds:!0})} ago`:"never"}),{history:Ot}=la(S);(ot=navigator==null?void 0:navigator.geolocation)==null||ot.watchPosition(e=>{x.value||(x.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let je=!0;y([x,a],async()=>{x.value===T.value||!a.value||!je||(V.goToTarget(C.HOME),je=!1)});const B=c();y(i.coordinates,()=>{if(!(!a.value||!S.value)){if(B.value===void 0){let e=sa;i.vehicleType===ct.MAV_TYPE_SURFACE_BOAT?e=ia:i.vehicleType===ct.MAV_TYPE_SUBMARINE&&(e=na);const t=v.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});B.value=v.marker(S.value,{icon:t});const o=v.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});B.value.bindTooltip(o),a.value.addLayer(B.value)}B.value.setLatLng(S.value)}}),y(S,(e,t)=>{X.value===C.VEHICLE||t!==void 0||V.follow(C.VEHICLE)}),y([S,_e,Ze,()=>i.isArmed],()=>{var t,o,s,g,p;if(B.value===void 0)return;(g=B.value.getTooltip())==null||g.setContent(`
    <p>Coordinates: ${(t=S.value)==null?void 0:t[0].toFixed(6)}, ${(o=S.value)==null?void 0:o[1].toFixed(6)}</p>
    <p>Velocity: ${((s=i.velocity.ground)==null?void 0:s.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${_e.value.toFixed(2)}°</p>
    <p>${i.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${Ze.value}</p>
  `);const e=(p=B.value.getElement())==null?void 0:p.querySelector("img");e&&(e.style.transform=`rotate(${_e.value}deg)`)});const G=c();y(x,()=>{if(a.value===void 0)return;const e=x.value;if(e!==void 0)if(G.value)G.value.setLatLng(e);else{G.value=v.marker(e,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=v.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});G.value.bindTooltip(t),G.value.on("dragend",o=>{const g=o.target.getLatLng();Ae([g.lat,g.lng])}),a.value.addLayer(G.value)}});const xe=c();y(se,e=>{a.value&&(xe.value||(xe.value=v.polyline([],{color:"#358AC3"}).addTo(a.value)),xe.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,o)=>{var p;const s=v.marker(t.coordinates);s.setIcon(v.divIcon({className:"marker-icon",iconSize:[16,16],iconAnchor:[8,8]}));const g=v.tooltip({content:o.toString(),permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});s.bindTooltip(g),(p=a.value)==null||p.addLayer(s)}))},{deep:!0});const $e=c();y(Ot,e=>{if(a.value===void 0||e===void 0)return;$e.value===void 0&&($e.value=v.polyline([],{color:"#ffff00"}).addTo(a.value));const t=e.filter(o=>o.snapshot!==void 0).map(o=>o.snapshot);$e.value.setLatLngs(t)});const N=c(!1),k=c(null),Ye=c(),Lt=ra([{item:"Set home waypoint",action:()=>be("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Place Point of Interest",action:()=>be("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>be("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>be("set-default-map-position"),icon:"mdi-map-check"}]),ee=c(),_t=async()=>{var e;if(!(!a.value||!k.value))try{await m.setDefaultMapPosition(k.value,H.value),$({message:"Default map position set",variant:"success"});const t=v.marker(k.value,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value),o=v.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(o).openTooltip();const s=t.getElement(),g=(e=t.getTooltip())==null?void 0:e.getElement();[s,g].forEach(p=>{p&&(p.style.transition="opacity 1s",p.style.opacity="1")}),setTimeout(()=>{[s,g].forEach(p=>{p&&(p.style.opacity="0")}),setTimeout(()=>{var p;(p=a.value)==null||p.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),$({message:"Failed to set default map position",variant:"error"})}},$t=async()=>{if(!k.value||!a.value)return;ee.value&&(a.value.removeLayer(ee.value),ee.value=void 0),ee.value=v.marker(k.value,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value);const e=v.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(ee.value.bindTooltip(e),k.value){const p=i.coordinates.altitude??0,O=k.value[0],Z=k.value[1];try{await i.goTo(0,0,0,0,O,Z,p)}catch(j){$({message:`GoTo request failed: ${j.message}`,variant:"error"})}}},be=async e=>{switch(e){case"goto":{$t();break}case"set-default-map-position":_t();break;case"place-poi":k.value&&Q.value?Q.value.openDialog(k.value):k.value?Q.value||($({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):($({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":k.value&&Ae(k.value);break;default:console.warn("Unknown menu option selected:",e)}N.value=!1},ke=()=>{N.value=!1,a.value!==void 0&&Ye.value!==void 0&&a.value.removeLayer(Ye.value)},qe=e=>{e.key==="Escape"&&ke()},Fe=e=>{e.forEach((t,o)=>{o===0?(x.value=t.coordinates,Ae(t.coordinates)):se.value.push(t)})},we=c(!1),Ke=c(0),Qe=async()=>{we.value=!0,Ge();const e=async t=>{Ke.value=t};try{const t=await i.fetchMission(e);Fe(t),$({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){oe({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{we.value=!1}},Ae=async e=>{const t=[e[0],e[1]];x.value=t,await i.setHomeWaypoint(t,0),N.value&&(N.value=!1)},Je=async()=>{try{await i.startMission()}catch{$({message:"Failed to start mission.",variant:"error"})}},Ft=async()=>{if(m.showChecklistBeforeArm){l.value=!0;return}Je()},re=ca(),At=E(()=>`${Math.max(-re.widgetClearanceForVisibleArea(I.value).bottom,0)}px`),Xe=E(()=>`${Math.max(-re.widgetClearanceForVisibleArea(I.value).top,0)}px`),Pt=E(()=>i.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),Dt=E(()=>i.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),zt=E(()=>x.value===void 0?"Cannot center map on home (home position undefined).":X.value===C.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),Ht=E(()=>i.isVehicleOnline?S.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":X.value===C.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),et=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),tt=e=>{if(!a.value||!a.value.getContainer())return;const t=v.divIcon(et(e)),o=v.marker(e.coordinates,{icon:t,draggable:!0}).addTo(a.value),s=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,g={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};o.bindTooltip(s,g),o.on("drag",p=>{var j;const O=p.target.getLatLng(),Z=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${O.lat.toFixed(8)}, Lng: ${O.lng.toFixed(8)}
    `;(j=o.getTooltip())==null||j.setContent(Z)}),o.on("dragend",p=>{const O=p.target.getLatLng();m.movePointOfInterest(e.id,[O.lat,O.lng])}),o.on("click",p=>{if(v.DomEvent.stopPropagation(p),Q.value){const O=m.pointsOfInterest.find(Z=>Z.id===e.id);O?Q.value.openDialog(void 0,O):console.warn("POI not found in store:",e.id)}}),_.value[e.id]=o},at=e=>{var s;if(!a.value||!a.value.getContainer()||!_.value[e.id])return;const t=_.value[e.id];t.setLatLng(e.coordinates),t.setIcon(v.divIcon(et(e)));const o=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(s=t.getTooltip())==null||s.setContent(o)},Bt=e=>{!a.value||!_.value[e]||(_.value[e].remove(),delete _.value[e])};return y(()=>m.pointsOfInterest,async e=>{if((!a.value||!a.value.getContainer())&&(await Ve(),!a.value||!a.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(o=>o.id));Object.keys(_.value).forEach(o=>{t.has(o)||Bt(o)}),e.forEach(o=>{_.value[o.id]?at(o):tt(o)})},{deep:!0,immediate:!0}),y(a,e=>{e&&e.getContainer()&&m.pointsOfInterest.forEach(t=>{_.value[t.id]?at(t):tt(t)})},{immediate:!0}),(e,t)=>{const o=ua("contextmenu");return w(),W(xt,null,[ut((w(),W("div",{ref_key:"mapBase",ref:J,class:Pe(["page-base",r(re).editingMode?"pointer-events-none":"pointer-events-auto"])},[Y("div",{id:le.value,ref_key:"map",ref:a,class:"map"},[n(va,{modelValue:K.value,"onUpdate:modelValue":t[0]||(t[0]=s=>K.value=s),"close-on-content-click":!1,location:"top end"},{activator:u(({props:s})=>[ut(n(F,ue(s,{class:"absolute right-[209px] m-3 bottom-button bg-slate-50 text-[14px]",elevation:"2",size:"x-small",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download-multiple"}),null,16),[[da,L.value]])]),default:u(()=>[n(yt,{style:ae(r(M).globalGlassMenuStyles),class:"py-0 min-w-[220px] rounded-lg border-[1px]"},{default:u(()=>[n(Te,{class:"py-0",title:"Save visible Esri tiles",onClick:wt}),n(ze),n(Te,{class:"py-0",title:"Save visible OSM tiles",onClick:Ct}),n(ze),n(Te,{class:"py-0",title:"Save visible Seamarks tiles",onClick:Mt})]),_:1},8,["style"])]),_:1},8,["modelValue"]),n(Me,{location:"top",text:zt.value},{activator:u(({props:s})=>[L.value?(w(),R(F,ue({key:0},s,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",x.value?"":"active-events-on-disabled"],color:X.value==r(C).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!x.value,onClick:t[1]||(t[1]=te(g=>r(V).goToTarget(r(C).HOME,!0),["stop"])),onDblclick:t[2]||(t[2]=te(g=>r(V).follow(r(C).HOME),["stop"]))}),null,16,["class","color","disabled"])):U("",!0)]),_:1},8,["text"]),n(Me,{location:"top",text:Ht.value},{activator:u(({props:s})=>[L.value?(w(),R(F,ue({key:0},s,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",S.value?"":"active-events-on-disabled"],color:X.value==r(C).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!S.value,onClick:t[3]||(t[3]=te(g=>r(V).goToTarget(r(C).VEHICLE,!0),["stop"])),onDblclick:t[4]||(t[4]=te(g=>r(V).follow(r(C).VEHICLE),["stop"]))}),null,16,["class","color","disabled"])):U("",!0)]),_:1},8,["text"]),n(Me,{location:"top",text:Pt.value},{activator:u(({props:s})=>[L.value?(w(),R(F,ue({key:0},s,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",r(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!r(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:te(Qe,["stop"])}),null,16,["class","disabled"])):U("",!0)]),_:1},8,["text"]),n(Me,{location:"top",text:Dt.value},{activator:u(({props:s})=>[L.value?(w(),R(F,ue({key:0},s,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",r(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!r(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:te(Ft,["stop"])}),null,16,["class","disabled"])):U("",!0)]),_:1},8,["text"])],8,Ma)],2)),[[o,It]]),n(ma,{ref_key:"contextMenuRef",ref:ie,visible:N.value,width:"260px","menu-items":Lt,onClose:ke},null,8,["visible","menu-items"]),n(bt,{modelValue:r(re).widgetManagerVars(r(I).hash).configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=s=>r(re).widgetManagerVars(r(I).hash).configMenuOpen=s),width:"auto"},{default:u(()=>[n(ft,{class:"pa-2",style:ae(r(M).globalGlassMenuStyles)},{default:u(()=>[n(gt,{class:"text-center"},{default:u(()=>t[8]||(t[8]=[D("Map widget settings")])),_:1,__:[8]}),n(ht,null,{default:u(()=>[n(pa,{modelValue:r(I).options.showVehiclePath,"onUpdate:modelValue":t[5]||(t[5]=s=>r(I).options.showVehiclePath=s),class:"my-1",label:"Show vehicle path",color:r(I).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),we.value?(w(),R(fa,{key:0,"model-value":Ke.value,height:"10",absolute:"",bottom:"",color:"white",style:ae(`top: ${Xe.value}`)},null,8,["model-value","style"])):U("",!0),we.value?(w(),W("p",{key:1,style:ae({top:Xe.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):U("",!0),n(ga,{ref_key:"poiManagerMapWidgetRef",ref:Q},null,512),n(Ca,{"model-value":l.value,onConfirmed:Je,"onUpdate:modelValue":t[7]||(t[7]=s=>l.value=s)},null,8,["model-value"]),d.value?(w(),W("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:ae(r(M).globalGlassMenuStyles)},[Y("p",null,[t[9]||(t[9]=D(" Saving offline map content ")),ve.value?(w(),W("span",Ta,"("+De(ve.value)+")",1)):U("",!0),D(":  "+De(A.value?Math.round(b.value/A.value*100):0)+"% ",1)])],4)):U("",!0)],64)}}}),Ea=kt(Va,[["__scopeId","data-v-25f96c29"]]);export{Ea as default};
