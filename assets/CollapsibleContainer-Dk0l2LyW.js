import{c as We,y as Fe,K as Se,aL as Be,J as Ee,r as f,k as $,aD as Le,w as Oe,L as $e,o as ze,D as Te,l as d,m as v,n as u,H as a,N as i,Q as w,af as X,G as I,at as se,az as Ae,O as U,t as J,q as l,s as k,I as K,a6 as _,a0 as De,aM as je,aN as N,aO as R,aP as Ie,aQ as Ue,v as h,F as V,p as W,aR as q,aS as Q,V as ne,P as oe,U as ie,aB as de,aT as re,au as Ne,aU as Re,am as Ge,aJ as He,aV as Pe,aW as Xe,_ as Je}from"./index-CT9iBj1f.js";const Ke=["width","height"],_e={class:"flex flex-col justify-between h-full pa-2 cursor-pointer"},qe={class:"flex justify-between w-full"},Qe={key:0},Ye={key:0},Ze={class:"flex"},et={key:0,class:"flex rotate-[270deg] justify-center whitespace-nowrap"},tt={class:"flex justify-center h-full px-3 pt-2 gap-x-2"},lt=["data-widget-hash"],at=["data-widget-hash"],st={class:"flex flex-col justify-start items-start gap-x-4 mt-3 w-full"},nt={key:0,ref:"widgetTrashArea",class:"absolute w-32 h-32 -translate-x-32 -translate-y-32 bottom-[20%] left-1/3 bg-[#FF000055] z-[65] rounded-xl flex items-center justify-center hover:bg-slate-200/50 transition-all"},ot={class:"relative flex justify-center items-center w-full h-full"},it={class:"select-none"},dt={class:"flex w-full justify-center items-center mt-4"},rt=["value"],ut=We({__name:"CollapsibleContainer",props:{widget:{}},setup(ue){const o=Fe(),ve=Se(),{openSnackbar:F}=Be(),b=ue,r=Ee(b).widget,m=f(b.widget),z=f(new Map),Y=f(!1),Z=f("justify-center"),fe=f(!1),G=f(!1),S=f(b.widget.name),M=f(null),T=f(b.widget.options.leftColumnWidth||50),ee=f(!1),B=f(null),c=f(!1),C=f("right"),A=f([]),D=f(!1),E=f(""),ge=()=>{if(E.value){try{o.copyWidgetToView(m.value,E.value),F({variant:"success",message:"Widget cloned successfully."})}catch(s){F({variant:"error",message:s.message||"Error cloning widget."})}D.value=!1,E.value=""}},H=()=>{if(B.value){const s=B.value.getBoundingClientRect(),e=window.innerWidth;s.left+s.width/2<e/2?C.value="left":C.value="right"}},me=$(()=>C.value==="left"?c.value?"mdi-chevron-right":"mdi-chevron-left":c.value?"mdi-chevron-left":"mdi-chevron-right"),pe=()=>{S.value=b.widget.name,G.value=!0,He(()=>{M.value&&(M.value.focus(),M.value.select())})},te=()=>{G.value=!1,m.value&&S.value!==m.value.name&&(m.value.name=S.value)},ce=s=>{var t;const e=(t=s.target.files)==null?void 0:t[0];if(!e){F({variant:"error",message:"No file selected.",duration:3e3});return}const p=new FileReader;p.onload=n=>{var x;try{const g=JSON.parse((x=n.target)==null?void 0:x.result),O=m.value.hash;o.loadWidgetFromFile(O,g)}catch{F({variant:"error",message:"Invalid widget file format.",duration:3e3})}},p.readAsText(e)},L=f(!1),we=()=>{o.elementToShowOnDrawer=void 0,A.value=[]},j=s=>{if(fe.value=!1,s==="options")o.widgetManagerVars(m.value.hash).configMenuOpen=!0;else if(s==="save")he();else if(s==="load"){const e=document.createElement("input");e.type="file",e.accept=".widget",e.addEventListener("change",p=>{ce(p)}),e.click()}else s==="copy-to-view"&&(D.value=!0)},he=()=>{const s=new Blob([JSON.stringify(r.value)],{type:"application/json;charset=utf-8"}),e=`${r.value.name}.widget`;Pe(s,e)},be=s=>{if(!o.editingMode)return;const e=s.clientX,p=T.value;ee.value=!0;const t=x=>{if(!B.value)return;const g=B.value.offsetWidth,O=p+(x.clientX-e)/g*100;T.value=Math.max(10,Math.min(90,O))},n=()=>{ee.value=!1,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",n)},ye=$(()=>m.value.options.elementContainers.filter(s=>s.name.includes("left"))),xe=$(()=>m.value.options.elementContainers.filter(s=>s.name.includes("right"))),ke=$(()=>Math.round(r.value.options.backgroundOpacity*255).toString(16)),Ve=()=>{o.allowMovingAndResizing(m.value.hash,!0),window.addEventListener("mouseup",y),window.addEventListener("dragend",y)},y=()=>{H(),o.allowMovingAndResizing(m.value.hash,!1),window.removeEventListener("mouseup",y),window.removeEventListener("dragend",y)},le=(s,e)=>{const p=m.value.options.elementContainers.find(g=>g.name===e);if(!p)return;const t=p.elements.map(g=>g.hash),n=z.value.get(e)||[],x=t.find(g=>!n.includes(g));if(x){const g=p.elements.find(O=>O.hash===x);if(g&&s.pullMode==="clone"){g.hash=Xe(),o.miniWidgetManagerVars(g.hash).configMenuOpen=!0,z.value.set(e,t);return}o.showElementPropsDrawer(g.hash),z.value.set(e,t)}},{width:ae}=Le(),P=$(()=>({width:m.value.size.width*ae.value,height:m.value.size.height*ae.value})),Me=f(null);Oe(()=>o.editingMode,s=>{s===!0&&(y(),c.value=!1)});const Ce=()=>{try{const s=o.editWidgetByHash(b.widget.hash);s&&(m.value=s)}catch{F({variant:"warning",message:"Error reading widget file.",duration:1e3})}};return $e(()=>{b.widget.options.elementContainers.forEach(s=>{z.value.set(s.name,s.elements.map(e=>e.hash))})}),ze(()=>{H(),window.addEventListener("resize",H),Me.value=document.querySelector(".main"),Ce(),y()}),(s,e)=>{const p=Te("FontAwesomeIcon");return d(),v(V,null,[u("div",{ref_key:"widgetBase",ref:B,class:h(["h-full rounded-lg overflow-hidden",[c.value?"w-[40px]":"w-full",c.value&&C.value==="left"?"ml-0 mr-auto":"",c.value&&C.value==="right"?"mr-0 ml-auto":""]]),width:P.value.width,height:P.value.height,style:U([l(ve).globalGlassMenuStyles,{backgroundColor:`${l(r).options.backgroundColor+ke.value}`,backdropFilter:`blur(${l(r).options.backgroundBlur}px)`}])},[u("div",_e,[u("div",qe,[a(X,{class:"cursor-grab opacity-40",onMousedown:Ve,onMouseup:y},{default:i(()=>e[19]||(e[19]=[w(" mdi-drag ")])),_:1}),c.value?k("",!0):(d(),v("div",Qe,[G.value?(d(),v("div",Ye,[I(u("input",{ref_key:"nameInput",ref:M,"onUpdate:modelValue":e[0]||(e[0]=t=>S.value=t),class:"border-b border-gray-400",onBlur:te,onKeyup:Ae(te,["enter"])},null,544),[[se,S.value]])])):(d(),v("p",{key:1,class:"whitespace-nowrap overflow-hidden text-ellipsis",style:U({maxWidth:`${P.value.width*.8}px`}),onDblclick:pe},J(l(r).name),37))])),u("div",Ze,[l(o).editingMode?(d(),K(Ie,{key:0,theme:"dark"},{activator:i(({props:t})=>[a(_,De({size:"20",icon:"mdi-dots-vertical",variant:"text"},t),null,16)]),default:i(()=>[a(je,null,{default:i(()=>[a(N,{onClick:e[1]||(e[1]=t=>j("options"))},{default:i(()=>[a(R,null,{default:i(()=>e[20]||(e[20]=[w("Options")])),_:1})]),_:1}),a(N,{onClick:e[2]||(e[2]=t=>j("save"))},{default:i(()=>[a(R,null,{default:i(()=>e[21]||(e[21]=[w("Save")])),_:1})]),_:1}),a(N,{onClick:e[3]||(e[3]=t=>j("load"))},{default:i(()=>[a(R,null,{default:i(()=>e[22]||(e[22]=[w("Load")])),_:1})]),_:1}),a(N,{onClick:e[4]||(e[4]=t=>j("copy-to-view"))},{default:i(()=>[a(R,null,{default:i(()=>e[23]||(e[23]=[w("Clone to another view")])),_:1})]),_:1})]),_:1})]),_:1})):k("",!0)])]),c.value?(d(),v("div",et,J(l(r).name),1)):k("",!0),I(u("div",tt,[u("div",{class:h(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[l(o).editingMode?"border-[1px]":"border-0"]]),style:U({width:l(r).options.columns>1?`${T.value}%`:"100%"})},[(d(!0),v(V,null,W(ye.value,t=>(d(),v("div",{key:t.name,class:"w-full h-full"},[a(l(Q),{modelValue:t.elements,"onUpdate:modelValue":n=>t.elements=n,disabled:!l(o).editingMode,animation:150,group:"generalGroup",class:h(["flex items-center w-full h-full gap-2 px-2",[Y.value?"flex-wrap":"",Z.value]]),onAdd:n=>le(n,t.name),onStart:e[5]||(e[5]=n=>L.value=!0),onEnd:e[6]||(e[6]=n=>L.value=!1)},{default:i(()=>[(d(!0),v(V,null,W(t.elements,n=>(d(),v("div",{key:n.hash,"data-widget-hash":n.hash,class:h(["rounded-md w-full",{"cursor-grab":l(o).editingMode,"bg-slate-400":l(o).miniWidgetManagerVars(n.hash).highlighted}])},[a(q,{"mini-widget":n},null,8,["mini-widget"])],10,lt))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6),l(r).options.columns>1&&l(o).editingMode?(d(),v("div",{key:0,class:"cursor-col-resize w-1 bg-[#FFFFFF22] relative",onMousedown:be},e[24]||(e[24]=[u("div",{class:"absolute inset-y-0 -left-1 -right-1"},null,-1)]),32)):k("",!0),l(r).options.columns>1?(d(),v("div",{key:1,class:h(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[l(o).editingMode?"border-[1px]":"border-0"]]),style:U({width:`${100-T.value}%`})},[(d(!0),v(V,null,W(xe.value,t=>(d(),v("div",{key:t.name,class:"w-full h-full"},[a(l(Q),{modelValue:t.elements,"onUpdate:modelValue":n=>t.elements=n,disabled:!l(o).editingMode,animation:150,group:"generalGroup",class:h(["flex items-center w-full h-full gap-2 px-2",[Y.value?"flex-wrap":"",Z.value]]),onAdd:n=>le(n,t.name),onStart:e[7]||(e[7]=n=>L.value=!0),onEnd:e[8]||(e[8]=n=>L.value=!1)},{default:i(()=>[(d(!0),v(V,null,W(t.elements,n=>(d(),v("div",{key:n.hash,"data-widget-hash":n.hash,class:h(["rounded-md w-full",{"cursor-grab":l(o).editingMode,"bg-slate-400":l(o).miniWidgetManagerVars(n.hash).highlighted}])},[a(q,{"mini-widget":n},null,8,["mini-widget"])],10,at))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6)):k("",!0)],512),[[Ue,!c.value]]),e[25]||(e[25]=u("div",null,null,-1)),l(o).editingMode?k("",!0):(d(),K(_,{key:1,class:h(["fixed bottom-[2px]",C.value==="left"?"left-[2px]":"right-[2px]"]),icon:me.value,variant:"text",size:"36",onClick:e[9]||(e[9]=t=>c.value=!c.value)},null,8,["class","icon"]))])],14,Ke),(d(),K(Ge,{to:"body"},[a(re,{"is-visible":l(o).widgetManagerVars(l(r).hash).configMenuOpen},{default:i(()=>[a(ne,{class:"px-8 pb-6 pt-2 rounded-lg w-[400px] bg-transparent"},{default:i(()=>[a(oe,{class:"text-center -mt-1"},{default:i(()=>e[26]||(e[26]=[w("Custom Widget options")])),_:1}),a(_,{class:"absolute top-3 right-0 text-lg rounded-full",variant:"text",size:"small",onClick:e[10]||(e[10]=t=>l(o).widgetManagerVars(l(r).hash).configMenuOpen=!1)},{default:i(()=>[a(X,null,{default:i(()=>e[27]||(e[27]=[w("mdi-close")])),_:1})]),_:1}),u("div",st,[e[28]||(e[28]=u("p",{class:"text-start"},"Name:",-1)),a(ie,{ref_key:"nameInput",ref:M,modelValue:l(r).name,"onUpdate:modelValue":e[11]||(e[11]=t=>l(r).name=t),density:"compact",class:"w-3/4"},null,8,["modelValue"]),e[29]||(e[29]=u("p",{class:"text-start"},"Columns:",-1)),a(ie,{ref_key:"nameInput",ref:M,modelValue:l(r).options.columns,"onUpdate:modelValue":e[12]||(e[12]=t=>l(r).options.columns=t),min:"1",max:"2",type:"number",density:"compact",class:"w-1/4"},null,8,["modelValue"]),e[30]||(e[30]=u("p",{class:"mt-1"},"Background color",-1)),I(u("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>l(r).options.backgroundColor=t),type:"color",class:"p-0 w-20 mr-4"},null,512),[[se,l(r).options.backgroundColor]]),e[31]||(e[31]=u("p",{class:"mt-3"},"Background opacity:",-1)),a(de,{modelValue:l(r).options.backgroundOpacity,"onUpdate:modelValue":e[14]||(e[14]=t=>l(r).options.backgroundOpacity=t),min:"0",max:"1",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"]),e[32]||(e[32]=u("p",{class:"mt-3"},"Background blur:",-1)),a(de,{modelValue:l(r).options.backgroundBlur,"onUpdate:modelValue":e[15]||(e[15]=t=>l(r).options.backgroundBlur=t),min:"0",max:"100",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"])])]),_:1})]),_:1},8,["is-visible"]),a(Ne,null,{default:i(()=>[L.value?(d(),v("div",nt,[u("div",ot,[a(p,{icon:"fa-solid fa-trash",class:"absolute h-16 transition-all -translate-x-7 -translate-y-8 top-1/2 left-1/2 text-white"}),a(l(Q),{modelValue:A.value,"onUpdate:modelValue":e[16]||(e[16]=t=>A.value=t),animation:150,group:"generalGroup",class:"flex flex-wrap items-center justify-center w-full h-full gap-2",onAdd:we},{default:i(()=>[(d(!0),v(V,null,W(A.value,t=>(d(),v("div",{key:t.hash},[u("div",it,[a(q,{"mini-widget":t},null,8,["mini-widget"])])]))),128))]),_:1},8,["modelValue"])])],512)):k("",!0)]),_:1}),a(re,{"is-visible":D.value},{default:i(()=>[a(ne,{class:"px-3 pb-6 pt-2 rounded-lg w-auto bg-transparent z-40"},{default:i(()=>[a(oe,{class:"flex justify-around -mt-1 w-full px-0"},{default:i(()=>[e[34]||(e[34]=u("div",null,null,-1)),e[35]||(e[35]=u("p",{class:"mx-8"},"Clone widget to",-1)),a(X,{class:"cursor-pointer self-end",onClick:e[17]||(e[17]=t=>D.value=!1)},{default:i(()=>e[33]||(e[33]=[w("mdi-close")])),_:1})]),_:1}),u("div",dt,[I(u("select",{"onUpdate:modelValue":e[18]||(e[18]=t=>E.value=t),class:"bg-[#50505022] dark:bg-gray-800 dark:text-white w-[180px] p-2 border border-gray-300 dark:border-gray-600 rounded appearance-none",onChange:ge},[(d(!0),v(V,null,W(l(o).currentProfile.views,t=>(d(),v("option",{key:t.name,value:t.name,class:"bg-gray-800 dark:bg-gray-800 dark:text-white"},J(t.name),9,rt))),128))],544),[[Re,E.value]])])]),_:1})]),_:1},8,["is-visible"])]))],64)}}}),ft=Je(ut,[["__scopeId","data-v-54dd4966"]]);export{ft as default};
