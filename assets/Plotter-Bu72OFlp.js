import{ba as ee,bb as te,h as S,cb as ae,bs as le,bh as ne,cc as I,c8 as _,c as we,e as Ce,t as xe,r as x,W as Le,o as Se,aN as Pe,aH as Me,aM as Ne,j as Ie,cd as Te,w as L,ag as je,aU as $e,aY as De,a_ as Oe,aX as Ue,m as E,n as B,q as u,z as o,p as c,E as f,V as Ee,G as Be,a1 as N,as as Ae,a0 as A,af as Y,a$ as K,P as J,x as q,J as Re,F as Fe,ac as X,_ as _e}from"./index-DG9W5PmJ.js";const oe=I.reduce((l,r)=>(l[r]={type:[Boolean,String,Number],default:!1},l),{}),se=I.reduce((l,r)=>{const i="offset"+_(r);return l[i]={type:[String,Number],default:null},l},{}),ie=I.reduce((l,r)=>{const i="order"+_(r);return l[i]={type:[String,Number],default:null},l},{}),Q={col:Object.keys(oe),offset:Object.keys(se),order:Object.keys(ie)};function ze(l,r,i){let e=l;if(!(i==null||i===!1)){if(r){const s=r.replace(l,"");e+=`-${s}`}return l==="col"&&(e="v-"+e),l==="col"&&(i===""||i===!0)||(e+=`-${i}`),e.toLowerCase()}}const We=["auto","start","end","center","baseline","stretch"],Ge=te({cols:{type:[Boolean,String,Number],default:!1},...oe,offset:{type:[String,Number],default:null},...se,order:{type:[String,Number],default:null},...ie,alignSelf:{type:String,default:null,validator:l=>We.includes(l)},...ne(),...le()},"VCol"),R=ee()({name:"VCol",props:Ge(),setup(l,r){let{slots:i}=r;const e=S(()=>{const s=[];let m;for(m in Q)Q[m].forEach(v=>{const g=l[v],p=ze(m,v,g);p&&s.push(p)});const b=s.some(v=>v.startsWith("v-col-"));return s.push({"v-col":!b||!l.cols,[`v-col-${l.cols}`]:l.cols,[`offset-${l.offset}`]:l.offset,[`order-${l.order}`]:l.order,[`align-self-${l.alignSelf}`]:l.alignSelf}),s});return()=>{var s;return ae(l.tag,{class:[e.value,l.class],style:l.style},(s=i.default)==null?void 0:s.call(i))}}}),z=["start","end","center"],re=["space-between","space-around","space-evenly"];function W(l,r){return I.reduce((i,e)=>{const s=l+_(e);return i[s]=r(),i},{})}const He=[...z,"baseline","stretch"],ue=l=>He.includes(l),de=W("align",()=>({type:String,default:null,validator:ue})),Ye=[...z,...re],ce=l=>Ye.includes(l),me=W("justify",()=>({type:String,default:null,validator:ce})),Ke=[...z,...re,"stretch"],fe=l=>Ke.includes(l),pe=W("alignContent",()=>({type:String,default:null,validator:fe})),Z={align:Object.keys(de),justify:Object.keys(me),alignContent:Object.keys(pe)},Je={align:"align",justify:"justify",alignContent:"align-content"};function qe(l,r,i){let e=Je[l];if(i!=null){if(r){const s=r.replace(l,"");e+=`-${s}`}return e+=`-${i}`,e.toLowerCase()}}const Xe=te({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:ue},...de,justify:{type:String,default:null,validator:ce},...me,alignContent:{type:String,default:null,validator:fe},...pe,...ne(),...le()},"VRow"),F=ee()({name:"VRow",props:Xe(),setup(l,r){let{slots:i}=r;const e=S(()=>{const s=[];let m;for(m in Z)Z[m].forEach(b=>{const v=l[b],g=qe(m,b,v);g&&s.push(g)});return s.push({"v-row--no-gutters":l.noGutters,"v-row--dense":l.dense,[`align-${l.align}`]:l.align,[`justify-${l.justify}`]:l.justify,[`align-content-${l.alignContent}`]:l.alignContent}),s});return()=>{var s;return ae(l.tag,{class:["v-row",e.value,l.class],style:l.style},(s=i.default)==null?void 0:s.call(i))}}}),Qe={key:0,class:"w-full h-full flex items-center justify-center text-center text-white text-h5 font-weight-bold p-4 overflow-hidden"},Ze={key:1,class:"main"},et=["width","height"],tt={class:"ml-2"},at={class:"ml-2 flex gap-x-8"},lt={class:"ml-2 flex gap-x-8"},nt={class:"ml-2"},ot={class:"flex w-full justify-end my-2"},st=we({__name:"Plotter",props:{widget:{}},setup(l){const r=Ce(),e=xe(l).widget,s=x([]);let m,b;Le(()=>{const t={backgroundColor:"rgba(0, 0, 0, 0.7)",lineColor:"rgba(255, 0, 0, 1.0)",dataLakeVariableId:void 0,maxSamples:1e3,limitSamples:!0,lineThickness:1,decimalPlaces:2,showTitle:!0,updateOnConstantValue:!0};e.value.options={...t,...e.value.options}}),Se(()=>{if(T(e.value.options.dataLakeVariableId),s.value=Object.values(Pe()),b=Me(t=>{s.value=Object.values(t)}),d.length===0){const t=Ne(e.value.options.dataLakeVariableId);t&&H(t)}}),Ie(()=>{b&&Te(b),m&&X(e.value.options.dataLakeVariableId,m)});const v=S(()=>s.value.filter(t=>t.type==="number")),g=x(""),p=x(!1);L(()=>e.value.options.dataLakeVariableId,()=>p.value=!1);const be=S(()=>{const t=(g.value||"").toLowerCase();return v.value.filter(a=>a.name.toLowerCase().includes(t))}),G=()=>{e.value.options.limitSamples&&(d.length===e.value.options.maxSamples+1?d.shift():d.length>e.value.options.maxSamples&&d.splice(0,d.length-e.value.options.maxSamples))},H=t=>{d.push(t),G(),$()},T=(t,a)=>{if(t===void 0){console.error("No data lake variable ID provided!");return}a!==void 0&&m&&X(a,m),m=je(t,n=>H(n),{notifyOnTimestampChange:e.value.options.updateOnConstantValue})};L(()=>e.value.options.dataLakeVariableId,(t,a)=>{T(t,a),d.length=0}),L(()=>e.value.options.updateOnConstantValue,()=>{const t=e.value.options.dataLakeVariableId;t&&T(t,t)});const{width:ve,height:ge}=$e(),k=S(()=>({width:e.value.size.width*ve.value,height:e.value.size.height*ge.value})),y=x(),j=x(),P=(t,a,n,V)=>{const D=t.measureText(a),h=4;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(n-h,V-16-h,D.width+h*2,16+h*2),t.fillStyle=e.value.options.lineColor,t.fillText(a,n,V)},$=()=>{if(y.value===void 0||y.value===null)return;if(j.value===void 0){console.debug("Canvas context undefined!"),j.value=y.value.getContext("2d");return}const t=j.value,a=k.value.width,n=k.value.height;De(t),t.clearRect(0,0,a,n),t.fillStyle=e.value.options.backgroundColor,t.fillRect(0,0,a,n),t.strokeStyle=e.value.options.lineColor,t.lineWidth=Math.max(e.value.options.lineThickness,1);try{w=Math.max(...d),C=Math.min(...d);const V=.05*(w!=C?w-C:1),D=w+V,h=C-V,he=d[d.length-1];if(t.beginPath(),t.moveTo(0,n/2),t.setLineDash([]),d.length===0?(t.beginPath(),t.arc(0,n/2,7,0,2*Math.PI),t.stroke()):d.length===1?(t.fillStyle=e.value.options.lineColor,t.beginPath(),t.arc(0,n/2,7,0,2*Math.PI),t.fill(),t.beginPath(),t.setLineDash([5,5]),t.moveTo(0,n/2),t.lineTo(50,n/2),t.stroke()):(t.setLineDash([]),d.forEach((M,U)=>{const ke=U*(a/d.length),ye=n-(M-h)/(D-h)*n;t.lineTo(ke,ye)})),t.stroke(),t.font="14px monospace",t.textBaseline="bottom",e.value.options.showTitle&&e.value.options.dataLakeVariableId){const M=s.value.find(U=>U.id===e.value.options.dataLakeVariableId);M&&(P(t,M.name,10,26),t.textBaseline="bottom")}const O=e.value.options.decimalPlaces;P(t,`Current: ${Number(he).toFixed(O)}`,10,n-10),P(t,`Min: ${Number(C).toFixed(O)}`,10,n-30),P(t,`Max: ${Number(w).toFixed(O)}`,10,n-50)}catch(V){console.error("Error drawing graph:",V)}},d=[];let w=0,C=0;L([k,e],()=>{r.isWidgetVisible(e.value)&&(G(),Oe(()=>$()))},{deep:!0});const Ve=Ue(y);return L(Ve,(t,a)=>{t&&!a&&$()}),(t,a)=>(B(),E(Fe,null,[o(e).options.dataLakeVariableId?(B(),E("div",Ze,[c("canvas",{ref_key:"canvasRef",ref:y,width:k.value.width,height:k.value.height},null,8,et)])):(B(),E("p",Qe," Please open the Plotter widget configuration menu to select a variable to be plotted. ")),u(Re,{modelValue:o(r).widgetManagerVars(o(e).hash).configMenuOpen,"onUpdate:modelValue":a[15]||(a[15]=n=>o(r).widgetManagerVars(o(e).hash).configMenuOpen=n),title:"Plotter config",variant:"text-only"},{content:f(()=>[u(F,null,{default:f(()=>[u(R,{cols:"12"},{default:f(()=>[a[16]||(a[16]=c("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Source",-1)),c("div",tt,[u(N,{modelValue:g.value,"onUpdate:modelValue":[a[0]||(a[0]=n=>g.value=n),a[1]||(a[1]=n=>p.value=!0)],density:"compact",variant:"filled",theme:"dark",type:"text",placeholder:"Search variables...",class:"mb-4",clearable:"","onClick:clear":a[2]||(a[2]=n=>p.value=!1),"onUpdate:focused":a[3]||(a[3]=n=>p.value=n)},null,8,["modelValue"]),u(Ae,{modelValue:o(e).options.dataLakeVariableId,"onUpdate:modelValue":a[4]||(a[4]=n=>o(e).options.dataLakeVariableId=n),items:be.value,"item-title":"name","item-value":"id",label:"Data Lake variable",hint:"Select a variable to be plotted","persistent-hint":"",theme:"dark",variant:"outlined",density:"comfortable","menu-props":{modelValue:p.value},onClick:a[5]||(a[5]=n=>p.value=!p.value)},null,8,["modelValue","items","menu-props"])])]),_:1,__:[16]})]),_:1}),u(F,null,{default:f(()=>[u(R,{cols:"12"},{default:f(()=>[a[19]||(a[19]=c("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Appearance",-1)),c("div",at,[u(A,{modelValue:o(e).options.showTitle,"onUpdate:modelValue":a[6]||(a[6]=n=>o(e).options.showTitle=n),label:"Show title","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),u(Y,{"close-on-content-click":!1},{activator:f(({props:n})=>[c("div",J(n,{class:"flex cursor-pointer"}),[a[17]||(a[17]=c("span",{class:"mt-3"},"Background color",-1)),c("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:q({backgroundColor:o(e).options.backgroundColor})},null,4)],16)]),default:f(()=>[u(K,{modelValue:o(e).options.backgroundColor,"onUpdate:modelValue":a[7]||(a[7]=n=>o(e).options.backgroundColor=n),label:"Background","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),u(Y,{"close-on-content-click":!1},{activator:f(({props:n})=>[c("div",J(n,{class:"flex cursor-pointer"}),[a[18]||(a[18]=c("span",{class:"mt-3"},"Line color",-1)),c("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:q({backgroundColor:o(e).options.lineColor})},null,4)],16)]),default:f(()=>[u(K,{modelValue:o(e).options.lineColor,"onUpdate:modelValue":a[8]||(a[8]=n=>o(e).options.lineColor=n),label:"Line","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),u(N,{modelValue:o(e).options.lineThickness,"onUpdate:modelValue":a[9]||(a[9]=n=>o(e).options.lineThickness=n),modelModifiers:{number:!0},type:"number",label:"Line thickness",variant:"outlined",density:"compact",rules:[n=>n>0||"Must be greater than 0"],width:"140px","hide-details":""},null,8,["modelValue","rules"])])]),_:1,__:[19]})]),_:1}),u(F,null,{default:f(()=>[u(R,{cols:"12"},{default:f(()=>[a[20]||(a[20]=c("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Points",-1)),c("div",lt,[u(N,{modelValue:o(e).options.decimalPlaces,"onUpdate:modelValue":a[10]||(a[10]=n=>o(e).options.decimalPlaces=n),modelModifiers:{number:!0},type:"number",label:"Decimal places",variant:"outlined",density:"comfortable",rules:[n=>n>=0||"Must be 0 or greater"],hint:"Number of decimal places to be displayed",width:"160px",class:"ml-2"},null,8,["modelValue","rules"]),u(A,{modelValue:o(e).options.limitSamples,"onUpdate:modelValue":a[11]||(a[11]=n=>o(e).options.limitSamples=n),label:"Limit number of samples"},null,8,["modelValue"]),u(N,{modelValue:o(e).options.maxSamples,"onUpdate:modelValue":a[12]||(a[12]=n=>o(e).options.maxSamples=n),modelModifiers:{number:!0},type:"number",label:"Maximum samples",variant:"outlined",density:"comfortable",disabled:!o(e).options.limitSamples,rules:[n=>n>0||"Must be greater than 0"],hint:"Higher values will show more history but may impact performance",width:"220px"},null,8,["modelValue","disabled","rules"])]),c("div",nt,[u(A,{modelValue:o(e).options.updateOnConstantValue,"onUpdate:modelValue":a[13]||(a[13]=n=>o(e).options.updateOnConstantValue=n),label:"Update on constant value",hint:"Advance graph when value is unchanged (shows horizontal lines for constant values)","persistent-hint":""},null,8,["modelValue"])])]),_:1,__:[20]})]),_:1})]),actions:f(()=>[c("div",ot,[u(Ee,{onClick:a[14]||(a[14]=n=>o(r).widgetManagerVars(o(e).hash).configMenuOpen=!1)},{default:f(()=>a[21]||(a[21]=[Be("Close")])),_:1,__:[21]})])]),_:1},8,["modelValue"])],64))}}),rt=_e(st,[["__scopeId","data-v-98c977d7"]]);export{rt as default};
