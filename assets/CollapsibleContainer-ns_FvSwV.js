import{c as We,y as Fe,K as Se,aO as Ee,J as Oe,r as v,k as L,aG as Be,w as $e,L as Le,o as Te,D as ze,l as r,m as g,n as u,H as a,N as i,Q as w,af as P,G as j,av as se,aC as Ae,O as I,t as K,q as l,s as V,I as J,a6 as q,a0 as De,aP as Ue,aQ as N,aR as R,aS as je,aT as Ie,v as h,F as k,p as W,aU as Q,aV as _,aW as ne,V as oe,P as ie,U as de,aE as re,aw as Ne,aX as Re,W as Ge,am as He,aM as Xe,aY as Pe,aZ as Ke,_ as Je}from"./index-B3JxYYwD.js";const qe=["width","height"],Qe={class:"flex flex-col justify-between h-full pa-2 cursor-pointer"},_e={class:"flex justify-between w-full"},Ye={key:0},Ze={key:0},et={class:"flex"},tt={key:0,class:"flex rotate-[270deg] justify-center whitespace-nowrap"},lt={class:"flex justify-center h-full px-3 pt-2 gap-x-2"},at=["data-widget-hash"],st=["data-widget-hash"],nt={class:"flex flex-col justify-start items-start gap-x-4 mt-3 w-full"},ot={key:0,ref:"widgetTrashArea",class:"absolute w-32 h-32 -translate-x-32 -translate-y-32 bottom-[20%] left-1/3 bg-[#FF000055] z-[65] rounded-xl flex items-center justify-center hover:bg-slate-200/50 transition-all"},it={class:"relative flex justify-center items-center w-full h-full"},dt={class:"select-none"},rt={class:"flex w-full justify-center items-center mt-4"},ut=["value"],gt=We({__name:"CollapsibleContainer",props:{widget:{}},setup(ue){const o=Fe(),ge=Se(),{openSnackbar:F}=Ee(),b=ue,d=Oe(b).widget,m=v(b.widget),T=v(new Map),Y=v(!1),Z=v("justify-center"),ve=v(!1),G=v(!1),S=v(b.widget.name),M=v(null),z=v(b.widget.options.leftColumnWidth||50),ee=v(!1),E=v(null),c=v(!1),C=v("right"),A=v([]),D=v(!1),O=v(""),fe=()=>{if(O.value){try{o.copyWidgetToView(m.value,O.value),F({variant:"success",message:"Widget cloned successfully."})}catch(s){F({variant:"error",message:s.message||"Error cloning widget."})}D.value=!1,O.value=""}},H=()=>{if(E.value){const s=E.value.getBoundingClientRect(),e=window.innerWidth;s.left+s.width/2<e/2?C.value="left":C.value="right"}},me=L(()=>C.value==="left"?c.value?"mdi-chevron-right":"mdi-chevron-left":c.value?"mdi-chevron-left":"mdi-chevron-right"),pe=()=>{S.value=b.widget.name,G.value=!0,Xe(()=>{M.value&&(M.value.focus(),M.value.select())})},te=()=>{G.value=!1,m.value&&S.value!==m.value.name&&(m.value.name=S.value)},ce=s=>{var t;const e=(t=s.target.files)==null?void 0:t[0];if(!e){F({variant:"error",message:"No file selected.",duration:3e3});return}const p=new FileReader;p.onload=n=>{var x;try{const f=JSON.parse((x=n.target)==null?void 0:x.result),$=m.value.hash;o.loadWidgetFromFile($,f)}catch{F({variant:"error",message:"Invalid widget file format.",duration:3e3})}},p.readAsText(e)},B=v(!1),we=()=>{o.elementToShowOnDrawer=void 0,A.value=[]},U=s=>{if(ve.value=!1,s==="options")o.widgetManagerVars(m.value.hash).configMenuOpen=!0;else if(s==="save")he();else if(s==="load"){const e=document.createElement("input");e.type="file",e.accept=".widget",e.addEventListener("change",p=>{ce(p)}),e.click()}else s==="copy-to-view"&&(D.value=!0)},he=()=>{const s=new Blob([JSON.stringify(d.value)],{type:"application/json;charset=utf-8"}),e=`${d.value.name}.widget`;Pe(s,e)},be=s=>{if(!o.editingMode)return;const e=s.clientX,p=z.value;ee.value=!0;const t=x=>{if(!E.value)return;const f=E.value.offsetWidth,$=p+(x.clientX-e)/f*100;z.value=Math.max(10,Math.min(90,$))},n=()=>{ee.value=!1,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",n)},ye=L(()=>m.value.options.elementContainers.filter(s=>s.name.includes("left"))),xe=L(()=>m.value.options.elementContainers.filter(s=>s.name.includes("right"))),Ve=L(()=>Math.round(d.value.options.backgroundOpacity*255).toString(16)),ke=()=>{o.allowMovingAndResizing(m.value.hash,!0),window.addEventListener("mouseup",y),window.addEventListener("dragend",y)},y=()=>{H(),o.allowMovingAndResizing(m.value.hash,!1),window.removeEventListener("mouseup",y),window.removeEventListener("dragend",y)},le=(s,e)=>{const p=m.value.options.elementContainers.find(f=>f.name===e);if(!p)return;const t=p.elements.map(f=>f.hash),n=T.value.get(e)||[],x=t.find(f=>!n.includes(f));if(x){const f=p.elements.find($=>$.hash===x);if(f&&s.pullMode==="clone"){f.hash=Ke(),o.miniWidgetManagerVars(f.hash).configMenuOpen=!0,T.value.set(e,t);return}o.showElementPropsDrawer(f.hash),T.value.set(e,t)}},{width:ae}=Be(),X=L(()=>({width:m.value.size.width*ae.value,height:m.value.size.height*ae.value})),Me=v(null);$e(()=>o.editingMode,s=>{s===!0&&(y(),c.value=!1)});const Ce=()=>{try{const s=o.editWidgetByHash(b.widget.hash);s&&(m.value=s)}catch{F({variant:"warning",message:"Error reading widget file.",duration:1e3})}};return Le(()=>{b.widget.options.elementContainers.forEach(s=>{T.value.set(s.name,s.elements.map(e=>e.hash))})}),Te(()=>{H(),window.addEventListener("resize",H),Me.value=document.querySelector(".main"),Ce(),y()}),(s,e)=>{const p=ze("FontAwesomeIcon");return r(),g(k,null,[u("div",{ref_key:"widgetBase",ref:E,class:h(["h-full rounded-lg overflow-hidden",[c.value?"w-[40px]":"w-full",c.value&&C.value==="left"?"ml-0 mr-auto":"",c.value&&C.value==="right"?"mr-0 ml-auto":""]]),width:X.value.width,height:X.value.height,style:I([l(ge).globalGlassMenuStyles,{backgroundColor:`${l(d).options.backgroundColor+Ve.value}`,backdropFilter:`blur(${l(d).options.backgroundBlur}px)`}])},[u("div",Qe,[u("div",_e,[a(P,{class:"cursor-grab opacity-40",onMousedown:ke,onMouseup:y},{default:i(()=>e[20]||(e[20]=[w(" mdi-drag ")])),_:1}),c.value?V("",!0):(r(),g("div",Ye,[G.value?(r(),g("div",Ze,[j(u("input",{ref_key:"nameInput",ref:M,"onUpdate:modelValue":e[0]||(e[0]=t=>S.value=t),class:"border-b border-gray-400",onBlur:te,onKeyup:Ae(te,["enter"])},null,544),[[se,S.value]])])):(r(),g("p",{key:1,class:"whitespace-nowrap overflow-hidden text-ellipsis",style:I({maxWidth:`${X.value.width*.8}px`}),onDblclick:pe},K(l(d).name),37))])),u("div",et,[l(o).editingMode?(r(),J(je,{key:0,theme:"dark"},{activator:i(({props:t})=>[a(q,De({size:"20",icon:"mdi-dots-vertical",variant:"text"},t),null,16)]),default:i(()=>[a(Ue,null,{default:i(()=>[a(N,{onClick:e[1]||(e[1]=t=>U("options"))},{default:i(()=>[a(R,null,{default:i(()=>e[21]||(e[21]=[w("Options")])),_:1})]),_:1}),a(N,{onClick:e[2]||(e[2]=t=>U("save"))},{default:i(()=>[a(R,null,{default:i(()=>e[22]||(e[22]=[w("Save")])),_:1})]),_:1}),a(N,{onClick:e[3]||(e[3]=t=>U("load"))},{default:i(()=>[a(R,null,{default:i(()=>e[23]||(e[23]=[w("Load")])),_:1})]),_:1}),a(N,{onClick:e[4]||(e[4]=t=>U("copy-to-view"))},{default:i(()=>[a(R,null,{default:i(()=>e[24]||(e[24]=[w("Clone to another view")])),_:1})]),_:1})]),_:1})]),_:1})):V("",!0)])]),c.value?(r(),g("div",tt,K(l(d).name),1)):V("",!0),j(u("div",lt,[u("div",{class:h(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[l(o).editingMode?"border-[1px]":"border-0"]]),style:I({width:l(d).options.columns>1?`${z.value}%`:"100%"})},[(r(!0),g(k,null,W(ye.value,t=>(r(),g("div",{key:t.name,class:"w-full h-full"},[a(l(_),{modelValue:t.elements,"onUpdate:modelValue":n=>t.elements=n,disabled:!l(o).editingMode,animation:150,group:"generalGroup",class:h(["flex items-center w-full h-full gap-2 px-2",[Y.value?"flex-wrap":"",Z.value]]),onAdd:n=>le(n,t.name),onStart:e[5]||(e[5]=n=>B.value=!0),onEnd:e[6]||(e[6]=n=>B.value=!1)},{default:i(()=>[(r(!0),g(k,null,W(t.elements,n=>(r(),g("div",{key:n.hash,"data-widget-hash":n.hash,class:h(["rounded-md w-full",{"cursor-grab":l(o).editingMode,"bg-slate-400":l(o).miniWidgetManagerVars(n.hash).highlighted}])},[a(Q,{"mini-widget":n},null,8,["mini-widget"])],10,at))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6),l(d).options.columns>1&&l(o).editingMode?(r(),g("div",{key:0,class:"cursor-col-resize w-1 bg-[#FFFFFF22] relative",onMousedown:be},e[25]||(e[25]=[u("div",{class:"absolute inset-y-0 -left-1 -right-1"},null,-1)]),32)):V("",!0),l(d).options.columns>1?(r(),g("div",{key:1,class:h(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[l(o).editingMode?"border-[1px]":"border-0"]]),style:I({width:`${100-z.value}%`})},[(r(!0),g(k,null,W(xe.value,t=>(r(),g("div",{key:t.name,class:"w-full h-full"},[a(l(_),{modelValue:t.elements,"onUpdate:modelValue":n=>t.elements=n,disabled:!l(o).editingMode,animation:150,group:"generalGroup",class:h(["flex items-center w-full h-full gap-2 px-2",[Y.value?"flex-wrap":"",Z.value]]),onAdd:n=>le(n,t.name),onStart:e[7]||(e[7]=n=>B.value=!0),onEnd:e[8]||(e[8]=n=>B.value=!1)},{default:i(()=>[(r(!0),g(k,null,W(t.elements,n=>(r(),g("div",{key:n.hash,"data-widget-hash":n.hash,class:h(["rounded-md w-full",{"cursor-grab":l(o).editingMode,"bg-slate-400":l(o).miniWidgetManagerVars(n.hash).highlighted}])},[a(Q,{"mini-widget":n},null,8,["mini-widget"])],10,st))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6)):V("",!0)],512),[[Ie,!c.value]]),e[26]||(e[26]=u("div",null,null,-1)),l(o).editingMode?V("",!0):(r(),J(q,{key:1,class:h(["fixed bottom-[2px]",C.value==="left"?"left-[2px]":"right-[2px]"]),icon:me.value,variant:"text",size:"36",onClick:e[9]||(e[9]=t=>c.value=!c.value)},null,8,["class","icon"]))])],14,qe),(r(),J(He,{to:"body"},[a(Ge,{modelValue:l(o).widgetManagerVars(l(d).hash).configMenuOpen,"onUpdate:modelValue":e[19]||(e[19]=t=>l(o).widgetManagerVars(l(d).hash).configMenuOpen=t),persistent:""},{default:i(()=>[a(ne,{"is-visible":l(o).widgetManagerVars(l(d).hash).configMenuOpen},{default:i(()=>[a(oe,{class:"px-8 pb-6 pt-2 rounded-lg w-[400px] bg-transparent"},{default:i(()=>[a(ie,{class:"text-center -mt-1"},{default:i(()=>e[27]||(e[27]=[w("Custom Widget options")])),_:1}),a(q,{class:"absolute top-3 right-0 text-lg rounded-full",variant:"text",size:"small",onClick:e[10]||(e[10]=t=>l(o).widgetManagerVars(l(d).hash).configMenuOpen=!1)},{default:i(()=>[a(P,null,{default:i(()=>e[28]||(e[28]=[w("mdi-close")])),_:1})]),_:1}),u("div",nt,[e[29]||(e[29]=u("p",{class:"text-start"},"Name:",-1)),a(de,{ref_key:"nameInput",ref:M,modelValue:l(d).name,"onUpdate:modelValue":e[11]||(e[11]=t=>l(d).name=t),density:"compact",class:"w-3/4"},null,8,["modelValue"]),e[30]||(e[30]=u("p",{class:"text-start"},"Columns:",-1)),a(de,{ref_key:"nameInput",ref:M,modelValue:l(d).options.columns,"onUpdate:modelValue":e[12]||(e[12]=t=>l(d).options.columns=t),min:"1",max:"2",type:"number",density:"compact",class:"w-1/4"},null,8,["modelValue"]),e[31]||(e[31]=u("p",{class:"mt-1"},"Background color",-1)),j(u("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>l(d).options.backgroundColor=t),type:"color",class:"p-0 w-20 mr-4"},null,512),[[se,l(d).options.backgroundColor]]),e[32]||(e[32]=u("p",{class:"mt-3"},"Background opacity:",-1)),a(re,{modelValue:l(d).options.backgroundOpacity,"onUpdate:modelValue":e[14]||(e[14]=t=>l(d).options.backgroundOpacity=t),min:"0",max:"1",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"]),e[33]||(e[33]=u("p",{class:"mt-3"},"Background blur:",-1)),a(re,{modelValue:l(d).options.backgroundBlur,"onUpdate:modelValue":e[15]||(e[15]=t=>l(d).options.backgroundBlur=t),min:"0",max:"100",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"])])]),_:1})]),_:1},8,["is-visible"]),a(Ne,null,{default:i(()=>[B.value?(r(),g("div",ot,[u("div",it,[a(p,{icon:"fa-solid fa-trash",class:"absolute h-16 transition-all -translate-x-7 -translate-y-8 top-1/2 left-1/2 text-white"}),a(l(_),{modelValue:A.value,"onUpdate:modelValue":e[16]||(e[16]=t=>A.value=t),animation:150,group:"generalGroup",class:"flex flex-wrap items-center justify-center w-full h-full gap-2",onAdd:we},{default:i(()=>[(r(!0),g(k,null,W(A.value,t=>(r(),g("div",{key:t.hash},[u("div",dt,[a(Q,{"mini-widget":t},null,8,["mini-widget"])])]))),128))]),_:1},8,["modelValue"])])],512)):V("",!0)]),_:1}),a(ne,{"is-visible":D.value},{default:i(()=>[a(oe,{class:"px-3 pb-6 pt-2 rounded-lg w-auto bg-transparent z-40"},{default:i(()=>[a(ie,{class:"flex justify-around -mt-1 w-full px-0"},{default:i(()=>[e[35]||(e[35]=u("div",null,null,-1)),e[36]||(e[36]=u("p",{class:"mx-8"},"Clone widget to",-1)),a(P,{class:"cursor-pointer self-end",onClick:e[17]||(e[17]=t=>D.value=!1)},{default:i(()=>e[34]||(e[34]=[w("mdi-close")])),_:1})]),_:1}),u("div",rt,[j(u("select",{"onUpdate:modelValue":e[18]||(e[18]=t=>O.value=t),class:"bg-[#50505022] dark:bg-gray-800 dark:text-white w-[180px] p-2 border border-gray-300 dark:border-gray-600 rounded appearance-none",onChange:fe},[(r(!0),g(k,null,W(l(o).currentProfile.views,t=>(r(),g("option",{key:t.name,value:t.name,class:"bg-gray-800 dark:bg-gray-800 dark:text-white"},K(t.name),9,ut))),128))],544),[[Re,O.value]])])]),_:1})]),_:1},8,["is-visible"])]),_:1},8,["modelValue"])]))],64)}}}),ft=Je(gt,[["__scopeId","data-v-ec042de7"]]);export{ft as default};
