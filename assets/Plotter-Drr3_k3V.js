import{bW as T,bT as R,b1 as ee,b2 as te,bj as ae,b4 as le,k as S,bX as ne,c as we,y as Ce,J as xe,r as x,L as Se,o as Le,ay as Pe,aq as Ne,ax as Me,h as Te,bY as Ie,w as N,at as je,aG as De,aK as $e,aM as Ue,aJ as Ee,l as E,m as O,q as o,n as c,H as u,N as f,U as M,ai as Oe,S as K,aS as Y,a0 as J,O as q,aN as Q,a6 as Be,Q as Ae,a7 as Re,F as Fe,aB as X,_ as We}from"./index--yn_uFz7.js";const oe=T.reduce((l,r)=>(l[r]={type:[Boolean,String,Number],default:!1},l),{}),se=T.reduce((l,r)=>{const i="offset"+R(r);return l[i]={type:[String,Number],default:null},l},{}),ie=T.reduce((l,r)=>{const i="order"+R(r);return l[i]={type:[String,Number],default:null},l},{}),Z={col:Object.keys(oe),offset:Object.keys(se),order:Object.keys(ie)};function Ge(l,r,i){let e=l;if(!(i==null||i===!1)){if(r){const s=r.replace(l,"");e+=`-${s}`}return l==="col"&&(e="v-"+e),l==="col"&&(i===""||i===!0)||(e+=`-${i}`),e.toLowerCase()}}const ze=["auto","start","end","center","baseline","stretch"],He=ee({cols:{type:[Boolean,String,Number],default:!1},...oe,offset:{type:[String,Number],default:null},...se,order:{type:[String,Number],default:null},...ie,alignSelf:{type:String,default:null,validator:l=>ze.includes(l)},...te(),...ae()},"VCol"),B=le()({name:"VCol",props:He(),setup(l,r){let{slots:i}=r;const e=S(()=>{const s=[];let m;for(m in Z)Z[m].forEach(g=>{const v=l[g],p=Ge(m,g,v);p&&s.push(p)});const b=s.some(g=>g.startsWith("v-col-"));return s.push({"v-col":!b||!l.cols,[`v-col-${l.cols}`]:l.cols,[`offset-${l.offset}`]:l.offset,[`order-${l.order}`]:l.order,[`align-self-${l.alignSelf}`]:l.alignSelf}),s});return()=>{var s;return ne(l.tag,{class:[e.value,l.class],style:l.style},(s=i.default)==null?void 0:s.call(i))}}}),F=["start","end","center"],re=["space-between","space-around","space-evenly"];function W(l,r){return T.reduce((i,e)=>{const s=l+R(e);return i[s]=r(),i},{})}const Ke=[...F,"baseline","stretch"],ue=l=>Ke.includes(l),de=W("align",()=>({type:String,default:null,validator:ue})),Ye=[...F,...re],ce=l=>Ye.includes(l),me=W("justify",()=>({type:String,default:null,validator:ce})),Je=[...F,...re,"stretch"],fe=l=>Je.includes(l),pe=W("alignContent",()=>({type:String,default:null,validator:fe})),_={align:Object.keys(de),justify:Object.keys(me),alignContent:Object.keys(pe)},qe={align:"align",justify:"justify",alignContent:"align-content"};function Qe(l,r,i){let e=qe[l];if(i!=null){if(r){const s=r.replace(l,"");e+=`-${s}`}return e+=`-${i}`,e.toLowerCase()}}const Xe=ee({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:ue},...de,justify:{type:String,default:null,validator:ce},...me,alignContent:{type:String,default:null,validator:fe},...pe,...te(),...ae()},"VRow"),A=le()({name:"VRow",props:Xe(),setup(l,r){let{slots:i}=r;const e=S(()=>{const s=[];let m;for(m in _)_[m].forEach(b=>{const g=l[b],v=Qe(m,b,g);v&&s.push(v)});return s.push({"v-row--no-gutters":l.noGutters,"v-row--dense":l.dense,[`align-${l.align}`]:l.align,[`justify-${l.justify}`]:l.justify,[`align-content-${l.alignContent}`]:l.alignContent}),s});return()=>{var s;return ne(l.tag,{class:["v-row",e.value,l.class],style:l.style},(s=i.default)==null?void 0:s.call(i))}}}),Ze={key:0,class:"w-full h-full flex items-center justify-center text-center text-white text-h5 font-weight-bold p-4 overflow-hidden"},_e={key:1,class:"main"},et=["width","height"],tt={class:"ml-2"},at={class:"ml-2 flex gap-x-8"},lt={class:"ml-2 flex gap-x-8"},nt={class:"flex w-full justify-end my-2"},ot=we({__name:"Plotter",props:{widget:{}},setup(l){const r=Ce(),e=xe(l).widget,s=x([]);let m,b;Se(()=>{const t={backgroundColor:"rgba(0, 0, 0, 0.7)",lineColor:"rgba(255, 0, 0, 1.0)",dataLakeVariableId:void 0,maxSamples:1e3,limitSamples:!0,lineThickness:1,decimalPlaces:2,showTitle:!0};e.value.options={...t,...e.value.options}}),Le(()=>{if(H(e.value.options.dataLakeVariableId),s.value=Object.values(Pe()),b=Ne(t=>{s.value=Object.values(t)}),d.length===0){const t=Me(e.value.options.dataLakeVariableId);t&&z(t)}}),Te(()=>{b&&Ie(b),m&&X(e.value.options.dataLakeVariableId,m)});const g=S(()=>s.value.filter(t=>t.type==="number")),v=x(""),p=x(!1);N(()=>e.value.options.dataLakeVariableId,()=>p.value=!1);const be=S(()=>{const t=(v.value||"").toLowerCase();return g.value.filter(a=>a.name.toLowerCase().includes(t))}),G=()=>{e.value.options.limitSamples&&(d.length===e.value.options.maxSamples+1?d.shift():d.length>e.value.options.maxSamples&&d.splice(0,d.length-e.value.options.maxSamples))},z=t=>{d.push(t),G(),j()},H=(t,a)=>{if(t===void 0){console.error("No data lake variable ID provided!");return}a!==void 0&&m&&X(a,m),m=je(t,n=>z(n))};N(()=>e.value.options.dataLakeVariableId,(t,a)=>{H(t,a),d.length=0});const{width:ge,height:ve}=De(),k=S(()=>({width:e.value.size.width*ge.value,height:e.value.size.height*ve.value})),y=x(),I=x(),L=(t,a,n,h)=>{const D=t.measureText(a),V=4;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(n-V,h-16-V,D.width+V*2,16+V*2),t.fillStyle=e.value.options.lineColor,t.fillText(a,n,h)},j=()=>{if(y.value===void 0||y.value===null)return;if(I.value===void 0){console.debug("Canvas context undefined!"),I.value=y.value.getContext("2d");return}const t=I.value,a=k.value.width,n=k.value.height;$e(t),t.clearRect(0,0,a,n),t.fillStyle=e.value.options.backgroundColor,t.fillRect(0,0,a,n),t.strokeStyle=e.value.options.lineColor,t.lineWidth=Math.max(e.value.options.lineThickness,1);try{w=Math.max(...d),C=Math.min(...d);const h=.05*(w!=C?w-C:1),D=w+h,V=C-h,Ve=d[d.length-1];if(t.beginPath(),t.moveTo(0,n/2),t.setLineDash([]),d.length===0?(t.beginPath(),t.arc(0,n/2,7,0,2*Math.PI),t.stroke()):d.length===1?(t.fillStyle=e.value.options.lineColor,t.beginPath(),t.arc(0,n/2,7,0,2*Math.PI),t.fill(),t.beginPath(),t.setLineDash([5,5]),t.moveTo(0,n/2),t.lineTo(50,n/2),t.stroke()):(t.setLineDash([]),d.forEach((P,U)=>{const ke=U*(a/d.length),ye=n-(P-V)/(D-V)*n;t.lineTo(ke,ye)})),t.stroke(),t.font="14px monospace",t.textBaseline="bottom",e.value.options.showTitle&&e.value.options.dataLakeVariableId){const P=s.value.find(U=>U.id===e.value.options.dataLakeVariableId);P&&(L(t,P.name,10,26),t.textBaseline="bottom")}const $=e.value.options.decimalPlaces;L(t,`Current: ${Number(Ve).toFixed($)}`,10,n-10),L(t,`Min: ${Number(C).toFixed($)}`,10,n-30),L(t,`Max: ${Number(w).toFixed($)}`,10,n-50)}catch(h){console.error("Error drawing graph:",h)}},d=[];let w=0,C=0;N([k,e],()=>{r.isWidgetVisible(e.value)&&(G(),Ue(()=>j()))},{deep:!0});const he=Ee(y);return N(he,(t,a)=>{t&&!a&&j()}),(t,a)=>(E(),O(Fe,null,[o(e).options.dataLakeVariableId?(E(),O("div",_e,[c("canvas",{ref_key:"canvasRef",ref:y,width:k.value.width,height:k.value.height},null,8,et)])):(E(),O("p",Ze," Please open the Plotter widget configuration menu to select a variable to be plotted. ")),u(Re,{modelValue:o(r).widgetManagerVars(o(e).hash).configMenuOpen,"onUpdate:modelValue":a[14]||(a[14]=n=>o(r).widgetManagerVars(o(e).hash).configMenuOpen=n),title:"Plotter config",variant:"text-only"},{content:f(()=>[u(A,null,{default:f(()=>[u(B,{cols:"12"},{default:f(()=>[a[15]||(a[15]=c("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Source",-1)),c("div",tt,[u(M,{modelValue:v.value,"onUpdate:modelValue":[a[0]||(a[0]=n=>v.value=n),a[1]||(a[1]=n=>p.value=!0)],density:"compact",variant:"filled",theme:"dark",type:"text",placeholder:"Search variables...",class:"mb-4",clearable:"","onClick:clear":a[2]||(a[2]=n=>p.value=!1),"onUpdate:focused":a[3]||(a[3]=n=>p.value=n)},null,8,["modelValue"]),u(Oe,{modelValue:o(e).options.dataLakeVariableId,"onUpdate:modelValue":a[4]||(a[4]=n=>o(e).options.dataLakeVariableId=n),items:be.value,"item-title":"name","item-value":"id",label:"Data Lake variable",hint:"Select a variable to be plotted","persistent-hint":"",theme:"dark",variant:"outlined",density:"comfortable","menu-props":{modelValue:p.value},onClick:a[5]||(a[5]=n=>p.value=!p.value)},null,8,["modelValue","items","menu-props"])])]),_:1})]),_:1}),u(A,null,{default:f(()=>[u(B,{cols:"12"},{default:f(()=>[a[18]||(a[18]=c("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Appearance",-1)),c("div",at,[u(K,{modelValue:o(e).options.showTitle,"onUpdate:modelValue":a[6]||(a[6]=n=>o(e).options.showTitle=n),label:"Show title","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),u(Y,{"close-on-content-click":!1},{activator:f(({props:n})=>[c("div",J(n,{class:"flex cursor-pointer"}),[a[16]||(a[16]=c("span",{class:"mt-3"},"Background color",-1)),c("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:q({backgroundColor:o(e).options.backgroundColor})},null,4)],16)]),default:f(()=>[u(Q,{modelValue:o(e).options.backgroundColor,"onUpdate:modelValue":a[7]||(a[7]=n=>o(e).options.backgroundColor=n),label:"Background","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),u(Y,{"close-on-content-click":!1},{activator:f(({props:n})=>[c("div",J(n,{class:"flex cursor-pointer"}),[a[17]||(a[17]=c("span",{class:"mt-3"},"Line color",-1)),c("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:q({backgroundColor:o(e).options.lineColor})},null,4)],16)]),default:f(()=>[u(Q,{modelValue:o(e).options.lineColor,"onUpdate:modelValue":a[8]||(a[8]=n=>o(e).options.lineColor=n),label:"Line","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),u(M,{modelValue:o(e).options.lineThickness,"onUpdate:modelValue":a[9]||(a[9]=n=>o(e).options.lineThickness=n),modelModifiers:{number:!0},type:"number",label:"Line thickness",variant:"outlined",density:"compact",rules:[n=>n>0||"Must be greater than 0"],width:"140px","hide-details":""},null,8,["modelValue","rules"])])]),_:1})]),_:1}),u(A,null,{default:f(()=>[u(B,{cols:"12"},{default:f(()=>[a[19]||(a[19]=c("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Points",-1)),c("div",lt,[u(M,{modelValue:o(e).options.decimalPlaces,"onUpdate:modelValue":a[10]||(a[10]=n=>o(e).options.decimalPlaces=n),modelModifiers:{number:!0},type:"number",label:"Decimal places",variant:"outlined",density:"comfortable",rules:[n=>n>=0||"Must be 0 or greater"],hint:"Number of decimal places to be displayed",width:"160px",class:"ml-2"},null,8,["modelValue","rules"]),u(K,{modelValue:o(e).options.limitSamples,"onUpdate:modelValue":a[11]||(a[11]=n=>o(e).options.limitSamples=n),label:"Limit number of samples"},null,8,["modelValue"]),u(M,{modelValue:o(e).options.maxSamples,"onUpdate:modelValue":a[12]||(a[12]=n=>o(e).options.maxSamples=n),modelModifiers:{number:!0},type:"number",label:"Maximum samples",variant:"outlined",density:"comfortable",disabled:!o(e).options.limitSamples,rules:[n=>n>0||"Must be greater than 0"],hint:"Higher values will show more history but may impact performance",width:"220px"},null,8,["modelValue","disabled","rules"])])]),_:1})]),_:1})]),actions:f(()=>[c("div",nt,[u(Be,{onClick:a[13]||(a[13]=n=>o(r).widgetManagerVars(o(e).hash).configMenuOpen=!1)},{default:f(()=>a[20]||(a[20]=[Ae("Close")])),_:1})])]),_:1},8,["modelValue"])],64))}}),it=We(ot,[["__scopeId","data-v-7d1b75bc"]]);export{it as default};
