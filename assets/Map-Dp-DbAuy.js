import{c as Ye,bP as xt,K as oa,bQ as la,r as c,w,h as I,s as q,n as O,E as v,p as $,q as n,Z as Le,J as ia,Q as St,ar as Lt,ay as sa,aY as Ee,o as Ot,az as z,U as Et,x as ce,z as r,W as It,V as G,aa as wt,G as N,X as At,aA as $t,m as j,F as _t,C as na,aB as Oe,bM as ra,a_ as ua,y as Ue,B as Ne,Y as kt,v as Z,aQ as ca,an as We,bH as da,$ as Pt,_ as Dt,bD as va,t as ma,ag as pa,u as fa,bR as U,l as ga,S as Ct,a1 as Mt,R as ha,bS as ba,bT as Ve,bU as d,bV as ya,bW as E,am as xa,aU as wa,bX as ka,bY as Ca,bZ as ee,b_ as Ma,b$ as Ta,c0 as Va,a4 as Sa,e as La,bj as Oa,P as Tt,a9 as ge,a$ as Ea,ab as Ia,aG as ue,a8 as Se,c1 as Aa,H as Vt,c2 as $a,c3 as _a}from"./index-Du36eRUo.js";const Pa=""+new URL("arducopter-top-view-DWT9mmA0.png",import.meta.url).href,Da={class:"flex items-center gap-2 mb-6"},Fa={class:"flex items-center gap-2 mb-6"},Ba={class:"flex items-center gap-2 mb-2"},Ha=Ye({__name:"GlobalOriginDialog",props:xt({vehicle:{},initialLatitude:{},initialLongitude:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:xt(["origin-set"],["update:modelValue"]),setup(te,{emit:ae}){const{openSnackbar:g}=oa(),M=la(te,"modelValue"),K=ae,T=te,i=c(T.initialLatitude),u=c(T.initialLongitude),a=c(0),V=c(!1);w(()=>[T.initialLatitude,T.initialLongitude],([B,h])=>{i.value=B,u.value=h});const S=I(()=>i.value!==null&&i.value!==void 0&&i.value>=-90&&i.value<=90&&u.value!==null&&u.value!==void 0&&u.value>=-180&&u.value<=180&&a.value!==null&&a.value!==void 0),k=()=>{M.value=!1},Q=()=>{if(!(!S.value||V.value)){if(T.vehicle===void 0||T.vehicle.dateLastHeartbeat()===void 0||T.vehicle.dateLastHeartbeat()>new Date(Date.now()-5e3)){g({message:"Cannot set global origin. Vehicle does not appear to be online.",variant:"error"});return}V.value=!0;try{T.vehicle.setGlobalOrigin([i.value,u.value],a.value),g({message:"Global origin set successfully.",variant:"success"}),K("origin-set",i.value,u.value),k()}catch(B){g({message:`Failed to set global origin: ${B}`,variant:"error"})}finally{V.value=!1}}},A=I(()=>[{text:"Cancel",action:k,disabled:V.value},{text:V.value?"Saving...":"Save",disabled:!S.value||V.value,action:Q,class:V.value?"opacity-70":""}]);return(B,h)=>(O(),q(ia,{"show-dialog":M.value,title:"Set Global Origin",variant:"text-only","max-width":"500px",actions:A.value,"onUpdate:showDialog":h[3]||(h[3]=m=>M.value=m)},{content:v(()=>[h[7]||(h[7]=$("p",{class:"text-sm mb-8 -mt-6 text-gray-300"}," This feature allows you to set the GNSS coordinates of the vehicle's local origin (0,0,0). This is useful when using local position units (such as indoor positioning systems or DVLs) where you want to define a corresponding global position. ",-1)),$("div",Da,[n(Le,{modelValue:i.value,"onUpdate:modelValue":h[0]||(h[0]=m=>i.value=m),modelModifiers:{number:!0},label:"Latitude",type:"number",step:"0.000001",hint:"Latitude in degrees (-90 to 90)","persistent-hint":"",variant:"outlined",rules:[m=>m!=null||"Latitude is required",m=>m>=-90&&m<=90||"Latitude must be between -90 and 90"],class:"flex-1"},null,8,["modelValue","rules"]),h[4]||(h[4]=$("span",{class:"text-white text-lg font-medium mb-6 w-4"},"°",-1))]),$("div",Fa,[n(Le,{modelValue:u.value,"onUpdate:modelValue":h[1]||(h[1]=m=>u.value=m),modelModifiers:{number:!0},label:"Longitude",type:"number",step:"0.000001",hint:"Longitude in degrees (-180 to 180)","persistent-hint":"",variant:"outlined",rules:[m=>m!=null||"Longitude is required",m=>m>=-180&&m<=180||"Longitude must be between -180 and 180"],class:"flex-1"},null,8,["modelValue","rules"]),h[5]||(h[5]=$("span",{class:"text-white text-lg font-medium mb-6 w-4"},"°",-1))]),$("div",Ba,[n(Le,{modelValue:a.value,"onUpdate:modelValue":h[2]||(h[2]=m=>a.value=m),modelModifiers:{number:!0},label:"Altitude",type:"number",step:"0.1",hint:"Altitude in meters (MSL)","persistent-hint":"",variant:"outlined",rules:[m=>m!=null||"Altitude is required"],class:"flex-1"},null,8,["modelValue","rules"]),h[6]||(h[6]=$("span",{class:"text-white text-lg font-medium mb-6 w-4"},"m",-1))])]),_:1},8,["show-dialog","actions"]))}}),za={class:"flex justify-end"},Ga={key:0,class:"fixed top-[80px] right-5"},Ra={key:1,class:"flex w-full items-center"},Ua={class:"flex justify-between w-full py-1 px-2 pt-3"},Na={class:"flex items-center"},Wa=Ye({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(te,{emit:ae}){const g=St(),M=Lt(),K=te,T=ae,i=sa("cockpit-pre-arm-checklist",[]),u=c({}),a=c(""),V=c(null),S=c(!1),k=I(()=>K.modelValue),Q=()=>{const y={};for(const l of i.value??[])y[l.id]=!1;u.value=y},A=I(()=>{if(!M.showChecklistBeforeArm)return!0;const y=i.value??[];return y.length>0&&y.every(l=>u.value[l.id]===!0)});w(()=>k.value,y=>{y?(Q(),Ee(()=>{var l,p;return(p=(l=V.value)==null?void 0:l.focus)==null?void 0:p.call(l)})):(u.value={},S.value=!1)}),w(()=>i.value,y=>{if(!k.value)return;const l={...u.value},p={};for(const L of y??[])p[L.id]=!0,L.id in l||(l[L.id]=!1);for(const L of Object.keys(l)){const R=Number(L);p[R]||delete l[R]}u.value=l},{deep:!0});const B=async()=>{var p,L;const y=a.value.trim();if(!y)return;const l={id:Date.now(),text:y};i.value.push(l),k.value&&(u.value[l.id]=!1),a.value="",await Ee(),(L=(p=V.value)==null?void 0:p.focus)==null||L.call(p)},h=y=>{if(i.value=i.value.filter(l=>l.id!==y),y in u.value){const l={...u.value};delete l[y],u.value=l}},m=()=>{T("dismissed"),T("update:modelValue",!1)},de=()=>{T("confirmed",!0),T("update:modelValue",!1)};return Ot(()=>{i.value.length===0&&(i.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),k.value&&Q()}),w(()=>M.showChecklistBeforeArm,y=>{y||z({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(y,l)=>(O(),q(Pt,{modelValue:k.value,"onUpdate:modelValue":l[4]||(l[4]=p=>k.value=p),"max-width":"600",scrollable:"",persistent:""},{default:v(()=>[n(Et,{style:ce(r(g).globalGlassMenuStyles),class:"rounded-lg"},{default:v(()=>[n(It,{class:"text-center relative pt-3"},{default:v(()=>[l[6]||(l[6]=$("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),n(G,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:m},{default:v(()=>[n(wt,null,{default:v(()=>l[5]||(l[5]=[N("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),n(At,{class:"mt-[-10px]"},{default:v(()=>[n($t,{lines:"one",theme:"dark",class:"bg-transparent"},{default:v(()=>[(O(!0),j(_t,null,na(r(i),p=>(O(),q(Oe,{key:p.id,theme:"dark"},ra({prepend:v(()=>[n(kt,{modelValue:u.value[p.id],"onUpdate:modelValue":L=>u.value[p.id]=L,class:"mt-0","hide-details":"",density:"compact",disabled:!r(M).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:v(()=>[n(ua,{class:Ue([{"line-through opacity-60":u.value[p.id]},{"opacity-50":!r(M).showChecklistBeforeArm}])},{default:v(()=>[N(Ne(p.text),1)]),_:2},1032,["class"])]),_:2},[S.value&&r(i).length>1?{name:"append",fn:v(()=>[n(G,{icon:"",variant:"text",disabled:!r(M).showChecklistBeforeArm,onClick:L=>h(p.id)},{default:v(()=>[n(wt,null,{default:v(()=>l[7]||(l[7]=[N("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),$("div",za,[S.value?(O(),j("div",Ra,[S.value?(O(),q(Le,{key:0,ref_key:"newItemInput",ref:V,modelValue:a.value,"onUpdate:modelValue":l[1]||(l[1]=p=>a.value=p),disabled:!r(M).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:ca(B,["enter"]),"onClick:appendInner":B},null,8,["modelValue","disabled"])):Z("",!0),n(G,{"prepend-icon":"mdi-check",disabled:!r(M).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:l[2]||(l[2]=()=>{S.value=!1,B()})},{default:v(()=>l[9]||(l[9]=[N("Done")])),_:1,__:[9]},8,["disabled"])])):(O(),j("div",Ga,[n(G,{"prepend-icon":"mdi-format-list-checks",disabled:!r(M).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:l[0]||(l[0]=p=>S.value=!0)},{default:v(()=>l[8]||(l[8]=[N(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),n(We,{class:"flex center w-[80%]",inset:""}),n(da,null,{default:v(()=>[$("div",Ua,[n(G,{variant:"text",onClick:m},{default:v(()=>l[10]||(l[10]=[N("Cancel")])),_:1,__:[10]}),$("div",Na,[n(kt,{"model-value":!r(M).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":l[3]||(l[3]=p=>r(M).showChecklistBeforeArm=!p)},null,8,["model-value"]),l[11]||(l[11]=$("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),n(G,{color:"#ffffff33",class:Ue({"opacity-30":!A.value}),variant:"flat",disabled:!A.value,onClick:de},{default:v(()=>l[12]||(l[12]=[N("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),Ya=Dt(Wa,[["__scopeId","data-v-b0b8e43a"]]),Za=["id"],qa={key:0},ja=Ye({__name:"Map",props:{widget:{}},setup(te){var ht;va(e=>({"6bd332e8":Qt.value}));const ae=te,g=ma(ae).widget,M=St(),{showDialog:K,closeDialog:T}=pa(),i=fa(),u=Lt(),a=U(),V=c(u.defaultMapZoom),S=c(u.defaultMapCenter),k=c(),Q=I(()=>`map-${g.value.hash}`),A=I(()=>Ae.value||oe.value),B=c(!1),h=c([]),m=c(),de=c(!1),y=c(!1),l=c(!1),p=c(!1),L=c(0),R=c(0),he=c("");let be,ye,xe;const oe=c(!1),Ft=()=>{be==null||be.click(),oe.value=!1},Bt=()=>{ye==null||ye.click(),oe.value=!1},Ht=()=>{xe==null||xe.click(),oe.value=!1};let Ze;const qe=e=>{e.touches.length>1&&(y.value=!0,Y.value&&Me(),clearTimeout(Ze))},je=e=>{e.touches.length<=1&&(Ze=window.setTimeout(()=>y.value=!1,300))},le=c(null),H=U({});Ct.registerUsage(Mt.latitude),Ct.registerUsage(Mt.longitude),ha(()=>{Object.keys(g.value.options).length===0&&(g.value.options={showVehiclePath:!0,showCoordinateGrid:!1}),g.value.options.showCoordinateGrid===void 0&&(g.value.options.showCoordinateGrid=!1),_.enableAutoUpdate()});const Ie=Ve.tileLayerOffline("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),we=Ve.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),ke=Ve.tileLayerOffline("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),Ke=d.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),Qe={OpenStreetMap:Ie,"Esri World Imagery":we},zt={Seamarks:ke,"Marine Profile":Ke},ie=c(),Ae=ga(ie),Xe=d.control.zoom({position:"bottomright"}),Je=d.control.layers(Qe,zt),ve=U(void 0);w(A,()=>{a.value!==void 0&&(A.value?(a.value.addControl(Xe),a.value.addControl(Je),tt()):(a.value.removeControl(Xe),a.value.removeControl(Je),at()))}),w(Ae,()=>{A.value=Ae.value}),w(()=>g.value.options.showCoordinateGrid,e=>{a.value!==void 0&&(e?$e():Gt())}),w([V,S],()=>{g.value.options.showCoordinateGrid&&a.value&&$e(),A.value&&a.value&&tt()});const $e=()=>{if(a.value)try{ve.value=ya(a.value,ve.value)}catch(e){console.error("Failed to create grid overlay:",e)}},Gt=()=>{ve.value&&a.value&&(a.value.removeLayer(ve.value),ve.value=void 0)},et=d.control.scale({position:"bottomright",metric:!0,imperial:!1,maxWidth:100}),tt=()=>{a.value&&(at(),et.addTo(a.value))},at=()=>{if(a.value)try{a.value.removeControl(et)}catch{}};Ot(async()=>{var bt,yt;(bt=ie.value)==null||bt.addEventListener("touchstart",qe,{passive:!0}),(yt=ie.value)==null||yt.addEventListener("touchend",je,{passive:!0});const e=Qe[u.userLastMapTileProvider]||we;a.value=d.map(Q.value,{layers:[e,ke,Ke],attributionControl:!1}).setView(S.value,V.value),a.value.on("baselayerchange",b=>{const D=b.name;D.includes(D)&&(u.userLastMapTileProvider=b.name)}),a.value.removeControl(a.value.zoomControl),a.value.on("click",b=>{C.value=[b.latlng.lat,b.latlng.lng]}),a.value.on("moveend",()=>{if(a.value===void 0)return;let{lat:b,lng:D}=a.value.getCenter();b&&D&&(S.value=[b,D])});const t=_e(we,"Esri",19),o=_e(Ie,"OSM",19),s=_e(ke,"Seamarks",18);a.value&&(t.addTo(a.value),o.addTo(a.value),s.addTo(a.value));const x=b=>{var fe;const D=((fe=b.getContainer)==null?void 0:fe.call(b))??b._container;D&&(D.classList.add("hidden-savetiles"),D.style.display="none")};x(t),x(o),x(s),await Ee();const f=b=>{var fe;const D=((fe=b.getContainer)==null?void 0:fe.call(b))??b._container;return Array.from((D==null?void 0:D.querySelectorAll("a"))??[])},[F]=f(t),[J]=f(o),[re]=f(s);be=F,ye=J,xe=re,Pe(we,"Esri"),Pe(Ie,"OSM"),Pe(ke,"Seamarks"),a.value.on("dragstart",()=>{de.value=!0}),a.value.on("dragend",()=>{setTimeout(()=>de.value=!1,200)}),a.value.on("zoomend",()=>{var b;Y.value=!1,a.value!==void 0&&(V.value=((b=a.value)==null?void 0:b.getZoom())??S.value)}),a.value.on("contextmenu",b=>{C.value=[b.latlng.lat,b.latlng.lng]}),_.enableAutoUpdate(),window.addEventListener("keydown",ut),P.value?_.goToTarget(E.VEHICLE):_.goToTarget(E.HOME),!i.isVehicleOnline&&u.vehicleMission.length&&Ge(u.vehicleMission),g.value.options.showCoordinateGrid&&$e(),B.value=!0,await De()});const Rt=e=>(t,o)=>{K({variant:"info",message:`Save ${t._tilesforSave.length} ${e} tiles for offline use?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:T},{text:"Save tiles",color:"white",action:()=>{o(),T()}}]})},Ut=e=>(t,o)=>{K({variant:"warning",message:`Remove all saved ${e} tiles for this layer?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:T},{text:"Remove tiles",color:"white",action:()=>{o(),T(),z({message:`${e} offline tiles removed`,variant:"info",duration:3e3})}}]})},_e=(e,t,o)=>Ve.savetiles(e,{saveWhatYouSee:!0,maxZoom:o,alwaysDownload:!1,position:"topright",parallel:20,confirm:Rt(t),confirmRemoval:Ut(t),saveText:`<i class="mdi mdi-download" title="Save ${t} tiles"></i>`,rmText:`<i class="mdi mdi-trash-can" title="Remove ${t} tiles"></i>`}),Pe=(e,t)=>{e.on("savestart",o=>{var s;L.value=0,R.value=((s=o==null?void 0:o._tilesforSave)==null?void 0:s.length)??0,he.value=t,p.value=!0,z({message:`Saving ${R.value} ${t} tiles...`,variant:"info",duration:2e3})}),e.on("loadtileend",()=>{L.value+=1,R.value>0&&L.value>=R.value&&(z({message:`${t} offline tiles saved!`,variant:"success",duration:3e3}),p.value=!1,he.value="",L.value=0,R.value=0)})},Nt={open:e=>{if(!a.value||y.value||de.value)return;e.preventDefault(),e.stopPropagation();const t=a.value.mouseEventToContainerPoint(e),o=a.value.containerPointToLatLng(t);C.value=[o.lat,o.lng],m.value.openAt(e),Y.value=!0},close:()=>{Me()}},ot=()=>{var e;(e=a.value)==null||e.eachLayer(t=>{(t instanceof d.Marker||t instanceof d.Polyline&&t.options.color==="#358AC3")&&a.value.removeLayer(t)}),h.value=[],Ce.value=void 0,X.value=void 0,ne.value=void 0,W.value=void 0},De=async()=>{B.value&&(ot(),i.isVehicleOnline?await dt():u.vehicleMission.length&&Ge(u.vehicleMission))};w(()=>i.isVehicleOnline,()=>{De()}),w(()=>u.vehicleMissionRevision,()=>{De()}),xa(()=>{var e,t;_.disableAutoUpdate(),window.removeEventListener("keydown",ut),a.value&&(a.value.off("contextmenu"),Object.values(H.value).forEach(o=>o.remove()),H.value={}),(e=ie.value)==null||e.removeEventListener("touchstart",qe),(t=ie.value)==null||t.removeEventListener("touchend",je)}),w(S,(e,t)=>{var o;e.toString()!==t.toString()&&((o=a.value)==null||o.panTo(e))}),w(a,(e,t)=>{a.value!==void 0&&(e==null?void 0:e.options)===void 0&&(a.value=t)}),w(V,(e,t)=>{var o;e!==t&&(Y.value=!1,(o=a.value)==null||o.setZoom(V.value))}),w(ae.widget,()=>{var e;(e=a.value)==null||e.invalidateSize()});const se=c(void 0),_=new ba(e=>se.value=e,e=>S.value=e);_.setTrackableTarget(E.VEHICLE,()=>P.value),_.setTrackableTarget(E.HOME,()=>k.value);const P=I(()=>i.coordinates.latitude?[i.coordinates.latitude,i.coordinates.longitude]:void 0),Fe=I(()=>{var e;return i.attitude.yaw?wa((e=i.attitude)==null?void 0:e.yaw):0}),lt=I(()=>{const e=i.lastHeartbeat;return e?`${ka(e??0,{includeSeconds:!0})} ago`:"never"}),{history:Wt}=Ca(P);(ht=navigator==null?void 0:navigator.geolocation)==null||ht.watchPosition(e=>{k.value||(k.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let it=!0;w([k,a],async()=>{k.value===S.value||!a.value||!it||(_.goToTarget(E.HOME),it=!1)});const W=U();w(i.coordinates,()=>{if(!(!a.value||!P.value)){if(W.value===void 0){let e=Ma;i.vehicleType===ee.MAV_TYPE_SURFACE_BOAT?e=Ta:i.vehicleType===ee.MAV_TYPE_SUBMARINE?e=Va:[ee.MAV_TYPE_QUADROTOR,ee.MAV_TYPE_HEXAROTOR,ee.MAV_TYPE_OCTOROTOR,ee.MAV_TYPE_TRICOPTER,ee.MAV_TYPE_DODECAROTOR].includes(i.vehicleType)&&(e=Pa);const t=d.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});W.value=d.marker(P.value,{icon:t});const o=d.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});W.value.bindTooltip(o),a.value.addLayer(W.value)}W.value.setLatLng(P.value)}}),w(P,(e,t)=>{se.value===E.VEHICLE||t!==void 0||_.follow(E.VEHICLE)}),w([P,Fe,lt,()=>i.isArmed],()=>{var t,o,s,x,f;if(W.value===void 0)return;(x=W.value.getTooltip())==null||x.setContent(`
    <p>Coordinates: ${(t=P.value)==null?void 0:t[0].toFixed(6)}, ${(o=P.value)==null?void 0:o[1].toFixed(6)}</p>
    <p>Velocity: ${((s=i.velocity.ground)==null?void 0:s.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${Fe.value.toFixed(2)}°</p>
    <p>${i.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${lt.value}</p>
  `);const e=(f=W.value.getElement())==null?void 0:f.querySelector("img");e&&(e.style.transform=`rotate(${Fe.value}deg)`)});const X=U();w(k,()=>{if(a.value===void 0)return;const e=k.value;if(e!==void 0)if(X.value)X.value.setLatLng(e);else{X.value=d.marker(e,{icon:d.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=d.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});X.value.bindTooltip(t),X.value.on("dragend",o=>{const x=o.target.getLatLng();Re([x.lat,x.lng])}),a.value.addLayer(X.value)}});const Ce=U();w(h,e=>{a.value&&(Ce.value||(Ce.value=d.polyline([],{color:"#358AC3"}).addTo(a.value)),Ce.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,o)=>{var f;const s=d.marker(t.coordinates);s.setIcon(d.divIcon({className:"marker-icon",iconSize:[16,16],iconAnchor:[8,8]}));const x=d.tooltip({content:o.toString(),permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});s.bindTooltip(x),(f=a.value)==null||f.addLayer(s)}))},{deep:!0});const Be=U();w(Wt,e=>{if(a.value===void 0||e===void 0)return;Be.value===void 0&&(Be.value=d.polyline([],{color:"#ffff00"}).addTo(a.value));const t=e.filter(o=>o.snapshot!==void 0).map(o=>o.snapshot);Be.value.setLatLngs(t)});const Y=c(!1),C=c(null),st=U(),He=c(!1),nt=c(0),rt=c(0),ze=U(),Yt=Sa([{item:"Set home waypoint",action:()=>me("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Set Global Origin",action:()=>me("set-global-origin"),icon:"mdi-crosshairs-question"},{item:"Place Point of Interest",action:()=>me("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>me("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>me("set-default-map-position"),icon:"mdi-map-check"}]),ne=U(),Zt=async()=>{var e;if(!(!a.value||!C.value))try{await u.setDefaultMapPosition(C.value,V.value),z({message:"Default map position set",variant:"success"});const t=d.marker(C.value,{icon:d.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value),o=d.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(o).openTooltip();const s=t.getElement(),x=(e=t.getTooltip())==null?void 0:e.getElement();[s,x].forEach(f=>{f&&(f.style.transition="opacity 1s",f.style.opacity="1")}),setTimeout(()=>{[s,x].forEach(f=>{f&&(f.style.opacity="0")}),setTimeout(()=>{var f;(f=a.value)==null||f.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),z({message:"Failed to set default map position",variant:"error"})}},qt=async()=>{if(!C.value||!a.value)return;ne.value&&(a.value.removeLayer(ne.value),ne.value=void 0),ne.value=d.marker(C.value,{icon:d.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value);const e=d.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(ne.value.bindTooltip(e),C.value){const f=i.coordinates.altitude??0,F=C.value[0],J=C.value[1];try{await i.goTo(0,0,0,0,F,J,f)}catch(re){z({message:`GoTo request failed: ${re.message}`,variant:"error"})}}},me=async e=>{switch(e){case"goto":{qt();break}case"set-default-map-position":Zt();break;case"place-poi":C.value&&le.value?le.value.openDialog(C.value):C.value?le.value||(z({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):(z({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":C.value&&Re(C.value);break;case"set-global-origin":C.value&&(nt.value=C.value[0],rt.value=C.value[1],He.value=!0);break;default:console.warn("Unknown menu option selected:",e)}Y.value=!1},Me=()=>{Y.value=!1,a.value!==void 0&&st.value!==void 0&&a.value.removeLayer(st.value)},jt=(e,t)=>{if(!a.value)return;ze.value&&a.value.removeLayer(ze.value);const o=d.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),s=d.marker([e,t],{icon:o}).addTo(a.value),x=d.tooltip({content:'<i class="mdi mdi-axis-arrow text-[18px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});s.bindTooltip(x),ze.value=s},ut=e=>{e.key==="Escape"&&Me()},Ge=e=>{e.forEach((t,o)=>{o===0?(k.value=t.coordinates,Re(t.coordinates)):h.value.push(t)})},Te=c(!1),ct=c(0),dt=async()=>{Te.value=!0,ot();const e=async t=>{ct.value=t};try{const t=await i.fetchMission(e);Ge(t),z({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){K({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{Te.value=!1}},Re=async e=>{const t=[e[0],e[1]];k.value=t,await i.setHomeWaypoint(t,0),Y.value&&(Y.value=!1)},vt=async()=>{try{await i.startMission()}catch{z({message:"Failed to start mission.",variant:"error"})}},Kt=async()=>{if(u.showChecklistBeforeArm){l.value=!0;return}vt()},pe=La(),Qt=I(()=>`${Math.max(-pe.widgetClearanceForVisibleArea(g.value).bottom,0)}px`),mt=I(()=>`${Math.max(-pe.widgetClearanceForVisibleArea(g.value).top,0)}px`),Xt=I(()=>i.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),Jt=I(()=>i.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),ea=I(()=>k.value===void 0?"Cannot center map on home (home position undefined).":se.value===E.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),ta=I(()=>i.isVehicleOnline?P.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":se.value===E.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),pt=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),ft=e=>{if(!a.value||!a.value.getContainer())return;const t=d.divIcon(pt(e)),o=d.marker(e.coordinates,{icon:t,draggable:!0}).addTo(a.value),s=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,x={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};o.bindTooltip(s,x),o.on("drag",f=>{var re;const F=f.target.getLatLng(),J=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${F.lat.toFixed(8)}, Lng: ${F.lng.toFixed(8)}
    `;(re=o.getTooltip())==null||re.setContent(J)}),o.on("dragend",f=>{const F=f.target.getLatLng();u.movePointOfInterest(e.id,[F.lat,F.lng])}),o.on("click",f=>{if(d.DomEvent.stopPropagation(f),le.value){const F=u.pointsOfInterest.find(J=>J.id===e.id);F?le.value.openDialog(void 0,F):console.warn("POI not found in store:",e.id)}}),H.value[e.id]=o},gt=e=>{var s;if(!a.value||!a.value.getContainer()||!H.value[e.id])return;const t=H.value[e.id];t.setLatLng(e.coordinates),t.setIcon(d.divIcon(pt(e)));const o=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(s=t.getTooltip())==null||s.setContent(o)},aa=e=>{!a.value||!H.value[e]||(H.value[e].remove(),delete H.value[e])};return w(()=>u.pointsOfInterest,async e=>{if((!a.value||!a.value.getContainer())&&(await Ee(),!a.value||!a.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(o=>o.id));Object.keys(H.value).forEach(o=>{t.has(o)||aa(o)}),e.forEach(o=>{H.value[o.id]?gt(o):ft(o)})},{deep:!0,immediate:!0}),w(a,e=>{e&&e.getContainer()&&u.pointsOfInterest.forEach(t=>{H.value[t.id]?gt(t):ft(t)})},{immediate:!0}),(e,t)=>{const o=Oa("contextmenu");return O(),j(_t,null,[Tt((O(),j("div",{ref_key:"mapBase",ref:ie,class:Ue(["page-base",r(pe).editingMode?"pointer-events-none":"pointer-events-auto"])},[$("div",{id:Q.value,ref_key:"map",ref:a,class:"map"},[n(Ia,{modelValue:oe.value,"onUpdate:modelValue":t[0]||(t[0]=s=>oe.value=s),"close-on-content-click":!1,location:"top end"},{activator:v(({props:s})=>[Tt(n(G,ge(s,{class:"absolute right-[209px] m-3 bottom-button bg-slate-50 text-[14px]",elevation:"2",size:"x-small",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download-multiple"}),null,16),[[Ea,A.value]])]),default:v(()=>[n($t,{style:ce(r(M).globalGlassMenuStyles),class:"py-0 min-w-[220px] rounded-lg border-[1px]"},{default:v(()=>[n(Oe,{class:"py-0",title:"Save visible Esri tiles",onClick:Ft}),n(We),n(Oe,{class:"py-0",title:"Save visible OSM tiles",onClick:Bt}),n(We),n(Oe,{class:"py-0",title:"Save visible Seamarks tiles",onClick:Ht})]),_:1},8,["style"])]),_:1},8,["modelValue"]),n(Se,{location:"top",text:ea.value},{activator:v(({props:s})=>[A.value?(O(),q(G,ge({key:0},s,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",k.value?"":"active-events-on-disabled"],color:se.value==r(E).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!k.value,onClick:t[1]||(t[1]=ue(x=>r(_).goToTarget(r(E).HOME,!0),["stop"])),onDblclick:t[2]||(t[2]=ue(x=>r(_).follow(r(E).HOME),["stop"]))}),null,16,["class","color","disabled"])):Z("",!0)]),_:1},8,["text"]),n(Se,{location:"top",text:ta.value},{activator:v(({props:s})=>[A.value?(O(),q(G,ge({key:0},s,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",P.value?"":"active-events-on-disabled"],color:se.value==r(E).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!P.value,onClick:t[3]||(t[3]=ue(x=>r(_).goToTarget(r(E).VEHICLE,!0),["stop"])),onDblclick:t[4]||(t[4]=ue(x=>r(_).follow(r(E).VEHICLE),["stop"]))}),null,16,["class","color","disabled"])):Z("",!0)]),_:1},8,["text"]),n(Se,{location:"top",text:Xt.value},{activator:v(({props:s})=>[A.value?(O(),q(G,ge({key:0},s,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",r(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!r(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:ue(dt,["stop"])}),null,16,["class","disabled"])):Z("",!0)]),_:1},8,["text"]),n(Se,{location:"top",text:Jt.value},{activator:v(({props:s})=>[A.value?(O(),q(G,ge({key:0},s,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",r(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!r(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:ue(Kt,["stop"])}),null,16,["class","disabled"])):Z("",!0)]),_:1},8,["text"])],8,Za)],2)),[[o,Nt]]),n(Aa,{ref_key:"contextMenuRef",ref:m,visible:Y.value,width:"260px","menu-items":Yt,onClose:Me},null,8,["visible","menu-items"]),n(Pt,{modelValue:r(pe).widgetManagerVars(r(g).hash).configMenuOpen,"onUpdate:modelValue":t[7]||(t[7]=s=>r(pe).widgetManagerVars(r(g).hash).configMenuOpen=s),width:"auto"},{default:v(()=>[n(Et,{class:"pa-2",style:ce(r(M).globalGlassMenuStyles)},{default:v(()=>[n(It,{class:"text-center"},{default:v(()=>t[10]||(t[10]=[N("Map widget settings")])),_:1,__:[10]}),n(At,null,{default:v(()=>[n(Vt,{modelValue:r(g).options.showVehiclePath,"onUpdate:modelValue":t[5]||(t[5]=s=>r(g).options.showVehiclePath=s),class:"my-1",label:"Show vehicle path",color:r(g).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),n(Vt,{modelValue:r(g).options.showCoordinateGrid,"onUpdate:modelValue":t[6]||(t[6]=s=>r(g).options.showCoordinateGrid=s),class:"my-1",label:"Show coordinate grid",color:r(g).options.showCoordinateGrid?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Te.value?(O(),q($a,{key:0,"model-value":ct.value,height:"10",absolute:"",bottom:"",color:"white",style:ce(`top: ${mt.value}`)},null,8,["model-value","style"])):Z("",!0),Te.value?(O(),j("p",{key:1,style:ce({top:mt.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):Z("",!0),n(_a,{ref_key:"poiManagerMapWidgetRef",ref:le},null,512),n(Ya,{"model-value":l.value,onConfirmed:vt,"onUpdate:modelValue":t[8]||(t[8]=s=>l.value=s)},null,8,["model-value"]),n(Ha,{modelValue:He.value,"onUpdate:modelValue":t[9]||(t[9]=s=>He.value=s),vehicle:r(i).mainVehicle,"initial-latitude":nt.value,"initial-longitude":rt.value,onOriginSet:jt},null,8,["modelValue","vehicle","initial-latitude","initial-longitude"]),p.value?(O(),j("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:ce(r(M).globalGlassMenuStyles)},[$("p",null,[t[11]||(t[11]=N(" Saving offline map content ")),he.value?(O(),j("span",qa,"("+Ne(he.value)+")",1)):Z("",!0),N(":  "+Ne(R.value?Math.round(L.value/R.value*100):0)+"% ",1)])],4)):Z("",!0)],64)}}}),Qa=Dt(ja,[["__scopeId","data-v-146cfbed"]]);export{Qa as default};
