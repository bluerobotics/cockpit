import{c as j,Q as I,e as J,X as Z,a9 as q,u as Q,t as X,r as D,ac as K,h as d,bF as ee,ab as te,W as ae,o as oe,aV as se,w as F,aa as le,az as P,aZ as ne,a$ as ie,aY as ue,m as re,n as de,p as $,q as n,E as h,Y as he,x as ce,z as l,Z as pe,G as N,$ as ve,H as fe,b0 as ge,a7 as me,F as we,_ as xe}from"./index-BYaVsw_w.js";import{w as Ve}from"./index-DxaGCbJO.js";import{g as k}from"./index-CH_iu5NA.js";import{V as be,a as Ce,b as De,c as Fe}from"./VExpansionPanels-C9UTIzKj.js";const Se={class:"main"},Te=["width","height"],_e=j({__name:"DepthHUD",props:{widget:{}},setup(O){const S=I(),T=J();Z.registerUsage(q.depth);const z=Q(),a=X(O).widget,A=D([["#FF2D2D"],["#0ADB0ACC"],["#FFFFFF"]]),i=K({depthLinesY:{},indicatorY:0}),x=D(Array(10).fill(0)),V=d(()=>x.value[x.value.length-1]),W=d(()=>x.value.slice(-10)),L=d(()=>Math.max(...W.value)),g=d(()=>1.3*L.value>10?1.3*L.value:10),b=d(()=>ee(0,g.value+1)),H=d(()=>Math.max(...b.value)),U=d(()=>te[S.displayUnitPreferences.distance]);ae(()=>{Object.keys(a.value.options).length===0&&(a.value.options={showDepthValue:!0,hudColor:A.value[2][0]})}),oe(()=>{b.value.forEach(e=>i.depthLinesY[e]=_(e)),Y()});const{height:B}=se(),r=d(()=>({width:128,height:a.value.size.height*B.value}));F(z.altitude,()=>{const e=z.altitude.msl,t=le(-e.value,e.toJSON().unit);if(Math.abs(t.value-(V.value||0))<.1)return;const v=t.to(S.displayUnitPreferences.distance);x.value.push(v.toJSON().value)});const _=e=>{const t=e,s=r.value.height/H.value;return P(s*t)},m=D(),y=D(),Y=()=>{if(m.value===void 0||m.value===null)return;if(y.value===void 0){console.debug("Canvas context undefined!"),y.value=m.value.getContext("2d");return}const e=y.value,t=r.value.width,s=r.value.height;ne(e);const v=12,c=16,p=10,o=1,R=5,u=10*o;e.textAlign="left",e.textBaseline="middle",e.font=`bold ${v}px Arial`,e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor;let f=[1,5];g.value>25&&(f=[2,10]),g.value>125&&(f=[5,25]),g.value>250&&(f=[10,50]),g.value>500&&(f=[20,100]);for(const[E,w]of Object.entries(i.depthLinesY))Number(E)%f[0]===0&&(e.beginPath(),e.moveTo(t-o-3.3*v-R,w+u),e.lineTo(o+3.9*c+p,w+u),e.lineWidth="1"),Number(E)%f[1]===0&&(e.lineWidth="2",e.moveTo(t-o-3.3*v,w+u),e.lineTo(o+3.9*c+p,w+u),e.fillText(`${E} ${U.value}`,t-o-3*v,w+u)),e.stroke();const C=Math.max(i.indicatorY,0);e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor,a.value.options.showDepthValue&&(e.textAlign="right",e.font=`bold ${c}px Arial`,e.fillText(`${V.value.toFixed(1)} ${U.value}`,o+4.3*c-p-o,C+u)),e.beginPath(),e.moveTo(o+4.3*c+o,C+u),e.lineTo(o+4.3*c+o-p,C-p/2+u),e.lineTo(o+4.3*c+o-p,C+p/2+u),e.closePath(),e.fill(),e.globalCompositeOperation="source-in";const M=e.createLinearGradient(t/2,0,t/2,s);M.addColorStop(.95,a.value.options.hudColor),M.addColorStop(1,Ve(a.value.options.hudColor).alpha(0).toRgbString()),e.fillStyle=M,e.fillRect(0,0,t,s)};F(V,()=>{b.value.forEach(t=>{var s;(s=i.depthLinesY)[t]??(s[t]=P(r.value.height+100)),k.to(i.depthLinesY,.5,{[t]:_(t)})}),Object.keys(i.depthLinesY).filter(t=>!b.value.includes(Number(t))).forEach(t=>{k.to(i.depthLinesY,.5,{[t]:P(r.value.height+100)})}),k.to(i,.5,{indicatorY:_(V.value)})}),F([i,r,a.value.options],()=>{T.isWidgetVisible(a.value)&&ie(()=>Y())});const G=ue(m);return F(G,(e,t)=>{e&&!t&&Y()}),(e,t)=>(de(),re(we,null,[$("div",Se,[$("canvas",{ref_key:"canvasRef",ref:m,width:r.value.width,height:r.value.height},null,8,Te)]),n(me,{modelValue:l(T).widgetManagerVars(l(a).hash).configMenuOpen,"onUpdate:modelValue":t[2]||(t[2]=s=>l(T).widgetManagerVars(l(a).hash).configMenuOpen=s),"min-width":"400","max-width":"35%"},{default:h(()=>[n(he,{class:"pa-2",style:ce(l(S).globalGlassMenuStyles)},{default:h(()=>[n(pe,{class:"text-center"},{default:h(()=>t[3]||(t[3]=[N("Depth HUD config")])),_:1,__:[3]}),n(ve,null,{default:h(()=>[n(fe,{class:"ma-1",label:"Show height value","model-value":l(a).options.showDepthValue,color:l(a).options.showDepthValue?"white":void 0,"hide-details":"",onChange:t[0]||(t[0]=s=>l(a).options.showDepthValue=!l(a).options.showDepthValue)},null,8,["model-value","color"]),n(be,{theme:"dark"},{default:h(()=>[n(Ce,{class:"bg-[#FFFFFF11] text-white"},{default:h(()=>[n(De,null,{default:h(()=>t[4]||(t[4]=[N("Color")])),_:1,__:[4]}),n(Fe,null,{default:h(()=>[n(ge,{modelValue:l(a).options.hudColor,"onUpdate:modelValue":t[1]||(t[1]=s=>l(a).options.hudColor=s),class:"ma-2 text-white bg-[#FFFFFF11]",swatches:A.value,width:"100%","show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),ke=xe(_e,[["__scopeId","data-v-6bcc5d64"]]);export{ke as default};
