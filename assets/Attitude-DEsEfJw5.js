import{c as te,e as ae,Q as oe,S as U,a1 as $,u as le,t as se,r as w,a4 as ie,R as ne,o as re,aS as ue,h as B,aT as k,w as p,aU as V,aV as de,aW as he,aX as b,av as M,aY as ce,m as ve,n as pe,p as y,q as i,E as c,U as ge,x as me,z as o,W as fe,G as j,X as we,H as E,I as G,aZ as Ve,$ as be,F as xe,_ as Ce}from"./index-CsbFJ4Vh.js";import{g as C}from"./index-CH_iu5NA.js";import{V as Fe,a as Te,b as Se,c as De}from"./VExpansionPanels-4qopEmWW.js";const Pe={class:"main"},Ae=["width","height"],Re={class:"flex justify-center gap-x-8 mb-4"},_e=te({__name:"Attitude",props:{widget:{}},setup(I){const S=ae(),X=oe();U.registerUsage($.roll),U.registerUsage($.pitch);const g=le(),a=se(I).widget,x=w(),D=w(),F=w(0),T=w(0),m=w(void 0),P=[-90,-70,-45,-30,-10,0,10,30,45,70,90],s=ie({rollDegrees:0,pitchLinesHeights:{},cameraTiltDeg:0,pitchDegrees:0}),O=w([["#FFFFFF"],["#FF2D2D"],["#0ADB0ACC"]]),Y={showCenterAim:!0,showPitchLines:!0,showRollPitchValues:!0,desiredAimRadius:150,hudColor:O.value[0][0],cameraFOV:64};ne(()=>{Object.entries(Y).forEach(([e,t])=>{a.value.options[e]===void 0&&(a.value.options[e]=t)})}),re(()=>{P.forEach(e=>s.pitchLinesHeights[e]=5*e),R()});const{width:q,height:Q}=ue(),r=B(()=>({width:a.value.size.width*q.value,height:a.value.size.height*Q.value})),n=B(()=>k(a.value.options.desiredAimRadius,35,.2*r.value.width));let W,N;p(g.attitude,e=>{const t=Math.abs(V(e.roll-(W||0))),l=Math.abs(V(e.pitch-(N||0)));t>.1&&(W=e.roll,F.value=V(g.attitude.roll)),l>.1&&(N=e.pitch,T.value=V(g.attitude.pitch))}),p(g.genericVariables,e=>{const t=e.cameraTiltDeg;(m.value===void 0||Math.abs(t-m.value)>.1)&&(m.value=t)});const A=e=>{const t=180/a.value.options.cameraFOV;return e/180*t*r.value.height},Z=de(x);p(Z,(e,t)=>{e&&!t&&R()});const R=()=>{if(x.value===void 0||x.value===null)return;if(D.value===void 0){console.debug("Canvas context undefined!"),D.value=x.value.getContext("2d");return}const e=D.value;he(e);const t=.5*r.value.width,l=.5*r.value.height,H=12,_=22,f=2;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${H}px Arial`,e.fillStyle="white";const d=2*n.value;e.translate(t,l),e.rotate(b(s.rollDegrees));let v=0;m.value!==void 0&&(v=-A(s.cameraTiltDeg+s.pitchDegrees));for(const[h,u]of Object.entries(s.pitchLinesHeights)){e.beginPath();const J=Number(h)===0?1:.7,K=Number(h)===0?[]:[5,2],ee=Number(h)===0?3:2;if(e.lineWidth=ee,e.setLineDash(K),a.value.options.showPitchLines){const z=d+J*(t-d);e.moveTo(-z+f,u),e.lineTo(-d,u),e.lineTo(-d+5,u+15),e.fillText(Number(h),-d-4*f,u-3*f),e.moveTo(+z-f,u),e.lineTo(d,u),e.lineTo(d-5,u+15),e.fillText(Number(h),d+4*f,u-3*f),e.stroke()}}if(e.lineWidth=3,e.setLineDash([]),e.font=`bold ${_}px Arial`,a.value.options.showCenterAim&&(e.beginPath(),e.moveTo(-n.value,v),e.lineTo(-1.5*n.value,v),e.stroke(),e.beginPath(),e.arc(0,v,n.value,b(135),b(225)),e.stroke(),e.beginPath(),e.moveTo(n.value,v),e.lineTo(1.5*n.value,v),e.stroke(),e.beginPath(),e.arc(0,v,n.value,b(-45),b(45)),e.stroke()),a.value.options.showRollPitchValues){const h=`r: ${Number(F.value).toFixed(2)}`,u=`p: ${Number(T.value).toFixed(2)}`;e.rotate(b(-s.rollDegrees)),n.value<200?(e.fillText(h,0,k(-1.5*n.value,-.8*l,0)),e.fillText(u,0,k(1.5*n.value,0,.8*l))):(e.textAlign="start",e.fillText(h,-n.value+_,-30),e.fillText(u,-n.value+_,30)),e.stroke()}e.translate(-t,-l),e.globalCompositeOperation="source-in";const L=e.createLinearGradient(0,0,r.value.width,r.value.height);L.addColorStop(0,a.value.options.hudColor),L.addColorStop(1,a.value.options.hudColor),e.fillStyle=L,e.fillRect(0,0,r.value.width,r.value.height)};return p(T,()=>{P.forEach(e=>{const t=-M(A(e+s.cameraTiltDeg-V(g.attitude.pitch)),2);C.to(s.pitchLinesHeights,.1,{[e]:t})}),C.to(s,.1,{pitchDegrees:T.value})}),p(F,()=>{C.to(s,.1,{rollDegrees:-M(F.value,2)})}),p(m,()=>{C.to(s,.1,{cameraTiltDeg:m.value}),P.forEach(e=>{const t=-M(A(e+s.cameraTiltDeg-V(g.attitude.pitch)),2);C.to(s.pitchLinesHeights,.1,{[e]:t})})}),p([s,r,a.value.options],()=>{S.isWidgetVisible(a.value)&&ce(()=>R())}),(e,t)=>(pe(),ve(xe,null,[y("div",Pe,[y("canvas",{ref_key:"canvasRef",ref:x,width:r.value.width,height:r.value.height},null,8,Ae)]),i(be,{modelValue:o(S).widgetManagerVars(o(a).hash).configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=l=>o(S).widgetManagerVars(o(a).hash).configMenuOpen=l),"min-width":"400","max-width":"45%"},{default:c(()=>[i(ge,{class:"pa-4",style:me([o(X).globalGlassMenuStyles,{"border-radius":"15px"}])},{default:c(()=>[i(fe,{class:"text-center"},{default:c(()=>t[7]||(t[7]=[j("Attitude widget config")])),_:1,__:[7]}),i(we,null,{default:c(()=>[y("div",Re,[i(E,{class:"ma-1",label:"Show roll/pitch values","model-value":o(a).options.showRollPitchValues,color:o(a).options.showRollPitchValues?"white":void 0,"hide-details":"",onChange:t[0]||(t[0]=l=>o(a).options.showRollPitchValues=!o(a).options.showRollPitchValues)},null,8,["model-value","color"]),i(E,{class:"ma-1",label:"Show center aim","model-value":o(a).options.showCenterAim,color:o(a).options.showCenterAim?"white":void 0,"hide-details":"",onChange:t[1]||(t[1]=l=>o(a).options.showCenterAim=!o(a).options.showCenterAim)},null,8,["model-value","color"]),i(E,{class:"ma-1",label:"Show pitch lines","model-value":o(a).options.showPitchLines,color:o(a).options.showPitchLines?"white":void 0,"hide-details":"",onChange:t[2]||(t[2]=l=>o(a).options.showPitchLines=!o(a).options.showPitchLines)},null,8,["model-value","color"])]),i(G,{modelValue:o(a).options.cameraFOV,"onUpdate:modelValue":t[3]||(t[3]=l=>o(a).options.cameraFOV=l),color:"white",label:"Camera vertical FOV",min:20,max:180,"thumb-label":""},null,8,["modelValue"]),i(G,{modelValue:o(a).options.desiredAimRadius,"onUpdate:modelValue":t[4]||(t[4]=l=>o(a).options.desiredAimRadius=l),label:"Center circle radius",color:"white",min:10,max:300,"thumb-label":""},null,8,["modelValue"]),i(Fe,{theme:"dark"},{default:c(()=>[i(Te,{class:"bg-[#FFFFFF22]"},{default:c(()=>[i(Se,null,{default:c(()=>t[8]||(t[8]=[j("Color")])),_:1,__:[8]}),i(De,{class:"pa-2"},{default:c(()=>[i(Ve,{modelValue:o(a).options.hudColor,"onUpdate:modelValue":t[5]||(t[5]=l=>o(a).options.hudColor=l),class:"ma-1 bg-[#FFFFFF11] text-white",swatches:O.value,"show-swatches":"",width:"100%"},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),Ee=Ce(_e,[["__scopeId","data-v-64737875"]]);export{Ee as default};
