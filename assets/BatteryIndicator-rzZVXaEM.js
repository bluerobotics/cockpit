import{c as G,t as q,u as H,e as Q,Q as X,r as f,R as Y,S as Z,h as m,U as J,w as K,W as ee,X as te,j as oe,m as r,n as u,P as h,q as i,T as le,p as l,v as b,x as C,z as a,B as S,E as c,Y as ae,Z as se,G as ne,$ as ie,V as re,a0 as I,a1 as y,a2 as ue,a3 as de,a4 as pe,a5 as me,a6 as T,a7 as ve,F as ce}from"./index-BYaVsw_w.js";const ge={class:"flex items-center w-[95px] h-12 text-white justify-center"},we={key:0,class:"relative w-[1.5rem] battery-icon"},fe={key:0,class:"absolute text-sm text-white -bottom-[3px] left-[4px] mdi mdi-circle"},he={key:1,class:"absolute text-sm text-yellow-400 -bottom-[3px] left-[4px] mdi mdi-alert-circle"},be={key:1,class:"relative flex flex-col justify-center items-center h-full w-[1.5rem] battery-icon"},ye={key:1,class:"absolute text-sm text-white bottom-0 left-0 mdi mdi-circle"},xe={key:2,class:"absolute text-sm text-yellow-400 bottom-0 left-0 mdi mdi-alert-circle"},Ve={class:"relative right-0 flex flex-col w-[4rem] select-none text-sm font-semibold leading-4 text-end -mr-2"},Ce={class:"w-full"},Se={class:"flex justify-end gap-x-1 items-center"},Te={class:"font-mono"},ke={class:"w-full"},Me={key:0,class:"flex justify-end gap-x-1 items-center"},Ie={class:"font-mono mt-[2px]"},_e={key:1,class:"flex justify-end gap-x-1 items-center text-yellow-100"},Ue={class:"font-mono mt-[2px]"},Be={class:"absolute top-2 right-2 z-10"},We={class:"flex justify-between items-center -mt-1"},De={class:"flex items-center gap-x-2"},je={class:"flex items-center gap-x-2"},Pe={class:"flex items-center gap-x-2"},Fe={class:"flex items-center gap-x-2"},Oe={class:"text-red-500 text-center text-sm w-[full]"},g=500,Le=G({__name:"BatteryIndicator",props:{miniWidget:{}},setup(F){var D,j,P;const t=q(F).miniWidget,_={showCurrent:!0,showPower:!0,toggleInterval:1e3},s=H(),k=Q(),O=X(),x=f(!0),w=f(void 0),V=f(""),M=f(void 0),v=f(t.value.options.toggleInterval??_.toggleInterval);(D=t.value.options).useVoltageToColor??(D.useVoltageToColor=!1),(j=t.value.options).voltageToColorScheme??(j.voltageToColorScheme=Object.assign({},Y)),(P=t.value.options).batteryThresholds??(P.batteryThresholds=Object.assign({},Z));const d=m(()=>t.value.options.batteryThresholds),$=m(()=>{var n;return((n=s==null?void 0:s.powerSupply)==null?void 0:n.voltage)??null}),z=J($,4e3),U=m(()=>{const n=z.value;if(n==null)return"unknown";const{critical:e,low:o,medium:R,high:E}=d.value;return n>=E?"high":n>=R?"medium":n>=o?"low":n>=e||n<e?"critical":"unknown"}),B=m(()=>{const n=U.value;return t.value.options.voltageToColorScheme[n]??"transparent"}),L=m(()=>{var n;return((n=s==null?void 0:s.powerSupply)==null?void 0:n.voltage)===void 0?"--":Math.abs(s.powerSupply.voltage)>=100?s.powerSupply.voltage.toFixed(0):s.powerSupply.voltage.toFixed(1)}),N=m(()=>{var n;return((n=s==null?void 0:s.powerSupply)==null?void 0:n.current)===void 0?"--":Math.abs(s.powerSupply.current)>=100?s.powerSupply.current.toFixed(0):s.powerSupply.current.toFixed(1)}),A=m(()=>s.instantaneousWatts!==void 0?s.instantaneousWatts.toFixed(1):"--"),p=m(()=>{var n;return((n=s==null?void 0:s.powerSupply)==null?void 0:n.remaining)===void 0?-1:Math.abs(s.powerSupply.remaining)>100?100:s.powerSupply.remaining}),W=()=>{(w.value||M.value)&&(clearInterval(w.value),clearTimeout(M.value)),v.value<g?(t.value.options.toggleInterval=g,V.value=`Interval must be at least ${g}ms.`):t.value.options.toggleInterval=v.value,!t.value.options.showCurrent&&!t.value.options.showPower&&(t.value.options.showCurrent=!0,t.value.options.showPower=!0,V.value="At least one of the options must be enabled."),t.value.options.showCurrent&&t.value.options.showPower?w.value=setInterval(()=>{x.value=!x.value},t.value.options.toggleInterval):x.value=t.value.options.showCurrent,M.value=setTimeout(()=>{V.value="",v.value<g&&(v.value=g)},5e3)};return K([()=>t.value.options,v],W,{deep:!0}),ee(()=>{t.value.options=Object.assign({},_,t.value.options),W(),te.registerUsage("Instantaneous Watts")}),oe(()=>{w.value===void 0&&clearInterval(w.value)}),(n,e)=>(u(),r(ce,null,[h((u(),r("div",ge,[p.value>=0?(u(),r("div",we,[e[14]||(e[14]=l("i",{class:"mdi mdi-battery-outline"},null,-1)),l("i",{class:"mdi mdi-battery absolute inset-0 bottom-0 -right-1 text-transparent bg-clip-text",style:C({backgroundImage:`linear-gradient(to top, white ${p.value}%, transparent ${p.value}%)`})},null,4),p.value<0?(u(),r("span",fe)):b("",!0),p.value<0?(u(),r("span",he)):b("",!0)])):(u(),r("div",be,[l("i",{class:"absolute mdi mdi-battery",style:C({color:a(t).options.useVoltageToColor?B.value:"transparent"})},null,4),U.value==="critical"&&a(t).options.useVoltageToColor?(u(),r("i",{key:0,class:"absolute mdi mdi-battery animate-ping",style:C({color:B.value})},null,4)):b("",!0),e[15]||(e[15]=l("i",{class:"absolute mdi mdi-battery-outline text-[#CCCCCC88]"},null,-1)),p.value<0?(u(),r("span",ye)):b("",!0),p.value<0?(u(),r("span",xe)):b("",!0)])),l("div",Ve,[l("div",Ce,[l("div",Se,[l("span",Te,S(L.value),1),e[16]||(e[16]=l("div",{class:"w-[15px] mr-[1px] -ml-[1px]"},"V",-1))])]),l("div",ke,[x.value?(u(),r("div",Me,[l("span",Ie,S(N.value),1),e[17]||(e[17]=l("div",{class:"w-[15px]"},"A",-1))])):(u(),r("div",_e,[l("span",Ue,S(A.value),1),e[18]||(e[18]=l("div",{class:"w-[15px]"},"W",-1))]))])])])),[[le,`Battery remaining: ${p.value<0?"No Data":p.value+"%"}`]]),i(ve,{modelValue:a(k).miniWidgetManagerVars(a(t).hash).configMenuOpen,"onUpdate:modelValue":e[13]||(e[13]=o=>a(k).miniWidgetManagerVars(a(t).hash).configMenuOpen=o),width:"auto"},{default:c(()=>[i(ae,{class:"pa-4 text-white w-[400px]",style:C([{"border-radius":"15px"},a(O).globalGlassMenuStyles])},{default:c(()=>[i(se,{class:"text-center"},{default:c(()=>e[19]||(e[19]=[ne("Battery Indicator Config")])),_:1,__:[19]}),i(ie,{class:"flex flex-col gap-y-4"},{default:c(()=>[l("div",Be,[i(re,{icon:"",size:"30",variant:"text",class:"text-white text-[22px]","aria-label":"Close",onClick:e[0]||(e[0]=o=>a(k).miniWidgetManagerVars(a(t).hash).configMenuOpen=!1)},{default:c(()=>e[20]||(e[20]=[l("i",{class:"mdi mdi-close"},null,-1)])),_:1,__:[20]})]),i(I,{modelValue:a(t).options.showCurrent,"onUpdate:modelValue":e[1]||(e[1]=o=>a(t).options.showCurrent=o),label:"Show Current","hide-details":"",class:"-mb-5"},null,8,["modelValue"]),i(I,{modelValue:a(t).options.showPower,"onUpdate:modelValue":e[2]||(e[2]=o=>a(t).options.showPower=o),label:"Show Power","hide-details":""},null,8,["modelValue"]),i(y,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=o=>v.value=o),modelModifiers:{number:!0},label:"Toggle Interval (ms)",type:"number",min:g,step:"100",density:"compact",variant:"outlined","hide-details":"",disabled:!a(t).options.showCurrent||!a(t).options.showPower},null,8,["modelValue","disabled"]),i(ue,{class:"mt-2"}),l("div",We,[i(I,{modelValue:a(t).options.useVoltageToColor,"onUpdate:modelValue":e[4]||(e[4]=o=>a(t).options.useVoltageToColor=o),label:"Use voltage to color scheme","hide-details":"",class:"mr-1"},null,8,["modelValue"]),i(de,{location:"top",text:"Configure these voltage levels according to your battery pack. Defaults are based on Blue Robotics' 4S Li-ion battery pack."},{activator:c(({props:o})=>[i(pe,me(o,{icon:"mdi-information-outline",class:"ml-1 text-yellow-300 cursor-pointer",size:"18"}),null,16)]),_:1})]),l("div",De,[i(y,{modelValue:d.value.critical,"onUpdate:modelValue":e[5]||(e[5]=o=>d.value.critical=o),modelModifiers:{number:!0},label:"Critical voltage (V)",type:"number",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"]),h(l("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>a(t).options.voltageToColorScheme.critical=o),type:"color",theme:"dark",class:"w-8 h-8 rounded border border-white/30 bg-transparent cursor-pointer"},null,512),[[T,a(t).options.voltageToColorScheme.critical]])]),l("div",je,[i(y,{modelValue:d.value.low,"onUpdate:modelValue":e[7]||(e[7]=o=>d.value.low=o),modelModifiers:{number:!0},label:"Low voltage (V)",type:"number",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"]),h(l("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>a(t).options.voltageToColorScheme.low=o),type:"color",theme:"dark",class:"w-8 h-8 rounded border border-white/30 bg-transparent cursor-pointer"},null,512),[[T,a(t).options.voltageToColorScheme.low]])]),l("div",Pe,[i(y,{modelValue:d.value.medium,"onUpdate:modelValue":e[9]||(e[9]=o=>d.value.medium=o),modelModifiers:{number:!0},label:"Medium voltage (V)",type:"number",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"]),h(l("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>a(t).options.voltageToColorScheme.medium=o),type:"color",theme:"dark",class:"w-8 h-8 rounded border border-white/30 bg-transparent cursor-pointer"},null,512),[[T,a(t).options.voltageToColorScheme.medium]])]),l("div",Fe,[i(y,{modelValue:d.value.high,"onUpdate:modelValue":e[11]||(e[11]=o=>d.value.high=o),modelModifiers:{number:!0},label:"High voltage (V)",type:"number",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"]),h(l("input",{"onUpdate:modelValue":e[12]||(e[12]=o=>a(t).options.voltageToColorScheme.high=o),type:"color",theme:"dark",class:"w-8 h-8 rounded border border-white/30 bg-transparent cursor-pointer"},null,512),[[T,a(t).options.voltageToColorScheme.high]])]),l("p",Oe,S(V.value),1)]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}});export{Le as default};
