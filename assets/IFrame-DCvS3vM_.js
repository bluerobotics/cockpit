import{c as Y,bF as Z,h as m,R as X,e as ee,r as u,t as se,bN as T,aU as ae,w as I,W as te,aM as oe,ag as N,aq as le,ac as ie,m as b,n as h,q as l,z as t,x as y,y as ne,p as i,a4 as A,E as d,G as x,a3 as de,B as W,V as M,b1 as S,s as re,aw as ue,Y as ce,Z as ve,$ as pe,a1 as j,aS as me,bO as he,bP as fe,I as ge,bQ as we,H as G,v as Ve,a2 as be,bJ as ye,a6 as Ae,bR as xe,aC as P,_ as _e}from"./index-CcGAYuwt.js";const Be={class:"w-full h-full"},Ue=["width","height"],ke={class:"flex flex-col justify-start items-center h-auto pt-2 cursor-pointer"},Le={class:"flex justify-between w-full h-[25px] px-2"},Ce={class:"select-none"},Me={class:"pt-2"},Se=["src"],Re={key:1},Fe=["src"],De={class:"flex items-center justify-between mt-2 gap-1"},ze={class:"-mr-3 text-base text-gray-400"},$e={class:"mt-2 mb-2 w-[95%]"},Ee={class:"flex justify-between"},Oe={key:0},Te=Y({__name:"IFrame",props:{widget:{}},setup(q){Z(a=>({"64e083e1":Q.value}));const R=X(),r=ee(),_=u(),e=se(q).widget,c=u(!1),B=u(0),n=u(e.value.options.source),v=u(!1),f=u(""),g=u({usingVehicleAddressAsBase:"",notUsingVehicleAddressAsBase:""}),F=m(()=>{const a=window.location.protocol.includes("file")?"http:":window.location.protocol,s=f.value||T;return`${a}//${s}`}),U=(a,s)=>s?`${F.value}${a}`:a,w=m(()=>U(e.value.options.source,e.value.options.useVehicleAddressAsBase)),H=()=>{v.value=!v.value},K=()=>{r.allowMovingAndResizing(e.value.hash,!0),window.addEventListener("mouseup",p),window.addEventListener("dragend",p)},p=()=>{r.allowMovingAndResizing(e.value.hash,!1),window.removeEventListener("mouseup",p),window.removeEventListener("dragend",p)},D=m(()=>({width:e.value.size.width*V.value,height:e.value.size.height*V.value})),k=a=>xe(a)?!0:"URL is not valid.",L=()=>{const a=k(U(n.value,e.value.options.useVehicleAddressAsBase));if(a!==!0){P({message:`${a} Please enter a valid URL.`,variant:"error"});return}e.value.options.source=n.value,P({message:`IFrame URL sucessfully updated to '${w.value}'.`,variant:"success"})},J=a=>{a?(g.value.notUsingVehicleAddressAsBase=n.value,n.value=g.value.usingVehicleAddressAsBase):(g.value.usingVehicleAddressAsBase=n.value,n.value=g.value.notUsingVehicleAddressAsBase),L()},z=a=>{if(a.data.type!=="cockpit:listenToDatalakeVariables")return;const{variable:s}=a.data;N(s,o=>{_.value.contentWindow.postMessage({type:"cockpit:datalakeVariable",variable:s,value:o},"*")})};I([f,()=>e.value.options.useVehicleAddressAsBase],()=>{e.value.options.useVehicleAddressAsBase&&(c.value=!1,setTimeout(()=>{c.value=!0},100))},{deep:!0});let C;te(()=>{window.addEventListener("message",z,!0);const a={source:"http://"+T,useVehicleAddressAsBase:!1};e.value.options={...a,...e.value.options};const s=oe("vehicle-address");typeof s=="string"&&(f.value=s),C=N("vehicle-address",o=>{typeof o=="string"&&(f.value=o)})}),le(()=>{window.removeEventListener("message",z,!0),C&&ie("vehicle-address",C)});const{width:V,height:$}=ae(),E=m(()=>{let a="";return a=a.concat(" ",`left: ${e.value.position.x*V.value}px;`),a=a.concat(" ",`top: ${e.value.position.y*$.value}px;`),a=a.concat(" ",`width: ${e.value.size.width*V.value}px;`),a=a.concat(" ",`height: ${e.value.size.height*$.value}px;`),r.editingMode&&(a=a.concat(" ","pointer-events:none; border:0;")),r.isWidgetVisible(e.value)||(a=a.concat(" ","display: none;")),a}),Q=m(()=>(100-B.value)/100);function O(){console.log("Finished loading"),c.value=!0}return I(e,()=>{r.widgetManagerVars(e.value.hash).configMenuOpen===!1&&k(w.value)!==!0&&(n.value=e.value.options.source)},{deep:!0}),(a,s)=>(h(),b("div",Be,[t(e).options.isCollapsible?(h(),b("div",{key:0,ref:"iframe-container",class:ne(["w-full rounded-lg overflow-hidden -mt-2",[v.value?"h-[42px]":"h-full"]]),width:D.value.width,height:D.value.height,style:y(t(R).globalGlassMenuStyles)},[i("div",ke,[i("div",Le,[l(de,{class:"cursor-grab opacity-40",onMousedown:K,onMouseup:p},{default:d(()=>s[7]||(s[7]=[x(" mdi-drag ")])),_:1,__:[7]}),i("div",Ce,W(t(e).options.containerName||"iframe"),1),l(M,{icon:v.value?"mdi-chevron-down":"mdi-chevron-up",variant:"text",size:"36",class:"mt-[-6px] opacity-60",onClick:H},null,8,["icon"])]),A(i("div",Me,[A(i("iframe",{ref_key:"iframe",ref:_,src:w.value,style:y(E.value),frameborder:"0",onLoad:O},null,44,Se),[[S,c.value]])],512),[[S,!v.value]])])],14,Ue)):(h(),b("div",Re,[(h(),re(ue,{to:".widgets-view"},[A(i("iframe",{ref_key:"iframe",ref:_,src:w.value,style:y([E.value,{position:"absolute"}]),frameborder:"0",onLoad:O},null,44,Fe),[[S,c.value]])]))])),l(Ae,{modelValue:t(r).widgetManagerVars(t(e).hash).configMenuOpen,"onUpdate:modelValue":s[6]||(s[6]=o=>t(r).widgetManagerVars(t(e).hash).configMenuOpen=o),"min-width":"600","max-width":"45%"},{default:d(()=>[l(ce,{class:"pa-2",style:y(t(R).globalGlassMenuStyles)},{default:d(()=>[l(ve,{class:"text-center"},{default:d(()=>s[8]||(s[8]=[x("Settings")])),_:1,__:[8]}),l(pe,null,{default:d(()=>[i("div",null,[s[9]||(s[9]=i("p",null,"Iframe Source",-1)),i("div",De,[l(j,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=o=>n.value=o),variant:"outlined",rules:[k(U(n.value,t(e).options.useVehicleAddressAsBase))],placeholder:t(e).options.useVehicleAddressAsBase?"/my-service":"http://example.com",onKeydown:me(L,["enter"])},he({_:2},[t(e).options.useVehicleAddressAsBase?{name:"prepend-inner",fn:d(()=>[i("span",ze,W(F.value),1)]),key:"0"}:void 0]),1032,["modelValue","rules","placeholder"]),A(l(M,{icon:"mdi-check",class:"mx-1 mb-5 bg-[#FFFFFF22]",rounded:"lg",flat:"",onClick:L},null,512),[[fe,"Set",void 0,{bottom:!0}]])])]),i("div",$e,[l(ge,{modelValue:B.value,"onUpdate:modelValue":s[1]||(s[1]=o=>B.value=o),label:"Transparency",color:"white",min:0,max:90},null,8,["modelValue"])]),l(we,{compact:"","is-expanded":!0,"no-bottom-divider":"","no-top-divider":""},{title:d(()=>s[10]||(s[10]=[x("Advanced options")])),content:d(()=>[l(G,{modelValue:t(e).options.useVehicleAddressAsBase,"onUpdate:modelValue":[s[2]||(s[2]=o=>t(e).options.useVehicleAddressAsBase=o),J],label:"Use vehicle address as base URL",color:"white",density:"compact","hide-details":"",class:"ml-3 my-2"},null,8,["modelValue"]),i("div",Ee,[l(G,{modelValue:t(e).options.isCollapsible,"onUpdate:modelValue":s[3]||(s[3]=o=>t(e).options.isCollapsible=o),label:"Collapsible container",color:"white",class:"ml-2"},null,8,["modelValue"]),t(e).options.isCollapsible?(h(),b("div",Oe,[l(j,{modelValue:t(e).options.containerName,"onUpdate:modelValue":s[4]||(s[4]=o=>t(e).options.containerName=o),label:"Container name","item-title":"name",density:"compact",variant:"outlined","no-data-text":"iframe","hide-details":"",theme:"dark",class:"w-[300px] mt-2"},null,8,["modelValue"])])):Ve("",!0)])]),_:1})]),_:1}),l(be,{width:"80%",inset:""}),l(ye,{class:"flex justify-end mt-2"},{default:d(()=>[l(M,{color:"white",onClick:s[5]||(s[5]=o=>t(r).widgetManagerVars(t(e).hash).configMenuOpen=!1)},{default:d(()=>s[11]||(s[11]=[x(" Close ")])),_:1,__:[11]})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])]))}}),We=_e(Te,[["__scopeId","data-v-77611c69"]]);export{We as default};
