import{ba as ae,bb as le,h as T,cb as oe,bs as ne,bh as se,cc as U,c8 as z,c as Ce,e as Me,t as Se,r as S,W as Le,o as Pe,aN as Te,aH as Ne,aM as Ye,j as Ie,cd as Ue,w as L,ag as Fe,aU as je,aY as De,a_ as $e,aX as Oe,m as R,n as W,q as s,z as n,p as d,E as c,V as Ee,G as Be,a1 as k,as as Ae,a0 as P,af as J,a$ as q,P as X,x as Q,J as Re,F as We,ac as Z,_ as ze}from"./index-PUuVzxCe.js";const ie=U.reduce((o,r)=>(o[r]={type:[Boolean,String,Number],default:!1},o),{}),ue=U.reduce((o,r)=>{const u="offset"+z(r);return o[u]={type:[String,Number],default:null},o},{}),re=U.reduce((o,r)=>{const u="order"+z(r);return o[u]={type:[String,Number],default:null},o},{}),ee={col:Object.keys(ie),offset:Object.keys(ue),order:Object.keys(re)};function _e(o,r,u){let e=o;if(!(u==null||u===!1)){if(r){const i=r.replace(o,"");e+=`-${i}`}return o==="col"&&(e="v-"+e),o==="col"&&(u===""||u===!0)||(e+=`-${u}`),e.toLowerCase()}}const Ge=["auto","start","end","center","baseline","stretch"],He=le({cols:{type:[Boolean,String,Number],default:!1},...ie,offset:{type:[String,Number],default:null},...ue,order:{type:[String,Number],default:null},...re,alignSelf:{type:String,default:null,validator:o=>Ge.includes(o)},...se(),...ne()},"VCol"),Y=ae()({name:"VCol",props:He(),setup(o,r){let{slots:u}=r;const e=T(()=>{const i=[];let f;for(f in ee)ee[f].forEach(b=>{const g=o[b],p=_e(f,b,g);p&&i.push(p)});const v=i.some(b=>b.startsWith("v-col-"));return i.push({"v-col":!v||!o.cols,[`v-col-${o.cols}`]:o.cols,[`offset-${o.offset}`]:o.offset,[`order-${o.order}`]:o.order,[`align-self-${o.alignSelf}`]:o.alignSelf}),i});return()=>{var i;return oe(o.tag,{class:[e.value,o.class],style:o.style},(i=u.default)==null?void 0:i.call(u))}}}),_=["start","end","center"],de=["space-between","space-around","space-evenly"];function G(o,r){return U.reduce((u,e)=>{const i=o+z(e);return u[i]=r(),u},{})}const Ke=[..._,"baseline","stretch"],me=o=>Ke.includes(o),ce=G("align",()=>({type:String,default:null,validator:me})),Je=[..._,...de],fe=o=>Je.includes(o),pe=G("justify",()=>({type:String,default:null,validator:fe})),qe=[..._,...de,"stretch"],ve=o=>qe.includes(o),be=G("alignContent",()=>({type:String,default:null,validator:ve})),te={align:Object.keys(ce),justify:Object.keys(pe),alignContent:Object.keys(be)},Xe={align:"align",justify:"justify",alignContent:"align-content"};function Qe(o,r,u){let e=Xe[o];if(u!=null){if(r){const i=r.replace(o,"");e+=`-${i}`}return e+=`-${u}`,e.toLowerCase()}}const Ze=le({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:me},...ce,justify:{type:String,default:null,validator:fe},...pe,alignContent:{type:String,default:null,validator:ve},...be,...se(),...ne()},"VRow"),I=ae()({name:"VRow",props:Ze(),setup(o,r){let{slots:u}=r;const e=T(()=>{const i=[];let f;for(f in te)te[f].forEach(v=>{const b=o[v],g=Qe(f,v,b);g&&i.push(g)});return i.push({"v-row--no-gutters":o.noGutters,"v-row--dense":o.dense,[`align-${o.align}`]:o.align,[`justify-${o.justify}`]:o.justify,[`align-content-${o.alignContent}`]:o.alignContent}),i});return()=>{var i;return oe(o.tag,{class:["v-row",e.value,o.class],style:o.style},(i=u.default)==null?void 0:i.call(u))}}}),et={key:0,class:"w-full h-full flex items-center justify-center text-center text-white text-h5 font-weight-bold p-4 overflow-hidden"},tt={key:1,class:"main"},at=["width","height"],lt={class:"ml-2"},ot={class:"ml-2 flex gap-x-8"},nt={class:"ml-2 flex gap-x-8"},st={class:"ml-2"},it={class:"ml-2 flex gap-x-8 mb-4"},ut={class:"flex flex-col"},rt={class:"flex flex-col"},dt={class:"flex w-full justify-end my-2"},mt=Ce({__name:"Plotter",props:{widget:{}},setup(o){const r=Me(),e=Se(o).widget,i=S([]);let f,v;Le(()=>{const t={backgroundColor:"rgba(0, 0, 0, 0.7)",lineColor:"rgba(255, 0, 0, 1.0)",dataLakeVariableId:void 0,maxSamples:1e3,limitSamples:!0,lineThickness:1,decimalPlaces:2,showTitle:!0,updateOnConstantValue:!0,useFixedMinY:!1,useFixedMaxY:!1,fixedMinY:0,fixedMaxY:100};e.value.options={...t,...e.value.options}}),Pe(()=>{if(F(e.value.options.dataLakeVariableId),i.value=Object.values(Te()),v=Ne(t=>{i.value=Object.values(t)}),m.length===0){const t=Ye(e.value.options.dataLakeVariableId);t&&K(t)}}),Ie(()=>{v&&Ue(v),f&&Z(e.value.options.dataLakeVariableId,f)});const b=T(()=>i.value.filter(t=>t.type==="number")),g=S(""),p=S(!1);L(()=>e.value.options.dataLakeVariableId,()=>p.value=!1);const ge=T(()=>{const t=(g.value||"").toLowerCase();return b.value.filter(a=>a.name.toLowerCase().includes(t))}),H=()=>{e.value.options.limitSamples&&(m.length===e.value.options.maxSamples+1?m.shift():m.length>e.value.options.maxSamples&&m.splice(0,m.length-e.value.options.maxSamples))},K=t=>{m.push(t),H(),D()},F=(t,a)=>{if(t===void 0){console.error("No data lake variable ID provided!");return}a!==void 0&&f&&Z(a,f),f=Fe(t,l=>K(l),{notifyOnTimestampChange:e.value.options.updateOnConstantValue})};L(()=>e.value.options.dataLakeVariableId,(t,a)=>{F(t,a),m.length=0}),L(()=>e.value.options.updateOnConstantValue,()=>{const t=e.value.options.dataLakeVariableId;t&&F(t,t)});const{width:Ve,height:he}=je(),y=T(()=>({width:e.value.size.width*Ve.value,height:e.value.size.height*he.value})),w=S(),j=S(),N=(t,a,l,V)=>{const C=t.measureText(a),h=4;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(l-h,V-16-h,C.width+h*2,16+h*2),t.fillStyle=e.value.options.lineColor,t.fillText(a,l,V)},D=()=>{if(w.value===void 0||w.value===null)return;if(j.value===void 0){console.debug("Canvas context undefined!"),j.value=w.value.getContext("2d");return}const t=j.value,a=y.value.width,l=y.value.height;De(t),t.clearRect(0,0,a,l),t.fillStyle=e.value.options.backgroundColor,t.fillRect(0,0,a,l),t.strokeStyle=e.value.options.lineColor,t.lineWidth=Math.max(e.value.options.lineThickness,1);try{$=Math.max(...m),O=Math.min(...m);const V=e.value.options.useFixedMinY?e.value.options.fixedMinY:O,C=e.value.options.useFixedMaxY?e.value.options.fixedMaxY:$,h=.05*(C!=V?C-V:1),M=e.value.options.useFixedMinY?e.value.options.fixedMinY:V-h,E=e.value.options.useFixedMaxY?e.value.options.fixedMaxY:C+h,ke=m[m.length-1];if(M<=0&&E>=0){const x=l-(0-M)/(E-M)*l;t.beginPath(),t.setLineDash([5,5]),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=1,t.moveTo(0,x),t.lineTo(a,x),t.stroke(),t.strokeStyle=e.value.options.lineColor,t.lineWidth=Math.max(e.value.options.lineThickness,1)}if(t.beginPath(),t.moveTo(0,l/2),t.setLineDash([]),m.length===0?(t.beginPath(),t.arc(0,l/2,7,0,2*Math.PI),t.stroke()):m.length===1?(t.fillStyle=e.value.options.lineColor,t.beginPath(),t.arc(0,l/2,7,0,2*Math.PI),t.fill(),t.beginPath(),t.setLineDash([5,5]),t.moveTo(0,l/2),t.lineTo(50,l/2),t.stroke()):(t.setLineDash([]),m.forEach((x,A)=>{const ye=A*(a/m.length),we=l-(x-M)/(E-M)*l;t.lineTo(ye,we)})),t.stroke(),t.font="14px monospace",t.textBaseline="bottom",e.value.options.showTitle&&e.value.options.dataLakeVariableId){const x=i.value.find(A=>A.id===e.value.options.dataLakeVariableId);x&&(N(t,x.name,10,26),t.textBaseline="bottom")}const B=e.value.options.decimalPlaces;N(t,`Current: ${Number(ke).toFixed(B)}`,10,l-10),N(t,`Min: ${Number(O).toFixed(B)}`,10,l-30),N(t,`Max: ${Number($).toFixed(B)}`,10,l-50)}catch(V){console.error("Error drawing graph:",V)}},m=[];let $=0,O=0;L([y,e],()=>{r.isWidgetVisible(e.value)&&(H(),$e(()=>D()))},{deep:!0});const xe=Oe(w);return L(xe,(t,a)=>{t&&!a&&D()}),(t,a)=>(W(),R(We,null,[n(e).options.dataLakeVariableId?(W(),R("div",tt,[d("canvas",{ref_key:"canvasRef",ref:w,width:y.value.width,height:y.value.height},null,8,at)])):(W(),R("p",et," Please open the Plotter widget configuration menu to select a variable to be plotted. ")),s(Re,{modelValue:n(r).widgetManagerVars(n(e).hash).configMenuOpen,"onUpdate:modelValue":a[19]||(a[19]=l=>n(r).widgetManagerVars(n(e).hash).configMenuOpen=l),title:"Plotter config",variant:"text-only"},{content:c(()=>[s(I,null,{default:c(()=>[s(Y,{cols:"12"},{default:c(()=>[a[20]||(a[20]=d("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Source",-1)),d("div",lt,[s(k,{modelValue:g.value,"onUpdate:modelValue":[a[0]||(a[0]=l=>g.value=l),a[1]||(a[1]=l=>p.value=!0)],density:"compact",variant:"filled",theme:"dark",type:"text",placeholder:"Search variables...",class:"mb-4",clearable:"","onClick:clear":a[2]||(a[2]=l=>p.value=!1),"onUpdate:focused":a[3]||(a[3]=l=>p.value=l)},null,8,["modelValue"]),s(Ae,{modelValue:n(e).options.dataLakeVariableId,"onUpdate:modelValue":a[4]||(a[4]=l=>n(e).options.dataLakeVariableId=l),items:ge.value,"item-title":"name","item-value":"id",label:"Data Lake variable",hint:"Select a variable to be plotted","persistent-hint":"",theme:"dark",variant:"outlined",density:"comfortable","menu-props":{modelValue:p.value},onClick:a[5]||(a[5]=l=>p.value=!p.value)},null,8,["modelValue","items","menu-props"])])]),_:1,__:[20]})]),_:1}),s(I,null,{default:c(()=>[s(Y,{cols:"12"},{default:c(()=>[a[23]||(a[23]=d("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Appearance",-1)),d("div",ot,[s(P,{modelValue:n(e).options.showTitle,"onUpdate:modelValue":a[6]||(a[6]=l=>n(e).options.showTitle=l),label:"Show title","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),s(J,{"close-on-content-click":!1},{activator:c(({props:l})=>[d("div",X(l,{class:"flex cursor-pointer"}),[a[21]||(a[21]=d("span",{class:"mt-3"},"Background color",-1)),d("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:Q({backgroundColor:n(e).options.backgroundColor})},null,4)],16)]),default:c(()=>[s(q,{modelValue:n(e).options.backgroundColor,"onUpdate:modelValue":a[7]||(a[7]=l=>n(e).options.backgroundColor=l),label:"Background","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),s(J,{"close-on-content-click":!1},{activator:c(({props:l})=>[d("div",X(l,{class:"flex cursor-pointer"}),[a[22]||(a[22]=d("span",{class:"mt-3"},"Line color",-1)),d("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:Q({backgroundColor:n(e).options.lineColor})},null,4)],16)]),default:c(()=>[s(q,{modelValue:n(e).options.lineColor,"onUpdate:modelValue":a[8]||(a[8]=l=>n(e).options.lineColor=l),label:"Line","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),s(k,{modelValue:n(e).options.lineThickness,"onUpdate:modelValue":a[9]||(a[9]=l=>n(e).options.lineThickness=l),modelModifiers:{number:!0},type:"number",label:"Line thickness",variant:"outlined",density:"compact",rules:[l=>l>0||"Must be greater than 0"],width:"140px","hide-details":""},null,8,["modelValue","rules"])])]),_:1,__:[23]})]),_:1}),s(I,null,{default:c(()=>[s(Y,{cols:"12"},{default:c(()=>[a[24]||(a[24]=d("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Points",-1)),d("div",nt,[s(k,{modelValue:n(e).options.decimalPlaces,"onUpdate:modelValue":a[10]||(a[10]=l=>n(e).options.decimalPlaces=l),modelModifiers:{number:!0},type:"number",label:"Decimal places",variant:"outlined",density:"comfortable",rules:[l=>l>=0||"Must be 0 or greater"],hint:"Number of decimal places to be displayed",width:"160px",class:"ml-2"},null,8,["modelValue","rules"]),s(P,{modelValue:n(e).options.limitSamples,"onUpdate:modelValue":a[11]||(a[11]=l=>n(e).options.limitSamples=l),label:"Limit number of samples"},null,8,["modelValue"]),s(k,{modelValue:n(e).options.maxSamples,"onUpdate:modelValue":a[12]||(a[12]=l=>n(e).options.maxSamples=l),modelModifiers:{number:!0},type:"number",label:"Maximum samples",variant:"outlined",density:"comfortable",disabled:!n(e).options.limitSamples,rules:[l=>l>0||"Must be greater than 0"],hint:"Higher values will show more history but may impact performance",width:"220px"},null,8,["modelValue","disabled","rules"])]),d("div",st,[s(P,{modelValue:n(e).options.updateOnConstantValue,"onUpdate:modelValue":a[13]||(a[13]=l=>n(e).options.updateOnConstantValue=l),label:"Update on constant value",hint:"Advance graph when value is unchanged (shows horizontal lines for constant values)","persistent-hint":""},null,8,["modelValue"])])]),_:1,__:[24]})]),_:1}),s(I,null,{default:c(()=>[s(Y,{cols:"12"},{default:c(()=>[a[25]||(a[25]=d("div",{class:"text-subtitle-1 font-weight-medium"},"Y-Axis Bounds",-1)),d("div",it,[d("div",ut,[s(P,{modelValue:n(e).options.useFixedMinY,"onUpdate:modelValue":a[14]||(a[14]=l=>n(e).options.useFixedMinY=l),label:"Fixed minimum","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),s(k,{modelValue:n(e).options.fixedMinY,"onUpdate:modelValue":a[15]||(a[15]=l=>n(e).options.fixedMinY=l),modelModifiers:{number:!0},type:"number",label:"Min value",variant:"outlined",density:"compact",disabled:!n(e).options.useFixedMinY,width:"140px","hide-details":""},null,8,["modelValue","disabled"])]),d("div",rt,[s(P,{modelValue:n(e).options.useFixedMaxY,"onUpdate:modelValue":a[16]||(a[16]=l=>n(e).options.useFixedMaxY=l),label:"Fixed maximum","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),s(k,{modelValue:n(e).options.fixedMaxY,"onUpdate:modelValue":a[17]||(a[17]=l=>n(e).options.fixedMaxY=l),modelModifiers:{number:!0},type:"number",label:"Max value",variant:"outlined",density:"compact",disabled:!n(e).options.useFixedMaxY,width:"140px","hide-details":""},null,8,["modelValue","disabled"])])])]),_:1,__:[25]})]),_:1})]),actions:c(()=>[d("div",dt,[s(Ee,{onClick:a[18]||(a[18]=l=>n(r).widgetManagerVars(n(e).hash).configMenuOpen=!1)},{default:c(()=>a[26]||(a[26]=[Be("Close")])),_:1,__:[26]})])]),_:1},8,["modelValue"])],64))}}),ft=ze(mt,[["__scopeId","data-v-8931d064"]]);export{ft as default};
