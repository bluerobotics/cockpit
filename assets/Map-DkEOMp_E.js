import{c as Qe,bS as Ot,K as ma,bT as pa,r as d,w as x,h as E,s as q,n as O,E as m,p as D,q as r,a1 as _e,J as fa,R as $t,au as Dt,aB as ga,a_ as we,o as Pt,aC as B,Y as Gt,x as ie,z as n,Z as Rt,V as N,a3 as Lt,G as W,$ as Nt,aD as zt,m as J,F as Bt,C as ha,aE as $e,bO as ba,b0 as ya,y as Ke,B as Je,a0 as Et,v as U,aS as xa,a2 as Xe,bJ as wa,a6 as Ht,_ as Ut,bF as ka,t as Ma,ak as Ca,u as Va,bU as Sa,bV as R,l as Ta,X as It,a8 as Ft,W as Oa,bW as La,bX as Ae,bY as v,bZ as Ea,b_ as _,aq as Ia,aW as Fa,b$ as Aa,c0 as _a,c1 as oe,c2 as $a,c3 as Da,c4 as Pa,ab as Ga,e as Ra,bl as Na,a4 as At,P as pe,b1 as za,af as Ba,aJ as le,Q as xe,c5 as Ha,H as _t,c6 as Ua,c7 as Wa}from"./index-DuAj7zaV.js";const qa=""+new URL("arducopter-top-view-DWT9mmA0.png",import.meta.url).href,Ya={class:"flex items-center gap-2 mb-6"},Za={class:"flex items-center gap-2 mb-6"},ja={class:"flex items-center gap-2 mb-2"},Ka=Qe({__name:"GlobalOriginDialog",props:Ot({vehicle:{},initialLatitude:{},initialLongitude:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:Ot(["origin-set"],["update:modelValue"]),setup(se,{emit:ne}){const{openSnackbar:y}=ma(),f=pa(se,"modelValue"),X=ne,V=se,i=d(V.initialLatitude),u=d(V.initialLongitude),G=d(0),a=d(!1);x(()=>[V.initialLatitude,V.initialLongitude],([M,w])=>{i.value=M,u.value=w});const I=E(()=>i.value!==null&&i.value!==void 0&&i.value>=-90&&i.value<=90&&u.value!==null&&u.value!==void 0&&u.value>=-180&&u.value<=180&&G.value!==null&&G.value!==void 0),L=()=>{f.value=!1},S=()=>{if(!(!I.value||a.value)){if(V.vehicle===void 0||V.vehicle.dateLastHeartbeat()===void 0||V.vehicle.dateLastHeartbeat()>new Date(Date.now()-5e3)){y({message:"Cannot set global origin. Vehicle does not appear to be online.",variant:"error"});return}a.value=!0;try{V.vehicle.setGlobalOrigin([i.value,u.value],G.value),y({message:"Global origin set successfully.",variant:"success"}),X("origin-set",i.value,u.value),L()}catch(M){y({message:`Failed to set global origin: ${M}`,variant:"error"})}finally{a.value=!1}}},Q=E(()=>[{text:"Cancel",action:L,disabled:a.value},{text:a.value?"Saving...":"Save",disabled:!I.value||a.value,action:S,class:a.value?"opacity-70":""}]);return(M,w)=>(O(),q(fa,{"show-dialog":f.value,title:"Set Global Origin",variant:"text-only","max-width":"500px",actions:Q.value,"onUpdate:showDialog":w[3]||(w[3]=g=>f.value=g)},{content:m(()=>[w[7]||(w[7]=D("p",{class:"text-sm mb-8 -mt-6 text-gray-300"}," This feature allows you to set the GNSS coordinates of the vehicle's local origin (0,0,0). This is useful when using local position units (such as indoor positioning systems or DVLs) where you want to define a corresponding global position. ",-1)),D("div",Ya,[r(_e,{modelValue:i.value,"onUpdate:modelValue":w[0]||(w[0]=g=>i.value=g),modelModifiers:{number:!0},label:"Latitude",type:"number",step:"0.000001",hint:"Latitude in degrees (-90 to 90)","persistent-hint":"",variant:"outlined",rules:[g=>g!=null||"Latitude is required",g=>g>=-90&&g<=90||"Latitude must be between -90 and 90"],class:"flex-1"},null,8,["modelValue","rules"]),w[4]||(w[4]=D("span",{class:"text-white text-lg font-medium mb-6 w-4"},"°",-1))]),D("div",Za,[r(_e,{modelValue:u.value,"onUpdate:modelValue":w[1]||(w[1]=g=>u.value=g),modelModifiers:{number:!0},label:"Longitude",type:"number",step:"0.000001",hint:"Longitude in degrees (-180 to 180)","persistent-hint":"",variant:"outlined",rules:[g=>g!=null||"Longitude is required",g=>g>=-180&&g<=180||"Longitude must be between -180 and 180"],class:"flex-1"},null,8,["modelValue","rules"]),w[5]||(w[5]=D("span",{class:"text-white text-lg font-medium mb-6 w-4"},"°",-1))]),D("div",ja,[r(_e,{modelValue:G.value,"onUpdate:modelValue":w[2]||(w[2]=g=>G.value=g),modelModifiers:{number:!0},label:"Altitude",type:"number",step:"0.1",hint:"Altitude in meters (MSL)","persistent-hint":"",variant:"outlined",rules:[g=>g!=null||"Altitude is required"],class:"flex-1"},null,8,["modelValue","rules"]),w[6]||(w[6]=D("span",{class:"text-white text-lg font-medium mb-6 w-4"},"m",-1))])]),_:1},8,["show-dialog","actions"]))}}),Ja={class:"flex justify-end"},Xa={key:0,class:"fixed top-[80px] right-5"},Qa={key:1,class:"flex w-full items-center"},eo={class:"flex justify-between w-full py-1 px-2 pt-3"},to={class:"flex items-center"},ao=Qe({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(se,{emit:ne}){const y=$t(),f=Dt(),X=se,V=ne,i=ga("cockpit-pre-arm-checklist",[]),u=d({}),G=d(""),a=d(null),I=d(!1),L=E(()=>X.modelValue),S=()=>{const k={};for(const s of i.value??[])k[s.id]=!1;u.value=k},Q=E(()=>{if(!f.showChecklistBeforeArm)return!0;const k=i.value??[];return k.length>0&&k.every(s=>u.value[s.id]===!0)});x(()=>L.value,k=>{k?(S(),we(()=>{var s,h;return(h=(s=a.value)==null?void 0:s.focus)==null?void 0:h.call(s)})):(u.value={},I.value=!1)}),x(()=>i.value,k=>{if(!L.value)return;const s={...u.value},h={};for(const F of k??[])h[F.id]=!0,F.id in s||(s[F.id]=!1);for(const F of Object.keys(s)){const re=Number(F);h[re]||delete s[re]}u.value=s},{deep:!0});const M=async()=>{var h,F;const k=G.value.trim();if(!k)return;const s={id:Date.now(),text:k};i.value.push(s),L.value&&(u.value[s.id]=!1),G.value="",await we(),(F=(h=a.value)==null?void 0:h.focus)==null||F.call(h)},w=k=>{if(i.value=i.value.filter(s=>s.id!==k),k in u.value){const s={...u.value};delete s[k],u.value=s}},g=()=>{V("dismissed"),V("update:modelValue",!1)},Y=()=>{V("confirmed",!0),V("update:modelValue",!1)};return Pt(()=>{i.value.length===0&&(i.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),L.value&&S()}),x(()=>f.showChecklistBeforeArm,k=>{k||B({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(k,s)=>(O(),q(Ht,{modelValue:L.value,"onUpdate:modelValue":s[4]||(s[4]=h=>L.value=h),"max-width":"600",scrollable:"",persistent:""},{default:m(()=>[r(Gt,{style:ie(n(y).globalGlassMenuStyles),class:"rounded-lg"},{default:m(()=>[r(Rt,{class:"text-center relative pt-3"},{default:m(()=>[s[6]||(s[6]=D("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),r(N,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:g},{default:m(()=>[r(Lt,null,{default:m(()=>s[5]||(s[5]=[W("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),r(Nt,{class:"mt-[-10px]"},{default:m(()=>[r(zt,{lines:"one",theme:"dark",class:"bg-transparent"},{default:m(()=>[(O(!0),J(Bt,null,ha(n(i),h=>(O(),q($e,{key:h.id,theme:"dark"},ba({prepend:m(()=>[r(Et,{modelValue:u.value[h.id],"onUpdate:modelValue":F=>u.value[h.id]=F,class:"mt-0","hide-details":"",density:"compact",disabled:!n(f).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:m(()=>[r(ya,{class:Ke([{"line-through opacity-60":u.value[h.id]},{"opacity-50":!n(f).showChecklistBeforeArm}])},{default:m(()=>[W(Je(h.text),1)]),_:2},1032,["class"])]),_:2},[I.value&&n(i).length>1?{name:"append",fn:m(()=>[r(N,{icon:"",variant:"text",disabled:!n(f).showChecklistBeforeArm,onClick:F=>w(h.id)},{default:m(()=>[r(Lt,null,{default:m(()=>s[7]||(s[7]=[W("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),D("div",Ja,[I.value?(O(),J("div",Qa,[I.value?(O(),q(_e,{key:0,ref_key:"newItemInput",ref:a,modelValue:G.value,"onUpdate:modelValue":s[1]||(s[1]=h=>G.value=h),disabled:!n(f).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:xa(M,["enter"]),"onClick:appendInner":M},null,8,["modelValue","disabled"])):U("",!0),r(N,{"prepend-icon":"mdi-check",disabled:!n(f).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:s[2]||(s[2]=()=>{I.value=!1,M()})},{default:m(()=>s[9]||(s[9]=[W("Done")])),_:1,__:[9]},8,["disabled"])])):(O(),J("div",Xa,[r(N,{"prepend-icon":"mdi-format-list-checks",disabled:!n(f).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:s[0]||(s[0]=h=>I.value=!0)},{default:m(()=>s[8]||(s[8]=[W(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),r(Xe,{class:"flex center w-[80%]",inset:""}),r(wa,null,{default:m(()=>[D("div",eo,[r(N,{variant:"text",onClick:g},{default:m(()=>s[10]||(s[10]=[W("Cancel")])),_:1,__:[10]}),D("div",to,[r(Et,{"model-value":!n(f).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":s[3]||(s[3]=h=>n(f).showChecklistBeforeArm=!h)},null,8,["model-value"]),s[11]||(s[11]=D("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),r(N,{color:"#ffffff33",class:Ke({"opacity-30":!Q.value}),variant:"flat",disabled:!Q.value,onClick:Y},{default:m(()=>s[12]||(s[12]=[W("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),oo=Ut(ao,[["__scopeId","data-v-b0b8e43a"]]),lo=["id"],io={key:0},so=Qe({__name:"Map",props:{widget:{}},setup(se){var St;ka(e=>({"6e88d530":na.value}));const ne=se,y=Ma(ne).widget,f=$t(),{showDialog:X,closeDialog:V}=Ca(),i=Va(),u=Dt(),G=Sa(),a=R(),I=d(u.defaultMapZoom),L=d(u.defaultMapCenter),S=d(),Q=E(()=>`map-${y.value.hash}`),M=E(()=>Re.value||ue.value),w=d(!1),g=d([]),Y=R({}),k=d(),s=d(!1),h=d(!1),F=d(!1),re=d(!1),fe=d(0),ee=d(0),ke=d("");let Me,Ce,Ve;const ue=d(!1),ge=d([]),Se=R({}),Wt=E(()=>({"--glass-background":f.globalGlassMenuStyles.backgroundColor,"--glass-filter":f.globalGlassMenuStyles.backdropFilter,"--glass-border":f.globalGlassMenuStyles.border,"--glass-color":f.globalGlassMenuStyles.color,"--glass-box-shadow":f.globalGlassMenuStyles.boxShadow})),qt=()=>{Me==null||Me.click(),ue.value=!1},Yt=()=>{Ce==null||Ce.click(),ue.value=!1},Zt=()=>{Ve==null||Ve.click(),ue.value=!1};let et;const tt=e=>{e.touches.length>1&&(h.value=!0,j.value&&Ee(),clearTimeout(et))},at=e=>{e.touches.length<=1&&(et=window.setTimeout(()=>h.value=!1,300))},De=E(()=>{const e=new Set;return i.reachedMissionItemSequences.length&&i.reachedMissionItemSequences.forEach(t=>{const o=Se.value[t];o!==void 0&&e.add(o)}),e}),Pe=(e,t)=>{const o=e>=100;return v.divIcon({className:t?"marker-icon marker-icon--reached":"marker-icon",iconSize:o?[24,24]:[20,20],iconAnchor:o?[12,12]:[10,10]})},ot=e=>{const t=Y.value[e];if(!t)return;const o=De.value.has(e);t.setIcon(Pe(e,o));const l=t.getTooltip();if(l){const c=l.getElement();c&&(o?c.classList.add("waypoint-tooltip--reached"):c.classList.remove("waypoint-tooltip--reached"))}},jt=()=>{Object.keys(Y.value).forEach(e=>ot(Number(e)))},ce=d(null),z=R({});It.registerUsage(Ft.latitude),It.registerUsage(Ft.longitude),Oa(()=>{Object.keys(y.value.options).length===0&&(y.value.options={showVehiclePath:!0,showCoordinateGrid:!1}),y.value.options.showCoordinateGrid===void 0&&(y.value.options.showCoordinateGrid=!1),P.enableAutoUpdate()});const Ge=Ae.tileLayerOffline("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),Te=Ae.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),Oe=Ae.tileLayerOffline("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),lt=v.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),it={OpenStreetMap:Ge,"Esri World Imagery":Te},Kt={Seamarks:Oe,"Marine Profile":lt},de=d(),Re=Ta(de),st=v.control.zoom({position:"bottomright"}),nt=v.control.layers(it,Kt),he=R(void 0);x(M,()=>{a.value!==void 0&&(M.value?(a.value.addControl(st),a.value.addControl(nt),ut()):(a.value.removeControl(st),a.value.removeControl(nt),ct()))}),x(Re,()=>{M.value=Re.value}),x(()=>y.value.options.showCoordinateGrid,e=>{a.value!==void 0&&(e?Ne():Jt())}),x([I,L],()=>{y.value.options.showCoordinateGrid&&a.value&&Ne(),M.value&&a.value&&ut()}),x(()=>i.reachedMissionItemSequences,()=>{jt()},{deep:!0});const Ne=()=>{if(a.value)try{he.value=Ea(a.value,he.value)}catch(e){console.error("Failed to create grid overlay:",e)}},Jt=()=>{he.value&&a.value&&(a.value.removeLayer(he.value),he.value=void 0)},rt=v.control.scale({position:"bottomright",metric:!0,imperial:!1,maxWidth:100}),ut=()=>{a.value&&(ct(),rt.addTo(a.value))},ct=()=>{if(a.value)try{a.value.removeControl(rt)}catch{}};Pt(async()=>{var Fe,Tt;Y.value={},ge.value=[],Se.value={},i.clearReachedMissionItems(),(Fe=de.value)==null||Fe.addEventListener("touchstart",tt,{passive:!0}),(Tt=de.value)==null||Tt.addEventListener("touchend",at,{passive:!0});const e=it[u.userLastMapTileProvider]||Te;a.value=v.map(Q.value,{layers:[e,Oe,lt],attributionControl:!1}).setView(L.value,I.value),a.value.on("baselayerchange",b=>{const A=b.name;A.includes(A)&&(u.userLastMapTileProvider=b.name)}),a.value.removeControl(a.value.zoomControl),a.value.on("click",b=>{C.value=[b.latlng.lat,b.latlng.lng]}),a.value.on("moveend",()=>{if(a.value===void 0)return;let{lat:b,lng:A}=a.value.getCenter();b&&A&&(L.value=[b,A])});const t=ze(Te,"Esri",19),o=ze(Ge,"OSM",19),l=ze(Oe,"Seamarks",18);a.value&&(t.addTo(a.value),o.addTo(a.value),l.addTo(a.value));const c=b=>{var ae;const A=((ae=b.getContainer)==null?void 0:ae.call(b))??b._container;A&&(A.classList.add("hidden-savetiles"),A.style.display="none")};c(t),c(o),c(l),await we();const p=b=>{var ae;const A=((ae=b.getContainer)==null?void 0:ae.call(b))??b._container;return Array.from((A==null?void 0:A.querySelectorAll("a"))??[])},[T]=p(t),[H]=p(o),[K]=p(l);Me=T,Ce=H,Ve=K,Be(Te,"Esri"),Be(Ge,"OSM"),Be(Oe,"Seamarks"),a.value.on("dragstart",()=>{s.value=!0}),a.value.on("dragend",()=>{setTimeout(()=>s.value=!1,200)}),a.value.on("zoomend",()=>{var b;j.value=!1,a.value!==void 0&&(I.value=((b=a.value)==null?void 0:b.getZoom())??L.value)}),a.value.whenReady(()=>{we(()=>{Object.entries(Y.value).forEach(([b,A])=>{const ae=De.value.has(Number(b));A.setIcon(Pe(Number(b),ae))})})}),a.value.on("contextmenu",b=>{C.value=[b.latlng.lat,b.latlng.lng]}),P.enableAutoUpdate(),window.addEventListener("keydown",ht),$.value?P.goToTarget(_.VEHICLE):P.goToTarget(_.HOME),!i.isVehicleOnline&&u.vehicleMission.length&&Ze(u.vehicleMission),y.value.options.showCoordinateGrid&&Ne(),w.value=!0,await He()});const Xt=e=>(t,o)=>{X({variant:"info",message:`Save ${t._tilesforSave.length} ${e} tiles for offline use?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:V},{text:"Save tiles",color:"white",action:()=>{o(),V()}}]})},Qt=e=>(t,o)=>{X({variant:"warning",message:`Remove all saved ${e} tiles for this layer?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:V},{text:"Remove tiles",color:"white",action:()=>{o(),V(),B({message:`${e} offline tiles removed`,variant:"info",duration:3e3})}}]})},ze=(e,t,o)=>Ae.savetiles(e,{saveWhatYouSee:!0,maxZoom:o,alwaysDownload:!1,position:"topright",parallel:20,confirm:Xt(t),confirmRemoval:Qt(t),saveText:`<i class="mdi mdi-download" title="Save ${t} tiles"></i>`,rmText:`<i class="mdi mdi-trash-can" title="Remove ${t} tiles"></i>`}),Be=(e,t)=>{e.on("savestart",o=>{var l;fe.value=0,ee.value=((l=o==null?void 0:o._tilesforSave)==null?void 0:l.length)??0,ke.value=t,re.value=!0,B({message:`Saving ${ee.value} ${t} tiles...`,variant:"info",duration:2e3})}),e.on("loadtileend",()=>{fe.value+=1,ee.value>0&&fe.value>=ee.value&&(B({message:`${t} offline tiles saved!`,variant:"success",duration:3e3}),re.value=!1,ke.value="",fe.value=0,ee.value=0)})},ea={open:e=>{if(!a.value||h.value||s.value)return;e.preventDefault(),e.stopPropagation();const t=a.value.mouseEventToContainerPoint(e),o=a.value.containerPointToLatLng(t);C.value=[o.lat,o.lng],k.value.openAt(e),j.value=!0},close:()=>{Ee()}},dt=()=>{var e;(e=a.value)==null||e.eachLayer(t=>{(t instanceof v.Marker||t instanceof v.Polyline&&t.options.color==="#358AC3")&&a.value.removeLayer(t)}),g.value=[],Le.value=void 0,te.value=void 0,me.value=void 0,Z.value=void 0,Y.value={},ge.value=[],Se.value={}},He=async()=>{w.value&&(dt(),i.isVehicleOnline?await xt():u.vehicleMission.length&&(yt(u.vehicleMission),Ze(u.vehicleMission)))};x(()=>i.isVehicleOnline,()=>{He()}),x(()=>u.vehicleMissionRevision,()=>{He()}),Ia(()=>{var e,t;P.disableAutoUpdate(),window.removeEventListener("keydown",ht),a.value&&(a.value.off("contextmenu"),Object.values(z.value).forEach(o=>o.remove()),z.value={}),(e=de.value)==null||e.removeEventListener("touchstart",tt),(t=de.value)==null||t.removeEventListener("touchend",at)}),x(L,(e,t)=>{var o;e.toString()!==t.toString()&&((o=a.value)==null||o.panTo(e))}),x(a,(e,t)=>{a.value!==void 0&&(e==null?void 0:e.options)===void 0&&(a.value=t)}),x(I,(e,t)=>{var o;e!==t&&(j.value=!1,(o=a.value)==null||o.setZoom(I.value))}),x(ne.widget,()=>{var e;(e=a.value)==null||e.invalidateSize()});const ve=d(void 0),P=new La(e=>ve.value=e,e=>L.value=e);P.setTrackableTarget(_.VEHICLE,()=>$.value),P.setTrackableTarget(_.HOME,()=>S.value);const $=E(()=>i.coordinates.latitude?[i.coordinates.latitude,i.coordinates.longitude]:void 0),Ue=E(()=>{var e;return i.attitude.yaw?Fa((e=i.attitude)==null?void 0:e.yaw):0}),vt=E(()=>{const e=i.lastHeartbeat;return e?`${Aa(e??0,{includeSeconds:!0})} ago`:"never"}),{history:ta}=_a($);(St=navigator==null?void 0:navigator.geolocation)==null||St.watchPosition(e=>{S.value||(S.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let mt=!0;x([S,a],async()=>{S.value===L.value||!a.value||!mt||(P.goToTarget(_.HOME),mt=!1)});const Z=R();x(i.coordinates,()=>{if(!(!a.value||!$.value)){if(Z.value===void 0){let e=$a;i.vehicleType===oe.MAV_TYPE_SURFACE_BOAT?e=Da:i.vehicleType===oe.MAV_TYPE_SUBMARINE?e=Pa:[oe.MAV_TYPE_QUADROTOR,oe.MAV_TYPE_HEXAROTOR,oe.MAV_TYPE_OCTOROTOR,oe.MAV_TYPE_TRICOPTER,oe.MAV_TYPE_DODECAROTOR].includes(i.vehicleType)&&(e=qa);const t=v.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});Z.value=v.marker($.value,{icon:t});const o=v.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});Z.value.bindTooltip(o),a.value.addLayer(Z.value)}Z.value.setLatLng($.value)}}),x($,(e,t)=>{ve.value===_.VEHICLE||t!==void 0||P.follow(_.VEHICLE)}),x([$,Ue,vt,()=>i.isArmed],()=>{var t,o,l,c,p;if(Z.value===void 0)return;(c=Z.value.getTooltip())==null||c.setContent(`
    <p>Coordinates: ${(t=$.value)==null?void 0:t[0].toFixed(6)}, ${(o=$.value)==null?void 0:o[1].toFixed(6)}</p>
    <p>Velocity: ${((l=i.velocity.ground)==null?void 0:l.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${Ue.value.toFixed(2)}°</p>
    <p>${i.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${vt.value}</p>
  `);const e=(p=Z.value.getElement())==null?void 0:p.querySelector("img");e&&(e.style.transform=`rotate(${Ue.value}deg)`)});const te=R();x(S,()=>{if(a.value===void 0)return;const e=S.value;if(e!==void 0)if(te.value)te.value.setLatLng(e);else{te.value=v.marker(e,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=v.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});te.value.bindTooltip(t),te.value.on("dragend",o=>{const c=o.target.getLatLng();je([c.lat,c.lng])}),a.value.addLayer(te.value)}});const Le=R();x(g,e=>{a.value&&(Le.value||(Le.value=v.polyline([],{color:"#358AC3"}).addTo(a.value)),Le.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,o)=>{var p,T;const l=o+1;let c=Y.value[l];if(c)c.setLatLng(t.coordinates),(T=c.getTooltip())==null||T.setContent(l.toString()),ot(l);else{const H=De.value.has(l),K=Pe(l,H);c=v.marker(t.coordinates,{icon:K}),Y.value[l]=c;const Fe=v.tooltip({content:l.toString(),permanent:!0,direction:"center",className:H?"waypoint-tooltip waypoint-tooltip--reached":"waypoint-tooltip",opacity:1});c.bindTooltip(Fe),(p=a.value)==null||p.addLayer(c)}}))},{deep:!0});const We=R();x(ta,e=>{if(a.value===void 0||e===void 0)return;We.value===void 0&&(We.value=v.polyline([],{color:"#ffff00"}).addTo(a.value));const t=e.filter(o=>o.snapshot!==void 0).map(o=>o.snapshot);We.value.setLatLngs(t)});const j=d(!1),C=d(null),pt=R(),qe=d(!1),ft=d(0),gt=d(0),Ye=R(),aa=Ga([{item:"Set home waypoint",action:()=>be("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Set Global Origin",action:()=>be("set-global-origin"),icon:"mdi-crosshairs-question"},{item:"Place Point of Interest",action:()=>be("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>be("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>be("set-default-map-position"),icon:"mdi-map-check"}]),me=R(),oa=async()=>{var e;if(!(!a.value||!C.value))try{await u.setDefaultMapPosition(C.value,I.value),B({message:"Default map position set",variant:"success"});const t=v.marker(C.value,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value),o=v.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(o).openTooltip();const l=t.getElement(),c=(e=t.getTooltip())==null?void 0:e.getElement();[l,c].forEach(p=>{p&&(p.style.transition="opacity 1s",p.style.opacity="1")}),setTimeout(()=>{[l,c].forEach(p=>{p&&(p.style.opacity="0")}),setTimeout(()=>{var p;(p=a.value)==null||p.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),B({message:"Failed to set default map position",variant:"error"})}},la=async()=>{if(!C.value||!a.value)return;me.value&&(a.value.removeLayer(me.value),me.value=void 0),me.value=v.marker(C.value,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value);const e=v.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(me.value.bindTooltip(e),C.value){const p=i.coordinates.altitude??0,T=C.value[0],H=C.value[1];try{await i.goTo(0,0,0,0,T,H,p)}catch(K){B({message:`GoTo request failed: ${K.message}`,variant:"error"})}}},be=async e=>{switch(e){case"goto":{la();break}case"set-default-map-position":oa();break;case"place-poi":C.value&&ce.value?ce.value.openDialog(C.value):C.value?ce.value||(B({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):(B({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":C.value&&je(C.value);break;case"set-global-origin":C.value&&(ft.value=C.value[0],gt.value=C.value[1],qe.value=!0);break;default:console.warn("Unknown menu option selected:",e)}j.value=!1},Ee=()=>{j.value=!1,a.value!==void 0&&pt.value!==void 0&&a.value.removeLayer(pt.value)},ia=(e,t)=>{if(!a.value)return;Ye.value&&a.value.removeLayer(Ye.value);const o=v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),l=v.marker([e,t],{icon:o}).addTo(a.value),c=v.tooltip({content:'<i class="mdi mdi-axis-arrow text-[18px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});l.bindTooltip(c),Ye.value=l},ht=e=>{e.key==="Escape"&&Ee()},Ze=e=>{e.forEach((t,o)=>{o===0?(S.value=t.coordinates,je(t.coordinates)):g.value.push(t)})},Ie=d(!1),bt=d(0),yt=e=>{const t={};let o=0;e.forEach((l,c)=>{const p=c===0?void 0:c;l.commands.forEach(T=>{T.type!=="MAVLINK_NAV_COMMAND"&&T.type!=="MAVLINK_NON_NAV_COMMAND"||(p!==void 0&&(t[o]=p),o+=1)})}),Se.value=t},xt=async()=>{Ie.value=!0,dt();const e=async t=>{bt.value=t};try{ge.value=await i.fetchMission(e),yt(ge.value),Ze(ge.value),B({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){X({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{Ie.value=!1}},je=async e=>{const t=[e[0],e[1]];S.value=t,await i.setHomeWaypoint(t,0),j.value&&(j.value=!1)},wt=async()=>{try{await i.startMission()}catch{B({message:"Failed to start mission.",variant:"error"})}},sa=async()=>{if(u.showChecklistBeforeArm){F.value=!0;return}wt()},ye=Ra(),na=E(()=>`${Math.max(-ye.widgetClearanceForVisibleArea(y.value).bottom,0)}px`),kt=E(()=>`${Math.max(-ye.widgetClearanceForVisibleArea(y.value).top,0)}px`),ra=E(()=>i.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),ua=E(()=>i.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),ca=E(()=>S.value===void 0?"Cannot center map on home (home position undefined).":ve.value===_.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),da=E(()=>i.isVehicleOnline?$.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":ve.value===_.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),Mt=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),Ct=e=>{if(!a.value||!a.value.getContainer())return;const t=v.divIcon(Mt(e)),o=v.marker(e.coordinates,{icon:t,draggable:!0}).addTo(a.value),l=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,c={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};o.bindTooltip(l,c),o.on("drag",p=>{var K;const T=p.target.getLatLng(),H=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${T.lat.toFixed(8)}, Lng: ${T.lng.toFixed(8)}
    `;(K=o.getTooltip())==null||K.setContent(H)}),o.on("dragend",p=>{const T=p.target.getLatLng();u.movePointOfInterest(e.id,[T.lat,T.lng])}),o.on("click",p=>{if(v.DomEvent.stopPropagation(p),ce.value){const T=u.pointsOfInterest.find(H=>H.id===e.id);T?ce.value.openDialog(void 0,T):console.warn("POI not found in store:",e.id)}}),z.value[e.id]=o},Vt=e=>{var l;if(!a.value||!a.value.getContainer()||!z.value[e.id])return;const t=z.value[e.id];t.setLatLng(e.coordinates),t.setIcon(v.divIcon(Mt(e)));const o=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(l=t.getTooltip())==null||l.setContent(o)},va=e=>{!a.value||!z.value[e]||(z.value[e].remove(),delete z.value[e])};return x(()=>u.pointsOfInterest,async e=>{if((!a.value||!a.value.getContainer())&&(await we(),!a.value||!a.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(o=>o.id));Object.keys(z.value).forEach(o=>{t.has(o)||va(o)}),e.forEach(o=>{z.value[o.id]?Vt(o):Ct(o)})},{deep:!0,immediate:!0}),x(a,e=>{e&&e.getContainer()&&u.pointsOfInterest.forEach(t=>{z.value[t.id]?Vt(t):Ct(t)})},{immediate:!0}),(e,t)=>{const o=Na("contextmenu");return O(),J(Bt,null,[At((O(),J("div",{ref_key:"mapBase",ref:de,class:Ke(["page-base",n(ye).editingMode?"pointer-events-none":"pointer-events-auto"]),style:ie(Wt.value)},[D("div",{id:Q.value,ref_key:"map",ref:a,class:"map"},[r(Ba,{modelValue:ue.value,"onUpdate:modelValue":t[0]||(t[0]=l=>ue.value=l),"close-on-content-click":!1,location:"top end"},{activator:m(({props:l})=>[At(r(N,pe({style:n(f).globalGlassMenuStyles},l,{class:"absolute right-[209px] m-3 bottom-button bg-slate-50 text-[14px]",elevation:"2",size:"x-small",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download-multiple"}),null,16,["style"]),[[za,M.value]])]),default:m(()=>[r(zt,{style:ie(n(f).globalGlassMenuStyles),class:"py-0 min-w-[220px] rounded-lg border-[1px]"},{default:m(()=>[r($e,{class:"py-0",title:"Save visible Esri tiles",onClick:qt}),r(Xe),r($e,{class:"py-0",title:"Save visible OSM tiles",onClick:Yt}),r(Xe),r($e,{class:"py-0",title:"Save visible Seamarks tiles",onClick:Zt})]),_:1},8,["style"])]),_:1},8,["modelValue"]),r(xe,{location:"top",text:"Switch to Mission Planning mode"},{activator:m(({props:l})=>[M.value?(O(),q(N,pe({key:0},l,{class:"absolute right-[265px] w-[140px] mb-[14px] bottom-button bg-slate-50 text-[12px] font-bold",elevation:"4",text:"Edit mission","append-icon":"mdi-map-marker-radius-outline",style:[{"z-index":"1002","border-radius":"0px"},n(f).globalGlassMenuStyles],"hide-details":"",size:"small",onClick:t[1]||(t[1]=le(c=>n(G).push("/mission-planning"),["stop"]))}),null,16,["style"])):U("",!0)]),_:1}),r(xe,{location:"top",text:ca.value},{activator:m(({props:l})=>[M.value?(O(),q(N,pe({key:0,style:[n(f).globalGlassMenuStyles,S.value?{}:{color:"#FFFFFF33"}]},l,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",S.value?"":"active-events-on-disabled"],color:ve.value==n(_).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!S.value,onClick:t[2]||(t[2]=le(c=>n(P).goToTarget(n(_).HOME,!0),["stop"])),onDblclick:t[3]||(t[3]=le(c=>n(P).follow(n(_).HOME),["stop"]))}),null,16,["style","class","color","disabled"])):U("",!0)]),_:1},8,["text"]),r(xe,{location:"top",text:da.value},{activator:m(({props:l})=>[M.value?(O(),q(N,pe({key:0,style:[n(f).globalGlassMenuStyles,$.value?{}:{color:"#FFFFFF33"}]},l,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",$.value?"":"active-events-on-disabled"],color:ve.value==n(_).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!$.value,onClick:t[4]||(t[4]=le(c=>n(P).goToTarget(n(_).VEHICLE,!0),["stop"])),onDblclick:t[5]||(t[5]=le(c=>n(P).follow(n(_).VEHICLE),["stop"]))}),null,16,["style","class","color","disabled"])):U("",!0)]),_:1},8,["text"]),r(xe,{location:"top",text:ra.value},{activator:m(({props:l})=>[M.value?(O(),q(N,pe({key:0,style:[n(f).globalGlassMenuStyles,n(i).isVehicleOnline?{}:{color:"#FFFFFF33"}]},l,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",n(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!n(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:le(xt,["stop"])}),null,16,["style","class","disabled"])):U("",!0)]),_:1},8,["text"]),r(xe,{location:"top",text:ua.value},{activator:m(({props:l})=>[M.value?(O(),q(N,pe({key:0,style:[n(f).globalGlassMenuStyles,n(i).isVehicleOnline?{}:{color:"#FFFFFF33"}]},l,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",n(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!n(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:le(sa,["stop"])}),null,16,["style","class","disabled"])):U("",!0)]),_:1},8,["text"])],8,lo)],6)),[[o,ea]]),r(Ha,{ref_key:"contextMenuRef",ref:k,visible:j.value,width:"260px","menu-items":aa,onClose:Ee},null,8,["visible","menu-items"]),r(Ht,{modelValue:n(ye).widgetManagerVars(n(y).hash).configMenuOpen,"onUpdate:modelValue":t[8]||(t[8]=l=>n(ye).widgetManagerVars(n(y).hash).configMenuOpen=l),width:"auto"},{default:m(()=>[r(Gt,{class:"pa-2",style:ie(n(f).globalGlassMenuStyles)},{default:m(()=>[r(Rt,{class:"text-center"},{default:m(()=>t[11]||(t[11]=[W("Map widget settings")])),_:1,__:[11]}),r(Nt,null,{default:m(()=>[r(_t,{modelValue:n(y).options.showVehiclePath,"onUpdate:modelValue":t[6]||(t[6]=l=>n(y).options.showVehiclePath=l),class:"my-1",label:"Show vehicle path",color:n(y).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),r(_t,{modelValue:n(y).options.showCoordinateGrid,"onUpdate:modelValue":t[7]||(t[7]=l=>n(y).options.showCoordinateGrid=l),class:"my-1",label:"Show coordinate grid",color:n(y).options.showCoordinateGrid?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Ie.value?(O(),q(Ua,{key:0,"model-value":bt.value,height:"10",absolute:"",bottom:"",color:"white",style:ie(`top: ${kt.value}`)},null,8,["model-value","style"])):U("",!0),Ie.value?(O(),J("p",{key:1,style:ie({top:kt.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):U("",!0),r(Wa,{ref_key:"poiManagerMapWidgetRef",ref:ce},null,512),r(oo,{"model-value":F.value,onConfirmed:wt,"onUpdate:modelValue":t[9]||(t[9]=l=>F.value=l)},null,8,["model-value"]),r(Ka,{modelValue:qe.value,"onUpdate:modelValue":t[10]||(t[10]=l=>qe.value=l),vehicle:n(i).mainVehicle,"initial-latitude":ft.value,"initial-longitude":gt.value,onOriginSet:ia},null,8,["modelValue","vehicle","initial-latitude","initial-longitude"]),re.value?(O(),J("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:ie(n(f).globalGlassMenuStyles)},[D("p",null,[t[12]||(t[12]=W(" Saving offline map content ")),ke.value?(O(),J("span",io,"("+Je(ke.value)+")",1)):U("",!0),W(":  "+Je(ee.value?Math.round(fe.value/ee.value*100):0)+"% ",1)])],4)):U("",!0)],64)}}}),ro=Ut(so,[["__scopeId","data-v-dcd763ff"]]);export{ro as default};
