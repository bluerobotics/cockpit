import{bO as M,bL as A,b1 as q,b2 as X,bi as Z,b4 as ee,k as P,bP as te,c as he,y as Ve,J as ke,r as U,L as ye,o as we,bQ as xe,bR as Se,h as Ce,bS as Le,av as Ne,w as N,aC as Pe,aG as Me,aI as Te,aF as Ie,l as E,m as O,q as o,n as c,H as u,N as f,ah as je,S as G,aR as W,a2 as z,O as H,aJ as J,U as B,a5 as $e,Q as Ue,a6 as Ee,F as Oe,ax as K,_ as Be}from"./index-7JEsIEbG.js";const ae=M.reduce((t,r)=>(t[r]={type:[Boolean,String,Number],default:!1},t),{}),le=M.reduce((t,r)=>{const i="offset"+A(r);return t[i]={type:[String,Number],default:null},t},{}),ne=M.reduce((t,r)=>{const i="order"+A(r);return t[i]={type:[String,Number],default:null},t},{}),Y={col:Object.keys(ae),offset:Object.keys(le),order:Object.keys(ne)};function De(t,r,i){let e=t;if(!(i==null||i===!1)){if(r){const s=r.replace(t,"");e+=`-${s}`}return t==="col"&&(e="v-"+e),t==="col"&&(i===""||i===!0)||(e+=`-${i}`),e.toLowerCase()}}const Re=["auto","start","end","center","baseline","stretch"],Ae=q({cols:{type:[Boolean,String,Number],default:!1},...ae,offset:{type:[String,Number],default:null},...le,order:{type:[String,Number],default:null},...ne,alignSelf:{type:String,default:null,validator:t=>Re.includes(t)},...X(),...Z()},"VCol"),D=ee()({name:"VCol",props:Ae(),setup(t,r){let{slots:i}=r;const e=P(()=>{const s=[];let m;for(m in Y)Y[m].forEach(b=>{const g=t[b],V=De(m,b,g);V&&s.push(V)});const p=s.some(b=>b.startsWith("v-col-"));return s.push({"v-col":!p||!t.cols,[`v-col-${t.cols}`]:t.cols,[`offset-${t.offset}`]:t.offset,[`order-${t.order}`]:t.order,[`align-self-${t.alignSelf}`]:t.alignSelf}),s});return()=>{var s;return te(t.tag,{class:[e.value,t.class],style:t.style},(s=i.default)==null?void 0:s.call(i))}}}),F=["start","end","center"],oe=["space-between","space-around","space-evenly"];function _(t,r){return M.reduce((i,e)=>{const s=t+A(e);return i[s]=r(),i},{})}const Fe=[...F,"baseline","stretch"],se=t=>Fe.includes(t),ie=_("align",()=>({type:String,default:null,validator:se})),_e=[...F,...oe],re=t=>_e.includes(t),ue=_("justify",()=>({type:String,default:null,validator:re})),Ge=[...F,...oe,"stretch"],de=t=>Ge.includes(t),ce=_("alignContent",()=>({type:String,default:null,validator:de})),Q={align:Object.keys(ie),justify:Object.keys(ue),alignContent:Object.keys(ce)},We={align:"align",justify:"justify",alignContent:"align-content"};function ze(t,r,i){let e=We[t];if(i!=null){if(r){const s=r.replace(t,"");e+=`-${s}`}return e+=`-${i}`,e.toLowerCase()}}const He=q({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:se},...ie,justify:{type:String,default:null,validator:re},...ue,alignContent:{type:String,default:null,validator:de},...ce,...X(),...Z()},"VRow"),R=ee()({name:"VRow",props:He(),setup(t,r){let{slots:i}=r;const e=P(()=>{const s=[];let m;for(m in Q)Q[m].forEach(p=>{const b=t[p],g=ze(m,p,b);g&&s.push(g)});return s.push({"v-row--no-gutters":t.noGutters,"v-row--dense":t.dense,[`align-${t.align}`]:t.align,[`justify-${t.justify}`]:t.justify,[`align-content-${t.alignContent}`]:t.alignContent}),s});return()=>{var s;return te(t.tag,{class:["v-row",e.value,t.class],style:t.style},(s=i.default)==null?void 0:s.call(i))}}}),Je={key:0,class:"w-full h-full flex items-center justify-center text-center text-white text-h5 font-weight-bold p-4 overflow-hidden"},Ke={key:1,class:"main"},Ye=["width","height"],Qe={class:"ml-2"},qe={class:"ml-2 flex gap-x-8"},Xe={class:"ml-2 flex gap-x-8"},Ze={class:"flex w-full justify-end my-2"},et=he({__name:"Plotter",props:{widget:{}},setup(t){const r=Ve(),e=ke(t).widget,s=U([]);let m,p;ye(()=>{const n={backgroundColor:"rgba(0, 0, 0, 0.7)",lineColor:"rgba(255, 0, 0, 1.0)",dataLakeVariableId:void 0,maxSamples:1e3,limitSamples:!0,lineThickness:1,decimalPlaces:2,showTitle:!0};e.value.options={...n,...e.value.options}}),we(()=>{V(e.value.options.dataLakeVariableId),s.value=Object.values(xe()),p=Se(n=>{s.value=Object.values(n)})}),Ce(()=>{p&&Le(p),m&&K(e.value.options.dataLakeVariableId,m)});const b=P(()=>s.value.filter(n=>n.type==="number")),g=()=>{e.value.options.limitSamples&&(d.length===e.value.options.maxSamples+1?d.shift():d.length>e.value.options.maxSamples&&d.splice(0,d.length-e.value.options.maxSamples))},V=(n,a)=>{if(n===void 0){console.error("No data lake variable ID provided!");return}a!==void 0&&m&&K(a,m),m=Ne(n,l=>{d.push(l),g(),C()})};N([e.value.options.maxSamples,e.value.options.limitSamples],()=>{g(),C()}),N(()=>e.value.options.dataLakeVariableId,(n,a)=>{V(n,a),d.length=0});const{width:me,height:fe}=Pe(),k=P(()=>({width:e.value.size.width*me.value,height:e.value.size.height*fe.value})),y=U(),T=U(),S=(n,a,l,v)=>{const I=n.measureText(a),h=4;n.fillStyle="rgba(0, 0, 0, 0.5)",n.fillRect(l-h,v-16-h,I.width+h*2,16+h*2),n.fillStyle=e.value.options.lineColor,n.fillText(a,l,v)},C=()=>{if(y.value===void 0||y.value===null)return;if(T.value===void 0){console.debug("Canvas context undefined!"),T.value=y.value.getContext("2d");return}const n=T.value,a=k.value.width,l=k.value.height;Me(n),n.clearRect(0,0,a,l),n.fillStyle=e.value.options.backgroundColor,n.fillRect(0,0,a,l),n.strokeStyle=e.value.options.lineColor,n.lineWidth=Math.max(e.value.options.lineThickness,1);try{if(d.length===0)return;w=Math.max(...d),x=Math.min(...d);const v=.05*(w!=x?w-x:1),I=w+v,h=x-v,be=d[d.length-1];if(n.beginPath(),n.moveTo(0,l/2),d.forEach((L,$)=>{const ge=$*(a/d.length),ve=l-(L-h)/(I-h)*l;n.lineTo(ge,ve)}),n.stroke(),n.font="14px monospace",n.textBaseline="bottom",e.value.options.showTitle&&e.value.options.dataLakeVariableId){const L=s.value.find($=>$.id===e.value.options.dataLakeVariableId);L&&(n.textBaseline="top",S(n,L.name,10,10),n.textBaseline="bottom")}const j=e.value.options.decimalPlaces;S(n,`Current: ${Number(be).toFixed(j)}`,10,l-10),S(n,`Min: ${Number(x).toFixed(j)}`,10,l-30),S(n,`Max: ${Number(w).toFixed(j)}`,10,l-50)}catch(v){console.error("Error drawing graph:",v)}},d=[];let w=0,x=0;N([k,e.value.options],()=>{r.isWidgetVisible(e.value)&&Te(()=>C())});const pe=Ie(y);return N(pe,(n,a)=>{n&&!a&&C()}),(n,a)=>(E(),O(Oe,null,[o(e).options.dataLakeVariableId?(E(),O("div",Ke,[c("canvas",{ref_key:"canvasRef",ref:y,width:k.value.width,height:k.value.height},null,8,Ye)])):(E(),O("p",Je," Please open the Plotter widget configuration menu to select a variable to be plotted. ")),u(Ee,{modelValue:o(r).widgetManagerVars(o(e).hash).configMenuOpen,"onUpdate:modelValue":a[9]||(a[9]=l=>o(r).widgetManagerVars(o(e).hash).configMenuOpen=l),title:"Plotter config",variant:"text-only"},{content:f(()=>[u(R,null,{default:f(()=>[u(D,{cols:"12"},{default:f(()=>[a[10]||(a[10]=c("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Source",-1)),c("div",Qe,[u(je,{modelValue:o(e).options.dataLakeVariableId,"onUpdate:modelValue":a[0]||(a[0]=l=>o(e).options.dataLakeVariableId=l),items:b.value,"item-title":"name","item-value":"id",label:"Data Lake variable",hint:"Select a variable to be plotted","persistent-hint":"",variant:"outlined",density:"comfortable"},null,8,["modelValue","items"])])]),_:1})]),_:1}),u(R,null,{default:f(()=>[u(D,{cols:"12"},{default:f(()=>[a[13]||(a[13]=c("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Appearance",-1)),c("div",qe,[u(G,{modelValue:o(e).options.showTitle,"onUpdate:modelValue":a[1]||(a[1]=l=>o(e).options.showTitle=l),label:"Show title","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),u(W,{"close-on-content-click":!1},{activator:f(({props:l})=>[c("div",z(l,{class:"flex cursor-pointer"}),[a[11]||(a[11]=c("span",{class:"mt-3"},"Background color",-1)),c("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:H({backgroundColor:o(e).options.backgroundColor})},null,4)],16)]),default:f(()=>[u(J,{modelValue:o(e).options.backgroundColor,"onUpdate:modelValue":a[2]||(a[2]=l=>o(e).options.backgroundColor=l),label:"Background","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),u(W,{"close-on-content-click":!1},{activator:f(({props:l})=>[c("div",z(l,{class:"flex cursor-pointer"}),[a[12]||(a[12]=c("span",{class:"mt-3"},"Line color",-1)),c("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:H({backgroundColor:o(e).options.lineColor})},null,4)],16)]),default:f(()=>[u(J,{modelValue:o(e).options.lineColor,"onUpdate:modelValue":a[3]||(a[3]=l=>o(e).options.lineColor=l),label:"Line","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),u(B,{modelValue:o(e).options.lineThickness,"onUpdate:modelValue":a[4]||(a[4]=l=>o(e).options.lineThickness=l),modelModifiers:{number:!0},type:"number",label:"Line thickness",variant:"outlined",density:"compact",rules:[l=>l>0||"Must be greater than 0"],width:"140px","hide-details":""},null,8,["modelValue","rules"])])]),_:1})]),_:1}),u(R,null,{default:f(()=>[u(D,{cols:"12"},{default:f(()=>[a[14]||(a[14]=c("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Points",-1)),c("div",Xe,[u(B,{modelValue:o(e).options.decimalPlaces,"onUpdate:modelValue":a[5]||(a[5]=l=>o(e).options.decimalPlaces=l),modelModifiers:{number:!0},type:"number",label:"Decimal places",variant:"outlined",density:"comfortable",rules:[l=>l>=0||"Must be 0 or greater"],hint:"Number of decimal places to be displayed",width:"160px",class:"ml-2"},null,8,["modelValue","rules"]),u(G,{modelValue:o(e).options.limitSamples,"onUpdate:modelValue":a[6]||(a[6]=l=>o(e).options.limitSamples=l),label:"Limit number of samples"},null,8,["modelValue"]),u(B,{modelValue:o(e).options.maxSamples,"onUpdate:modelValue":a[7]||(a[7]=l=>o(e).options.maxSamples=l),modelModifiers:{number:!0},type:"number",label:"Maximum samples",variant:"outlined",density:"comfortable",disabled:!o(e).options.limitSamples,rules:[l=>l>0||"Must be greater than 0"],hint:"Higher values will show more history but may impact performance",width:"220px"},null,8,["modelValue","disabled","rules"])])]),_:1})]),_:1})]),actions:f(()=>[c("div",Ze,[u($e,{onClick:a[8]||(a[8]=l=>o(r).widgetManagerVars(o(e).hash).configMenuOpen=!1)},{default:f(()=>a[15]||(a[15]=[Ue("Close")])),_:1})])]),_:1},8,["modelValue"])],64))}}),at=Be(et,[["__scopeId","data-v-1a4b29b9"]]);export{at as default};
