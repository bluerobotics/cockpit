import{c as Ze,bP as wt,K as la,bQ as ia,r as d,w,h as A,s as W,n as V,E as v,p as $,q as n,Z as Oe,J as sa,Q as Lt,ar as Ot,ay as na,aY as Ie,o as Et,az as G,U as It,x as ve,z as r,W as At,V as B,aa as kt,G as N,X as $t,aA as _t,m as j,F as Pt,C as ra,aB as Ee,bM as ua,a_ as da,y as Ne,B as We,Y as Ct,v as U,aQ as ca,an as Ye,bH as va,$ as Dt,_ as Ft,bD as ma,t as pa,ag as fa,u as ga,bR as ha,bS as R,l as ba,S as Mt,a1 as Tt,R as ya,bT as xa,bU as Le,bV as c,bW as wa,bX as I,am as ka,aU as Ca,bY as Ma,bZ as Ta,b_ as te,b$ as Va,c0 as Sa,c1 as La,a4 as Oa,e as Ea,bj as Ia,P as Vt,a9 as ce,a$ as Aa,ab as $a,aG as ae,a8 as he,c2 as _a,H as St,c3 as Pa,c4 as Da}from"./index-DXIMP-zM.js";const Fa=""+new URL("arducopter-top-view-DWT9mmA0.png",import.meta.url).href,za={class:"flex items-center gap-2 mb-6"},Ba={class:"flex items-center gap-2 mb-6"},Ha={class:"flex items-center gap-2 mb-2"},Ga=Ze({__name:"GlobalOriginDialog",props:wt({vehicle:{},initialLatitude:{},initialLongitude:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:wt(["origin-set"],["update:modelValue"]),setup(oe,{emit:le}){const{openSnackbar:g}=la(),M=ia(oe,"modelValue"),K=le,T=oe,i=d(T.initialLatitude),u=d(T.initialLongitude),F=d(0),a=d(!1);w(()=>[T.initialLatitude,T.initialLongitude],([k,y])=>{i.value=k,u.value=y});const O=A(()=>i.value!==null&&i.value!==void 0&&i.value>=-90&&i.value<=90&&u.value!==null&&u.value!==void 0&&u.value>=-180&&u.value<=180&&F.value!==null&&F.value!==void 0),S=()=>{M.value=!1},L=()=>{if(!(!O.value||a.value)){if(T.vehicle===void 0||T.vehicle.dateLastHeartbeat()===void 0||T.vehicle.dateLastHeartbeat()>new Date(Date.now()-5e3)){g({message:"Cannot set global origin. Vehicle does not appear to be online.",variant:"error"});return}a.value=!0;try{T.vehicle.setGlobalOrigin([i.value,u.value],F.value),g({message:"Global origin set successfully.",variant:"success"}),K("origin-set",i.value,u.value),S()}catch(k){g({message:`Failed to set global origin: ${k}`,variant:"error"})}finally{a.value=!1}}},Q=A(()=>[{text:"Cancel",action:S,disabled:a.value},{text:a.value?"Saving...":"Save",disabled:!O.value||a.value,action:L,class:a.value?"opacity-70":""}]);return(k,y)=>(V(),W(sa,{"show-dialog":M.value,title:"Set Global Origin",variant:"text-only","max-width":"500px",actions:Q.value,"onUpdate:showDialog":y[3]||(y[3]=m=>M.value=m)},{content:v(()=>[y[7]||(y[7]=$("p",{class:"text-sm mb-8 -mt-6 text-gray-300"}," This feature allows you to set the GNSS coordinates of the vehicle's local origin (0,0,0). This is useful when using local position units (such as indoor positioning systems or DVLs) where you want to define a corresponding global position. ",-1)),$("div",za,[n(Oe,{modelValue:i.value,"onUpdate:modelValue":y[0]||(y[0]=m=>i.value=m),modelModifiers:{number:!0},label:"Latitude",type:"number",step:"0.000001",hint:"Latitude in degrees (-90 to 90)","persistent-hint":"",variant:"outlined",rules:[m=>m!=null||"Latitude is required",m=>m>=-90&&m<=90||"Latitude must be between -90 and 90"],class:"flex-1"},null,8,["modelValue","rules"]),y[4]||(y[4]=$("span",{class:"text-white text-lg font-medium mb-6 w-4"},"°",-1))]),$("div",Ba,[n(Oe,{modelValue:u.value,"onUpdate:modelValue":y[1]||(y[1]=m=>u.value=m),modelModifiers:{number:!0},label:"Longitude",type:"number",step:"0.000001",hint:"Longitude in degrees (-180 to 180)","persistent-hint":"",variant:"outlined",rules:[m=>m!=null||"Longitude is required",m=>m>=-180&&m<=180||"Longitude must be between -180 and 180"],class:"flex-1"},null,8,["modelValue","rules"]),y[5]||(y[5]=$("span",{class:"text-white text-lg font-medium mb-6 w-4"},"°",-1))]),$("div",Ha,[n(Oe,{modelValue:F.value,"onUpdate:modelValue":y[2]||(y[2]=m=>F.value=m),modelModifiers:{number:!0},label:"Altitude",type:"number",step:"0.1",hint:"Altitude in meters (MSL)","persistent-hint":"",variant:"outlined",rules:[m=>m!=null||"Altitude is required"],class:"flex-1"},null,8,["modelValue","rules"]),y[6]||(y[6]=$("span",{class:"text-white text-lg font-medium mb-6 w-4"},"m",-1))])]),_:1},8,["show-dialog","actions"]))}}),Ra={class:"flex justify-end"},Ua={key:0,class:"fixed top-[80px] right-5"},Na={key:1,class:"flex w-full items-center"},Wa={class:"flex justify-between w-full py-1 px-2 pt-3"},Ya={class:"flex items-center"},Za=Ze({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(oe,{emit:le}){const g=Lt(),M=Ot(),K=oe,T=le,i=na("cockpit-pre-arm-checklist",[]),u=d({}),F=d(""),a=d(null),O=d(!1),S=A(()=>K.modelValue),L=()=>{const x={};for(const l of i.value??[])x[l.id]=!1;u.value=x},Q=A(()=>{if(!M.showChecklistBeforeArm)return!0;const x=i.value??[];return x.length>0&&x.every(l=>u.value[l.id]===!0)});w(()=>S.value,x=>{x?(L(),Ie(()=>{var l,p;return(p=(l=a.value)==null?void 0:l.focus)==null?void 0:p.call(l)})):(u.value={},O.value=!1)}),w(()=>i.value,x=>{if(!S.value)return;const l={...u.value},p={};for(const E of x??[])p[E.id]=!0,E.id in l||(l[E.id]=!1);for(const E of Object.keys(l)){const q=Number(E);p[q]||delete l[q]}u.value=l},{deep:!0});const k=async()=>{var p,E;const x=F.value.trim();if(!x)return;const l={id:Date.now(),text:x};i.value.push(l),S.value&&(u.value[l.id]=!1),F.value="",await Ie(),(E=(p=a.value)==null?void 0:p.focus)==null||E.call(p)},y=x=>{if(i.value=i.value.filter(l=>l.id!==x),x in u.value){const l={...u.value};delete l[x],u.value=l}},m=()=>{T("dismissed"),T("update:modelValue",!1)},be=()=>{T("confirmed",!0),T("update:modelValue",!1)};return Et(()=>{i.value.length===0&&(i.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),S.value&&L()}),w(()=>M.showChecklistBeforeArm,x=>{x||G({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(x,l)=>(V(),W(Dt,{modelValue:S.value,"onUpdate:modelValue":l[4]||(l[4]=p=>S.value=p),"max-width":"600",scrollable:"",persistent:""},{default:v(()=>[n(It,{style:ve(r(g).globalGlassMenuStyles),class:"rounded-lg"},{default:v(()=>[n(At,{class:"text-center relative pt-3"},{default:v(()=>[l[6]||(l[6]=$("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),n(B,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:m},{default:v(()=>[n(kt,null,{default:v(()=>l[5]||(l[5]=[N("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),n($t,{class:"mt-[-10px]"},{default:v(()=>[n(_t,{lines:"one",theme:"dark",class:"bg-transparent"},{default:v(()=>[(V(!0),j(Pt,null,ra(r(i),p=>(V(),W(Ee,{key:p.id,theme:"dark"},ua({prepend:v(()=>[n(Ct,{modelValue:u.value[p.id],"onUpdate:modelValue":E=>u.value[p.id]=E,class:"mt-0","hide-details":"",density:"compact",disabled:!r(M).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:v(()=>[n(da,{class:Ne([{"line-through opacity-60":u.value[p.id]},{"opacity-50":!r(M).showChecklistBeforeArm}])},{default:v(()=>[N(We(p.text),1)]),_:2},1032,["class"])]),_:2},[O.value&&r(i).length>1?{name:"append",fn:v(()=>[n(B,{icon:"",variant:"text",disabled:!r(M).showChecklistBeforeArm,onClick:E=>y(p.id)},{default:v(()=>[n(kt,null,{default:v(()=>l[7]||(l[7]=[N("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),$("div",Ra,[O.value?(V(),j("div",Na,[O.value?(V(),W(Oe,{key:0,ref_key:"newItemInput",ref:a,modelValue:F.value,"onUpdate:modelValue":l[1]||(l[1]=p=>F.value=p),disabled:!r(M).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:ca(k,["enter"]),"onClick:appendInner":k},null,8,["modelValue","disabled"])):U("",!0),n(B,{"prepend-icon":"mdi-check",disabled:!r(M).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:l[2]||(l[2]=()=>{O.value=!1,k()})},{default:v(()=>l[9]||(l[9]=[N("Done")])),_:1,__:[9]},8,["disabled"])])):(V(),j("div",Ua,[n(B,{"prepend-icon":"mdi-format-list-checks",disabled:!r(M).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:l[0]||(l[0]=p=>O.value=!0)},{default:v(()=>l[8]||(l[8]=[N(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),n(Ye,{class:"flex center w-[80%]",inset:""}),n(va,null,{default:v(()=>[$("div",Wa,[n(B,{variant:"text",onClick:m},{default:v(()=>l[10]||(l[10]=[N("Cancel")])),_:1,__:[10]}),$("div",Ya,[n(Ct,{"model-value":!r(M).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":l[3]||(l[3]=p=>r(M).showChecklistBeforeArm=!p)},null,8,["model-value"]),l[11]||(l[11]=$("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),n(B,{color:"#ffffff33",class:Ne({"opacity-30":!Q.value}),variant:"flat",disabled:!Q.value,onClick:be},{default:v(()=>l[12]||(l[12]=[N("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),qa=Ft(Za,[["__scopeId","data-v-b0b8e43a"]]),ja=["id"],Ka={key:0},Qa=Ze({__name:"Map",props:{widget:{}},setup(oe){var bt;ma(e=>({"3ca9444f":Xt.value}));const le=oe,g=pa(le).widget,M=Lt(),{showDialog:K,closeDialog:T}=fa(),i=ga(),u=Ot(),F=ha(),a=R(),O=d(u.defaultMapZoom),S=d(u.defaultMapCenter),L=d(),Q=A(()=>`map-${g.value.hash}`),k=A(()=>$e.value||ie.value),y=d(!1),m=d([]),be=d(),x=d(!1),l=d(!1),p=d(!1),E=d(!1),q=d(0),X=d(0),ye=d("");let xe,we,ke;const ie=d(!1),zt=()=>{xe==null||xe.click(),ie.value=!1},Bt=()=>{we==null||we.click(),ie.value=!1},Ht=()=>{ke==null||ke.click(),ie.value=!1};let qe;const je=e=>{e.touches.length>1&&(l.value=!0,Z.value&&Ve(),clearTimeout(qe))},Ke=e=>{e.touches.length<=1&&(qe=window.setTimeout(()=>l.value=!1,300))},se=d(null),H=R({});Mt.registerUsage(Tt.latitude),Mt.registerUsage(Tt.longitude),ya(()=>{Object.keys(g.value.options).length===0&&(g.value.options={showVehiclePath:!0,showCoordinateGrid:!1}),g.value.options.showCoordinateGrid===void 0&&(g.value.options.showCoordinateGrid=!1),_.enableAutoUpdate()});const Ae=Le.tileLayerOffline("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),Ce=Le.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),Me=Le.tileLayerOffline("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),Qe=c.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),Xe={OpenStreetMap:Ae,"Esri World Imagery":Ce},Gt={Seamarks:Me,"Marine Profile":Qe},ne=d(),$e=ba(ne),Je=c.control.zoom({position:"bottomright"}),et=c.control.layers(Xe,Gt),me=R(void 0);w(k,()=>{a.value!==void 0&&(k.value?(a.value.addControl(Je),a.value.addControl(et),at()):(a.value.removeControl(Je),a.value.removeControl(et),ot()))}),w($e,()=>{k.value=$e.value}),w(()=>g.value.options.showCoordinateGrid,e=>{a.value!==void 0&&(e?_e():Rt())}),w([O,S],()=>{g.value.options.showCoordinateGrid&&a.value&&_e(),k.value&&a.value&&at()});const _e=()=>{if(a.value)try{me.value=wa(a.value,me.value)}catch(e){console.error("Failed to create grid overlay:",e)}},Rt=()=>{me.value&&a.value&&(a.value.removeLayer(me.value),me.value=void 0)},tt=c.control.scale({position:"bottomright",metric:!0,imperial:!1,maxWidth:100}),at=()=>{a.value&&(ot(),tt.addTo(a.value))},ot=()=>{if(a.value)try{a.value.removeControl(tt)}catch{}};Et(async()=>{var yt,xt;(yt=ne.value)==null||yt.addEventListener("touchstart",je,{passive:!0}),(xt=ne.value)==null||xt.addEventListener("touchend",Ke,{passive:!0});const e=Xe[u.userLastMapTileProvider]||Ce;a.value=c.map(Q.value,{layers:[e,Me,Qe],attributionControl:!1}).setView(S.value,O.value),a.value.on("baselayerchange",b=>{const D=b.name;D.includes(D)&&(u.userLastMapTileProvider=b.name)}),a.value.removeControl(a.value.zoomControl),a.value.on("click",b=>{C.value=[b.latlng.lat,b.latlng.lng]}),a.value.on("moveend",()=>{if(a.value===void 0)return;let{lat:b,lng:D}=a.value.getCenter();b&&D&&(S.value=[b,D])});const t=Pe(Ce,"Esri",19),o=Pe(Ae,"OSM",19),s=Pe(Me,"Seamarks",18);a.value&&(t.addTo(a.value),o.addTo(a.value),s.addTo(a.value));const h=b=>{var ge;const D=((ge=b.getContainer)==null?void 0:ge.call(b))??b._container;D&&(D.classList.add("hidden-savetiles"),D.style.display="none")};h(t),h(o),h(s),await Ie();const f=b=>{var ge;const D=((ge=b.getContainer)==null?void 0:ge.call(b))??b._container;return Array.from((D==null?void 0:D.querySelectorAll("a"))??[])},[z]=f(t),[ee]=f(o),[de]=f(s);xe=z,we=ee,ke=de,De(Ce,"Esri"),De(Ae,"OSM"),De(Me,"Seamarks"),a.value.on("dragstart",()=>{x.value=!0}),a.value.on("dragend",()=>{setTimeout(()=>x.value=!1,200)}),a.value.on("zoomend",()=>{var b;Z.value=!1,a.value!==void 0&&(O.value=((b=a.value)==null?void 0:b.getZoom())??S.value)}),a.value.on("contextmenu",b=>{C.value=[b.latlng.lat,b.latlng.lng]}),_.enableAutoUpdate(),window.addEventListener("keydown",dt),P.value?_.goToTarget(I.VEHICLE):_.goToTarget(I.HOME),!i.isVehicleOnline&&u.vehicleMission.length&&Re(u.vehicleMission),g.value.options.showCoordinateGrid&&_e(),y.value=!0,await Fe()});const Ut=e=>(t,o)=>{K({variant:"info",message:`Save ${t._tilesforSave.length} ${e} tiles for offline use?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:T},{text:"Save tiles",color:"white",action:()=>{o(),T()}}]})},Nt=e=>(t,o)=>{K({variant:"warning",message:`Remove all saved ${e} tiles for this layer?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:T},{text:"Remove tiles",color:"white",action:()=>{o(),T(),G({message:`${e} offline tiles removed`,variant:"info",duration:3e3})}}]})},Pe=(e,t,o)=>Le.savetiles(e,{saveWhatYouSee:!0,maxZoom:o,alwaysDownload:!1,position:"topright",parallel:20,confirm:Ut(t),confirmRemoval:Nt(t),saveText:`<i class="mdi mdi-download" title="Save ${t} tiles"></i>`,rmText:`<i class="mdi mdi-trash-can" title="Remove ${t} tiles"></i>`}),De=(e,t)=>{e.on("savestart",o=>{var s;q.value=0,X.value=((s=o==null?void 0:o._tilesforSave)==null?void 0:s.length)??0,ye.value=t,E.value=!0,G({message:`Saving ${X.value} ${t} tiles...`,variant:"info",duration:2e3})}),e.on("loadtileend",()=>{q.value+=1,X.value>0&&q.value>=X.value&&(G({message:`${t} offline tiles saved!`,variant:"success",duration:3e3}),E.value=!1,ye.value="",q.value=0,X.value=0)})},Wt={open:e=>{if(!a.value||l.value||x.value)return;e.preventDefault(),e.stopPropagation();const t=a.value.mouseEventToContainerPoint(e),o=a.value.containerPointToLatLng(t);C.value=[o.lat,o.lng],be.value.openAt(e),Z.value=!0},close:()=>{Ve()}},lt=()=>{var e;(e=a.value)==null||e.eachLayer(t=>{(t instanceof c.Marker||t instanceof c.Polyline&&t.options.color==="#358AC3")&&a.value.removeLayer(t)}),m.value=[],Te.value=void 0,J.value=void 0,ue.value=void 0,Y.value=void 0},Fe=async()=>{y.value&&(lt(),i.isVehicleOnline?await vt():u.vehicleMission.length&&Re(u.vehicleMission))};w(()=>i.isVehicleOnline,()=>{Fe()}),w(()=>u.vehicleMissionRevision,()=>{Fe()}),ka(()=>{var e,t;_.disableAutoUpdate(),window.removeEventListener("keydown",dt),a.value&&(a.value.off("contextmenu"),Object.values(H.value).forEach(o=>o.remove()),H.value={}),(e=ne.value)==null||e.removeEventListener("touchstart",je),(t=ne.value)==null||t.removeEventListener("touchend",Ke)}),w(S,(e,t)=>{var o;e.toString()!==t.toString()&&((o=a.value)==null||o.panTo(e))}),w(a,(e,t)=>{a.value!==void 0&&(e==null?void 0:e.options)===void 0&&(a.value=t)}),w(O,(e,t)=>{var o;e!==t&&(Z.value=!1,(o=a.value)==null||o.setZoom(O.value))}),w(le.widget,()=>{var e;(e=a.value)==null||e.invalidateSize()});const re=d(void 0),_=new xa(e=>re.value=e,e=>S.value=e);_.setTrackableTarget(I.VEHICLE,()=>P.value),_.setTrackableTarget(I.HOME,()=>L.value);const P=A(()=>i.coordinates.latitude?[i.coordinates.latitude,i.coordinates.longitude]:void 0),ze=A(()=>{var e;return i.attitude.yaw?Ca((e=i.attitude)==null?void 0:e.yaw):0}),it=A(()=>{const e=i.lastHeartbeat;return e?`${Ma(e??0,{includeSeconds:!0})} ago`:"never"}),{history:Yt}=Ta(P);(bt=navigator==null?void 0:navigator.geolocation)==null||bt.watchPosition(e=>{L.value||(L.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let st=!0;w([L,a],async()=>{L.value===S.value||!a.value||!st||(_.goToTarget(I.HOME),st=!1)});const Y=R();w(i.coordinates,()=>{if(!(!a.value||!P.value)){if(Y.value===void 0){let e=Va;i.vehicleType===te.MAV_TYPE_SURFACE_BOAT?e=Sa:i.vehicleType===te.MAV_TYPE_SUBMARINE?e=La:[te.MAV_TYPE_QUADROTOR,te.MAV_TYPE_HEXAROTOR,te.MAV_TYPE_OCTOROTOR,te.MAV_TYPE_TRICOPTER,te.MAV_TYPE_DODECAROTOR].includes(i.vehicleType)&&(e=Fa);const t=c.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});Y.value=c.marker(P.value,{icon:t});const o=c.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});Y.value.bindTooltip(o),a.value.addLayer(Y.value)}Y.value.setLatLng(P.value)}}),w(P,(e,t)=>{re.value===I.VEHICLE||t!==void 0||_.follow(I.VEHICLE)}),w([P,ze,it,()=>i.isArmed],()=>{var t,o,s,h,f;if(Y.value===void 0)return;(h=Y.value.getTooltip())==null||h.setContent(`
    <p>Coordinates: ${(t=P.value)==null?void 0:t[0].toFixed(6)}, ${(o=P.value)==null?void 0:o[1].toFixed(6)}</p>
    <p>Velocity: ${((s=i.velocity.ground)==null?void 0:s.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${ze.value.toFixed(2)}°</p>
    <p>${i.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${it.value}</p>
  `);const e=(f=Y.value.getElement())==null?void 0:f.querySelector("img");e&&(e.style.transform=`rotate(${ze.value}deg)`)});const J=R();w(L,()=>{if(a.value===void 0)return;const e=L.value;if(e!==void 0)if(J.value)J.value.setLatLng(e);else{J.value=c.marker(e,{icon:c.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=c.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});J.value.bindTooltip(t),J.value.on("dragend",o=>{const h=o.target.getLatLng();Ue([h.lat,h.lng])}),a.value.addLayer(J.value)}});const Te=R();w(m,e=>{a.value&&(Te.value||(Te.value=c.polyline([],{color:"#358AC3"}).addTo(a.value)),Te.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,o)=>{var f;const s=c.marker(t.coordinates);s.setIcon(c.divIcon({className:"marker-icon",iconSize:[16,16],iconAnchor:[8,8]}));const h=c.tooltip({content:o.toString(),permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});s.bindTooltip(h),(f=a.value)==null||f.addLayer(s)}))},{deep:!0});const Be=R();w(Yt,e=>{if(a.value===void 0||e===void 0)return;Be.value===void 0&&(Be.value=c.polyline([],{color:"#ffff00"}).addTo(a.value));const t=e.filter(o=>o.snapshot!==void 0).map(o=>o.snapshot);Be.value.setLatLngs(t)});const Z=d(!1),C=d(null),nt=R(),He=d(!1),rt=d(0),ut=d(0),Ge=R(),Zt=Oa([{item:"Set home waypoint",action:()=>pe("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Set Global Origin",action:()=>pe("set-global-origin"),icon:"mdi-crosshairs-question"},{item:"Place Point of Interest",action:()=>pe("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>pe("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>pe("set-default-map-position"),icon:"mdi-map-check"}]),ue=R(),qt=async()=>{var e;if(!(!a.value||!C.value))try{await u.setDefaultMapPosition(C.value,O.value),G({message:"Default map position set",variant:"success"});const t=c.marker(C.value,{icon:c.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value),o=c.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(o).openTooltip();const s=t.getElement(),h=(e=t.getTooltip())==null?void 0:e.getElement();[s,h].forEach(f=>{f&&(f.style.transition="opacity 1s",f.style.opacity="1")}),setTimeout(()=>{[s,h].forEach(f=>{f&&(f.style.opacity="0")}),setTimeout(()=>{var f;(f=a.value)==null||f.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),G({message:"Failed to set default map position",variant:"error"})}},jt=async()=>{if(!C.value||!a.value)return;ue.value&&(a.value.removeLayer(ue.value),ue.value=void 0),ue.value=c.marker(C.value,{icon:c.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value);const e=c.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(ue.value.bindTooltip(e),C.value){const f=i.coordinates.altitude??0,z=C.value[0],ee=C.value[1];try{await i.goTo(0,0,0,0,z,ee,f)}catch(de){G({message:`GoTo request failed: ${de.message}`,variant:"error"})}}},pe=async e=>{switch(e){case"goto":{jt();break}case"set-default-map-position":qt();break;case"place-poi":C.value&&se.value?se.value.openDialog(C.value):C.value?se.value||(G({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):(G({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":C.value&&Ue(C.value);break;case"set-global-origin":C.value&&(rt.value=C.value[0],ut.value=C.value[1],He.value=!0);break;default:console.warn("Unknown menu option selected:",e)}Z.value=!1},Ve=()=>{Z.value=!1,a.value!==void 0&&nt.value!==void 0&&a.value.removeLayer(nt.value)},Kt=(e,t)=>{if(!a.value)return;Ge.value&&a.value.removeLayer(Ge.value);const o=c.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),s=c.marker([e,t],{icon:o}).addTo(a.value),h=c.tooltip({content:'<i class="mdi mdi-axis-arrow text-[18px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});s.bindTooltip(h),Ge.value=s},dt=e=>{e.key==="Escape"&&Ve()},Re=e=>{e.forEach((t,o)=>{o===0?(L.value=t.coordinates,Ue(t.coordinates)):m.value.push(t)})},Se=d(!1),ct=d(0),vt=async()=>{Se.value=!0,lt();const e=async t=>{ct.value=t};try{const t=await i.fetchMission(e);Re(t),G({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){K({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{Se.value=!1}},Ue=async e=>{const t=[e[0],e[1]];L.value=t,await i.setHomeWaypoint(t,0),Z.value&&(Z.value=!1)},mt=async()=>{try{await i.startMission()}catch{G({message:"Failed to start mission.",variant:"error"})}},Qt=async()=>{if(u.showChecklistBeforeArm){p.value=!0;return}mt()},fe=Ea(),Xt=A(()=>`${Math.max(-fe.widgetClearanceForVisibleArea(g.value).bottom,0)}px`),pt=A(()=>`${Math.max(-fe.widgetClearanceForVisibleArea(g.value).top,0)}px`),Jt=A(()=>i.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),ea=A(()=>i.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),ta=A(()=>L.value===void 0?"Cannot center map on home (home position undefined).":re.value===I.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),aa=A(()=>i.isVehicleOnline?P.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":re.value===I.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),ft=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),gt=e=>{if(!a.value||!a.value.getContainer())return;const t=c.divIcon(ft(e)),o=c.marker(e.coordinates,{icon:t,draggable:!0}).addTo(a.value),s=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,h={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};o.bindTooltip(s,h),o.on("drag",f=>{var de;const z=f.target.getLatLng(),ee=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${z.lat.toFixed(8)}, Lng: ${z.lng.toFixed(8)}
    `;(de=o.getTooltip())==null||de.setContent(ee)}),o.on("dragend",f=>{const z=f.target.getLatLng();u.movePointOfInterest(e.id,[z.lat,z.lng])}),o.on("click",f=>{if(c.DomEvent.stopPropagation(f),se.value){const z=u.pointsOfInterest.find(ee=>ee.id===e.id);z?se.value.openDialog(void 0,z):console.warn("POI not found in store:",e.id)}}),H.value[e.id]=o},ht=e=>{var s;if(!a.value||!a.value.getContainer()||!H.value[e.id])return;const t=H.value[e.id];t.setLatLng(e.coordinates),t.setIcon(c.divIcon(ft(e)));const o=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(s=t.getTooltip())==null||s.setContent(o)},oa=e=>{!a.value||!H.value[e]||(H.value[e].remove(),delete H.value[e])};return w(()=>u.pointsOfInterest,async e=>{if((!a.value||!a.value.getContainer())&&(await Ie(),!a.value||!a.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(o=>o.id));Object.keys(H.value).forEach(o=>{t.has(o)||oa(o)}),e.forEach(o=>{H.value[o.id]?ht(o):gt(o)})},{deep:!0,immediate:!0}),w(a,e=>{e&&e.getContainer()&&u.pointsOfInterest.forEach(t=>{H.value[t.id]?ht(t):gt(t)})},{immediate:!0}),(e,t)=>{const o=Ia("contextmenu");return V(),j(Pt,null,[Vt((V(),j("div",{ref_key:"mapBase",ref:ne,class:Ne(["page-base",r(fe).editingMode?"pointer-events-none":"pointer-events-auto"])},[$("div",{id:Q.value,ref_key:"map",ref:a,class:"map"},[n($a,{modelValue:ie.value,"onUpdate:modelValue":t[0]||(t[0]=s=>ie.value=s),"close-on-content-click":!1,location:"top end"},{activator:v(({props:s})=>[Vt(n(B,ce(s,{class:"absolute right-[209px] m-3 bottom-button bg-slate-50 text-[14px]",elevation:"2",size:"x-small",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download-multiple"}),null,16),[[Aa,k.value]])]),default:v(()=>[n(_t,{style:ve(r(M).globalGlassMenuStyles),class:"py-0 min-w-[220px] rounded-lg border-[1px]"},{default:v(()=>[n(Ee,{class:"py-0",title:"Save visible Esri tiles",onClick:zt}),n(Ye),n(Ee,{class:"py-0",title:"Save visible OSM tiles",onClick:Bt}),n(Ye),n(Ee,{class:"py-0",title:"Save visible Seamarks tiles",onClick:Ht})]),_:1},8,["style"])]),_:1},8,["modelValue"]),n(he,{location:"top",text:"Switch to Mission Planning mode"},{activator:v(({props:s})=>[k.value?(V(),W(B,ce({key:0},s,{class:"absolute right-[265px] w-[140px] mb-[15px] bottom-button bg-slate-50 text-[12px] font-bold",elevation:"2",text:"Edit mission","append-icon":"mdi-map-marker-radius-outline",style:{"z-index":"1002","border-radius":"0px"},"hide-details":"",size:"small",onClick:t[1]||(t[1]=ae(h=>r(F).push("/mission-planning"),["stop"]))}),null,16)):U("",!0)]),_:1}),n(he,{location:"top",text:ta.value},{activator:v(({props:s})=>[k.value?(V(),W(B,ce({key:0},s,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",L.value?"":"active-events-on-disabled"],color:re.value==r(I).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!L.value,onClick:t[2]||(t[2]=ae(h=>r(_).goToTarget(r(I).HOME,!0),["stop"])),onDblclick:t[3]||(t[3]=ae(h=>r(_).follow(r(I).HOME),["stop"]))}),null,16,["class","color","disabled"])):U("",!0)]),_:1},8,["text"]),n(he,{location:"top",text:aa.value},{activator:v(({props:s})=>[k.value?(V(),W(B,ce({key:0},s,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",P.value?"":"active-events-on-disabled"],color:re.value==r(I).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!P.value,onClick:t[4]||(t[4]=ae(h=>r(_).goToTarget(r(I).VEHICLE,!0),["stop"])),onDblclick:t[5]||(t[5]=ae(h=>r(_).follow(r(I).VEHICLE),["stop"]))}),null,16,["class","color","disabled"])):U("",!0)]),_:1},8,["text"]),n(he,{location:"top",text:Jt.value},{activator:v(({props:s})=>[k.value?(V(),W(B,ce({key:0},s,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",r(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!r(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:ae(vt,["stop"])}),null,16,["class","disabled"])):U("",!0)]),_:1},8,["text"]),n(he,{location:"top",text:ea.value},{activator:v(({props:s})=>[k.value?(V(),W(B,ce({key:0},s,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",r(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!r(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:ae(Qt,["stop"])}),null,16,["class","disabled"])):U("",!0)]),_:1},8,["text"])],8,ja)],2)),[[o,Wt]]),n(_a,{ref_key:"contextMenuRef",ref:be,visible:Z.value,width:"260px","menu-items":Zt,onClose:Ve},null,8,["visible","menu-items"]),n(Dt,{modelValue:r(fe).widgetManagerVars(r(g).hash).configMenuOpen,"onUpdate:modelValue":t[8]||(t[8]=s=>r(fe).widgetManagerVars(r(g).hash).configMenuOpen=s),width:"auto"},{default:v(()=>[n(It,{class:"pa-2",style:ve(r(M).globalGlassMenuStyles)},{default:v(()=>[n(At,{class:"text-center"},{default:v(()=>t[11]||(t[11]=[N("Map widget settings")])),_:1,__:[11]}),n($t,null,{default:v(()=>[n(St,{modelValue:r(g).options.showVehiclePath,"onUpdate:modelValue":t[6]||(t[6]=s=>r(g).options.showVehiclePath=s),class:"my-1",label:"Show vehicle path",color:r(g).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),n(St,{modelValue:r(g).options.showCoordinateGrid,"onUpdate:modelValue":t[7]||(t[7]=s=>r(g).options.showCoordinateGrid=s),class:"my-1",label:"Show coordinate grid",color:r(g).options.showCoordinateGrid?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Se.value?(V(),W(Pa,{key:0,"model-value":ct.value,height:"10",absolute:"",bottom:"",color:"white",style:ve(`top: ${pt.value}`)},null,8,["model-value","style"])):U("",!0),Se.value?(V(),j("p",{key:1,style:ve({top:pt.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):U("",!0),n(Da,{ref_key:"poiManagerMapWidgetRef",ref:se},null,512),n(qa,{"model-value":p.value,onConfirmed:mt,"onUpdate:modelValue":t[9]||(t[9]=s=>p.value=s)},null,8,["model-value"]),n(Ga,{modelValue:He.value,"onUpdate:modelValue":t[10]||(t[10]=s=>He.value=s),vehicle:r(i).mainVehicle,"initial-latitude":rt.value,"initial-longitude":ut.value,onOriginSet:Kt},null,8,["modelValue","vehicle","initial-latitude","initial-longitude"]),E.value?(V(),j("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:ve(r(M).globalGlassMenuStyles)},[$("p",null,[t[12]||(t[12]=N(" Saving offline map content ")),ye.value?(V(),j("span",Ka,"("+We(ye.value)+")",1)):U("",!0),N(":  "+We(X.value?Math.round(q.value/X.value*100):0)+"% ",1)])],4)):U("",!0)],64)}}}),Ja=Ft(Qa,[["__scopeId","data-v-9bb365e4"]]);export{Ja as default};
