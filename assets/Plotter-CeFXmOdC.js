import{b8 as ee,b9 as te,k as S,c2 as ae,bq as le,bf as oe,c3 as T,b$ as R,c as we,y as Ce,J as xe,r as x,L as Se,o as Le,aL as Pe,aD as Ne,aK as Me,h as Te,c4 as Ie,w as N,a9 as De,aS as $e,aW as je,aY as Ue,aV as Ee,l as E,m as O,H as u,v as n,n as c,O as f,a7 as Oe,Q as Be,U as M,ao as Ae,S as H,a8 as K,aZ as Y,a5 as J,N as q,ae as Re,F as Fe,a1 as Q,_ as We}from"./index-Dk-z1IUT.js";const ne=T.reduce((l,r)=>(l[r]={type:[Boolean,String,Number],default:!1},l),{}),se=T.reduce((l,r)=>{const i="offset"+R(r);return l[i]={type:[String,Number],default:null},l},{}),ie=T.reduce((l,r)=>{const i="order"+R(r);return l[i]={type:[String,Number],default:null},l},{}),Z={col:Object.keys(ne),offset:Object.keys(se),order:Object.keys(ie)};function _e(l,r,i){let e=l;if(!(i==null||i===!1)){if(r){const s=r.replace(l,"");e+=`-${s}`}return l==="col"&&(e="v-"+e),l==="col"&&(i===""||i===!0)||(e+=`-${i}`),e.toLowerCase()}}const ze=["auto","start","end","center","baseline","stretch"],Ge=te({cols:{type:[Boolean,String,Number],default:!1},...ne,offset:{type:[String,Number],default:null},...se,order:{type:[String,Number],default:null},...ie,alignSelf:{type:String,default:null,validator:l=>ze.includes(l)},...oe(),...le()},"VCol"),B=ee()({name:"VCol",props:Ge(),setup(l,r){let{slots:i}=r;const e=S(()=>{const s=[];let m;for(m in Z)Z[m].forEach(v=>{const g=l[v],p=_e(m,v,g);p&&s.push(p)});const b=s.some(v=>v.startsWith("v-col-"));return s.push({"v-col":!b||!l.cols,[`v-col-${l.cols}`]:l.cols,[`offset-${l.offset}`]:l.offset,[`order-${l.order}`]:l.order,[`align-self-${l.alignSelf}`]:l.alignSelf}),s});return()=>{var s;return ae(l.tag,{class:[e.value,l.class],style:l.style},(s=i.default)==null?void 0:s.call(i))}}}),F=["start","end","center"],re=["space-between","space-around","space-evenly"];function W(l,r){return T.reduce((i,e)=>{const s=l+R(e);return i[s]=r(),i},{})}const He=[...F,"baseline","stretch"],ue=l=>He.includes(l),de=W("align",()=>({type:String,default:null,validator:ue})),Ke=[...F,...re],ce=l=>Ke.includes(l),me=W("justify",()=>({type:String,default:null,validator:ce})),Ye=[...F,...re,"stretch"],fe=l=>Ye.includes(l),pe=W("alignContent",()=>({type:String,default:null,validator:fe})),X={align:Object.keys(de),justify:Object.keys(me),alignContent:Object.keys(pe)},Je={align:"align",justify:"justify",alignContent:"align-content"};function qe(l,r,i){let e=Je[l];if(i!=null){if(r){const s=r.replace(l,"");e+=`-${s}`}return e+=`-${i}`,e.toLowerCase()}}const Qe=te({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:ue},...de,justify:{type:String,default:null,validator:ce},...me,alignContent:{type:String,default:null,validator:fe},...pe,...oe(),...le()},"VRow"),A=ee()({name:"VRow",props:Qe(),setup(l,r){let{slots:i}=r;const e=S(()=>{const s=[];let m;for(m in X)X[m].forEach(b=>{const v=l[b],g=qe(m,b,v);g&&s.push(g)});return s.push({"v-row--no-gutters":l.noGutters,"v-row--dense":l.dense,[`align-${l.align}`]:l.align,[`justify-${l.justify}`]:l.justify,[`align-content-${l.alignContent}`]:l.alignContent}),s});return()=>{var s;return ae(l.tag,{class:["v-row",e.value,l.class],style:l.style},(s=i.default)==null?void 0:s.call(i))}}}),Ze={key:0,class:"w-full h-full flex items-center justify-center text-center text-white text-h5 font-weight-bold p-4 overflow-hidden"},Xe={key:1,class:"main"},et=["width","height"],tt={class:"ml-2"},at={class:"ml-2 flex gap-x-8"},lt={class:"ml-2 flex gap-x-8"},ot={class:"flex w-full justify-end my-2"},nt=we({__name:"Plotter",props:{widget:{}},setup(l){const r=Ce(),e=xe(l).widget,s=x([]);let m,b;Se(()=>{const t={backgroundColor:"rgba(0, 0, 0, 0.7)",lineColor:"rgba(255, 0, 0, 1.0)",dataLakeVariableId:void 0,maxSamples:1e3,limitSamples:!0,lineThickness:1,decimalPlaces:2,showTitle:!0};e.value.options={...t,...e.value.options}}),Le(()=>{if(G(e.value.options.dataLakeVariableId),s.value=Object.values(Pe()),b=Ne(t=>{s.value=Object.values(t)}),d.length===0){const t=Me(e.value.options.dataLakeVariableId);t&&z(t)}}),Te(()=>{b&&Ie(b),m&&Q(e.value.options.dataLakeVariableId,m)});const v=S(()=>s.value.filter(t=>t.type==="number")),g=x(""),p=x(!1);N(()=>e.value.options.dataLakeVariableId,()=>p.value=!1);const be=S(()=>{const t=(g.value||"").toLowerCase();return v.value.filter(a=>a.name.toLowerCase().includes(t))}),_=()=>{e.value.options.limitSamples&&(d.length===e.value.options.maxSamples+1?d.shift():d.length>e.value.options.maxSamples&&d.splice(0,d.length-e.value.options.maxSamples))},z=t=>{d.push(t),_(),D()},G=(t,a)=>{if(t===void 0){console.error("No data lake variable ID provided!");return}a!==void 0&&m&&Q(a,m),m=De(t,o=>z(o))};N(()=>e.value.options.dataLakeVariableId,(t,a)=>{G(t,a),d.length=0});const{width:ve,height:ge}=$e(),k=S(()=>({width:e.value.size.width*ve.value,height:e.value.size.height*ge.value})),y=x(),I=x(),L=(t,a,o,h)=>{const $=t.measureText(a),V=4;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(o-V,h-16-V,$.width+V*2,16+V*2),t.fillStyle=e.value.options.lineColor,t.fillText(a,o,h)},D=()=>{if(y.value===void 0||y.value===null)return;if(I.value===void 0){console.debug("Canvas context undefined!"),I.value=y.value.getContext("2d");return}const t=I.value,a=k.value.width,o=k.value.height;je(t),t.clearRect(0,0,a,o),t.fillStyle=e.value.options.backgroundColor,t.fillRect(0,0,a,o),t.strokeStyle=e.value.options.lineColor,t.lineWidth=Math.max(e.value.options.lineThickness,1);try{w=Math.max(...d),C=Math.min(...d);const h=.05*(w!=C?w-C:1),$=w+h,V=C-h,Ve=d[d.length-1];if(t.beginPath(),t.moveTo(0,o/2),t.setLineDash([]),d.length===0?(t.beginPath(),t.arc(0,o/2,7,0,2*Math.PI),t.stroke()):d.length===1?(t.fillStyle=e.value.options.lineColor,t.beginPath(),t.arc(0,o/2,7,0,2*Math.PI),t.fill(),t.beginPath(),t.setLineDash([5,5]),t.moveTo(0,o/2),t.lineTo(50,o/2),t.stroke()):(t.setLineDash([]),d.forEach((P,U)=>{const ke=U*(a/d.length),ye=o-(P-V)/($-V)*o;t.lineTo(ke,ye)})),t.stroke(),t.font="14px monospace",t.textBaseline="bottom",e.value.options.showTitle&&e.value.options.dataLakeVariableId){const P=s.value.find(U=>U.id===e.value.options.dataLakeVariableId);P&&(L(t,P.name,10,26),t.textBaseline="bottom")}const j=e.value.options.decimalPlaces;L(t,`Current: ${Number(Ve).toFixed(j)}`,10,o-10),L(t,`Min: ${Number(C).toFixed(j)}`,10,o-30),L(t,`Max: ${Number(w).toFixed(j)}`,10,o-50)}catch(h){console.error("Error drawing graph:",h)}},d=[];let w=0,C=0;N([k,e],()=>{r.isWidgetVisible(e.value)&&(_(),Ue(()=>D()))},{deep:!0});const he=Ee(y);return N(he,(t,a)=>{t&&!a&&D()}),(t,a)=>(O(),E(Fe,null,[n(e).options.dataLakeVariableId?(O(),E("div",Xe,[c("canvas",{ref_key:"canvasRef",ref:y,width:k.value.width,height:k.value.height},null,8,et)])):(O(),E("p",Ze," Please open the Plotter widget configuration menu to select a variable to be plotted. ")),u(Re,{modelValue:n(r).widgetManagerVars(n(e).hash).configMenuOpen,"onUpdate:modelValue":a[14]||(a[14]=o=>n(r).widgetManagerVars(n(e).hash).configMenuOpen=o),title:"Plotter config",variant:"text-only"},{content:f(()=>[u(A,null,{default:f(()=>[u(B,{cols:"12"},{default:f(()=>[a[15]||(a[15]=c("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Source",-1)),c("div",tt,[u(M,{modelValue:g.value,"onUpdate:modelValue":[a[0]||(a[0]=o=>g.value=o),a[1]||(a[1]=o=>p.value=!0)],density:"compact",variant:"filled",theme:"dark",type:"text",placeholder:"Search variables...",class:"mb-4",clearable:"","onClick:clear":a[2]||(a[2]=o=>p.value=!1),"onUpdate:focused":a[3]||(a[3]=o=>p.value=o)},null,8,["modelValue"]),u(Ae,{modelValue:n(e).options.dataLakeVariableId,"onUpdate:modelValue":a[4]||(a[4]=o=>n(e).options.dataLakeVariableId=o),items:be.value,"item-title":"name","item-value":"id",label:"Data Lake variable",hint:"Select a variable to be plotted","persistent-hint":"",theme:"dark",variant:"outlined",density:"comfortable","menu-props":{modelValue:p.value},onClick:a[5]||(a[5]=o=>p.value=!p.value)},null,8,["modelValue","items","menu-props"])])]),_:1,__:[15]})]),_:1}),u(A,null,{default:f(()=>[u(B,{cols:"12"},{default:f(()=>[a[18]||(a[18]=c("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Appearance",-1)),c("div",at,[u(H,{modelValue:n(e).options.showTitle,"onUpdate:modelValue":a[6]||(a[6]=o=>n(e).options.showTitle=o),label:"Show title","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),u(K,{"close-on-content-click":!1},{activator:f(({props:o})=>[c("div",J(o,{class:"flex cursor-pointer"}),[a[16]||(a[16]=c("span",{class:"mt-3"},"Background color",-1)),c("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:q({backgroundColor:n(e).options.backgroundColor})},null,4)],16)]),default:f(()=>[u(Y,{modelValue:n(e).options.backgroundColor,"onUpdate:modelValue":a[7]||(a[7]=o=>n(e).options.backgroundColor=o),label:"Background","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),u(K,{"close-on-content-click":!1},{activator:f(({props:o})=>[c("div",J(o,{class:"flex cursor-pointer"}),[a[17]||(a[17]=c("span",{class:"mt-3"},"Line color",-1)),c("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:q({backgroundColor:n(e).options.lineColor})},null,4)],16)]),default:f(()=>[u(Y,{modelValue:n(e).options.lineColor,"onUpdate:modelValue":a[8]||(a[8]=o=>n(e).options.lineColor=o),label:"Line","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),u(M,{modelValue:n(e).options.lineThickness,"onUpdate:modelValue":a[9]||(a[9]=o=>n(e).options.lineThickness=o),modelModifiers:{number:!0},type:"number",label:"Line thickness",variant:"outlined",density:"compact",rules:[o=>o>0||"Must be greater than 0"],width:"140px","hide-details":""},null,8,["modelValue","rules"])])]),_:1,__:[18]})]),_:1}),u(A,null,{default:f(()=>[u(B,{cols:"12"},{default:f(()=>[a[19]||(a[19]=c("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Points",-1)),c("div",lt,[u(M,{modelValue:n(e).options.decimalPlaces,"onUpdate:modelValue":a[10]||(a[10]=o=>n(e).options.decimalPlaces=o),modelModifiers:{number:!0},type:"number",label:"Decimal places",variant:"outlined",density:"comfortable",rules:[o=>o>=0||"Must be 0 or greater"],hint:"Number of decimal places to be displayed",width:"160px",class:"ml-2"},null,8,["modelValue","rules"]),u(H,{modelValue:n(e).options.limitSamples,"onUpdate:modelValue":a[11]||(a[11]=o=>n(e).options.limitSamples=o),label:"Limit number of samples"},null,8,["modelValue"]),u(M,{modelValue:n(e).options.maxSamples,"onUpdate:modelValue":a[12]||(a[12]=o=>n(e).options.maxSamples=o),modelModifiers:{number:!0},type:"number",label:"Maximum samples",variant:"outlined",density:"comfortable",disabled:!n(e).options.limitSamples,rules:[o=>o>0||"Must be greater than 0"],hint:"Higher values will show more history but may impact performance",width:"220px"},null,8,["modelValue","disabled","rules"])])]),_:1,__:[19]})]),_:1})]),actions:f(()=>[c("div",ot,[u(Oe,{onClick:a[13]||(a[13]=o=>n(r).widgetManagerVars(n(e).hash).configMenuOpen=!1)},{default:f(()=>a[20]||(a[20]=[Be("Close")])),_:1,__:[20]})])]),_:1},8,["modelValue"])],64))}}),it=We(nt,[["__scopeId","data-v-7d1b75bc"]]);export{it as default};
