import{c as $,af as j,av as D,K as R,y as G,ag as K,J as H,aw as J,r as m,ax as Q,w as q,ay as F,L as X,o as Y,l as O,m as x,n,H as o,I as E,s as Z,O as i,az as _,N as C,v as l,aA as T,am as b,a6 as p,a5 as B,a8 as ee,x as k,a4 as te,ao as ae,S as se,U as oe,aB as le,a7 as ne,Q as ie,W as re,F as de}from"./index-Dk-z1IUT.js";const pe={class:"absolute top-0 right-0"},ue={class:"flex items-center justify-start w-[90%] -mt-3 mb-2"},me={class:"flex w-[90%] justify-end items-center mt-4 border-t-[1px] border-t-[#FFFFFF11]"},fe=$({__name:"SnapshotTool",props:{miniWidget:{}},setup(A){const{showDialog:W}=j(),V=D(),v=R(),f=G(),M=K(),s=H(A).miniWidget,g=J(),L=m(),w=m("mdi-video-image"),y=m("single"),c=m(!1),r=Q("cockpit-snapshot-timed-interval",5),d=m(!1),u=m(50),I=async()=>{const t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="black",t.style.opacity="0",t.style.transition="opacity 0.1s ease",t.style.zIndex="9999",document.body.appendChild(t),t.offsetWidth,t.style.opacity="0.4",await new Promise(e=>setTimeout(e,50)),t.style.opacity="0",await new Promise(e=>setTimeout(e,100)),document.body.removeChild(t)},N=async()=>{if(U()){c.value=!1;try{y.value!=="timed"&&(await V.takeSnapshot(s.value.options.nameSelectedStreams,s.value.options.captureWorkspace),I(),F({message:"Snapshot recorded successfully.",variant:"success",duration:2e3}))}catch{W({title:"Error taking snapshot",message:"Make sure the streams have finished loading.",variant:"error",persistent:!1,maxWidth:"550px"})}}},P=()=>{c.value=!1,v.videoLibraryMode="snapshots",v.videoLibraryVisibility=!0},z=t=>{t==="single"?(y.value="single",w.value="mdi-video-image"):t==="timed"&&(y.value="timed",w.value="mdi-timer-outline"),c.value=!1};let S=null,h=null;q(d,t=>{if(t){V.takeSnapshot(s.value.options.nameSelectedStreams,s.value.options.captureWorkspace),I(),F({message:`Timed snapshot started. This will capture the selected interfaces every ${r.value} seconds until you press the camera button again.`,variant:"info",duration:4e3}),h=setInterval(async()=>{await V.takeSnapshot(s.value.options.nameSelectedStreams,s.value.options.captureWorkspace),u.value=0},r.value*1e3);const e=50,a=100*e/(r.value*1e3);u.value=0,S=setInterval(()=>{u.value=Math.min(u.value+a,100)},e);return}F({message:"Timed snapshot stopped.",variant:"info",duration:2e3}),h&&(clearInterval(h),h=null),S&&(clearInterval(S),S=null),u.value=0});const U=()=>s.value.options.selectedStreams.every(t=>M.namesAvailableStreams.includes(t))?(s.value.options.nameSelectedStreams=s.value.options.selectedStreams,!0):(W({message:"Selected streams are not available anymore. Please check the currently available options.",variant:"warning"}),!1);return X(async()=>{Object.keys(s.value.options).length===0&&(s.value.options={selectedStreams:void 0,captureWorkspace:!1})}),Y(()=>{g||(s.value.options.captureWorkspace=!1)}),(t,e)=>(x(),O(de,null,[n("div",{ref_key:"recorderWidget",ref:L,class:k(["flex justify-around pl-1 pr-[3px] py-1 text-center text-white rounded-lg w-[70px] h-9 align-center bg-slate-800/60",{"pointer-events-none":l(f).editingMode}])},[o(ee,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=a=>c.value=a),offset:"4",transition:"fade-transition"},{activator:i(({props:a})=>[n("div",B(a,{class:"flex flex-col items-center justify-around pl-1 pr-2"}),[o(p,{icon:"mdi-menu-up",class:"text-[22px] -mr-3 -ml-2 -mb-1 opacity-80 cursor-pointer",size:"22"}),o(p,{icon:w.value,class:"text-[22px] -mr-3 -ml-2 mb-1 cursor-pointer opacity-60",size:"14"},null,8,["icon"])],16)]),default:i(()=>[o(_,{density:"compact",class:"pa-0 text-white rounded-md",style:C(l(v).globalGlassMenuStyles)},{default:i(()=>[o(T,{class:"bg-[#FFFFFF11] hover:bg-[#FFFFFF22] cursor-pointer text-sm",onClick:P},{title:i(()=>e[11]||(e[11]=[n("span",{class:"text-white text-[16px] font-bold"},"Open snapshot library",-1)])),_:1}),o(b),o(T,{title:"Single capture",onClick:e[0]||(e[0]=a=>z("single"))},{append:i(()=>[o(p,{size:"22",icon:"mdi-video-image"})]),_:1}),o(b),o(b),o(T,{title:"Timed multi-capture",onClick:e[1]||(e[1]=a=>z("timed"))},{append:i(()=>[o(p,{size:"20",icon:"mdi-timer-outline"})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),d.value?(x(),O("div",{key:1,class:"bottom-0 left-0 w-[2px] bg-red-500 opacity-40",style:C({height:`${u.value}%`}),color:"green",value:"90"},null,4)):(x(),E(b,{key:0,vertical:""})),o(p,{icon:"mdi-camera",class:"mb-[-2px]",size:"32",onClick:N}),y.value==="timed"?(x(),E(p,{key:2,icon:d.value?"mdi-stop":"mdi-play",class:k(["mb-[-2px] cursor-pointer mr-1 bg-[#FFFFFFff] rounded-full",{"text-red-500 -ml-[32px]":d.value,"text-green-500 -ml-[33px]":!d.value}]),size:"22",onClick:e[3]||(e[3]=a=>d.value=!d.value)},null,8,["icon","class"])):Z("",!0)],2),o(re,{modelValue:l(f).miniWidgetManagerVars(l(s).hash).configMenuOpen,"onUpdate:modelValue":e[10]||(e[10]=a=>l(f).miniWidgetManagerVars(l(s).hash).configMenuOpen=a),width:"450"},{default:i(()=>[n("div",{class:"flex flex-col items-center p-2 px-4 pt-1 m-5 rounded-md gap-y-4",style:C(l(v).globalGlassMenuStyles)},[e[14]||(e[14]=n("p",{class:"text-xl font-semibold mt-2 mb-4"},"Snapshot settings",-1)),n("div",pe,[o(te,{location:"bottom","open-on-click":"",persistent:!1,"open-on-hover":!1,"open-on-focus":!1,"close-on-content-click":""},{activator:i(({props:a})=>[o(p,B(a,{icon:"mdi-information-outline",class:"absolute top-2 right-2 cursor-pointer text-white",size:"18"}),null,16)]),default:i(()=>[e[12]||(e[12]=n("span",null," Some features like “Capturing Cockpit work area” are only available in the Electron version. ",-1))]),_:1,__:[12]})]),o(ae,{modelValue:l(s).options.selectedStreams,"onUpdate:modelValue":e[4]||(e[4]=a=>l(s).options.selectedStreams=a),items:l(M).namesAvailableStreams||[],density:"compact",multiple:"",clearable:"",label:"Streams to capture",variant:"outlined","no-data-text":"No streams available.","hide-details":"",theme:"dark",class:"w-[90%]"},null,8,["modelValue","items"]),n("div",ue,[o(se,{modelValue:l(s).options.captureWorkspace,"onUpdate:modelValue":[e[5]||(e[5]=a=>l(s).options.captureWorkspace=a),e[6]||(e[6]=a=>l(s).options.captureWorkspace=a)],disabled:!l(g),class:k({"opacity-20 pointer-events-none":!l(g)}),density:"compact",variant:"outlined","hide-details":"",theme:"dark"},null,8,["modelValue","disabled","class"]),n("p",{class:k(["ml-[4px] -mb-[2px] text-sm",{"opacity-20 pointer-events-none":!l(g)}])}," Capture Cockpit work area (Electron only) ",2)]),o(oe,{modelValue:l(r),"onUpdate:modelValue":[e[7]||(e[7]=a=>le(r)?r.value=a:null),e[8]||(e[8]=a=>r.value=parseInt(a))],modelModifiers:{number:!0},label:"Timed snapshot interval (seconds)",type:"number",density:"compact",variant:"outlined","hide-details":"",theme:"dark",class:"w-[90%] mt-2",min:1,step:"1"},null,8,["modelValue"]),n("div",me,[o(ne,{class:"w-auto text-uppercase mt-2 -mr-6",variant:"text",onClick:e[9]||(e[9]=a=>l(f).miniWidgetManagerVars(l(s).hash).configMenuOpen=!1)},{default:i(()=>e[13]||(e[13]=[ie(" Close ")])),_:1,__:[13]})])],4)]),_:1},8,["modelValue"])],64))}});export{fe as default};
