import{c as Je,bP as It,K as ga,bQ as ha,r as v,w as x,h as F,s as q,n as L,E as p,p as P,q as r,a1 as $e,J as ba,R as Gt,au as Rt,aB as ya,a_ as we,o as Nt,aC as H,Y as Bt,x as ie,z as n,Z as Ht,V as N,a3 as At,G as W,$ as Ut,aD as Wt,m as Q,F as qt,C as xa,aE as De,bL as ka,b0 as wa,y as Ke,B as Qe,a0 as _t,v as U,aS as Ma,a2 as Xe,bG as Ca,a6 as Yt,_ as Zt,bF as Sa,t as Va,ak as Ta,u as Oa,bR as La,bS as R,l as Ea,X as $t,a8 as Dt,W as Fa,bT as Ia,bU as _e,bV as m,bW as Aa,bX as _,aq as _a,aW as $a,bY as Da,bZ as Pa,b_ as oe,b$ as za,c0 as Ga,c1 as Ra,ab as Na,e as Ba,bl as Ha,a4 as Pt,P as pe,b1 as Ua,af as Wa,aJ as le,Q as ke,c2 as qa,H as zt,c3 as Ya,c4 as Za}from"./index-CYBACqTC.js";const ja=""+new URL("arducopter-top-view-DWT9mmA0.png",import.meta.url).href,Ka={class:"flex items-center gap-2 mb-6"},Qa={class:"flex items-center gap-2 mb-6"},Xa={class:"flex items-center gap-2 mb-2"},Ja=Je({__name:"GlobalOriginDialog",props:It({vehicle:{},initialLatitude:{},initialLongitude:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:It(["origin-set"],["update:modelValue"]),setup(se,{emit:ne}){const{openSnackbar:k}=ga(),f=ha(se,"modelValue"),X=ne,T=se,i=v(T.initialLatitude),u=v(T.initialLongitude),G=v(0),a=v(!1);x(()=>[T.initialLatitude,T.initialLongitude],([S,w])=>{i.value=S,u.value=w});const M=F(()=>i.value!==null&&i.value!==void 0&&i.value>=-90&&i.value<=90&&u.value!==null&&u.value!==void 0&&u.value>=-180&&u.value<=180&&G.value!==null&&G.value!==void 0),E=()=>{f.value=!1},O=()=>{if(!(!M.value||a.value)){if(T.vehicle===void 0||T.vehicle.dateLastHeartbeat()===void 0||T.vehicle.dateLastHeartbeat()>new Date(Date.now()-5e3)){k({message:"Cannot set global origin. Vehicle does not appear to be online.",variant:"error"});return}a.value=!0;try{T.vehicle.setGlobalOrigin([i.value,u.value],G.value),k({message:"Global origin set successfully.",variant:"success"}),X("origin-set",i.value,u.value),E()}catch(S){k({message:`Failed to set global origin: ${S}`,variant:"error"})}finally{a.value=!1}}},J=F(()=>[{text:"Cancel",action:E,disabled:a.value},{text:a.value?"Saving...":"Save",disabled:!M.value||a.value,action:O,class:a.value?"opacity-70":""}]);return(S,w)=>(L(),q(ba,{"show-dialog":f.value,title:"Set Global Origin",variant:"text-only","max-width":"500px",actions:J.value,"onUpdate:showDialog":w[3]||(w[3]=g=>f.value=g)},{content:p(()=>[w[7]||(w[7]=P("p",{class:"text-sm mb-8 -mt-6 text-gray-300"}," This feature allows you to set the GNSS coordinates of the vehicle's local origin (0,0,0). This is useful when using local position units (such as indoor positioning systems or DVLs) where you want to define a corresponding global position. ",-1)),P("div",Ka,[r($e,{modelValue:i.value,"onUpdate:modelValue":w[0]||(w[0]=g=>i.value=g),modelModifiers:{number:!0},label:"Latitude",type:"number",step:"0.000001",hint:"Latitude in degrees (-90 to 90)","persistent-hint":"",variant:"outlined",rules:[g=>g!=null||"Latitude is required",g=>g>=-90&&g<=90||"Latitude must be between -90 and 90"],class:"flex-1"},null,8,["modelValue","rules"]),w[4]||(w[4]=P("span",{class:"text-white text-lg font-medium mb-6 w-4"},"°",-1))]),P("div",Qa,[r($e,{modelValue:u.value,"onUpdate:modelValue":w[1]||(w[1]=g=>u.value=g),modelModifiers:{number:!0},label:"Longitude",type:"number",step:"0.000001",hint:"Longitude in degrees (-180 to 180)","persistent-hint":"",variant:"outlined",rules:[g=>g!=null||"Longitude is required",g=>g>=-180&&g<=180||"Longitude must be between -180 and 180"],class:"flex-1"},null,8,["modelValue","rules"]),w[5]||(w[5]=P("span",{class:"text-white text-lg font-medium mb-6 w-4"},"°",-1))]),P("div",Xa,[r($e,{modelValue:G.value,"onUpdate:modelValue":w[2]||(w[2]=g=>G.value=g),modelModifiers:{number:!0},label:"Altitude",type:"number",step:"0.1",hint:"Altitude in meters (MSL)","persistent-hint":"",variant:"outlined",rules:[g=>g!=null||"Altitude is required"],class:"flex-1"},null,8,["modelValue","rules"]),w[6]||(w[6]=P("span",{class:"text-white text-lg font-medium mb-6 w-4"},"m",-1))])]),_:1},8,["show-dialog","actions"]))}}),eo={class:"flex justify-end"},to={key:0,class:"fixed top-[80px] right-5"},ao={key:1,class:"flex w-full items-center"},oo={class:"flex justify-between w-full py-1 px-2 pt-3"},lo={class:"flex items-center"},io=Je({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(se,{emit:ne}){const k=Gt(),f=Rt(),X=se,T=ne,i=ya("cockpit-pre-arm-checklist",[]),u=v({}),G=v(""),a=v(null),M=v(!1),E=F(()=>X.modelValue),O=()=>{const C={};for(const s of i.value??[])C[s.id]=!1;u.value=C},J=F(()=>{if(!f.showChecklistBeforeArm)return!0;const C=i.value??[];return C.length>0&&C.every(s=>u.value[s.id]===!0)});x(()=>E.value,C=>{C?(O(),we(()=>{var s,h;return(h=(s=a.value)==null?void 0:s.focus)==null?void 0:h.call(s)})):(u.value={},M.value=!1)}),x(()=>i.value,C=>{if(!E.value)return;const s={...u.value},h={};for(const I of C??[])h[I.id]=!0,I.id in s||(s[I.id]=!1);for(const I of Object.keys(s)){const re=Number(I);h[re]||delete s[re]}u.value=s},{deep:!0});const S=async()=>{var h,I;const C=G.value.trim();if(!C)return;const s={id:Date.now(),text:C};i.value.push(s),E.value&&(u.value[s.id]=!1),G.value="",await we(),(I=(h=a.value)==null?void 0:h.focus)==null||I.call(h)},w=C=>{if(i.value=i.value.filter(s=>s.id!==C),C in u.value){const s={...u.value};delete s[C],u.value=s}},g=()=>{T("dismissed"),T("update:modelValue",!1)},Y=()=>{T("confirmed",!0),T("update:modelValue",!1)};return Nt(()=>{i.value.length===0&&(i.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),E.value&&O()}),x(()=>f.showChecklistBeforeArm,C=>{C||H({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(C,s)=>(L(),q(Yt,{modelValue:E.value,"onUpdate:modelValue":s[4]||(s[4]=h=>E.value=h),"max-width":"600",scrollable:"",persistent:""},{default:p(()=>[r(Bt,{style:ie(n(k).globalGlassMenuStyles),class:"rounded-lg"},{default:p(()=>[r(Ht,{class:"text-center relative pt-3"},{default:p(()=>[s[6]||(s[6]=P("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),r(N,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:g},{default:p(()=>[r(At,null,{default:p(()=>s[5]||(s[5]=[W("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),r(Ut,{class:"mt-[-10px]"},{default:p(()=>[r(Wt,{lines:"one",theme:"dark",class:"bg-transparent"},{default:p(()=>[(L(!0),Q(qt,null,xa(n(i),h=>(L(),q(De,{key:h.id,theme:"dark"},ka({prepend:p(()=>[r(_t,{modelValue:u.value[h.id],"onUpdate:modelValue":I=>u.value[h.id]=I,class:"mt-0","hide-details":"",density:"compact",disabled:!n(f).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:p(()=>[r(wa,{class:Ke([{"line-through opacity-60":u.value[h.id]},{"opacity-50":!n(f).showChecklistBeforeArm}])},{default:p(()=>[W(Qe(h.text),1)]),_:2},1032,["class"])]),_:2},[M.value&&n(i).length>1?{name:"append",fn:p(()=>[r(N,{icon:"",variant:"text",disabled:!n(f).showChecklistBeforeArm,onClick:I=>w(h.id)},{default:p(()=>[r(At,null,{default:p(()=>s[7]||(s[7]=[W("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),P("div",eo,[M.value?(L(),Q("div",ao,[M.value?(L(),q($e,{key:0,ref_key:"newItemInput",ref:a,modelValue:G.value,"onUpdate:modelValue":s[1]||(s[1]=h=>G.value=h),disabled:!n(f).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:Ma(S,["enter"]),"onClick:appendInner":S},null,8,["modelValue","disabled"])):U("",!0),r(N,{"prepend-icon":"mdi-check",disabled:!n(f).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:s[2]||(s[2]=()=>{M.value=!1,S()})},{default:p(()=>s[9]||(s[9]=[W("Done")])),_:1,__:[9]},8,["disabled"])])):(L(),Q("div",to,[r(N,{"prepend-icon":"mdi-format-list-checks",disabled:!n(f).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:s[0]||(s[0]=h=>M.value=!0)},{default:p(()=>s[8]||(s[8]=[W(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),r(Xe,{class:"flex center w-[80%]",inset:""}),r(Ca,null,{default:p(()=>[P("div",oo,[r(N,{variant:"text",onClick:g},{default:p(()=>s[10]||(s[10]=[W("Cancel")])),_:1,__:[10]}),P("div",lo,[r(_t,{"model-value":!n(f).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":s[3]||(s[3]=h=>n(f).showChecklistBeforeArm=!h)},null,8,["model-value"]),s[11]||(s[11]=P("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),r(N,{color:"#ffffff33",class:Ke({"opacity-30":!J.value}),variant:"flat",disabled:!J.value,onClick:Y},{default:p(()=>s[12]||(s[12]=[W("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),so=Zt(io,[["__scopeId","data-v-b0b8e43a"]]),no=["id"],ro={key:0},uo=Je({__name:"Map",props:{widget:{}},setup(se){var Et;Sa(e=>({"3d0afd72":ca.value}));const ne=se,k=Va(ne).widget,f=Gt(),{showDialog:X,closeDialog:T}=Ta(),i=Oa(),u=Rt(),G=La(),a=R(),M=v(u.defaultMapZoom),E=v(u.defaultMapCenter),O=v(),J=F(()=>`map-${k.value.hash}`),S=F(()=>Ge.value||ue.value),w=v(!1),g=v([]),Y=R({}),C=v(),s=v(!1),h=v(!1),I=v(!1),re=v(!1),fe=v(0),ee=v(0),Me=v("");let Ce,Se,Ve;const ue=v(!1),ge=v([]),Te=R({}),jt=F(()=>({"--glass-background":f.globalGlassMenuStyles.backgroundColor,"--glass-filter":f.globalGlassMenuStyles.backdropFilter,"--glass-border":f.globalGlassMenuStyles.border,"--glass-color":f.globalGlassMenuStyles.color,"--glass-box-shadow":f.globalGlassMenuStyles.boxShadow})),Kt=()=>{Ce==null||Ce.click(),ue.value=!1},Qt=()=>{Se==null||Se.click(),ue.value=!1},Xt=()=>{Ve==null||Ve.click(),ue.value=!1};let et;const tt=e=>{e.touches.length>1&&(h.value=!0,j.value&&Fe(),clearTimeout(et))},at=e=>{e.touches.length<=1&&(et=window.setTimeout(()=>h.value=!1,300))},Pe=F(()=>{const e=new Set;return i.reachedMissionItemSequences.length&&i.reachedMissionItemSequences.forEach(t=>{const o=Te.value[t];o!==void 0&&e.add(o)}),e}),he=e=>e<=17?"xs":e>17&&e<=19?"sm":"md",ot=e=>e==="xs"?{iconSize:[6,6],iconAnchor:[3,3]}:e==="sm"?{iconSize:[12,12],iconAnchor:[6,6]}:{iconSize:[26,26],iconAnchor:[13,13]},lt=e=>{const t=e?"marker-icon marker-icon--reached":"marker-icon";return`
    <div class="${`wp-marker-${he(M.value)}`}">
      <div class="${t} waypoint-main-marker"></div>
    </div>
  `},it=(e,t)=>{const o=he(M.value),l=ot(o);return m.divIcon({html:lt(t),className:"waypoint-marker-icon",iconSize:l.iconSize,iconAnchor:l.iconAnchor})},st=e=>{const t=Y.value[e];if(!t)return;const o=Pe.value.has(e),l=he(M.value),c=ot(l);t.setIcon(m.divIcon({html:lt(o),className:"waypoint-marker-icon",iconSize:c.iconSize,iconAnchor:c.iconAnchor}));const d=t.getTooltip();if(d){l==="xs"||l==="sm"?d.setOpacity(0):d.setOpacity(1);const y=d.getElement();y&&(o?y.classList.add("waypoint-tooltip--reached"):y.classList.remove("waypoint-tooltip--reached"))}},nt=()=>{Object.keys(Y.value).forEach(e=>st(Number(e)))},ce=v(null),B=R({});$t.registerUsage(Dt.latitude),$t.registerUsage(Dt.longitude),Fa(()=>{Object.keys(k.value.options).length===0&&(k.value.options={showVehiclePath:!0,showCoordinateGrid:!1}),k.value.options.showCoordinateGrid===void 0&&(k.value.options.showCoordinateGrid=!1),z.enableAutoUpdate()});const ze=_e.tileLayerOffline("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),Oe=_e.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),Le=_e.tileLayerOffline("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),rt=m.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),ut={OpenStreetMap:ze,"Esri World Imagery":Oe},Jt={Seamarks:Le,"Marine Profile":rt},de=v(),Ge=Ea(de),ct=m.control.zoom({position:"bottomright"}),dt=m.control.layers(ut,Jt),be=R(void 0);x(S,()=>{a.value!==void 0&&(S.value?(a.value.addControl(ct),a.value.addControl(dt),mt()):(a.value.removeControl(ct),a.value.removeControl(dt),pt()))}),x(Ge,()=>{S.value=Ge.value}),x(()=>k.value.options.showCoordinateGrid,e=>{a.value!==void 0&&(e?Re():ea())}),x([M,E],()=>{k.value.options.showCoordinateGrid&&a.value&&Re(),S.value&&a.value&&mt()}),x(()=>i.reachedMissionItemSequences,()=>{nt()},{deep:!0});const Re=()=>{if(a.value)try{be.value=Aa(a.value,be.value)}catch(e){console.error("Failed to create grid overlay:",e)}},ea=()=>{be.value&&a.value&&(a.value.removeLayer(be.value),be.value=void 0)},vt=m.control.scale({position:"bottomright",metric:!0,imperial:!1,maxWidth:100}),mt=()=>{a.value&&(pt(),vt.addTo(a.value))},pt=()=>{if(a.value)try{a.value.removeControl(vt)}catch{}};Nt(async()=>{var Ae,Ft;Y.value={},ge.value=[],Te.value={},i.clearReachedMissionItems(),(Ae=de.value)==null||Ae.addEventListener("touchstart",tt,{passive:!0}),(Ft=de.value)==null||Ft.addEventListener("touchend",at,{passive:!0});const e=ut[u.userLastMapTileProvider]||Oe;a.value=m.map(J.value,{layers:[e,Le,rt],attributionControl:!1}).setView(E.value,M.value),a.value.on("baselayerchange",b=>{const A=b.name;A.includes(A)&&(u.userLastMapTileProvider=b.name)}),a.value.removeControl(a.value.zoomControl),a.value.on("click",b=>{V.value=[b.latlng.lat,b.latlng.lng]}),a.value.on("moveend",()=>{if(a.value===void 0)return;let{lat:b,lng:A}=a.value.getCenter();b&&A&&(E.value=[b,A])});const t=Ne(Oe,"Esri",19),o=Ne(ze,"OSM",19),l=Ne(Le,"Seamarks",18);a.value&&(t.addTo(a.value),o.addTo(a.value),l.addTo(a.value));const c=b=>{var ae;const A=((ae=b.getContainer)==null?void 0:ae.call(b))??b._container;A&&(A.classList.add("hidden-savetiles"),A.style.display="none")};c(t),c(o),c(l),await we();const d=b=>{var ae;const A=((ae=b.getContainer)==null?void 0:ae.call(b))??b._container;return Array.from((A==null?void 0:A.querySelectorAll("a"))??[])},[y]=d(t),[D]=d(o),[K]=d(l);Ce=y,Se=D,Ve=K,Be(Oe,"Esri"),Be(ze,"OSM"),Be(Le,"Seamarks"),a.value.on("dragstart",()=>{s.value=!0}),a.value.on("dragend",()=>{setTimeout(()=>s.value=!1,200)}),a.value.on("zoomend",()=>{var b;j.value=!1,a.value!==void 0&&(M.value=((b=a.value)==null?void 0:b.getZoom())??E.value)}),a.value.whenReady(()=>{we(()=>{Object.entries(Y.value).forEach(([b,A])=>{const ae=Pe.value.has(Number(b));A.setIcon(it(Number(b),ae))})})}),a.value.on("contextmenu",b=>{V.value=[b.latlng.lat,b.latlng.lng]}),z.enableAutoUpdate(),window.addEventListener("keydown",kt),$.value?z.goToTarget(_.VEHICLE):z.goToTarget(_.HOME),!i.isVehicleOnline&&u.vehicleMission.length&&Ze(u.vehicleMission),k.value.options.showCoordinateGrid&&Re(),w.value=!0,await He()});const ta=e=>(t,o)=>{X({variant:"info",message:`Save ${t._tilesforSave.length} ${e} tiles for offline use?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:T},{text:"Save tiles",color:"white",action:()=>{o(),T()}}]})},aa=e=>(t,o)=>{X({variant:"warning",message:`Remove all saved ${e} tiles for this layer?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:T},{text:"Remove tiles",color:"white",action:()=>{o(),T(),H({message:`${e} offline tiles removed`,variant:"info",duration:3e3})}}]})},Ne=(e,t,o)=>_e.savetiles(e,{saveWhatYouSee:!0,maxZoom:o,alwaysDownload:!1,position:"topright",parallel:20,confirm:ta(t),confirmRemoval:aa(t),saveText:`<i class="mdi mdi-download" title="Save ${t} tiles"></i>`,rmText:`<i class="mdi mdi-trash-can" title="Remove ${t} tiles"></i>`}),Be=(e,t)=>{e.on("savestart",o=>{var l;fe.value=0,ee.value=((l=o==null?void 0:o._tilesforSave)==null?void 0:l.length)??0,Me.value=t,re.value=!0,H({message:`Saving ${ee.value} ${t} tiles...`,variant:"info",duration:2e3})}),e.on("loadtileend",()=>{fe.value+=1,ee.value>0&&fe.value>=ee.value&&(H({message:`${t} offline tiles saved!`,variant:"success",duration:3e3}),re.value=!1,Me.value="",fe.value=0,ee.value=0)})},oa={open:e=>{if(!a.value||h.value||s.value)return;e.preventDefault(),e.stopPropagation();const t=a.value.mouseEventToContainerPoint(e),o=a.value.containerPointToLatLng(t);V.value=[o.lat,o.lng],C.value.openAt(e),j.value=!0},close:()=>{Fe()}},ft=()=>{var e;(e=a.value)==null||e.eachLayer(t=>{(t instanceof m.Marker||t instanceof m.Polyline&&t.options.color==="#358AC3")&&a.value.removeLayer(t)}),g.value=[],Ee.value=void 0,te.value=void 0,me.value=void 0,Z.value=void 0,Y.value={},ge.value=[],Te.value={}},He=async()=>{w.value&&(ft(),i.isVehicleOnline?await Ct():u.vehicleMission.length&&(Mt(u.vehicleMission),Ze(u.vehicleMission)))};x(()=>i.isVehicleOnline,()=>{He()}),x(()=>u.vehicleMissionRevision,()=>{He()}),_a(()=>{var e,t;z.disableAutoUpdate(),window.removeEventListener("keydown",kt),a.value&&(a.value.off("contextmenu"),Object.values(B.value).forEach(o=>o.remove()),B.value={}),(e=de.value)==null||e.removeEventListener("touchstart",tt),(t=de.value)==null||t.removeEventListener("touchend",at)}),x(E,(e,t)=>{var o;e.toString()!==t.toString()&&((o=a.value)==null||o.panTo(e))}),x(a,(e,t)=>{a.value!==void 0&&(e==null?void 0:e.options)===void 0&&(a.value=t)}),x(M,(e,t)=>{var o;e!==t&&(j.value=!1,(o=a.value)==null||o.setZoom(M.value))}),x(M,()=>{a.value&&nt()}),x(ne.widget,()=>{var e;(e=a.value)==null||e.invalidateSize()});const ve=v(void 0),z=new Ia(e=>ve.value=e,e=>E.value=e);z.setTrackableTarget(_.VEHICLE,()=>$.value),z.setTrackableTarget(_.HOME,()=>O.value);const $=F(()=>i.coordinates.latitude?[i.coordinates.latitude,i.coordinates.longitude]:void 0),Ue=F(()=>{var e;return i.attitude.yaw?$a((e=i.attitude)==null?void 0:e.yaw):0}),gt=F(()=>{const e=i.lastHeartbeat;return e?`${Da(e??0,{includeSeconds:!0})} ago`:"never"}),{history:la}=Pa($);(Et=navigator==null?void 0:navigator.geolocation)==null||Et.watchPosition(e=>{O.value||(O.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let ht=!0;x([O,a],async()=>{O.value===E.value||!a.value||!ht||(z.goToTarget(_.HOME),ht=!1)});const Z=R();x(i.coordinates,()=>{if(!(!a.value||!$.value)){if(Z.value===void 0){let e=za;i.vehicleType===oe.MAV_TYPE_SURFACE_BOAT?e=Ga:i.vehicleType===oe.MAV_TYPE_SUBMARINE?e=Ra:[oe.MAV_TYPE_QUADROTOR,oe.MAV_TYPE_HEXAROTOR,oe.MAV_TYPE_OCTOROTOR,oe.MAV_TYPE_TRICOPTER,oe.MAV_TYPE_DODECAROTOR].includes(i.vehicleType)&&(e=ja);const t=m.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});Z.value=m.marker($.value,{icon:t});const o=m.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});Z.value.bindTooltip(o),a.value.addLayer(Z.value)}Z.value.setLatLng($.value)}}),x($,(e,t)=>{ve.value===_.VEHICLE||t!==void 0||z.follow(_.VEHICLE)}),x([$,Ue,gt,()=>i.isArmed],()=>{var t,o,l,c,d;if(Z.value===void 0)return;(c=Z.value.getTooltip())==null||c.setContent(`
    <p>Coordinates: ${(t=$.value)==null?void 0:t[0].toFixed(6)}, ${(o=$.value)==null?void 0:o[1].toFixed(6)}</p>
    <p>Velocity: ${((l=i.velocity.ground)==null?void 0:l.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${Ue.value.toFixed(2)}°</p>
    <p>${i.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${gt.value}</p>
  `);const e=(d=Z.value.getElement())==null?void 0:d.querySelector("img");e&&(e.style.transform=`rotate(${Ue.value}deg)`)});const te=R();x(O,()=>{if(a.value===void 0)return;const e=O.value;if(e!==void 0)if(te.value)te.value.setLatLng(e);else{te.value=m.marker(e,{icon:m.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=m.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});te.value.bindTooltip(t),te.value.on("dragend",o=>{const c=o.target.getLatLng();je([c.lat,c.lng])}),a.value.addLayer(te.value)}});const Ee=R();x(g,e=>{a.value&&(Ee.value||(Ee.value=m.polyline([],{color:"#358AC3"}).addTo(a.value)),Ee.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,o)=>{var d;const l=o+1;let c=Y.value[l];if(c){c.setLatLng(t.coordinates);const y=he(M.value),D=c.getTooltip();D&&(y==="xs"||y==="sm"?D.setOpacity(0):(D.setContent(l.toString()),D.setOpacity(1))),st(l)}else{const y=Pe.value.has(l),D=it(l,y);c=m.marker(t.coordinates,{icon:D}),Y.value[l]=c;const K=he(M.value),Ae=m.tooltip({content:l.toString(),permanent:!0,direction:"center",className:y?"waypoint-tooltip waypoint-tooltip--reached":"waypoint-tooltip",opacity:K==="md"?1:0});c.bindTooltip(Ae),(d=a.value)==null||d.addLayer(c)}}))},{deep:!0});const We=R();x(la,e=>{if(a.value===void 0||e===void 0)return;We.value===void 0&&(We.value=m.polyline([],{color:"#ffff00"}).addTo(a.value));const t=e.filter(o=>o.snapshot!==void 0).map(o=>o.snapshot);We.value.setLatLngs(t)});const j=v(!1),V=v(null),bt=R(),qe=v(!1),yt=v(0),xt=v(0),Ye=R(),ia=Na([{item:"Set home waypoint",action:()=>ye("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Set Global Origin",action:()=>ye("set-global-origin"),icon:"mdi-crosshairs-question"},{item:"Place Point of Interest",action:()=>ye("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>ye("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>ye("set-default-map-position"),icon:"mdi-map-check"}]),me=R(),sa=async()=>{var e;if(!(!a.value||!V.value))try{await u.setDefaultMapPosition(V.value,M.value),H({message:"Default map position set",variant:"success"});const t=m.marker(V.value,{icon:m.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value),o=m.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(o).openTooltip();const l=t.getElement(),c=(e=t.getTooltip())==null?void 0:e.getElement();[l,c].forEach(d=>{d&&(d.style.transition="opacity 1s",d.style.opacity="1")}),setTimeout(()=>{[l,c].forEach(d=>{d&&(d.style.opacity="0")}),setTimeout(()=>{var d;(d=a.value)==null||d.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),H({message:"Failed to set default map position",variant:"error"})}},na=async()=>{if(!V.value||!a.value)return;me.value&&(a.value.removeLayer(me.value),me.value=void 0),me.value=m.marker(V.value,{icon:m.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value);const e=m.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(me.value.bindTooltip(e),V.value){const d=i.coordinates.altitude??0,y=V.value[0],D=V.value[1];try{await i.goTo(0,0,0,0,y,D,d)}catch(K){H({message:`GoTo request failed: ${K.message}`,variant:"error"})}}},ye=async e=>{switch(e){case"goto":{na();break}case"set-default-map-position":sa();break;case"place-poi":V.value&&ce.value?ce.value.openDialog(V.value):V.value?ce.value||(H({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):(H({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":V.value&&je(V.value);break;case"set-global-origin":V.value&&(yt.value=V.value[0],xt.value=V.value[1],qe.value=!0);break;default:console.warn("Unknown menu option selected:",e)}j.value=!1},Fe=()=>{j.value=!1,a.value!==void 0&&bt.value!==void 0&&a.value.removeLayer(bt.value)},ra=(e,t)=>{if(!a.value)return;Ye.value&&a.value.removeLayer(Ye.value);const o=m.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),l=m.marker([e,t],{icon:o}).addTo(a.value),c=m.tooltip({content:'<i class="mdi mdi-axis-arrow text-[18px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});l.bindTooltip(c),Ye.value=l},kt=e=>{e.key==="Escape"&&Fe()},Ze=e=>{e.forEach((t,o)=>{o===0?(O.value=t.coordinates,je(t.coordinates)):g.value.push(t)})},Ie=v(!1),wt=v(0),Mt=e=>{const t={};let o=0;e.forEach((l,c)=>{const d=c===0?void 0:c;l.commands.forEach(y=>{y.type!=="MAVLINK_NAV_COMMAND"&&y.type!=="MAVLINK_NON_NAV_COMMAND"||(d!==void 0&&(t[o]=d),o+=1)})}),Te.value=t},Ct=async()=>{Ie.value=!0,ft();const e=async t=>{wt.value=t};try{ge.value=await i.fetchMission(e),Mt(ge.value),Ze(ge.value),H({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){X({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{Ie.value=!1}},je=async e=>{const t=[e[0],e[1]];O.value=t,await i.setHomeWaypoint(t,0),j.value&&(j.value=!1)},St=async()=>{try{await i.startMission()}catch{H({message:"Failed to start mission.",variant:"error"})}},ua=async()=>{if(u.showChecklistBeforeArm){I.value=!0;return}St()},xe=Ba(),ca=F(()=>`${Math.max(-xe.widgetClearanceForVisibleArea(k.value).bottom,0)}px`),Vt=F(()=>`${Math.max(-xe.widgetClearanceForVisibleArea(k.value).top,0)}px`),da=F(()=>i.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),va=F(()=>i.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),ma=F(()=>O.value===void 0?"Cannot center map on home (home position undefined).":ve.value===_.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),pa=F(()=>i.isVehicleOnline?$.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":ve.value===_.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),Tt=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),Ot=e=>{if(!a.value||!a.value.getContainer())return;const t=m.divIcon(Tt(e)),o=m.marker(e.coordinates,{icon:t,draggable:!0}).addTo(a.value),l=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,c={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};o.bindTooltip(l,c),o.on("drag",d=>{var K;const y=d.target.getLatLng(),D=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${y.lat.toFixed(8)}, Lng: ${y.lng.toFixed(8)}
    `;(K=o.getTooltip())==null||K.setContent(D)}),o.on("dragend",d=>{const y=d.target.getLatLng();u.movePointOfInterest(e.id,[y.lat,y.lng])}),o.on("click",d=>{if(m.DomEvent.stopPropagation(d),ce.value){const y=u.pointsOfInterest.find(D=>D.id===e.id);y?ce.value.openDialog(void 0,y):console.warn("POI not found in store:",e.id)}}),B.value[e.id]=o},Lt=e=>{var l;if(!a.value||!a.value.getContainer()||!B.value[e.id])return;const t=B.value[e.id];t.setLatLng(e.coordinates),t.setIcon(m.divIcon(Tt(e)));const o=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(l=t.getTooltip())==null||l.setContent(o)},fa=e=>{!a.value||!B.value[e]||(B.value[e].remove(),delete B.value[e])};return x(()=>u.pointsOfInterest,async e=>{if((!a.value||!a.value.getContainer())&&(await we(),!a.value||!a.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(o=>o.id));Object.keys(B.value).forEach(o=>{t.has(o)||fa(o)}),e.forEach(o=>{B.value[o.id]?Lt(o):Ot(o)})},{deep:!0,immediate:!0}),x(a,e=>{e&&e.getContainer()&&u.pointsOfInterest.forEach(t=>{B.value[t.id]?Lt(t):Ot(t)})},{immediate:!0}),(e,t)=>{const o=Ha("contextmenu");return L(),Q(qt,null,[Pt((L(),Q("div",{ref_key:"mapBase",ref:de,class:Ke(["page-base",n(xe).editingMode?"pointer-events-none":"pointer-events-auto"]),style:ie(jt.value)},[P("div",{id:J.value,ref_key:"map",ref:a,class:"map"},[r(Wa,{modelValue:ue.value,"onUpdate:modelValue":t[0]||(t[0]=l=>ue.value=l),"close-on-content-click":!1,location:"top end"},{activator:p(({props:l})=>[Pt(r(N,pe({style:n(f).globalGlassMenuStyles},l,{class:"absolute right-[209px] m-3 bottom-button bg-slate-50 text-[14px]",elevation:"2",size:"x-small",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download-multiple"}),null,16,["style"]),[[Ua,S.value]])]),default:p(()=>[r(Wt,{style:ie(n(f).globalGlassMenuStyles),class:"py-0 min-w-[220px] rounded-lg border-[1px]"},{default:p(()=>[r(De,{class:"py-0",title:"Save visible Esri tiles",onClick:Kt}),r(Xe),r(De,{class:"py-0",title:"Save visible OSM tiles",onClick:Qt}),r(Xe),r(De,{class:"py-0",title:"Save visible Seamarks tiles",onClick:Xt})]),_:1},8,["style"])]),_:1},8,["modelValue"]),r(ke,{location:"top",text:"Switch to Mission Planning mode"},{activator:p(({props:l})=>[S.value?(L(),q(N,pe({key:0},l,{class:"absolute right-[265px] w-[140px] mb-[14px] bottom-button bg-slate-50 text-[12px] font-bold",elevation:"4",text:"Edit mission","append-icon":"mdi-map-marker-radius-outline",style:[{"z-index":"1002","border-radius":"0px"},n(f).globalGlassMenuStyles],"hide-details":"",size:"small",onClick:t[1]||(t[1]=le(c=>n(G).push("/mission-planning"),["stop"]))}),null,16,["style"])):U("",!0)]),_:1}),r(ke,{location:"top",text:ma.value},{activator:p(({props:l})=>[S.value?(L(),q(N,pe({key:0,style:[n(f).globalGlassMenuStyles,O.value?{}:{color:"#FFFFFF33"}]},l,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",O.value?"":"active-events-on-disabled"],color:ve.value==n(_).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!O.value,onClick:t[2]||(t[2]=le(c=>n(z).goToTarget(n(_).HOME,!0),["stop"])),onDblclick:t[3]||(t[3]=le(c=>n(z).follow(n(_).HOME),["stop"]))}),null,16,["style","class","color","disabled"])):U("",!0)]),_:1},8,["text"]),r(ke,{location:"top",text:pa.value},{activator:p(({props:l})=>[S.value?(L(),q(N,pe({key:0,style:[n(f).globalGlassMenuStyles,$.value?{}:{color:"#FFFFFF33"}]},l,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",$.value?"":"active-events-on-disabled"],color:ve.value==n(_).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!$.value,onClick:t[4]||(t[4]=le(c=>n(z).goToTarget(n(_).VEHICLE,!0),["stop"])),onDblclick:t[5]||(t[5]=le(c=>n(z).follow(n(_).VEHICLE),["stop"]))}),null,16,["style","class","color","disabled"])):U("",!0)]),_:1},8,["text"]),r(ke,{location:"top",text:da.value},{activator:p(({props:l})=>[S.value?(L(),q(N,pe({key:0,style:[n(f).globalGlassMenuStyles,n(i).isVehicleOnline?{}:{color:"#FFFFFF33"}]},l,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",n(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!n(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:le(Ct,["stop"])}),null,16,["style","class","disabled"])):U("",!0)]),_:1},8,["text"]),r(ke,{location:"top",text:va.value},{activator:p(({props:l})=>[S.value?(L(),q(N,pe({key:0,style:[n(f).globalGlassMenuStyles,n(i).isVehicleOnline?{}:{color:"#FFFFFF33"}]},l,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",n(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!n(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:le(ua,["stop"])}),null,16,["style","class","disabled"])):U("",!0)]),_:1},8,["text"])],8,no)],6)),[[o,oa]]),r(qa,{ref_key:"contextMenuRef",ref:C,visible:j.value,width:"260px","menu-items":ia,onClose:Fe},null,8,["visible","menu-items"]),r(Yt,{modelValue:n(xe).widgetManagerVars(n(k).hash).configMenuOpen,"onUpdate:modelValue":t[8]||(t[8]=l=>n(xe).widgetManagerVars(n(k).hash).configMenuOpen=l),width:"auto"},{default:p(()=>[r(Bt,{class:"pa-2",style:ie(n(f).globalGlassMenuStyles)},{default:p(()=>[r(Ht,{class:"text-center"},{default:p(()=>t[11]||(t[11]=[W("Map widget settings")])),_:1,__:[11]}),r(Ut,null,{default:p(()=>[r(zt,{modelValue:n(k).options.showVehiclePath,"onUpdate:modelValue":t[6]||(t[6]=l=>n(k).options.showVehiclePath=l),class:"my-1",label:"Show vehicle path",color:n(k).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),r(zt,{modelValue:n(k).options.showCoordinateGrid,"onUpdate:modelValue":t[7]||(t[7]=l=>n(k).options.showCoordinateGrid=l),class:"my-1",label:"Show coordinate grid",color:n(k).options.showCoordinateGrid?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Ie.value?(L(),q(Ya,{key:0,"model-value":wt.value,height:"10",absolute:"",bottom:"",color:"white",style:ie(`top: ${Vt.value}`)},null,8,["model-value","style"])):U("",!0),Ie.value?(L(),Q("p",{key:1,style:ie({top:Vt.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):U("",!0),r(Za,{ref_key:"poiManagerMapWidgetRef",ref:ce},null,512),r(so,{"model-value":I.value,onConfirmed:St,"onUpdate:modelValue":t[9]||(t[9]=l=>I.value=l)},null,8,["model-value"]),r(Ja,{modelValue:qe.value,"onUpdate:modelValue":t[10]||(t[10]=l=>qe.value=l),vehicle:n(i).mainVehicle,"initial-latitude":yt.value,"initial-longitude":xt.value,onOriginSet:ra},null,8,["modelValue","vehicle","initial-latitude","initial-longitude"]),re.value?(L(),Q("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:ie(n(f).globalGlassMenuStyles)},[P("p",null,[t[12]||(t[12]=W(" Saving offline map content ")),Me.value?(L(),Q("span",ro,"("+Qe(Me.value)+")",1)):U("",!0),W(":  "+Qe(ee.value?Math.round(fe.value/ee.value*100):0)+"% ",1)])],4)):U("",!0)],64)}}}),vo=Zt(uo,[["__scopeId","data-v-5f8654b9"]]);export{vo as default};
