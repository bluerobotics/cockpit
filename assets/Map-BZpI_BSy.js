import{c as ht,K as yt,aq as bt,ax as Yt,r as u,k as I,w as g,aY as Se,o as xt,ay as $,I as U,m as C,O as c,H as r,V as kt,N as oe,v as s,P as wt,n as Y,a7 as F,a6 as ct,Q as z,R as Ct,az as Mt,l as R,F as Tt,q as qt,aA as Ve,bO as Kt,a_ as Qt,x as ze,t as He,S as dt,s as N,U as Jt,aP as Xt,am as Be,bH as eo,W as Vt,_ as St,bD as to,J as oo,af as ao,u as lo,j as io,M as vt,Y as mt,L as so,bP as no,bQ as Me,bR as v,bS as ro,bT as M,al as uo,aU as co,bU as vo,bV as mo,bW as pt,bX as po,bY as fo,bZ as go,a0 as ho,y as yo,bj as bo,G as ft,a5 as de,a$ as xo,a8 as ko,aG as te,a4 as Te,b_ as wo,ad as gt,b$ as Co,c0 as Mo}from"./index-DfQ9qSLa.js";const To={class:"flex justify-end"},Vo={key:0,class:"fixed top-[80px] right-5"},So={key:1,class:"flex w-full items-center"},Eo={class:"flex justify-between w-full py-1 px-2 pt-3"},Io={class:"flex items-center"},Oo=ht({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(Ee,{emit:ve}){const b=yt(),T=bt(),ae=Ee,H=ve,n=Yt("cockpit-pre-arm-checklist",[]),m=u({}),o=u(""),A=u(null),V=u(!1),x=I(()=>ae.modelValue),le=()=>{const f={};for(const l of n.value??[])f[l.id]=!1;m.value=f},O=I(()=>{if(!T.showChecklistBeforeArm)return!0;const f=n.value??[];return f.length>0&&f.every(l=>m.value[l.id]===!0)});g(()=>x.value,f=>{f?(le(),Se(()=>{var l,d;return(d=(l=A.value)==null?void 0:l.focus)==null?void 0:d.call(l)})):(m.value={},V.value=!1)}),g(()=>n.value,f=>{if(!x.value)return;const l={...m.value},d={};for(const k of f??[])d[k.id]=!0,k.id in l||(l[k.id]=!1);for(const k of Object.keys(l)){const P=Number(k);d[P]||delete l[P]}m.value=l},{deep:!0});const q=async()=>{var d,k;const f=o.value.trim();if(!f)return;const l={id:Date.now(),text:f};n.value.push(l),x.value&&(m.value[l.id]=!1),o.value="",await Se(),(k=(d=A.value)==null?void 0:d.focus)==null||k.call(d)},ie=f=>{if(n.value=n.value.filter(l=>l.id!==f),f in m.value){const l={...m.value};delete l[f],m.value=l}},se=()=>{H("dismissed"),H("update:modelValue",!1)},ne=()=>{H("confirmed",!0),H("update:modelValue",!1)};return xt(()=>{n.value.length===0&&(n.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),x.value&&le()}),g(()=>T.showChecklistBeforeArm,f=>{f||$({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(f,l)=>(C(),U(Vt,{modelValue:x.value,"onUpdate:modelValue":l[4]||(l[4]=d=>x.value=d),"max-width":"600",scrollable:"",persistent:""},{default:c(()=>[r(kt,{style:oe(s(b).globalGlassMenuStyles),class:"rounded-lg"},{default:c(()=>[r(wt,{class:"text-center relative pt-3"},{default:c(()=>[l[6]||(l[6]=Y("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),r(F,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:se},{default:c(()=>[r(ct,null,{default:c(()=>l[5]||(l[5]=[z("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),r(Ct,{class:"mt-[-10px]"},{default:c(()=>[r(Mt,{lines:"one",theme:"dark",class:"bg-transparent"},{default:c(()=>[(C(!0),R(Tt,null,qt(s(n),d=>(C(),U(Ve,{key:d.id,theme:"dark"},Kt({prepend:c(()=>[r(dt,{modelValue:m.value[d.id],"onUpdate:modelValue":k=>m.value[d.id]=k,class:"mt-0","hide-details":"",density:"compact",disabled:!s(T).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:c(()=>[r(Qt,{class:ze([{"line-through opacity-60":m.value[d.id]},{"opacity-50":!s(T).showChecklistBeforeArm}])},{default:c(()=>[z(He(d.text),1)]),_:2},1032,["class"])]),_:2},[V.value&&s(n).length>1?{name:"append",fn:c(()=>[r(F,{icon:"",variant:"text",disabled:!s(T).showChecklistBeforeArm,onClick:k=>ie(d.id)},{default:c(()=>[r(ct,null,{default:c(()=>l[7]||(l[7]=[z("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),Y("div",To,[V.value?(C(),R("div",So,[V.value?(C(),U(Jt,{key:0,ref_key:"newItemInput",ref:A,modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=d=>o.value=d),disabled:!s(T).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:Xt(q,["enter"]),"onClick:appendInner":q},null,8,["modelValue","disabled"])):N("",!0),r(F,{"prepend-icon":"mdi-check",disabled:!s(T).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:l[2]||(l[2]=()=>{V.value=!1,q()})},{default:c(()=>l[9]||(l[9]=[z("Done")])),_:1,__:[9]},8,["disabled"])])):(C(),R("div",Vo,[r(F,{"prepend-icon":"mdi-format-list-checks",disabled:!s(T).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:l[0]||(l[0]=d=>V.value=!0)},{default:c(()=>l[8]||(l[8]=[z(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),r(Be,{class:"flex center w-[80%]",inset:""}),r(eo,null,{default:c(()=>[Y("div",Eo,[r(F,{variant:"text",onClick:se},{default:c(()=>l[10]||(l[10]=[z("Cancel")])),_:1,__:[10]}),Y("div",Io,[r(dt,{"model-value":!s(T).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":l[3]||(l[3]=d=>s(T).showChecklistBeforeArm=!d)},null,8,["model-value"]),l[11]||(l[11]=Y("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),r(F,{color:"#ffffff33",class:ze({"opacity-30":!O.value}),variant:"flat",disabled:!O.value,onClick:ne},{default:c(()=>l[12]||(l[12]=[z("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),Lo=St(Oo,[["__scopeId","data-v-b0b8e43a"]]),_o=["id"],$o={key:0},Fo=ht({__name:"Map",props:{widget:{}},setup(Ee){var rt;to(e=>({"690a9106":Nt.value}));const ve=Ee,b=oo(ve).widget,T=yt(),{showDialog:ae,closeDialog:H}=ao(),n=lo(),m=bt(),o=u(),A=u(m.defaultMapZoom),V=u(m.defaultMapCenter),x=u(),le=I(()=>`map-${b.value.hash}`),O=I(()=>Ie.value||K.value),q=u(!1),ie=u([]),se=u(),ne=u(!1),f=u(!1),l=u(!1),d=u(!1),k=u(0),P=u(0),me=u("");let pe,fe,ge;const K=u(!1),Et=()=>{pe==null||pe.click(),K.value=!1},It=()=>{fe==null||fe.click(),K.value=!1},Ot=()=>{ge==null||ge.click(),K.value=!1};let Ge;const Ne=e=>{e.touches.length>1&&(f.value=!0,G.value&&we(),clearTimeout(Ge))},Ue=e=>{e.touches.length<=1&&(Ge=window.setTimeout(()=>f.value=!1,300))},Q=u(null),_=u({});vt.registerUsage(mt.latitude),vt.registerUsage(mt.longitude),so(()=>{Object.keys(b.value.options).length===0&&(b.value.options={showVehiclePath:!0,showCoordinateGrid:!1}),b.value.options.showCoordinateGrid===void 0&&(b.value.options.showCoordinateGrid=!1),S.enableAutoUpdate()});const he=Me.tileLayerOffline("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),ye=Me.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),be=Me.tileLayerOffline("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),Re=v.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),Lt={OpenStreetMap:he,"Esri World Imagery":ye},_t={Seamarks:be,"Marine Profile":Re},J=u(),Ie=io(J),We=v.control.zoom({position:"bottomright"}),Ze=v.control.layers(Lt,_t),re=u(void 0);g(O,()=>{o.value!==void 0&&(O.value?(o.value.addControl(We),o.value.addControl(Ze),Ye()):(o.value.removeControl(We),o.value.removeControl(Ze),qe()))}),g(Ie,()=>{O.value=Ie.value}),g(()=>b.value.options.showCoordinateGrid,e=>{o.value!==void 0&&(e?Oe():$t())}),g([A,V],()=>{b.value.options.showCoordinateGrid&&o.value&&Oe(),O.value&&o.value&&Ye()});const Oe=()=>{if(o.value)try{re.value=ro(o.value,re.value)}catch(e){console.error("Failed to create grid overlay:",e)}},$t=()=>{re.value&&o.value&&(o.value.removeLayer(re.value),re.value=void 0)},je=v.control.scale({position:"bottomright",metric:!0,imperial:!1,maxWidth:100}),Ye=()=>{o.value&&(qe(),je.addTo(o.value))},qe=()=>{if(o.value)try{o.value.removeControl(je)}catch{}};xt(async()=>{var j,ut;(j=J.value)==null||j.addEventListener("touchstart",Ne,{passive:!0}),(ut=J.value)==null||ut.addEventListener("touchend",Ue,{passive:!0}),o.value=v.map(le.value,{layers:[he,ye,be,Re],attributionControl:!1}).setView(V.value,A.value),o.value.removeControl(o.value.zoomControl),o.value.on("click",y=>{w.value=[y.latlng.lat,y.latlng.lng]}),o.value.on("moveend",()=>{if(o.value===void 0)return;let{lat:y,lng:D}=o.value.getCenter();y&&D&&(V.value=[y,D])});const e=Le(ye,"Esri",19),t=Le(he,"OSM",19),a=Le(be,"Seamarks",18);o.value&&(e.addTo(o.value),t.addTo(o.value),a.addTo(o.value));const i=y=>{var ce;const D=((ce=y.getContainer)==null?void 0:ce.call(y))??y._container;D&&(D.classList.add("hidden-savetiles"),D.style.display="none")};i(e),i(t),i(a),await Se();const h=y=>{var ce;const D=((ce=y.getContainer)==null?void 0:ce.call(y))??y._container;return Array.from((D==null?void 0:D.querySelectorAll("a"))??[])},[p]=h(e),[L]=h(t),[Z]=h(a);pe=p,fe=L,ge=Z,_e(ye,"Esri"),_e(he,"OSM"),_e(be,"Seamarks"),o.value.on("dragstart",()=>{ne.value=!0}),o.value.on("dragend",()=>{setTimeout(()=>ne.value=!1,200)}),o.value.on("zoomend",()=>{var y;G.value=!1,o.value!==void 0&&(A.value=((y=o.value)==null?void 0:y.getZoom())??V.value)}),o.value.on("contextmenu",y=>{w.value=[y.latlng.lat,y.latlng.lng]}),S.enableAutoUpdate(),window.addEventListener("keydown",et),E.value?S.goToTarget(M.VEHICLE):S.goToTarget(M.HOME),!n.isVehicleOnline&&m.vehicleMission.length&&Pe(m.vehicleMission),b.value.options.showCoordinateGrid&&Oe(),q.value=!0,await $e()});const Ft=e=>(t,a)=>{ae({variant:"info",message:`Save ${t._tilesforSave.length} ${e} tiles for offline use?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:H},{text:"Save tiles",color:"white",action:()=>{a(),H()}}]})},At=e=>(t,a)=>{ae({variant:"warning",message:`Remove all saved ${e} tiles for this layer?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:H},{text:"Remove tiles",color:"white",action:()=>{a(),H(),$({message:`${e} offline tiles removed`,variant:"info",duration:3e3})}}]})},Le=(e,t,a)=>Me.savetiles(e,{saveWhatYouSee:!0,maxZoom:a,alwaysDownload:!1,position:"topright",parallel:20,confirm:Ft(t),confirmRemoval:At(t),saveText:`<i class="mdi mdi-download" title="Save ${t} tiles"></i>`,rmText:`<i class="mdi mdi-trash-can" title="Remove ${t} tiles"></i>`}),_e=(e,t)=>{e.on("savestart",a=>{var i;k.value=0,P.value=((i=a==null?void 0:a._tilesforSave)==null?void 0:i.length)??0,me.value=t,d.value=!0,$({message:`Saving ${P.value} ${t} tiles...`,variant:"info",duration:2e3})}),e.on("loadtileend",()=>{k.value+=1,P.value>0&&k.value>=P.value&&($({message:`${t} offline tiles saved!`,variant:"success",duration:3e3}),d.value=!1,me.value="",k.value=0,P.value=0)})},Pt={open:e=>{if(!o.value||f.value||ne.value)return;e.preventDefault(),e.stopPropagation();const t=o.value.mouseEventToContainerPoint(e),a=o.value.containerPointToLatLng(t);w.value=[a.lat,a.lng],se.value.openAt(e),G.value=!0},close:()=>{we()}},Ke=()=>{var e;(e=o.value)==null||e.eachLayer(t=>{(t instanceof v.Marker||t instanceof v.Polyline&&t.options.color==="#358AC3")&&o.value.removeLayer(t)}),ie.value=[],xe.value=void 0,W.value=void 0,ee.value=void 0,B.value=void 0},$e=async()=>{q.value&&(Ke(),n.isVehicleOnline?await ot():m.vehicleMission.length&&Pe(m.vehicleMission))};g(()=>n.isVehicleOnline,()=>{$e()}),g(()=>m.vehicleMissionRevision,()=>{$e()}),uo(()=>{var e,t;S.disableAutoUpdate(),window.removeEventListener("keydown",et),o.value&&(o.value.off("contextmenu"),Object.values(_.value).forEach(a=>a.remove()),_.value={}),(e=J.value)==null||e.removeEventListener("touchstart",Ne),(t=J.value)==null||t.removeEventListener("touchend",Ue)}),g(V,(e,t)=>{var a;e.toString()!==t.toString()&&((a=o.value)==null||a.panTo(e))}),g(o,(e,t)=>{o.value!==void 0&&(e==null?void 0:e.options)===void 0&&(o.value=t)}),g(A,(e,t)=>{var a;e!==t&&(G.value=!1,(a=o.value)==null||a.setZoom(A.value))}),g(ve.widget,()=>{var e;(e=o.value)==null||e.invalidateSize()});const X=u(void 0),S=new no(e=>X.value=e,e=>V.value=e);S.setTrackableTarget(M.VEHICLE,()=>E.value),S.setTrackableTarget(M.HOME,()=>x.value);const E=I(()=>n.coordinates.latitude?[n.coordinates.latitude,n.coordinates.longitude]:void 0),Fe=I(()=>{var e;return n.attitude.yaw?co((e=n.attitude)==null?void 0:e.yaw):0}),Qe=I(()=>{const e=n.lastHeartbeat;return e?`${vo(e??0,{includeSeconds:!0})} ago`:"never"}),{history:Dt}=mo(E);(rt=navigator==null?void 0:navigator.geolocation)==null||rt.watchPosition(e=>{x.value||(x.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let Je=!0;g([x,o],async()=>{x.value===V.value||!o.value||!Je||(S.goToTarget(M.HOME),Je=!1)});const B=u();g(n.coordinates,()=>{if(!(!o.value||!E.value)){if(B.value===void 0){let e=po;n.vehicleType===pt.MAV_TYPE_SURFACE_BOAT?e=fo:n.vehicleType===pt.MAV_TYPE_SUBMARINE&&(e=go);const t=v.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});B.value=v.marker(E.value,{icon:t});const a=v.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});B.value.bindTooltip(a),o.value.addLayer(B.value)}B.value.setLatLng(E.value)}}),g(E,(e,t)=>{X.value===M.VEHICLE||t!==void 0||S.follow(M.VEHICLE)}),g([E,Fe,Qe,()=>n.isArmed],()=>{var t,a,i,h,p;if(B.value===void 0)return;(h=B.value.getTooltip())==null||h.setContent(`
    <p>Coordinates: ${(t=E.value)==null?void 0:t[0].toFixed(6)}, ${(a=E.value)==null?void 0:a[1].toFixed(6)}</p>
    <p>Velocity: ${((i=n.velocity.ground)==null?void 0:i.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${Fe.value.toFixed(2)}°</p>
    <p>${n.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${Qe.value}</p>
  `);const e=(p=B.value.getElement())==null?void 0:p.querySelector("img");e&&(e.style.transform=`rotate(${Fe.value}deg)`)});const W=u();g(x,()=>{if(o.value===void 0)return;const e=x.value;if(e!==void 0)if(W.value)W.value.setLatLng(e);else{W.value=v.marker(e,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=v.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});W.value.bindTooltip(t),W.value.on("dragend",a=>{const h=a.target.getLatLng();De([h.lat,h.lng])}),o.value.addLayer(W.value)}});const xe=u();g(ie,e=>{o.value&&(xe.value||(xe.value=v.polyline([],{color:"#358AC3"}).addTo(o.value)),xe.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,a)=>{var p;const i=v.marker(t.coordinates);i.setIcon(v.divIcon({className:"marker-icon",iconSize:[16,16],iconAnchor:[8,8]}));const h=v.tooltip({content:a.toString(),permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});i.bindTooltip(h),(p=o.value)==null||p.addLayer(i)}))},{deep:!0});const Ae=u();g(Dt,e=>{if(o.value===void 0||e===void 0)return;Ae.value===void 0&&(Ae.value=v.polyline([],{color:"#ffff00"}).addTo(o.value));const t=e.filter(a=>a.snapshot!==void 0).map(a=>a.snapshot);Ae.value.setLatLngs(t)});const G=u(!1),w=u(null),Xe=u(),zt=ho([{item:"Set home waypoint",action:()=>ke("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Place Point of Interest",action:()=>ke("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>ke("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>ke("set-default-map-position"),icon:"mdi-map-check"}]),ee=u(),Ht=async()=>{var e;if(!(!o.value||!w.value))try{await m.setDefaultMapPosition(w.value,A.value),$({message:"Default map position set",variant:"success"});const t=v.marker(w.value,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(o.value),a=v.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(a).openTooltip();const i=t.getElement(),h=(e=t.getTooltip())==null?void 0:e.getElement();[i,h].forEach(p=>{p&&(p.style.transition="opacity 1s",p.style.opacity="1")}),setTimeout(()=>{[i,h].forEach(p=>{p&&(p.style.opacity="0")}),setTimeout(()=>{var p;(p=o.value)==null||p.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),$({message:"Failed to set default map position",variant:"error"})}},Bt=async()=>{if(!w.value||!o.value)return;ee.value&&(o.value.removeLayer(ee.value),ee.value=void 0),ee.value=v.marker(w.value,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(o.value);const e=v.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(ee.value.bindTooltip(e),w.value){const p=n.coordinates.altitude??0,L=w.value[0],Z=w.value[1];try{await n.goTo(0,0,0,0,L,Z,p)}catch(j){$({message:`GoTo request failed: ${j.message}`,variant:"error"})}}},ke=async e=>{switch(e){case"goto":{Bt();break}case"set-default-map-position":Ht();break;case"place-poi":w.value&&Q.value?Q.value.openDialog(w.value):w.value?Q.value||($({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):($({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":w.value&&De(w.value);break;default:console.warn("Unknown menu option selected:",e)}G.value=!1},we=()=>{G.value=!1,o.value!==void 0&&Xe.value!==void 0&&o.value.removeLayer(Xe.value)},et=e=>{e.key==="Escape"&&we()},Pe=e=>{e.forEach((t,a)=>{a===0?(x.value=t.coordinates,De(t.coordinates)):ie.value.push(t)})},Ce=u(!1),tt=u(0),ot=async()=>{Ce.value=!0,Ke();const e=async t=>{tt.value=t};try{const t=await n.fetchMission(e);Pe(t),$({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){ae({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{Ce.value=!1}},De=async e=>{const t=[e[0],e[1]];x.value=t,await n.setHomeWaypoint(t,0),G.value&&(G.value=!1)},at=async()=>{try{await n.startMission()}catch{$({message:"Failed to start mission.",variant:"error"})}},Gt=async()=>{if(m.showChecklistBeforeArm){l.value=!0;return}at()},ue=yo(),Nt=I(()=>`${Math.max(-ue.widgetClearanceForVisibleArea(b.value).bottom,0)}px`),lt=I(()=>`${Math.max(-ue.widgetClearanceForVisibleArea(b.value).top,0)}px`),Ut=I(()=>n.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),Rt=I(()=>n.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),Wt=I(()=>x.value===void 0?"Cannot center map on home (home position undefined).":X.value===M.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),Zt=I(()=>n.isVehicleOnline?E.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":X.value===M.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),it=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),st=e=>{if(!o.value||!o.value.getContainer())return;const t=v.divIcon(it(e)),a=v.marker(e.coordinates,{icon:t,draggable:!0}).addTo(o.value),i=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,h={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};a.bindTooltip(i,h),a.on("drag",p=>{var j;const L=p.target.getLatLng(),Z=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${L.lat.toFixed(8)}, Lng: ${L.lng.toFixed(8)}
    `;(j=a.getTooltip())==null||j.setContent(Z)}),a.on("dragend",p=>{const L=p.target.getLatLng();m.movePointOfInterest(e.id,[L.lat,L.lng])}),a.on("click",p=>{if(v.DomEvent.stopPropagation(p),Q.value){const L=m.pointsOfInterest.find(Z=>Z.id===e.id);L?Q.value.openDialog(void 0,L):console.warn("POI not found in store:",e.id)}}),_.value[e.id]=a},nt=e=>{var i;if(!o.value||!o.value.getContainer()||!_.value[e.id])return;const t=_.value[e.id];t.setLatLng(e.coordinates),t.setIcon(v.divIcon(it(e)));const a=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(i=t.getTooltip())==null||i.setContent(a)},jt=e=>{!o.value||!_.value[e]||(_.value[e].remove(),delete _.value[e])};return g(()=>m.pointsOfInterest,async e=>{if((!o.value||!o.value.getContainer())&&(await Se(),!o.value||!o.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(a=>a.id));Object.keys(_.value).forEach(a=>{t.has(a)||jt(a)}),e.forEach(a=>{_.value[a.id]?nt(a):st(a)})},{deep:!0,immediate:!0}),g(o,e=>{e&&e.getContainer()&&m.pointsOfInterest.forEach(t=>{_.value[t.id]?nt(t):st(t)})},{immediate:!0}),(e,t)=>{const a=bo("contextmenu");return C(),R(Tt,null,[ft((C(),R("div",{ref_key:"mapBase",ref:J,class:ze(["page-base",s(ue).editingMode?"pointer-events-none":"pointer-events-auto"])},[Y("div",{id:le.value,ref_key:"map",ref:o,class:"map"},[r(ko,{modelValue:K.value,"onUpdate:modelValue":t[0]||(t[0]=i=>K.value=i),"close-on-content-click":!1,location:"top end"},{activator:c(({props:i})=>[ft(r(F,de(i,{class:"absolute right-[209px] m-3 bottom-button bg-slate-50 text-[14px]",elevation:"2",size:"x-small",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download-multiple"}),null,16),[[xo,O.value]])]),default:c(()=>[r(Mt,{style:oe(s(T).globalGlassMenuStyles),class:"py-0 min-w-[220px] rounded-lg border-[1px]"},{default:c(()=>[r(Ve,{class:"py-0",title:"Save visible Esri tiles",onClick:Et}),r(Be),r(Ve,{class:"py-0",title:"Save visible OSM tiles",onClick:It}),r(Be),r(Ve,{class:"py-0",title:"Save visible Seamarks tiles",onClick:Ot})]),_:1},8,["style"])]),_:1},8,["modelValue"]),r(Te,{location:"top",text:Wt.value},{activator:c(({props:i})=>[O.value?(C(),U(F,de({key:0},i,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",x.value?"":"active-events-on-disabled"],color:X.value==s(M).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!x.value,onClick:t[1]||(t[1]=te(h=>s(S).goToTarget(s(M).HOME,!0),["stop"])),onDblclick:t[2]||(t[2]=te(h=>s(S).follow(s(M).HOME),["stop"]))}),null,16,["class","color","disabled"])):N("",!0)]),_:1},8,["text"]),r(Te,{location:"top",text:Zt.value},{activator:c(({props:i})=>[O.value?(C(),U(F,de({key:0},i,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",E.value?"":"active-events-on-disabled"],color:X.value==s(M).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!E.value,onClick:t[3]||(t[3]=te(h=>s(S).goToTarget(s(M).VEHICLE,!0),["stop"])),onDblclick:t[4]||(t[4]=te(h=>s(S).follow(s(M).VEHICLE),["stop"]))}),null,16,["class","color","disabled"])):N("",!0)]),_:1},8,["text"]),r(Te,{location:"top",text:Ut.value},{activator:c(({props:i})=>[O.value?(C(),U(F,de({key:0},i,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",s(n).isVehicleOnline?"":"active-events-on-disabled"],disabled:!s(n).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:te(ot,["stop"])}),null,16,["class","disabled"])):N("",!0)]),_:1},8,["text"]),r(Te,{location:"top",text:Rt.value},{activator:c(({props:i})=>[O.value?(C(),U(F,de({key:0},i,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",s(n).isVehicleOnline?"":"active-events-on-disabled"],disabled:!s(n).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:te(Gt,["stop"])}),null,16,["class","disabled"])):N("",!0)]),_:1},8,["text"])],8,_o)],2)),[[a,Pt]]),r(wo,{ref_key:"contextMenuRef",ref:se,visible:G.value,width:"260px","menu-items":zt,onClose:we},null,8,["visible","menu-items"]),r(Vt,{modelValue:s(ue).widgetManagerVars(s(b).hash).configMenuOpen,"onUpdate:modelValue":t[7]||(t[7]=i=>s(ue).widgetManagerVars(s(b).hash).configMenuOpen=i),width:"auto"},{default:c(()=>[r(kt,{class:"pa-2",style:oe(s(T).globalGlassMenuStyles)},{default:c(()=>[r(wt,{class:"text-center"},{default:c(()=>t[9]||(t[9]=[z("Map widget settings")])),_:1,__:[9]}),r(Ct,null,{default:c(()=>[r(gt,{modelValue:s(b).options.showVehiclePath,"onUpdate:modelValue":t[5]||(t[5]=i=>s(b).options.showVehiclePath=i),class:"my-1",label:"Show vehicle path",color:s(b).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),r(gt,{modelValue:s(b).options.showCoordinateGrid,"onUpdate:modelValue":t[6]||(t[6]=i=>s(b).options.showCoordinateGrid=i),class:"my-1",label:"Show coordinate grid",color:s(b).options.showCoordinateGrid?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Ce.value?(C(),U(Co,{key:0,"model-value":tt.value,height:"10",absolute:"",bottom:"",color:"white",style:oe(`top: ${lt.value}`)},null,8,["model-value","style"])):N("",!0),Ce.value?(C(),R("p",{key:1,style:oe({top:lt.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):N("",!0),r(Mo,{ref_key:"poiManagerMapWidgetRef",ref:Q},null,512),r(Lo,{"model-value":l.value,onConfirmed:at,"onUpdate:modelValue":t[8]||(t[8]=i=>l.value=i)},null,8,["model-value"]),d.value?(C(),R("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:oe(s(T).globalGlassMenuStyles)},[Y("p",null,[t[10]||(t[10]=z(" Saving offline map content ")),me.value?(C(),R("span",$o,"("+He(me.value)+")",1)):N("",!0),z(":  "+He(P.value?Math.round(k.value/P.value*100):0)+"% ",1)])],4)):N("",!0)],64)}}}),Po=St(Fo,[["__scopeId","data-v-1b607a95"]]);export{Po as default};
