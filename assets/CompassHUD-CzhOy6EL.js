import{c as H,e as O,R as B,X as G,a8 as I,u as j,t as Z,r as m,ab as q,W as J,o as K,aU as Q,h as ee,w as C,aW as E,aY as ae,a_ as te,aX as oe,m as se,n as ne,p as P,q as l,E as r,Y as le,x as ie,z as s,Z as re,G as X,$ as ue,H as k,a$ as de,a6 as ce,F as he,aZ as fe,_ as ge}from"./index-CYBACqTC.js";import{w as V}from"./index-DxaGCbJO.js";import{g as pe}from"./index-CH_iu5NA.js";import{V as we,a as ve,b as me,c as Ce}from"./VExpansionPanels-MWK6ObTl.js";const Ve={class:"main"},Se=["width","height"],be=H({__name:"CompassHUD",props:{widget:{}},setup(D){const S=O(),A=B();G.registerUsage(I.heading);const _=j(),t=Z(D).widget,T=m([["#FFFFFF"],["#FF2D2D"],["#0ADB0ACC"]]),Y=e=>{switch(e){case-180:return"S";case-135:return"SW";case-90:return"W";case-45:return"NW";case 0:return"N";case 45:return"NE";case 90:return"E";case 135:return"SE";case 180:return"S";case 225:return"SW";case 270:return"W";case 315:return"NW";case 360:return"N";default:return`${e}°`}},c=q({yawLinesX:{}}),b=[];let x=-180;for(;x<181;)b.push(x),x+=3;J(()=>{Object.keys(t.value.options).length===0&&(t.value.options={showYawValue:!0,hudColor:T.value[0][0],useNegativeRange:!1})}),K(()=>{b.forEach(e=>c.yawLinesX[e]=M(e)),y()});const{width:z}=Q(),u=ee(()=>({width:t.value.size.width*z.value,height:64})),w=m(0);let W;C(_.attitude,e=>{Math.abs(E(e.yaw-(W||0)))>.1&&(W=e.yaw,w.value=E(_.attitude.yaw))});const M=e=>{let o=-(e-w.value||0);return o<-180?o+=360:o>180&&(o-=360),-o},h=m(),F=m(),y=()=>{if(h.value===void 0||h.value===null)return;if(F.value===void 0){console.debug("Canvas context undefined!"),F.value=h.value.getContext("2d");return}const e=F.value;ae(e);const a=.5*u.value.width,o=.5*u.value.height,N=12,d=16,f=10,n=2,U=7;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${N}px Arial`,e.fillStyle="white";for(const[i,R]of Object.entries(c.yawLinesX)){if(R<-90||R>90)continue;const $=2*a/Math.PI*Math.sin(fe(R)),v=a+$;if(e.beginPath(),e.moveTo(v,d+n+f+n),e.lineTo(v,o*2-N-n-U),e.lineWidth="1",Number(i)%15===0){e.lineWidth="2",e.lineTo(v,o*2-N-n);let p=Number(i);t.value.options.useNegativeRange||(p=p<0?p+360:p),e.fillText(Y(Number(p)),v,o*2-n)}e.stroke()}if(t.value.options.showYawValue){e.font=`bold ${d}px Arial`;let i=Number(w.value);t.value.options.useNegativeRange||(i=i<0?i+360:i),e.fillText(`${i.toFixed(1)}°`,a,d)}e.beginPath(),e.moveTo(a,d+n+f),e.lineTo(a-.5*f,n+d+n),e.lineTo(a+.5*f,n+d+n),e.lineTo(a,d+n+f),e.closePath(),e.fill(),e.globalCompositeOperation="source-in";const g=e.createLinearGradient(0,o,u.value.width,o);g.addColorStop(.18,V(t.value.options.hudColor).alpha(0).toRgbString()),g.addColorStop(.3,V(t.value.options.hudColor).alpha(1).toRgbString()),g.addColorStop(.7,V(t.value.options.hudColor).alpha(1).toRgbString()),g.addColorStop(.82,V(t.value.options.hudColor).alpha(0).toRgbString()),e.fillStyle=g,e.fillRect(0,0,u.value.width,o*2)};C(w,()=>{b.forEach(e=>{const a=M(e);Math.abs(c.yawLinesX[e]-a)>90?c.yawLinesX[e]=a:pe.to(c.yawLinesX,{duration:2.5,ease:"elastic.out(1.2, 0.5)",[e]:a})})}),C([c,u,t.value.options],()=>{S.isWidgetVisible(t.value)&&te(()=>y())});const L=oe(h);return C(L,(e,a)=>{e&&!a&&y()}),(e,a)=>(ne(),se(he,null,[P("div",Ve,[P("canvas",{ref_key:"canvasRef",ref:h,width:u.value.width,height:u.value.height},null,8,Se)]),l(ce,{modelValue:s(S).widgetManagerVars(s(t).hash).configMenuOpen,"onUpdate:modelValue":a[3]||(a[3]=o=>s(S).widgetManagerVars(s(t).hash).configMenuOpen=o),"min-width":"400","max-width":"35%"},{default:r(()=>[l(le,{class:"px-8 pb-6 pt-2",style:ie(s(A).globalGlassMenuStyles)},{default:r(()=>[l(re,{class:"text-center"},{default:r(()=>a[4]||(a[4]=[X("HUD Compass widget config")])),_:1,__:[4]}),l(ue,null,{default:r(()=>[l(k,{class:"ma-1",label:"Show yaw value",color:s(t).options.showYawValue?"white":void 0,"model-value":s(t).options.showYawValue,"hide-details":"",onChange:a[0]||(a[0]=o=>s(t).options.showYawValue=!s(t).options.showYawValue)},null,8,["color","model-value"]),l(k,{class:"ma-1",label:"Use -180/+180 range",color:s(t).options.useNegativeRange?"white":void 0,"model-value":s(t).options.useNegativeRange,"hide-details":"",onChange:a[1]||(a[1]=o=>s(t).options.useNegativeRange=!s(t).options.useNegativeRange)},null,8,["color","model-value"]),l(we,{theme:"dark"},{default:r(()=>[l(ve,{class:"bg-[#FFFFFF11] text-white mt-2"},{default:r(()=>[l(me,null,{default:r(()=>a[5]||(a[5]=[X("Color")])),_:1,__:[5]}),l(Ce,null,{default:r(()=>[l(de,{modelValue:s(t).options.hudColor,"onUpdate:modelValue":a[2]||(a[2]=o=>s(t).options.hudColor=o),theme:"dark",class:"ma-1 bg-[#FFFFFF11] text-white",swatches:T.value,width:"100%","show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),_e=ge(be,[["__scopeId","data-v-9cd4de19"]]);export{_e as default};
