import{c as We,e as Fe,R as Se,K as Ee,t as _e,r as v,h as $,aU as Be,w as Oe,W as $e,o as ze,O as Ae,m as g,n as r,p as u,s as K,v as V,a4 as j,q as a,E as i,G as w,a3 as X,a5 as se,aS as De,x as I,B as P,z as l,aD as Le,aE as U,b0 as N,V as q,P as Te,af as je,b1 as Ie,y as h,F as k,C as W,b2 as J,b3 as Y,b4 as ne,Y as oe,Z as ie,a1 as de,I as re,aK as Ue,b5 as Ne,a6 as Re,aw as Ge,a_ as He,b6 as Ke,b7 as Xe,_ as Pe}from"./index-CsLQdWni.js";const qe=["width","height"],Je={class:"flex flex-col justify-between h-full pa-2 cursor-pointer"},Ye={class:"flex justify-between w-full"},Ze={key:0},Qe={key:0},et={class:"flex"},tt={key:0,class:"flex rotate-[270deg] justify-center whitespace-nowrap"},lt={class:"flex justify-center h-full px-3 pt-2 gap-x-2"},at=["data-widget-hash"],st=["data-widget-hash"],nt={class:"flex flex-col justify-start items-start gap-x-4 mt-3 w-full"},ot={key:0,ref:"widgetTrashArea",class:"absolute w-32 h-32 -translate-x-32 -translate-y-32 bottom-[20%] left-1/3 bg-[#FF000055] z-[65] rounded-xl flex items-center justify-center hover:bg-slate-200/50 transition-all"},it={class:"relative flex justify-center items-center w-full h-full"},dt={class:"select-none"},rt={class:"flex w-full justify-center items-center mt-4"},ut=["value"],gt=We({__name:"CollapsibleContainer",props:{widget:{}},setup(ue){const o=Fe(),ge=Se(),{openSnackbar:F}=Ee(),b=ue,d=_e(b).widget,m=v(b.widget),z=v(new Map),Z=v(!1),Q=v("justify-center"),ve=v(!1),R=v(!1),S=v(b.widget.name),M=v(null),A=v(b.widget.options.leftColumnWidth||50),ee=v(!1),E=v(null),c=v(!1),C=v("right"),D=v([]),L=v(!1),_=v(""),fe=()=>{if(_.value){try{o.copyWidgetToView(m.value,_.value),F({variant:"success",message:"Widget cloned successfully."})}catch(s){F({variant:"error",message:s.message||"Error cloning widget."})}L.value=!1,_.value=""}},G=()=>{if(E.value){const s=E.value.getBoundingClientRect(),e=window.innerWidth;s.left+s.width/2<e/2?C.value="left":C.value="right"}},me=$(()=>C.value==="left"?c.value?"mdi-chevron-right":"mdi-chevron-left":c.value?"mdi-chevron-left":"mdi-chevron-right"),pe=()=>{S.value=b.widget.name,R.value=!0,He(()=>{M.value&&(M.value.focus(),M.value.select())})},te=()=>{R.value=!1,m.value&&S.value!==m.value.name&&(m.value.name=S.value)},ce=s=>{var t;const e=(t=s.target.files)==null?void 0:t[0];if(!e){F({variant:"error",message:"No file selected.",duration:3e3});return}const p=new FileReader;p.onload=n=>{var x;try{const f=JSON.parse((x=n.target)==null?void 0:x.result),O=m.value.hash;o.loadWidgetFromFile(O,f)}catch{F({variant:"error",message:"Invalid widget file format.",duration:3e3})}},p.readAsText(e)},B=v(!1),we=()=>{o.elementToShowOnDrawer=void 0,D.value=[]},T=s=>{if(ve.value=!1,s==="options")o.widgetManagerVars(m.value.hash).configMenuOpen=!0;else if(s==="save")he();else if(s==="load"){const e=document.createElement("input");e.type="file",e.accept=".widget",e.addEventListener("change",p=>{ce(p)}),e.click()}else s==="copy-to-view"&&(L.value=!0)},he=()=>{const s=new Blob([JSON.stringify(d.value)],{type:"application/json;charset=utf-8"}),e=`${d.value.name}.widget`;Ke(s,e)},be=s=>{if(!o.editingMode)return;const e=s.clientX,p=A.value;ee.value=!0;const t=x=>{if(!E.value)return;const f=E.value.offsetWidth,O=p+(x.clientX-e)/f*100;A.value=Math.max(10,Math.min(90,O))},n=()=>{ee.value=!1,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",n)},ye=$(()=>m.value.options.elementContainers.filter(s=>s.name.includes("left"))),xe=$(()=>m.value.options.elementContainers.filter(s=>s.name.includes("right"))),Ve=$(()=>Math.round(d.value.options.backgroundOpacity*255).toString(16)),ke=()=>{o.allowMovingAndResizing(m.value.hash,!0),window.addEventListener("mouseup",y),window.addEventListener("dragend",y)},y=()=>{G(),o.allowMovingAndResizing(m.value.hash,!1),window.removeEventListener("mouseup",y),window.removeEventListener("dragend",y)},le=(s,e)=>{const p=m.value.options.elementContainers.find(f=>f.name===e);if(!p)return;const t=p.elements.map(f=>f.hash),n=z.value.get(e)||[],x=t.find(f=>!n.includes(f));if(x){const f=p.elements.find(O=>O.hash===x);if(f&&s.pullMode==="clone"){f.hash=Xe(),o.miniWidgetManagerVars(f.hash).configMenuOpen=!0,z.value.set(e,t);return}o.showElementPropsDrawer(f.hash),z.value.set(e,t)}},{width:ae}=Be(),H=$(()=>({width:m.value.size.width*ae.value,height:m.value.size.height*ae.value})),Me=v(null);Oe(()=>o.editingMode,s=>{s===!0&&(y(),c.value=!1)});const Ce=()=>{try{const s=o.editWidgetByHash(b.widget.hash);s&&(m.value=s)}catch{F({variant:"warning",message:"Error reading widget file.",duration:1e3})}};return $e(()=>{b.widget.options.elementContainers.forEach(s=>{z.value.set(s.name,s.elements.map(e=>e.hash))})}),ze(()=>{G(),window.addEventListener("resize",G),Me.value=document.querySelector(".main"),Ce(),y()}),(s,e)=>{const p=Ae("FontAwesomeIcon");return r(),g(k,null,[u("div",{ref_key:"widgetBase",ref:E,class:h(["h-full rounded-lg overflow-hidden",[c.value?"w-[40px]":"w-full",c.value&&C.value==="left"?"ml-0 mr-auto":"",c.value&&C.value==="right"?"mr-0 ml-auto":""]]),width:H.value.width,height:H.value.height,style:I([l(ge).globalGlassMenuStyles,{backgroundColor:`${l(d).options.backgroundColor+Ve.value}`,backdropFilter:`blur(${l(d).options.backgroundBlur}px)`}])},[u("div",Je,[u("div",Ye,[a(X,{class:"cursor-grab opacity-40",onMousedown:ke,onMouseup:y},{default:i(()=>e[20]||(e[20]=[w(" mdi-drag ")])),_:1,__:[20]}),c.value?V("",!0):(r(),g("div",Ze,[R.value?(r(),g("div",Qe,[j(u("input",{ref_key:"nameInput",ref:M,"onUpdate:modelValue":e[0]||(e[0]=t=>S.value=t),class:"border-b border-gray-400",onBlur:te,onKeyup:De(te,["enter"])},null,544),[[se,S.value]])])):(r(),g("p",{key:1,class:"whitespace-nowrap overflow-hidden text-ellipsis",style:I({maxWidth:`${H.value.width*.8}px`}),onDblclick:pe},P(l(d).name),37))])),u("div",et,[l(o).editingMode?(r(),K(je,{key:0,theme:"dark"},{activator:i(({props:t})=>[a(q,Te({size:"20",icon:"mdi-dots-vertical",variant:"text"},t),null,16)]),default:i(()=>[a(Le,null,{default:i(()=>[a(U,{onClick:e[1]||(e[1]=t=>T("options"))},{default:i(()=>[a(N,null,{default:i(()=>e[21]||(e[21]=[w("Options")])),_:1,__:[21]})]),_:1}),a(U,{onClick:e[2]||(e[2]=t=>T("save"))},{default:i(()=>[a(N,null,{default:i(()=>e[22]||(e[22]=[w("Save")])),_:1,__:[22]})]),_:1}),a(U,{onClick:e[3]||(e[3]=t=>T("load"))},{default:i(()=>[a(N,null,{default:i(()=>e[23]||(e[23]=[w("Load")])),_:1,__:[23]})]),_:1}),a(U,{onClick:e[4]||(e[4]=t=>T("copy-to-view"))},{default:i(()=>[a(N,null,{default:i(()=>e[24]||(e[24]=[w("Clone to another view")])),_:1,__:[24]})]),_:1})]),_:1})]),_:1})):V("",!0)])]),c.value?(r(),g("div",tt,P(l(d).name),1)):V("",!0),j(u("div",lt,[u("div",{class:h(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[l(o).editingMode?"border-[1px]":"border-0"]]),style:I({width:l(d).options.columns>1?`${A.value}%`:"100%"})},[(r(!0),g(k,null,W(ye.value,t=>(r(),g("div",{key:t.name,class:"w-full h-full"},[a(l(Y),{modelValue:t.elements,"onUpdate:modelValue":n=>t.elements=n,disabled:!l(o).editingMode,animation:150,group:"generalGroup",class:h(["flex items-center w-full h-full gap-2 px-2",[Z.value?"flex-wrap":"",Q.value]]),onAdd:n=>le(n,t.name),onStart:e[5]||(e[5]=n=>B.value=!0),onEnd:e[6]||(e[6]=n=>B.value=!1)},{default:i(()=>[(r(!0),g(k,null,W(t.elements,n=>(r(),g("div",{key:n.hash,"data-widget-hash":n.hash,class:h(["rounded-md w-full",{"cursor-grab":l(o).editingMode,"bg-slate-400":l(o).miniWidgetManagerVars(n.hash).highlighted}])},[a(J,{"mini-widget":n},null,8,["mini-widget"])],10,at))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6),l(d).options.columns>1&&l(o).editingMode?(r(),g("div",{key:0,class:"cursor-col-resize w-1 bg-[#FFFFFF22] relative",onMousedown:be},e[25]||(e[25]=[u("div",{class:"absolute inset-y-0 -left-1 -right-1"},null,-1)]),32)):V("",!0),l(d).options.columns>1?(r(),g("div",{key:1,class:h(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[l(o).editingMode?"border-[1px]":"border-0"]]),style:I({width:`${100-A.value}%`})},[(r(!0),g(k,null,W(xe.value,t=>(r(),g("div",{key:t.name,class:"w-full h-full"},[a(l(Y),{modelValue:t.elements,"onUpdate:modelValue":n=>t.elements=n,disabled:!l(o).editingMode,animation:150,group:"generalGroup",class:h(["flex items-center w-full h-full gap-2 px-2",[Z.value?"flex-wrap":"",Q.value]]),onAdd:n=>le(n,t.name),onStart:e[7]||(e[7]=n=>B.value=!0),onEnd:e[8]||(e[8]=n=>B.value=!1)},{default:i(()=>[(r(!0),g(k,null,W(t.elements,n=>(r(),g("div",{key:n.hash,"data-widget-hash":n.hash,class:h(["rounded-md w-full",{"cursor-grab":l(o).editingMode,"bg-slate-400":l(o).miniWidgetManagerVars(n.hash).highlighted}])},[a(J,{"mini-widget":n},null,8,["mini-widget"])],10,st))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6)):V("",!0)],512),[[Ie,!c.value]]),e[26]||(e[26]=u("div",null,null,-1)),l(o).editingMode?V("",!0):(r(),K(q,{key:1,class:h(["fixed bottom-[2px]",C.value==="left"?"left-[2px]":"right-[2px]"]),icon:me.value,variant:"text",size:"36",onClick:e[9]||(e[9]=t=>c.value=!c.value)},null,8,["class","icon"]))])],14,qe),(r(),K(Ge,{to:"body"},[a(Re,{modelValue:l(o).widgetManagerVars(l(d).hash).configMenuOpen,"onUpdate:modelValue":e[19]||(e[19]=t=>l(o).widgetManagerVars(l(d).hash).configMenuOpen=t),persistent:""},{default:i(()=>[a(ne,{"is-visible":l(o).widgetManagerVars(l(d).hash).configMenuOpen},{default:i(()=>[a(oe,{class:"px-8 pb-6 pt-2 rounded-lg w-[400px] bg-transparent"},{default:i(()=>[a(ie,{class:"text-center -mt-1"},{default:i(()=>e[27]||(e[27]=[w("Custom Widget options")])),_:1,__:[27]}),a(q,{class:"absolute top-3 right-0 text-lg rounded-full",variant:"text",size:"small",onClick:e[10]||(e[10]=t=>l(o).widgetManagerVars(l(d).hash).configMenuOpen=!1)},{default:i(()=>[a(X,null,{default:i(()=>e[28]||(e[28]=[w("mdi-close")])),_:1,__:[28]})]),_:1}),u("div",nt,[e[29]||(e[29]=u("p",{class:"text-start"},"Name:",-1)),a(de,{ref_key:"nameInput",ref:M,modelValue:l(d).name,"onUpdate:modelValue":e[11]||(e[11]=t=>l(d).name=t),density:"compact",class:"w-3/4"},null,8,["modelValue"]),e[30]||(e[30]=u("p",{class:"text-start"},"Columns:",-1)),a(de,{ref_key:"nameInput",ref:M,modelValue:l(d).options.columns,"onUpdate:modelValue":e[12]||(e[12]=t=>l(d).options.columns=t),min:"1",max:"2",type:"number",density:"compact",class:"w-1/4"},null,8,["modelValue"]),e[31]||(e[31]=u("p",{class:"mt-1"},"Background color",-1)),j(u("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>l(d).options.backgroundColor=t),type:"color",class:"p-0 w-20 mr-4"},null,512),[[se,l(d).options.backgroundColor]]),e[32]||(e[32]=u("p",{class:"mt-3"},"Background opacity:",-1)),a(re,{modelValue:l(d).options.backgroundOpacity,"onUpdate:modelValue":e[14]||(e[14]=t=>l(d).options.backgroundOpacity=t),min:"0",max:"1",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"]),e[33]||(e[33]=u("p",{class:"mt-3"},"Background blur:",-1)),a(re,{modelValue:l(d).options.backgroundBlur,"onUpdate:modelValue":e[15]||(e[15]=t=>l(d).options.backgroundBlur=t),min:"0",max:"100",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"])])]),_:1})]),_:1},8,["is-visible"]),a(Ue,null,{default:i(()=>[B.value?(r(),g("div",ot,[u("div",it,[a(p,{icon:"fa-solid fa-trash",class:"absolute h-16 transition-all -translate-x-7 -translate-y-8 top-1/2 left-1/2 text-white"}),a(l(Y),{modelValue:D.value,"onUpdate:modelValue":e[16]||(e[16]=t=>D.value=t),animation:150,group:"generalGroup",class:"flex flex-wrap items-center justify-center w-full h-full gap-2",onAdd:we},{default:i(()=>[(r(!0),g(k,null,W(D.value,t=>(r(),g("div",{key:t.hash},[u("div",dt,[a(J,{"mini-widget":t},null,8,["mini-widget"])])]))),128))]),_:1},8,["modelValue"])])],512)):V("",!0)]),_:1}),a(ne,{"is-visible":L.value},{default:i(()=>[a(oe,{class:"px-3 pb-6 pt-2 rounded-lg w-auto bg-transparent z-40"},{default:i(()=>[a(ie,{class:"flex justify-around -mt-1 w-full px-0"},{default:i(()=>[e[35]||(e[35]=u("div",null,null,-1)),e[36]||(e[36]=u("p",{class:"mx-8"},"Clone widget to",-1)),a(X,{class:"cursor-pointer self-end",onClick:e[17]||(e[17]=t=>L.value=!1)},{default:i(()=>e[34]||(e[34]=[w("mdi-close")])),_:1,__:[34]})]),_:1,__:[35,36]}),u("div",rt,[j(u("select",{"onUpdate:modelValue":e[18]||(e[18]=t=>_.value=t),class:"bg-[#50505022] dark:bg-gray-800 dark:text-white w-[180px] p-2 border border-gray-300 dark:border-gray-600 rounded appearance-none",onChange:fe},[(r(!0),g(k,null,W(l(o).currentProfile.views,t=>(r(),g("option",{key:t.name,value:t.name,class:"bg-gray-800 dark:bg-gray-800 dark:text-white"},P(t.name),9,ut))),128))],544),[[Ne,_.value]])])]),_:1})]),_:1},8,["is-visible"])]),_:1},8,["modelValue"])]))],64)}}}),ft=Pe(gt,[["__scopeId","data-v-ec042de7"]]);export{ft as default};
