import{c as xe,y as ye,K as ke,aM as Ve,J as Me,r as v,k as E,aC as Ce,w as Fe,L as We,o as Se,D as Be,l as d,m as u,n as m,H as n,N as r,Q as M,ae as ee,G as N,as as te,aN as Ee,O as z,t as ae,q as a,s as y,I as R,a5 as _,a2 as Oe,aO as Ae,aP as G,aQ as H,aR as Le,aS as $e,v as w,F as C,p as O,aT as X,aU as K,V as ze,P as Ie,U as le,aA as se,aV as De,at as Te,al as Ue,aI as je,aW as Ne,aX as Re,_ as _e}from"./index-Cfe-5QXR.js";const Ge=["width","height"],He={class:"flex flex-col justify-between h-full pa-2 cursor-pointer"},Xe={class:"flex justify-between w-full"},Ke={key:0},Pe={key:0},Je={class:"flex"},qe={key:0,class:"flex rotate-[270deg] justify-center whitespace-nowrap"},Qe={class:"flex justify-center h-full px-3 pt-2 gap-x-2"},Ye=["data-widget-hash"],Ze=["data-widget-hash"],et={class:"flex flex-col justify-start items-start gap-x-4 mt-3 w-full"},tt={key:0,ref:"widgetTrashArea",class:"absolute w-32 h-32 -translate-x-32 -translate-y-32 bottom-[20%] left-1/3 bg-[#FF000055] z-[65] rounded-xl flex items-center justify-center hover:bg-slate-200/50 transition-all"},at={class:"relative flex justify-center items-center w-full h-full"},lt={class:"select-none"},st=xe({__name:"CustomWidgetBase",props:{widget:{}},setup(ne){const o=ye(),oe=ke(),{showSnackbar:I}=Ve(),h=ne,i=Me(h).widget,g=v(h.widget),A=v(new Map),P=v(!1),J=v("justify-center"),ie=v(!1),D=v(!1),F=v(h.widget.name),k=v(null),L=v(h.widget.options.leftColumnWidth||50),q=v(!1),W=v(null),c=v(!1),V=v("right"),$=v([]),T=()=>{if(W.value){const l=W.value.getBoundingClientRect(),e=window.innerWidth;l.left+l.width/2<e/2?V.value="left":V.value="right"}},de=E(()=>V.value==="left"?c.value?"mdi-chevron-right":"mdi-chevron-left":c.value?"mdi-chevron-left":"mdi-chevron-right"),re=()=>{F.value=h.widget.name,D.value=!0,je(()=>{k.value&&(k.value.focus(),k.value.select())})},Q=()=>{D.value=!1,g.value&&F.value!==g.value.name&&(g.value.name=F.value)},ue=l=>{var t;const e=(t=l.target.files)==null?void 0:t[0];if(!e){I({variant:"error",message:"No file selected.",duration:3e3});return}const p=new FileReader;p.onload=s=>{var x;try{const f=JSON.parse((x=s.target)==null?void 0:x.result),B=g.value.hash;o.loadWidgetFromFile(B,f)}catch{I({variant:"error",message:"Invalid widget file format.",duration:3e3})}},p.readAsText(e)},S=v(!1),me=()=>{o.elementToShowOnDrawer=void 0,$.value=[]},U=l=>{if(ie.value=!1,l==="options")o.widgetManagerVars(g.value.hash).configMenuOpen=!0;else if(l==="save")ve();else if(l==="load"){const e=document.createElement("input");e.type="file",e.accept=".widget",e.addEventListener("change",p=>{ue(p)}),e.click()}},ve=()=>{const l=new Blob([JSON.stringify(i.value)],{type:"application/json;charset=utf-8"}),e=`${i.value.name}.widget`;Ne(l,e)},fe=l=>{if(!o.editingMode)return;const e=l.clientX,p=L.value;q.value=!0;const t=x=>{if(!W.value)return;const f=W.value.offsetWidth,B=p+(x.clientX-e)/f*100;L.value=Math.max(10,Math.min(90,B))},s=()=>{q.value=!1,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",s)},ge=E(()=>g.value.options.elementContainers.filter(l=>l.name.includes("left"))),pe=E(()=>g.value.options.elementContainers.filter(l=>l.name.includes("right"))),ce=E(()=>Math.round(i.value.options.backgroundOpacity*255).toString(16)),we=()=>{o.allowMovingAndResizing(g.value.hash,!0),window.addEventListener("mouseup",b),window.addEventListener("dragend",b)},b=()=>{T(),o.allowMovingAndResizing(g.value.hash,!1),window.removeEventListener("mouseup",b),window.removeEventListener("dragend",b)},Y=(l,e)=>{const p=g.value.options.elementContainers.find(f=>f.name===e);if(!p)return;const t=p.elements.map(f=>f.hash),s=A.value.get(e)||[],x=t.find(f=>!s.includes(f));if(x){const f=p.elements.find(B=>B.hash===x);if(f&&l.pullMode==="clone"){f.hash=Re(),o.miniWidgetManagerVars(f.hash).configMenuOpen=!0,A.value.set(e,t);return}o.showElementPropsDrawer(f.hash),A.value.set(e,t)}},{width:Z}=Ce(),j=E(()=>({width:g.value.size.width*Z.value,height:g.value.size.height*Z.value})),he=v(null);Fe(()=>o.editingMode,l=>{l===!0&&(b(),c.value=!1)});const be=()=>{try{const l=o.editWidgetByHash(h.widget.hash);l&&(g.value=l)}catch{I({variant:"warning",message:"Error reading widget file.",duration:1e3})}};return We(()=>{h.widget.options.elementContainers.forEach(l=>{A.value.set(l.name,l.elements.map(e=>e.hash))})}),Se(()=>{T(),window.addEventListener("resize",T),he.value=document.querySelector(".main"),be(),b()}),(l,e)=>{const p=Be("FontAwesomeIcon");return d(),u(C,null,[m("div",{ref_key:"widgetBase",ref:W,class:w(["h-full rounded-lg overflow-hidden",[c.value?"w-[40px]":"w-full",c.value&&V.value==="left"?"ml-0 mr-auto":"",c.value&&V.value==="right"?"mr-0 ml-auto":""]]),width:j.value.width,height:j.value.height,style:z([a(oe).globalGlassMenuStyles,{backgroundColor:`${a(i).options.backgroundColor+ce.value}`,backdropFilter:`blur(${a(i).options.backgroundBlur}px)`}])},[m("div",He,[m("div",Xe,[n(ee,{class:"cursor-grab opacity-40",onMousedown:we,onMouseup:b},{default:r(()=>e[16]||(e[16]=[M(" mdi-drag ")])),_:1}),c.value?y("",!0):(d(),u("div",Ke,[D.value?(d(),u("div",Pe,[N(m("input",{ref_key:"nameInput",ref:k,"onUpdate:modelValue":e[0]||(e[0]=t=>F.value=t),class:"border-b border-gray-400",onBlur:Q,onKeyup:Ee(Q,["enter"])},null,544),[[te,F.value]])])):(d(),u("p",{key:1,class:"whitespace-nowrap overflow-hidden text-ellipsis",style:z({maxWidth:`${j.value.width*.8}px`}),onDblclick:re},ae(a(i).name),37))])),m("div",Je,[a(o).editingMode?(d(),R(Le,{key:0,theme:"dark"},{activator:r(({props:t})=>[n(_,Oe({size:"20",icon:"mdi-dots-vertical",variant:"text"},t),null,16)]),default:r(()=>[n(Ae,null,{default:r(()=>[n(G,{onClick:e[1]||(e[1]=t=>U("options"))},{default:r(()=>[n(H,null,{default:r(()=>e[17]||(e[17]=[M("Options")])),_:1})]),_:1}),n(G,{onClick:e[2]||(e[2]=t=>U("save"))},{default:r(()=>[n(H,null,{default:r(()=>e[18]||(e[18]=[M("Save")])),_:1})]),_:1}),n(G,{onClick:e[3]||(e[3]=t=>U("load"))},{default:r(()=>[n(H,null,{default:r(()=>e[19]||(e[19]=[M("Load")])),_:1})]),_:1})]),_:1})]),_:1})):y("",!0)])]),c.value?(d(),u("div",qe,ae(a(i).name),1)):y("",!0),N(m("div",Qe,[m("div",{class:w(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[a(o).editingMode?"border-[1px]":"border-0"]]),style:z({width:a(i).options.columns>1?`${L.value}%`:"100%"})},[(d(!0),u(C,null,O(ge.value,t=>(d(),u("div",{key:t.name,class:"w-full h-full"},[n(a(K),{modelValue:t.elements,"onUpdate:modelValue":s=>t.elements=s,disabled:!a(o).editingMode,animation:150,group:"generalGroup",class:w(["flex items-center w-full h-full gap-2 px-2",[P.value?"flex-wrap":"",J.value]]),onAdd:s=>Y(s,t.name),onStart:e[4]||(e[4]=s=>S.value=!0),onEnd:e[5]||(e[5]=s=>S.value=!1)},{default:r(()=>[(d(!0),u(C,null,O(t.elements,s=>(d(),u("div",{key:s.hash,"data-widget-hash":s.hash,class:w(["rounded-md w-full",{"cursor-grab":a(o).editingMode,"bg-slate-400":a(o).miniWidgetManagerVars(s.hash).highlighted}])},[n(X,{"mini-widget":s},null,8,["mini-widget"])],10,Ye))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6),a(i).options.columns>1&&a(o).editingMode?(d(),u("div",{key:0,class:"cursor-col-resize w-1 bg-[#FFFFFF22] relative",onMousedown:fe},e[20]||(e[20]=[m("div",{class:"absolute inset-y-0 -left-1 -right-1"},null,-1)]),32)):y("",!0),a(i).options.columns>1?(d(),u("div",{key:1,class:w(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[a(o).editingMode?"border-[1px]":"border-0"]]),style:z({width:`${100-L.value}%`})},[(d(!0),u(C,null,O(pe.value,t=>(d(),u("div",{key:t.name,class:"w-full h-full"},[n(a(K),{modelValue:t.elements,"onUpdate:modelValue":s=>t.elements=s,disabled:!a(o).editingMode,animation:150,group:"generalGroup",class:w(["flex items-center w-full h-full gap-2 px-2",[P.value?"flex-wrap":"",J.value]]),onAdd:s=>Y(s,t.name),onStart:e[6]||(e[6]=s=>S.value=!0),onEnd:e[7]||(e[7]=s=>S.value=!1)},{default:r(()=>[(d(!0),u(C,null,O(t.elements,s=>(d(),u("div",{key:s.hash,"data-widget-hash":s.hash,class:w(["rounded-md w-full",{"cursor-grab":a(o).editingMode,"bg-slate-400":a(o).miniWidgetManagerVars(s.hash).highlighted}])},[n(X,{"mini-widget":s},null,8,["mini-widget"])],10,Ze))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6)):y("",!0)],512),[[$e,!c.value]]),e[21]||(e[21]=m("div",null,null,-1)),a(o).editingMode?y("",!0):(d(),R(_,{key:1,class:w(["fixed bottom-[2px]",V.value==="left"?"left-[2px]":"right-[2px]"]),icon:de.value,variant:"text",size:"36",onClick:e[8]||(e[8]=t=>c.value=!c.value)},null,8,["class","icon"]))])],14,Ge),(d(),R(Ue,{to:"body"},[n(De,{"is-visible":a(o).widgetManagerVars(a(i).hash).configMenuOpen},{default:r(()=>[n(ze,{class:"px-8 pb-6 pt-2 rounded-lg w-[400px] bg-transparent"},{default:r(()=>[n(Ie,{class:"text-center -mt-1"},{default:r(()=>e[22]||(e[22]=[M("Custom Widget options")])),_:1}),n(_,{class:"absolute top-3 right-0 text-lg rounded-full",variant:"text",size:"small",onClick:e[9]||(e[9]=t=>a(o).widgetManagerVars(a(i).hash).configMenuOpen=!1)},{default:r(()=>[n(ee,null,{default:r(()=>e[23]||(e[23]=[M("mdi-close")])),_:1})]),_:1}),m("div",et,[e[24]||(e[24]=m("p",{class:"text-start"},"Name:",-1)),n(le,{ref_key:"nameInput",ref:k,modelValue:a(i).name,"onUpdate:modelValue":e[10]||(e[10]=t=>a(i).name=t),density:"compact",class:"w-3/4"},null,8,["modelValue"]),e[25]||(e[25]=m("p",{class:"text-start"},"Columns:",-1)),n(le,{ref_key:"nameInput",ref:k,modelValue:a(i).options.columns,"onUpdate:modelValue":e[11]||(e[11]=t=>a(i).options.columns=t),min:"1",max:"2",type:"number",density:"compact",class:"w-1/4"},null,8,["modelValue"]),e[26]||(e[26]=m("p",{class:"mt-1"},"Background color",-1)),N(m("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>a(i).options.backgroundColor=t),type:"color",class:"p-0 w-20 mr-4"},null,512),[[te,a(i).options.backgroundColor]]),e[27]||(e[27]=m("p",{class:"mt-3"},"Background opacity:",-1)),n(se,{modelValue:a(i).options.backgroundOpacity,"onUpdate:modelValue":e[13]||(e[13]=t=>a(i).options.backgroundOpacity=t),min:"0",max:"1",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"]),e[28]||(e[28]=m("p",{class:"mt-3"},"Background blur:",-1)),n(se,{modelValue:a(i).options.backgroundBlur,"onUpdate:modelValue":e[14]||(e[14]=t=>a(i).options.backgroundBlur=t),min:"0",max:"100",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"])])]),_:1})]),_:1},8,["is-visible"]),n(Te,null,{default:r(()=>[S.value?(d(),u("div",tt,[m("div",at,[n(p,{icon:"fa-solid fa-trash",class:"absolute h-16 transition-all -translate-x-7 -translate-y-8 top-1/2 left-1/2 text-white"}),n(a(K),{modelValue:$.value,"onUpdate:modelValue":e[15]||(e[15]=t=>$.value=t),animation:150,group:"generalGroup",class:"flex flex-wrap items-center justify-center w-full h-full gap-2",onAdd:me},{default:r(()=>[(d(!0),u(C,null,O($.value,t=>(d(),u("div",{key:t.hash},[m("div",lt,[n(X,{"mini-widget":t},null,8,["mini-widget"])])]))),128))]),_:1},8,["modelValue"])])],512)):y("",!0)]),_:1})]))],64)}}}),ot=_e(st,[["__scopeId","data-v-259b1d53"]]);export{ot as default};
