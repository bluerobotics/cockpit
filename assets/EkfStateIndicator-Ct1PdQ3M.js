import{c as A,K as L,r as h,a0 as E,k as g,o as U,h as N,a1 as $,l as u,m as n,H as c,O as l,V as D,N as b,v as G,R as H,s as y,n as s,a2 as Q,Q as _,a3 as W,F as k,q as K,x as V,t as v,a4 as j,a5 as S,a6 as m,a7 as J,I as x,a8 as X,a9 as w,_ as Y}from"./index-iLvGpVz9.js";const Z={class:"flex items-center"},ee={key:0,class:"text-center mb-3"},te={key:1,class:"text-center mb-3"},ae={class:"d-flex"},se={class:"bars-container"},oe={class:"ekf-bar-container"},ie={class:"ekf-bar"},re={class:"bar-value"},le={class:"bar-label"},ne={class:"flags-section"},ce={class:"flags-grid"},de={class:"flag-name"},ue=A({__name:"EkfStateIndicator",setup(_e){const B=L(),z=h(!1),p=h(new Map),i=h("loading"),d=E([{label:"Velocity",value:0},{label:"Position (Horiz)",value:0},{label:"Position (Vert)",value:0},{label:"Compass",value:0},{label:"Terrain",value:0}]),o=E({attitude:!1,velocity_horiz:!1,velocity_vert:!1,pos_horiz_rel:!1,pos_horiz_abs:!1,pos_vert_abs:!1,pos_vert_agl:!1,const_pos_mode:!1,pred_pos_horiz_rel:!1,pred_pos_horiz_abs:!1,uninitialized:!1,gps_glitching:!1}),T=a=>a<=.5?"bar-green":a<=.8?"bar-orange":"bar-red",C=(a,t)=>a==="gps_glitching"||a==="uninitialized"?t?"flag-error":"flag-good":t?"flag-good":"flag-error",R=(a,t)=>t?"mdi-checkbox-marked-circle":"mdi-close-thick",q=a=>({attitude:"EKF attitude estimate quality - indicates how well the system knows its orientation (roll, pitch, yaw)",velocity_horiz:"EKF horizontal velocity estimate quality - indicates confidence in horizontal speed measurements",velocity_vert:"EKF vertical velocity estimate quality - indicates confidence in vertical speed measurements",pos_horiz_rel:"EKF horizontal position (relative) estimate quality - confidence in relative positioning from starting point",pos_horiz_abs:"EKF horizontal position (absolute) estimate quality - confidence in GPS-based absolute positioning",pos_vert_abs:"EKF vertical position (absolute) estimate quality - confidence in altitude measurements",pos_vert_agl:"EKF vertical position (above ground) estimate quality - confidence in height above terrain",const_pos_mode:"EKF constant position mode - system assumes stationary position when other estimates are poor",pred_pos_horiz_rel:"EKF predicted horizontal position (relative) estimate quality - confidence in future relative position",pred_pos_horiz_abs:"EKF predicted horizontal position (absolute) estimate quality - confidence in future absolute position",uninitialized:"EKF initialization status - whether the Extended Kalman Filter has been properly initialized",gps_glitching:"GPS health status - whether the EKF detects problems with GPS input data"})[a]||"EKF status flag",P=g(()=>d.some(e=>e.value>.8)?"rgba(255, 51, 51, 0.7)":d.some(e=>e.value>.5&&e.value<=.8)?"rgba(251, 146, 60, 0.7)":"rgba(74, 222, 128, 0.7)"),I=g(()=>i.value==="loading"?"mdi-dots-horizontal":i.value==="error"?"mdi-alert-circle":d.some(e=>e.value>.8)||d.some(e=>e.value>.5&&e.value<=.8)?"mdi-alert":"mdi-check-bold"),O=g(()=>i.value==="loading"?"rgba(255, 255, 255, 0.1)":i.value==="error"?"rgba(255, 51, 51, 0.7)":P.value),M=()=>{const a=w("EKF_STATUS_REPORT/flags",e=>{typeof e=="number"&&(o.attitude=!!(e&1),o.velocity_horiz=!!(e&2),o.velocity_vert=!!(e&4),o.pos_horiz_rel=!!(e&8),o.pos_horiz_abs=!!(e&16),o.pos_vert_abs=!!(e&32),o.pos_vert_agl=!!(e&64),o.const_pos_mode=!!(e&128),o.pred_pos_horiz_rel=!!(e&256),o.pred_pos_horiz_abs=!!(e&512),o.uninitialized=!!(e&1024),o.gps_glitching=!!(e&32768),i.value="connected")});a&&p.value.set("EKF_STATUS_REPORT/flags",a),["velocity_variance","pos_horiz_variance","pos_vert_variance","compass_variance","terrain_alt_variance"].forEach((e,r)=>{const f=w(`EKF_STATUS_REPORT/${e}`,F=>{typeof F=="number"&&d[r]&&(d[r].value=Math.sqrt(F),i.value="connected")});f&&p.value.set(`EKF_STATUS_REPORT/${e}`,f)})};return U(()=>{M()}),N(()=>{p.value.forEach((a,t)=>{try{$(t,a)}catch(e){console.warn(`Failed to unregister listener for ${t}:`,e)}}),p.value.clear()}),(a,t)=>(n(),u("div",Z,[c(X,{modelValue:z.value,"onUpdate:modelValue":t[0]||(t[0]=e=>z.value=e),"close-on-content-click":!1,location:"end"},{activator:l(({props:e})=>[c(J,S(e,{size:"default",variant:"elevated",style:{backgroundColor:O.value},disabled:i.value==="error"}),{default:l(()=>[c(m,{class:"mr-2"},{default:l(()=>[_(v(I.value),1)]),_:1}),t[3]||(t[3]=_(" EKF ")),i.value==="loading"?(n(),x(m,{key:0,class:"ml-2 animate-spin"},{default:l(()=>t[1]||(t[1]=[_("mdi-loading")])),_:1,__:[1]})):y("",!0),i.value==="error"?(n(),x(m,{key:1,class:"ml-2"},{default:l(()=>t[2]||(t[2]=[_("mdi-connection")])),_:1,__:[2]})):y("",!0)]),_:2,__:[3]},1040,["style","disabled"])]),default:l(()=>[c(D,{"min-width":"420","min-height":"280",class:"rounded-lg",style:b(G(B).globalGlassMenuStyles)},{default:l(()=>[c(H,{class:"pa-3"},{default:l(()=>[i.value==="error"?(n(),u("div",ee,[c(Q,{type:"warning",density:"compact",class:"text-sm"},{default:l(()=>t[4]||(t[4]=[_(" No EKF data - Check vehicle connection ")])),_:1,__:[4]})])):i.value==="loading"?(n(),u("div",te,[c(W,{indeterminate:"",size:"20",width:"2",class:"mr-2"}),t[5]||(t[5]=s("span",{class:"text-sm text-white opacity-70"},"Waiting for EKF data...",-1))])):y("",!0),s("div",ae,[s("div",se,[(n(!0),u(k,null,K(d,(e,r)=>(n(),u("div",{key:r,class:"bar-wrapper"},[s("div",oe,[s("div",ie,[s("div",{class:V(["bar-fill",T(e.value)]),style:b({height:`${Math.min(e.value*100,100)}%`})},null,6),t[6]||(t[6]=s("div",{class:"threshold-line threshold-50"},null,-1)),t[7]||(t[7]=s("div",{class:"threshold-line threshold-80"},null,-1)),s("div",{class:"value-indicator",style:b({bottom:`${Math.min(e.value*100,100)}%`})},null,4)]),s("div",re,v(e.value.toFixed(1)),1)]),s("div",le,v(e.label),1)]))),128))]),s("div",ne,[s("div",ce,[(n(!0),u(k,null,K(o,(e,r)=>(n(),u("div",{key:r,class:"flag-item"},[c(j,{text:q(r),location:"left"},{activator:l(({props:f})=>[s("div",S({ref_for:!0},f,{class:"flag-content"}),[c(m,{icon:R(r,e),class:V([C(r,e),"mr-2"]),size:"small"},null,8,["icon","class"]),s("span",de,v(r),1)],16)]),_:2},1032,["text"])]))),128))])])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])]))}}),fe=Y(ue,[["__scopeId","data-v-8ca6465c"]]);export{fe as default};
