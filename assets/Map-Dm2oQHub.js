import{c as Je,bP as It,K as ha,bQ as ba,r as v,w as x,h as F,s as q,n as E,E as p,p as P,q as u,a1 as _e,J as ya,R as Gt,au as Rt,aB as xa,a_ as we,o as Nt,aC as H,Y as Bt,x as ie,z as n,Z as Ht,V as B,a3 as At,G as W,$ as Ut,aD as Wt,m as Q,F as qt,C as ka,aE as De,bL as wa,b0 as Ma,y as Ke,B as Qe,a0 as $t,v as U,aS as Ca,a2 as Xe,bG as Sa,a6 as Yt,_ as Zt,bF as Va,t as Ta,ak as Oa,u as La,bR as Ea,bS as N,l as Fa,X as _t,a8 as Dt,W as Ia,bT as Aa,bU as $e,bV as m,bW as $a,bX as _a,bY as $,aq as Da,aW as Pa,bZ as za,b_ as Ga,b$ as oe,c0 as Ra,c1 as Na,c2 as Ba,ab as Ha,e as Ua,bl as Wa,a4 as Pt,P as pe,b1 as qa,af as Ya,aJ as le,Q as ke,c3 as Za,H as zt,c4 as ja,c5 as Ka}from"./index-BLj2N6pH.js";const Qa=""+new URL("arducopter-top-view-DWT9mmA0.png",import.meta.url).href,Xa={class:"flex items-center gap-2 mb-6"},Ja={class:"flex items-center gap-2 mb-6"},eo={class:"flex items-center gap-2 mb-2"},to=Je({__name:"GlobalOriginDialog",props:It({vehicle:{},initialLatitude:{},initialLongitude:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:It(["origin-set"],["update:modelValue"]),setup(se,{emit:ne}){const{openSnackbar:k}=ha(),f=ba(se,"modelValue"),X=ne,T=se,i=v(T.initialLatitude),r=v(T.initialLongitude),G=v(0),a=v(!1);x(()=>[T.initialLatitude,T.initialLongitude],([S,M])=>{i.value=S,r.value=M});const w=F(()=>i.value!==null&&i.value!==void 0&&i.value>=-90&&i.value<=90&&r.value!==null&&r.value!==void 0&&r.value>=-180&&r.value<=180&&G.value!==null&&G.value!==void 0),O=()=>{f.value=!1},L=()=>{if(!(!w.value||a.value)){if(T.vehicle===void 0||T.vehicle.dateLastHeartbeat()===void 0||T.vehicle.dateLastHeartbeat()>new Date(Date.now()-5e3)){k({message:"Cannot set global origin. Vehicle does not appear to be online.",variant:"error"});return}a.value=!0;try{T.vehicle.setGlobalOrigin([i.value,r.value],G.value),k({message:"Global origin set successfully.",variant:"success"}),X("origin-set",i.value,r.value),O()}catch(S){k({message:`Failed to set global origin: ${S}`,variant:"error"})}finally{a.value=!1}}},J=F(()=>[{text:"Cancel",action:O,disabled:a.value},{text:a.value?"Saving...":"Save",disabled:!w.value||a.value,action:L,class:a.value?"opacity-70":""}]);return(S,M)=>(E(),q(ya,{"show-dialog":f.value,title:"Set Global Origin",variant:"text-only","max-width":"500px",actions:J.value,"onUpdate:showDialog":M[3]||(M[3]=g=>f.value=g)},{content:p(()=>[M[7]||(M[7]=P("p",{class:"text-sm mb-8 -mt-6 text-gray-300"}," This feature allows you to set the GNSS coordinates of the vehicle's local origin (0,0,0). This is useful when using local position units (such as indoor positioning systems or DVLs) where you want to define a corresponding global position. ",-1)),P("div",Xa,[u(_e,{modelValue:i.value,"onUpdate:modelValue":M[0]||(M[0]=g=>i.value=g),modelModifiers:{number:!0},label:"Latitude",type:"number",step:"0.000001",hint:"Latitude in degrees (-90 to 90)","persistent-hint":"",variant:"outlined",rules:[g=>g!=null||"Latitude is required",g=>g>=-90&&g<=90||"Latitude must be between -90 and 90"],class:"flex-1"},null,8,["modelValue","rules"]),M[4]||(M[4]=P("span",{class:"text-white text-lg font-medium mb-6 w-4"},"°",-1))]),P("div",Ja,[u(_e,{modelValue:r.value,"onUpdate:modelValue":M[1]||(M[1]=g=>r.value=g),modelModifiers:{number:!0},label:"Longitude",type:"number",step:"0.000001",hint:"Longitude in degrees (-180 to 180)","persistent-hint":"",variant:"outlined",rules:[g=>g!=null||"Longitude is required",g=>g>=-180&&g<=180||"Longitude must be between -180 and 180"],class:"flex-1"},null,8,["modelValue","rules"]),M[5]||(M[5]=P("span",{class:"text-white text-lg font-medium mb-6 w-4"},"°",-1))]),P("div",eo,[u(_e,{modelValue:G.value,"onUpdate:modelValue":M[2]||(M[2]=g=>G.value=g),modelModifiers:{number:!0},label:"Altitude",type:"number",step:"0.1",hint:"Altitude in meters (MSL)","persistent-hint":"",variant:"outlined",rules:[g=>g!=null||"Altitude is required"],class:"flex-1"},null,8,["modelValue","rules"]),M[6]||(M[6]=P("span",{class:"text-white text-lg font-medium mb-6 w-4"},"m",-1))])]),_:1},8,["show-dialog","actions"]))}}),ao={class:"flex justify-end"},oo={key:0,class:"fixed top-[80px] right-5"},lo={key:1,class:"flex w-full items-center"},io={class:"flex justify-between w-full py-1 px-2 pt-3"},so={class:"flex items-center"},no=Je({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(se,{emit:ne}){const k=Gt(),f=Rt(),X=se,T=ne,i=xa("cockpit-pre-arm-checklist",[]),r=v({}),G=v(""),a=v(null),w=v(!1),O=F(()=>X.modelValue),L=()=>{const C={};for(const s of i.value??[])C[s.id]=!1;r.value=C},J=F(()=>{if(!f.showChecklistBeforeArm)return!0;const C=i.value??[];return C.length>0&&C.every(s=>r.value[s.id]===!0)});x(()=>O.value,C=>{C?(L(),we(()=>{var s,h;return(h=(s=a.value)==null?void 0:s.focus)==null?void 0:h.call(s)})):(r.value={},w.value=!1)}),x(()=>i.value,C=>{if(!O.value)return;const s={...r.value},h={};for(const I of C??[])h[I.id]=!0,I.id in s||(s[I.id]=!1);for(const I of Object.keys(s)){const re=Number(I);h[re]||delete s[re]}r.value=s},{deep:!0});const S=async()=>{var h,I;const C=G.value.trim();if(!C)return;const s={id:Date.now(),text:C};i.value.push(s),O.value&&(r.value[s.id]=!1),G.value="",await we(),(I=(h=a.value)==null?void 0:h.focus)==null||I.call(h)},M=C=>{if(i.value=i.value.filter(s=>s.id!==C),C in r.value){const s={...r.value};delete s[C],r.value=s}},g=()=>{T("dismissed"),T("update:modelValue",!1)},Y=()=>{T("confirmed",!0),T("update:modelValue",!1)};return Nt(()=>{i.value.length===0&&(i.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),O.value&&L()}),x(()=>f.showChecklistBeforeArm,C=>{C||H({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(C,s)=>(E(),q(Yt,{modelValue:O.value,"onUpdate:modelValue":s[4]||(s[4]=h=>O.value=h),"max-width":"600",scrollable:"",persistent:""},{default:p(()=>[u(Bt,{style:ie(n(k).globalGlassMenuStyles),class:"rounded-lg"},{default:p(()=>[u(Ht,{class:"text-center relative pt-3"},{default:p(()=>[s[6]||(s[6]=P("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),u(B,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:g},{default:p(()=>[u(At,null,{default:p(()=>s[5]||(s[5]=[W("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),u(Ut,{class:"mt-[-10px]"},{default:p(()=>[u(Wt,{lines:"one",theme:"dark",class:"bg-transparent"},{default:p(()=>[(E(!0),Q(qt,null,ka(n(i),h=>(E(),q(De,{key:h.id,theme:"dark"},wa({prepend:p(()=>[u($t,{modelValue:r.value[h.id],"onUpdate:modelValue":I=>r.value[h.id]=I,class:"mt-0","hide-details":"",density:"compact",disabled:!n(f).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:p(()=>[u(Ma,{class:Ke([{"line-through opacity-60":r.value[h.id]},{"opacity-50":!n(f).showChecklistBeforeArm}])},{default:p(()=>[W(Qe(h.text),1)]),_:2},1032,["class"])]),_:2},[w.value&&n(i).length>1?{name:"append",fn:p(()=>[u(B,{icon:"",variant:"text",disabled:!n(f).showChecklistBeforeArm,onClick:I=>M(h.id)},{default:p(()=>[u(At,null,{default:p(()=>s[7]||(s[7]=[W("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),P("div",ao,[w.value?(E(),Q("div",lo,[w.value?(E(),q(_e,{key:0,ref_key:"newItemInput",ref:a,modelValue:G.value,"onUpdate:modelValue":s[1]||(s[1]=h=>G.value=h),disabled:!n(f).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:Ca(S,["enter"]),"onClick:appendInner":S},null,8,["modelValue","disabled"])):U("",!0),u(B,{"prepend-icon":"mdi-check",disabled:!n(f).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:s[2]||(s[2]=()=>{w.value=!1,S()})},{default:p(()=>s[9]||(s[9]=[W("Done")])),_:1,__:[9]},8,["disabled"])])):(E(),Q("div",oo,[u(B,{"prepend-icon":"mdi-format-list-checks",disabled:!n(f).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:s[0]||(s[0]=h=>w.value=!0)},{default:p(()=>s[8]||(s[8]=[W(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),u(Xe,{class:"flex center w-[80%]",inset:""}),u(Sa,null,{default:p(()=>[P("div",io,[u(B,{variant:"text",onClick:g},{default:p(()=>s[10]||(s[10]=[W("Cancel")])),_:1,__:[10]}),P("div",so,[u($t,{"model-value":!n(f).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":s[3]||(s[3]=h=>n(f).showChecklistBeforeArm=!h)},null,8,["model-value"]),s[11]||(s[11]=P("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),u(B,{color:"#ffffff33",class:Ke({"opacity-30":!J.value}),variant:"flat",disabled:!J.value,onClick:Y},{default:p(()=>s[12]||(s[12]=[W("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),ro=Zt(no,[["__scopeId","data-v-b0b8e43a"]]),uo=["id"],co={key:0},vo=Je({__name:"Map",props:{widget:{}},setup(se){var Et;Va(e=>({"3998c9bb":da.value}));const ne=se,k=Ta(ne).widget,f=Gt(),{showDialog:X,closeDialog:T}=Oa(),i=La(),r=Rt(),G=Ea(),a=N(),w=v(r.userLastMapZoom??r.defaultMapZoom),O=v(r.userLastMapCenter??r.defaultMapCenter),L=v(),J=F(()=>`map-${k.value.hash}`),S=F(()=>Ge.value||ue.value),M=v(!1),g=v([]),Y=N({}),C=v(),s=v(!1),h=v(!1),I=v(!1),re=v(!1),fe=v(0),ee=v(0),Me=v("");let Ce,Se,Ve;const ue=v(!1),ge=v([]),Te=N({}),jt=F(()=>({"--glass-background":f.globalGlassMenuStyles.backgroundColor,"--glass-filter":f.globalGlassMenuStyles.backdropFilter,"--glass-border":f.globalGlassMenuStyles.border,"--glass-color":f.globalGlassMenuStyles.color,"--glass-box-shadow":f.globalGlassMenuStyles.boxShadow})),Kt=()=>{Ce==null||Ce.click(),ue.value=!1},Qt=()=>{Se==null||Se.click(),ue.value=!1},Xt=()=>{Ve==null||Ve.click(),ue.value=!1};let et;const tt=e=>{e.touches.length>1&&(h.value=!0,j.value&&Fe(),clearTimeout(et))},at=e=>{e.touches.length<=1&&(et=window.setTimeout(()=>h.value=!1,300))},Pe=F(()=>{const e=new Set;return i.reachedMissionItemSequences.length&&i.reachedMissionItemSequences.forEach(t=>{const o=Te.value[t];o!==void 0&&e.add(o)}),e}),he=e=>e<=17?"xs":e>17&&e<=19?"sm":"md",ot=e=>e==="xs"?{iconSize:[6,6],iconAnchor:[3,3]}:e==="sm"?{iconSize:[12,12],iconAnchor:[6,6]}:{iconSize:[26,26],iconAnchor:[13,13]},lt=e=>{const t=e?"marker-icon marker-icon--reached":"marker-icon";return`
    <div class="${`wp-marker-${he(w.value)}`}">
      <div class="${t} waypoint-main-marker"></div>
    </div>
  `},it=(e,t)=>{const o=he(w.value),l=ot(o);return m.divIcon({html:lt(t),className:"waypoint-marker-icon",iconSize:l.iconSize,iconAnchor:l.iconAnchor})},st=e=>{const t=Y.value[e];if(!t)return;const o=Pe.value.has(e),l=he(w.value),c=ot(l);t.setIcon(m.divIcon({html:lt(o),className:"waypoint-marker-icon",iconSize:c.iconSize,iconAnchor:c.iconAnchor}));const d=t.getTooltip();if(d){l==="xs"||l==="sm"?d.setOpacity(0):d.setOpacity(1);const y=d.getElement();y&&(o?y.classList.add("waypoint-tooltip--reached"):y.classList.remove("waypoint-tooltip--reached"))}},nt=()=>{Object.keys(Y.value).forEach(e=>st(Number(e)))},ce=v(null),R=N({});_t.registerUsage(Dt.latitude),_t.registerUsage(Dt.longitude),Ia(()=>{Object.keys(k.value.options).length===0&&(k.value.options={showVehiclePath:!0,showCoordinateGrid:!1}),k.value.options.showCoordinateGrid===void 0&&(k.value.options.showCoordinateGrid=!1),_.enableAutoUpdate()});const ze=$e.tileLayerOffline("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),Oe=$e.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),Le=$e.tileLayerOffline("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),rt=m.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),ut={OpenStreetMap:ze,"Esri World Imagery":Oe},Jt={Seamarks:Le,"Marine Profile":rt},de=v(),Ge=Fa(de),ct=m.control.zoom({position:"bottomright"}),dt=m.control.layers(ut,Jt),be=N(void 0);x(S,()=>{a.value!==void 0&&(S.value?(a.value.addControl(ct),a.value.addControl(dt),mt()):(a.value.removeControl(ct),a.value.removeControl(dt),pt()))}),x(Ge,()=>{S.value=Ge.value}),x(()=>k.value.options.showCoordinateGrid,e=>{a.value!==void 0&&(e?Re():ta())});const ea=$a(()=>{r.saveLastMapPosition(w.value,O.value)},3e3,{maxWait:8e3});x([w,O],()=>{k.value.options.showCoordinateGrid&&a.value&&Re(),S.value&&a.value&&mt(),ea()}),x(()=>i.reachedMissionItemSequences,()=>{nt()},{deep:!0});const Re=()=>{if(a.value)try{be.value=_a(a.value,be.value)}catch(e){console.error("Failed to create grid overlay:",e)}},ta=()=>{be.value&&a.value&&(a.value.removeLayer(be.value),be.value=void 0)},vt=m.control.scale({position:"bottomright",metric:!0,imperial:!1,maxWidth:100}),mt=()=>{a.value&&(pt(),vt.addTo(a.value))},pt=()=>{if(a.value)try{a.value.removeControl(vt)}catch{}};Nt(async()=>{var Ae,Ft;Y.value={},ge.value=[],Te.value={},i.clearReachedMissionItems(),(Ae=de.value)==null||Ae.addEventListener("touchstart",tt,{passive:!0}),(Ft=de.value)==null||Ft.addEventListener("touchend",at,{passive:!0});const e=ut[r.userLastMapTileProvider]||Oe;a.value=m.map(J.value,{layers:[e,Le,rt],attributionControl:!1}).setView(O.value,w.value),a.value.on("baselayerchange",b=>{const A=b.name;A.includes(A)&&(r.userLastMapTileProvider=b.name)}),a.value.removeControl(a.value.zoomControl),a.value.on("click",b=>{V.value=[b.latlng.lat,b.latlng.lng]}),a.value.on("moveend",()=>{if(a.value===void 0)return;let{lat:b,lng:A}=a.value.getCenter();b&&A&&(O.value=[b,A])});const t=Ne(Oe,"Esri",19),o=Ne(ze,"OSM",19),l=Ne(Le,"Seamarks",18);a.value&&(t.addTo(a.value),o.addTo(a.value),l.addTo(a.value));const c=b=>{var ae;const A=((ae=b.getContainer)==null?void 0:ae.call(b))??b._container;A&&(A.classList.add("hidden-savetiles"),A.style.display="none")};c(t),c(o),c(l),await we();const d=b=>{var ae;const A=((ae=b.getContainer)==null?void 0:ae.call(b))??b._container;return Array.from((A==null?void 0:A.querySelectorAll("a"))??[])},[y]=d(t),[D]=d(o),[K]=d(l);Ce=y,Se=D,Ve=K,Be(Oe,"Esri"),Be(ze,"OSM"),Be(Le,"Seamarks"),a.value.on("dragstart",()=>{s.value=!0}),a.value.on("dragend",()=>{setTimeout(()=>s.value=!1,200)}),a.value.on("zoomend",()=>{var b;j.value=!1,a.value!==void 0&&(w.value=((b=a.value)==null?void 0:b.getZoom())??O.value)}),a.value.whenReady(()=>{we(()=>{Object.entries(Y.value).forEach(([b,A])=>{const ae=Pe.value.has(Number(b));A.setIcon(it(Number(b),ae))})})}),a.value.on("contextmenu",b=>{V.value=[b.latlng.lat,b.latlng.lng]}),_.enableAutoUpdate(),window.addEventListener("keydown",kt),z.value?_.goToTarget($.VEHICLE):_.goToTarget($.HOME),!i.isVehicleOnline&&r.vehicleMission.length&&Ze(r.vehicleMission),k.value.options.showCoordinateGrid&&Re(),M.value=!0,r.followVehicleOnMap===!0?_.follow($.VEHICLE):_.unFollow(),await He()});const aa=e=>(t,o)=>{X({variant:"info",message:`Save ${t._tilesforSave.length} ${e} tiles for offline use?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:T},{text:"Save tiles",color:"white",action:()=>{o(),T()}}]})},oa=e=>(t,o)=>{X({variant:"warning",message:`Remove all saved ${e} tiles for this layer?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:T},{text:"Remove tiles",color:"white",action:()=>{o(),T(),H({message:`${e} offline tiles removed`,variant:"info",duration:3e3})}}]})},Ne=(e,t,o)=>$e.savetiles(e,{saveWhatYouSee:!0,maxZoom:o,alwaysDownload:!1,position:"topright",parallel:20,confirm:aa(t),confirmRemoval:oa(t),saveText:`<i class="mdi mdi-download" title="Save ${t} tiles"></i>`,rmText:`<i class="mdi mdi-trash-can" title="Remove ${t} tiles"></i>`}),Be=(e,t)=>{e.on("savestart",o=>{var l;fe.value=0,ee.value=((l=o==null?void 0:o._tilesforSave)==null?void 0:l.length)??0,Me.value=t,re.value=!0,H({message:`Saving ${ee.value} ${t} tiles...`,variant:"info",duration:2e3})}),e.on("loadtileend",()=>{fe.value+=1,ee.value>0&&fe.value>=ee.value&&(H({message:`${t} offline tiles saved!`,variant:"success",duration:3e3}),re.value=!1,Me.value="",fe.value=0,ee.value=0)})},la={open:e=>{if(!a.value||h.value||s.value)return;e.preventDefault(),e.stopPropagation();const t=a.value.mouseEventToContainerPoint(e),o=a.value.containerPointToLatLng(t);V.value=[o.lat,o.lng],C.value.openAt(e),j.value=!0},close:()=>{Fe()}},ft=()=>{var t;const e=new Set(Object.values(R.value));(t=a.value)==null||t.eachLayer(o=>{if(o instanceof m.Marker||o instanceof m.Polyline&&o.options.color==="#358AC3"){if(e.has(o))return;a.value.removeLayer(o)}}),g.value=[],Ee.value=void 0,te.value=void 0,me.value=void 0,Z.value=void 0,Y.value={},ge.value=[],Te.value={}},He=async()=>{M.value&&(ft(),i.isVehicleOnline?await Ct():r.vehicleMission.length&&(Mt(r.vehicleMission),Ze(r.vehicleMission)))};x(()=>i.isVehicleOnline,()=>{He()}),x(()=>r.vehicleMissionRevision,()=>{He()}),Da(()=>{var e,t;_.disableAutoUpdate(),window.removeEventListener("keydown",kt),a.value&&(a.value.off("contextmenu"),Object.values(R.value).forEach(o=>o.remove()),R.value={}),(e=de.value)==null||e.removeEventListener("touchstart",tt),(t=de.value)==null||t.removeEventListener("touchend",at)}),x(O,(e,t)=>{var o;e.toString()!==t.toString()&&((o=a.value)==null||o.panTo(e))}),x(a,(e,t)=>{a.value!==void 0&&(e==null?void 0:e.options)===void 0&&(a.value=t)}),x(w,(e,t)=>{var o;e!==t&&(j.value=!1,(o=a.value)==null||o.setZoom(w.value))}),x(w,()=>{a.value&&nt()}),x(ne.widget,()=>{var e;(e=a.value)==null||e.invalidateSize()});const ve=v(void 0),_=new Aa(e=>ve.value=e,e=>O.value=e);_.setTrackableTarget($.VEHICLE,()=>z.value),_.setTrackableTarget($.HOME,()=>L.value);const z=F(()=>i.coordinates.latitude?[i.coordinates.latitude,i.coordinates.longitude]:void 0),Ue=F(()=>{var e;return i.attitude.yaw?Pa((e=i.attitude)==null?void 0:e.yaw):0}),gt=F(()=>{const e=i.lastHeartbeat;return e?`${za(e??0,{includeSeconds:!0})} ago`:"never"}),{history:ia}=Ga(z);(Et=navigator==null?void 0:navigator.geolocation)==null||Et.watchPosition(e=>{L.value||(L.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let ht=!0;x([L,a],async()=>{L.value===O.value||!a.value||!ht||(_.goToTarget($.HOME),ht=!1)});const Z=N();x(i.coordinates,()=>{if(!(!a.value||!z.value)){if(Z.value===void 0){let e=Ra;i.vehicleType===oe.MAV_TYPE_SURFACE_BOAT?e=Na:i.vehicleType===oe.MAV_TYPE_SUBMARINE?e=Ba:[oe.MAV_TYPE_QUADROTOR,oe.MAV_TYPE_HEXAROTOR,oe.MAV_TYPE_OCTOROTOR,oe.MAV_TYPE_TRICOPTER,oe.MAV_TYPE_DODECAROTOR].includes(i.vehicleType)&&(e=Qa);const t=m.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});Z.value=m.marker(z.value,{icon:t});const o=m.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});Z.value.bindTooltip(o),a.value.addLayer(Z.value)}Z.value.setLatLng(z.value)}}),x(ve,e=>{e===$.VEHICLE?r.followVehicleOnMap=!0:r.followVehicleOnMap=!1}),x([z,Ue,gt,()=>i.isArmed],()=>{var t,o,l,c,d;if(Z.value===void 0)return;(c=Z.value.getTooltip())==null||c.setContent(`
    <p>Coordinates: ${(t=z.value)==null?void 0:t[0].toFixed(6)}, ${(o=z.value)==null?void 0:o[1].toFixed(6)}</p>
    <p>Velocity: ${((l=i.velocity.ground)==null?void 0:l.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${Ue.value.toFixed(2)}°</p>
    <p>${i.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${gt.value}</p>
  `);const e=(d=Z.value.getElement())==null?void 0:d.querySelector("img");e&&(e.style.transform=`rotate(${Ue.value}deg)`)});const te=N();x(L,()=>{if(a.value===void 0)return;const e=L.value;if(e!==void 0)if(te.value)te.value.setLatLng(e);else{te.value=m.marker(e,{icon:m.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=m.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});te.value.bindTooltip(t),te.value.on("dragend",o=>{const c=o.target.getLatLng();je([c.lat,c.lng])}),a.value.addLayer(te.value)}});const Ee=N();x(g,e=>{a.value&&(Ee.value||(Ee.value=m.polyline([],{color:"#358AC3"}).addTo(a.value)),Ee.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,o)=>{var d;const l=o+1;let c=Y.value[l];if(c){c.setLatLng(t.coordinates);const y=he(w.value),D=c.getTooltip();D&&(y==="xs"||y==="sm"?D.setOpacity(0):(D.setContent(l.toString()),D.setOpacity(1))),st(l)}else{const y=Pe.value.has(l),D=it(l,y);c=m.marker(t.coordinates,{icon:D}),Y.value[l]=c;const K=he(w.value),Ae=m.tooltip({content:l.toString(),permanent:!0,direction:"center",className:y?"waypoint-tooltip waypoint-tooltip--reached":"waypoint-tooltip",opacity:K==="md"?1:0});c.bindTooltip(Ae),(d=a.value)==null||d.addLayer(c)}}))},{deep:!0});const We=N();x(ia,e=>{if(a.value===void 0||e===void 0)return;We.value===void 0&&(We.value=m.polyline([],{color:"#ffff00"}).addTo(a.value));const t=e.filter(o=>o.snapshot!==void 0).map(o=>o.snapshot);We.value.setLatLngs(t)});const j=v(!1),V=v(null),bt=N(),qe=v(!1),yt=v(0),xt=v(0),Ye=N(),sa=Ha([{item:"Set home waypoint",action:()=>ye("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Set Global Origin",action:()=>ye("set-global-origin"),icon:"mdi-crosshairs-question"},{item:"Place Point of Interest",action:()=>ye("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>ye("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>ye("set-default-map-position"),icon:"mdi-map-check"}]),me=N(),na=async()=>{var e;if(!(!a.value||!V.value))try{await r.setDefaultMapPosition(V.value,w.value),H({message:"Default map position set",variant:"success"});const t=m.marker(V.value,{icon:m.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value),o=m.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(o).openTooltip();const l=t.getElement(),c=(e=t.getTooltip())==null?void 0:e.getElement();[l,c].forEach(d=>{d&&(d.style.transition="opacity 1s",d.style.opacity="1")}),setTimeout(()=>{[l,c].forEach(d=>{d&&(d.style.opacity="0")}),setTimeout(()=>{var d;(d=a.value)==null||d.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),H({message:"Failed to set default map position",variant:"error"})}},ra=async()=>{if(!V.value||!a.value)return;me.value&&(a.value.removeLayer(me.value),me.value=void 0),me.value=m.marker(V.value,{icon:m.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value);const e=m.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(me.value.bindTooltip(e),V.value){const d=i.coordinates.altitude??0,y=V.value[0],D=V.value[1];try{await i.goTo(0,0,0,0,y,D,d)}catch(K){H({message:`GoTo request failed: ${K.message}`,variant:"error"})}}},ye=async e=>{switch(e){case"goto":{ra();break}case"set-default-map-position":na();break;case"place-poi":V.value&&ce.value?ce.value.openDialog(V.value):V.value?ce.value||(H({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):(H({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":V.value&&je(V.value);break;case"set-global-origin":V.value&&(yt.value=V.value[0],xt.value=V.value[1],qe.value=!0);break;default:console.warn("Unknown menu option selected:",e)}j.value=!1},Fe=()=>{j.value=!1,a.value!==void 0&&bt.value!==void 0&&a.value.removeLayer(bt.value)},ua=(e,t)=>{if(!a.value)return;Ye.value&&a.value.removeLayer(Ye.value);const o=m.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),l=m.marker([e,t],{icon:o}).addTo(a.value),c=m.tooltip({content:'<i class="mdi mdi-axis-arrow text-[18px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});l.bindTooltip(c),Ye.value=l},kt=e=>{e.key==="Escape"&&Fe()},Ze=e=>{e.forEach((t,o)=>{o===0?(L.value=t.coordinates,je(t.coordinates)):g.value.push(t)})},Ie=v(!1),wt=v(0),Mt=e=>{const t={};let o=0;e.forEach((l,c)=>{const d=c===0?void 0:c;l.commands.forEach(y=>{y.type!=="MAVLINK_NAV_COMMAND"&&y.type!=="MAVLINK_NON_NAV_COMMAND"||(d!==void 0&&(t[o]=d),o+=1)})}),Te.value=t},Ct=async()=>{Ie.value=!0,ft();const e=async t=>{wt.value=t};try{ge.value=await i.fetchMission(e),Mt(ge.value),Ze(ge.value),H({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){X({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{Ie.value=!1}},je=async e=>{const t=[e[0],e[1]];L.value=t,await i.setHomeWaypoint(t,0),j.value&&(j.value=!1)},St=async()=>{try{await i.startMission()}catch{H({message:"Failed to start mission.",variant:"error"})}},ca=async()=>{if(r.showChecklistBeforeArm){I.value=!0;return}St()},xe=Ua(),da=F(()=>`${Math.max(-xe.widgetClearanceForVisibleArea(k.value).bottom,0)}px`),Vt=F(()=>`${Math.max(-xe.widgetClearanceForVisibleArea(k.value).top,0)}px`),va=F(()=>i.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),ma=F(()=>i.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),pa=F(()=>L.value===void 0?"Cannot center map on home (home position undefined).":ve.value===$.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),fa=F(()=>i.isVehicleOnline?z.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":ve.value===$.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),Tt=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),Ot=e=>{if(!a.value||!a.value.getContainer())return;const t=m.divIcon(Tt(e)),o=m.marker(e.coordinates,{icon:t,draggable:!0}).addTo(a.value),l=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,c={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};o.bindTooltip(l,c),o.on("drag",d=>{var K;const y=d.target.getLatLng(),D=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${y.lat.toFixed(8)}, Lng: ${y.lng.toFixed(8)}
    `;(K=o.getTooltip())==null||K.setContent(D)}),o.on("dragend",d=>{const y=d.target.getLatLng();r.movePointOfInterest(e.id,[y.lat,y.lng])}),o.on("click",d=>{if(m.DomEvent.stopPropagation(d),ce.value){const y=r.pointsOfInterest.find(D=>D.id===e.id);y?ce.value.openDialog(void 0,y):console.warn("POI not found in store:",e.id)}}),R.value[e.id]=o},Lt=e=>{var l;if(!a.value||!a.value.getContainer()||!R.value[e.id])return;const t=R.value[e.id];t.setLatLng(e.coordinates),t.setIcon(m.divIcon(Tt(e)));const o=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(l=t.getTooltip())==null||l.setContent(o)},ga=e=>{!a.value||!R.value[e]||(R.value[e].remove(),delete R.value[e])};return x(()=>r.pointsOfInterest,async e=>{if((!a.value||!a.value.getContainer())&&(await we(),!a.value||!a.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(o=>o.id));Object.keys(R.value).forEach(o=>{t.has(o)||ga(o)}),e.forEach(o=>{R.value[o.id]?Lt(o):Ot(o)})},{deep:!0,immediate:!0}),x(a,e=>{e&&e.getContainer()&&r.pointsOfInterest.forEach(t=>{R.value[t.id]?Lt(t):Ot(t)})},{immediate:!0}),(e,t)=>{const o=Wa("contextmenu");return E(),Q(qt,null,[Pt((E(),Q("div",{ref_key:"mapBase",ref:de,class:Ke(["page-base",n(xe).editingMode?"pointer-events-none":"pointer-events-auto"]),style:ie(jt.value)},[P("div",{id:J.value,ref_key:"map",ref:a,class:"map"},[u(Ya,{modelValue:ue.value,"onUpdate:modelValue":t[0]||(t[0]=l=>ue.value=l),"close-on-content-click":!1,location:"top end"},{activator:p(({props:l})=>[Pt(u(B,pe({style:n(f).globalGlassMenuStyles},l,{class:"absolute right-[209px] m-3 bottom-button bg-slate-50 text-[14px]",elevation:"2",size:"x-small",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download-multiple"}),null,16,["style"]),[[qa,S.value]])]),default:p(()=>[u(Wt,{style:ie(n(f).globalGlassMenuStyles),class:"py-0 min-w-[220px] rounded-lg border-[1px]"},{default:p(()=>[u(De,{class:"py-0",title:"Save visible Esri tiles",onClick:Kt}),u(Xe),u(De,{class:"py-0",title:"Save visible OSM tiles",onClick:Qt}),u(Xe),u(De,{class:"py-0",title:"Save visible Seamarks tiles",onClick:Xt})]),_:1},8,["style"])]),_:1},8,["modelValue"]),u(ke,{location:"top",text:"Switch to Mission Planning mode"},{activator:p(({props:l})=>[S.value?(E(),q(B,pe({key:0},l,{class:"absolute right-[265px] w-[140px] mb-[14px] bottom-button bg-slate-50 text-[12px] font-bold",elevation:"4",text:"Edit mission","append-icon":"mdi-map-marker-radius-outline",style:[{"z-index":"1002","border-radius":"0px"},n(f).globalGlassMenuStyles],"hide-details":"",size:"small",onClick:t[1]||(t[1]=le(c=>n(G).push("/mission-planning"),["stop"]))}),null,16,["style"])):U("",!0)]),_:1}),u(ke,{location:"top",text:pa.value},{activator:p(({props:l})=>[S.value?(E(),q(B,pe({key:0,style:[n(f).globalGlassMenuStyles,L.value?{}:{color:"#FFFFFF33"}]},l,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",L.value?"":"active-events-on-disabled"],color:ve.value==n($).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!L.value,onClick:t[2]||(t[2]=le(c=>n(_).goToTarget(n($).HOME,!0),["stop"])),onDblclick:t[3]||(t[3]=le(c=>n(_).follow(n($).HOME),["stop"]))}),null,16,["style","class","color","disabled"])):U("",!0)]),_:1},8,["text"]),u(ke,{location:"top",text:fa.value},{activator:p(({props:l})=>[S.value?(E(),q(B,pe({key:0,style:[n(f).globalGlassMenuStyles,z.value?{}:{color:"#FFFFFF33"}]},l,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",z.value?"":"active-events-on-disabled"],color:ve.value==n($).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!z.value,onClick:t[4]||(t[4]=le(c=>n(_).goToTarget(n($).VEHICLE,!0),["stop"])),onDblclick:t[5]||(t[5]=le(c=>n(_).follow(n($).VEHICLE),["stop"]))}),null,16,["style","class","color","disabled"])):U("",!0)]),_:1},8,["text"]),u(ke,{location:"top",text:va.value},{activator:p(({props:l})=>[S.value?(E(),q(B,pe({key:0,style:[n(f).globalGlassMenuStyles,n(i).isVehicleOnline?{}:{color:"#FFFFFF33"}]},l,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",n(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!n(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:le(Ct,["stop"])}),null,16,["style","class","disabled"])):U("",!0)]),_:1},8,["text"]),u(ke,{location:"top",text:ma.value},{activator:p(({props:l})=>[S.value?(E(),q(B,pe({key:0,style:[n(f).globalGlassMenuStyles,n(i).isVehicleOnline?{}:{color:"#FFFFFF33"}]},l,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",n(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!n(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:le(ca,["stop"])}),null,16,["style","class","disabled"])):U("",!0)]),_:1},8,["text"])],8,uo)],6)),[[o,la]]),u(Za,{ref_key:"contextMenuRef",ref:C,visible:j.value,width:"260px","menu-items":sa,onClose:Fe},null,8,["visible","menu-items"]),u(Yt,{modelValue:n(xe).widgetManagerVars(n(k).hash).configMenuOpen,"onUpdate:modelValue":t[8]||(t[8]=l=>n(xe).widgetManagerVars(n(k).hash).configMenuOpen=l),width:"auto"},{default:p(()=>[u(Bt,{class:"pa-2",style:ie(n(f).globalGlassMenuStyles)},{default:p(()=>[u(Ht,{class:"text-center"},{default:p(()=>t[11]||(t[11]=[W("Map widget settings")])),_:1,__:[11]}),u(Ut,null,{default:p(()=>[u(zt,{modelValue:n(k).options.showVehiclePath,"onUpdate:modelValue":t[6]||(t[6]=l=>n(k).options.showVehiclePath=l),class:"my-1",label:"Show vehicle path",color:n(k).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),u(zt,{modelValue:n(k).options.showCoordinateGrid,"onUpdate:modelValue":t[7]||(t[7]=l=>n(k).options.showCoordinateGrid=l),class:"my-1",label:"Show coordinate grid",color:n(k).options.showCoordinateGrid?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Ie.value?(E(),q(ja,{key:0,"model-value":wt.value,height:"10",absolute:"",bottom:"",color:"white",style:ie(`top: ${Vt.value}`)},null,8,["model-value","style"])):U("",!0),Ie.value?(E(),Q("p",{key:1,style:ie({top:Vt.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):U("",!0),u(Ka,{ref_key:"poiManagerMapWidgetRef",ref:ce},null,512),u(ro,{"model-value":I.value,onConfirmed:St,"onUpdate:modelValue":t[9]||(t[9]=l=>I.value=l)},null,8,["model-value"]),u(to,{modelValue:qe.value,"onUpdate:modelValue":t[10]||(t[10]=l=>qe.value=l),vehicle:n(i).mainVehicle,"initial-latitude":yt.value,"initial-longitude":xt.value,onOriginSet:ua},null,8,["modelValue","vehicle","initial-latitude","initial-longitude"]),re.value?(E(),Q("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:ie(n(f).globalGlassMenuStyles)},[P("p",null,[t[12]||(t[12]=W(" Saving offline map content ")),Me.value?(E(),Q("span",co,"("+Qe(Me.value)+")",1)):U("",!0),W(":  "+Qe(ee.value?Math.round(fe.value/ee.value*100):0)+"% ",1)])],4)):U("",!0)],64)}}}),po=Zt(vo,[["__scopeId","data-v-37f9aa05"]]);export{po as default};
