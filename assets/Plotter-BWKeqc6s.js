import{bT as P,bQ as R,a_ as X,a$ as Z,bg as ee,b1 as te,k as L,bU as ae,c as Ve,y as ke,J as ye,r as D,L as we,o as xe,bV as Ce,bW as Se,bX as Le,h as Pe,bY as Me,ax as Ne,w as $,aD as Te,aH as Ie,aJ as je,aG as De,l as U,m as E,q as o,n as c,H as u,N as f,ai as $e,S as G,aP as z,a0 as H,O as K,aK as Y,U as O,a6 as Ue,Q as Ee,a7 as Oe,F as Be,ay as J,_ as Ae}from"./index-CADLhm85.js";const le=P.reduce((a,r)=>(a[r]={type:[Boolean,String,Number],default:!1},a),{}),ne=P.reduce((a,r)=>{const i="offset"+R(r);return a[i]={type:[String,Number],default:null},a},{}),oe=P.reduce((a,r)=>{const i="order"+R(r);return a[i]={type:[String,Number],default:null},a},{}),Q={col:Object.keys(le),offset:Object.keys(ne),order:Object.keys(oe)};function Re(a,r,i){let e=a;if(!(i==null||i===!1)){if(r){const s=r.replace(a,"");e+=`-${s}`}return a==="col"&&(e="v-"+e),a==="col"&&(i===""||i===!0)||(e+=`-${i}`),e.toLowerCase()}}const _e=["auto","start","end","center","baseline","stretch"],Fe=X({cols:{type:[Boolean,String,Number],default:!1},...le,offset:{type:[String,Number],default:null},...ne,order:{type:[String,Number],default:null},...oe,alignSelf:{type:String,default:null,validator:a=>_e.includes(a)},...Z(),...ee()},"VCol"),B=te()({name:"VCol",props:Fe(),setup(a,r){let{slots:i}=r;const e=L(()=>{const s=[];let m;for(m in Q)Q[m].forEach(p=>{const g=a[p],V=Re(m,p,g);V&&s.push(V)});const b=s.some(p=>p.startsWith("v-col-"));return s.push({"v-col":!b||!a.cols,[`v-col-${a.cols}`]:a.cols,[`offset-${a.offset}`]:a.offset,[`order-${a.order}`]:a.order,[`align-self-${a.alignSelf}`]:a.alignSelf}),s});return()=>{var s;return ae(a.tag,{class:[e.value,a.class],style:a.style},(s=i.default)==null?void 0:s.call(i))}}}),_=["start","end","center"],se=["space-between","space-around","space-evenly"];function F(a,r){return P.reduce((i,e)=>{const s=a+R(e);return i[s]=r(),i},{})}const We=[..._,"baseline","stretch"],ie=a=>We.includes(a),re=F("align",()=>({type:String,default:null,validator:ie})),Ge=[..._,...se],ue=a=>Ge.includes(a),de=F("justify",()=>({type:String,default:null,validator:ue})),ze=[..._,...se,"stretch"],ce=a=>ze.includes(a),me=F("alignContent",()=>({type:String,default:null,validator:ce})),q={align:Object.keys(re),justify:Object.keys(de),alignContent:Object.keys(me)},He={align:"align",justify:"justify",alignContent:"align-content"};function Ke(a,r,i){let e=He[a];if(i!=null){if(r){const s=r.replace(a,"");e+=`-${s}`}return e+=`-${i}`,e.toLowerCase()}}const Ye=X({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:ie},...re,justify:{type:String,default:null,validator:ue},...de,alignContent:{type:String,default:null,validator:ce},...me,...Z(),...ee()},"VRow"),A=te()({name:"VRow",props:Ye(),setup(a,r){let{slots:i}=r;const e=L(()=>{const s=[];let m;for(m in q)q[m].forEach(b=>{const p=a[b],g=Ke(m,b,p);g&&s.push(g)});return s.push({"v-row--no-gutters":a.noGutters,"v-row--dense":a.dense,[`align-${a.align}`]:a.align,[`justify-${a.justify}`]:a.justify,[`align-content-${a.alignContent}`]:a.alignContent}),s});return()=>{var s;return ae(a.tag,{class:["v-row",e.value,a.class],style:a.style},(s=i.default)==null?void 0:s.call(i))}}}),Je={key:0,class:"w-full h-full flex items-center justify-center text-center text-white text-h5 font-weight-bold p-4 overflow-hidden"},Qe={key:1,class:"main"},qe=["width","height"],Xe={class:"ml-2"},Ze={class:"ml-2 flex gap-x-8"},et={class:"ml-2 flex gap-x-8"},tt={class:"flex w-full justify-end my-2"},at=Ve({__name:"Plotter",props:{widget:{}},setup(a){const r=ke(),e=ye(a).widget,s=D([]);let m,b;we(()=>{const t={backgroundColor:"rgba(0, 0, 0, 0.7)",lineColor:"rgba(255, 0, 0, 1.0)",dataLakeVariableId:void 0,maxSamples:1e3,limitSamples:!0,lineThickness:1,decimalPlaces:2,showTitle:!0};e.value.options={...t,...e.value.options}}),xe(()=>{if(W(e.value.options.dataLakeVariableId),s.value=Object.values(Ce()),b=Se(t=>{s.value=Object.values(t)}),d.length===0){const t=Le(e.value.options.dataLakeVariableId);t&&V(t)}}),Pe(()=>{b&&Me(b),m&&J(e.value.options.dataLakeVariableId,m)});const p=L(()=>s.value.filter(t=>t.type==="number")),g=()=>{e.value.options.limitSamples&&(d.length===e.value.options.maxSamples+1?d.shift():d.length>e.value.options.maxSamples&&d.splice(0,d.length-e.value.options.maxSamples))},V=t=>{d.push(t),g(),N()},W=(t,l)=>{if(t===void 0){console.error("No data lake variable ID provided!");return}l!==void 0&&m&&J(l,m),m=Ne(t,n=>V(n))};$(()=>e.value.options.dataLakeVariableId,(t,l)=>{W(t,l),d.length=0});const{width:fe,height:be}=Te(),k=L(()=>({width:e.value.size.width*fe.value,height:e.value.size.height*be.value})),y=D(),M=D(),C=(t,l,n,v)=>{const T=t.measureText(l),h=4;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(n-h,v-16-h,T.width+h*2,16+h*2),t.fillStyle=e.value.options.lineColor,t.fillText(l,n,v)},N=()=>{if(y.value===void 0||y.value===null)return;if(M.value===void 0){console.debug("Canvas context undefined!"),M.value=y.value.getContext("2d");return}const t=M.value,l=k.value.width,n=k.value.height;Ie(t),t.clearRect(0,0,l,n),t.fillStyle=e.value.options.backgroundColor,t.fillRect(0,0,l,n),t.strokeStyle=e.value.options.lineColor,t.lineWidth=Math.max(e.value.options.lineThickness,1);try{w=Math.max(...d),x=Math.min(...d);const v=.05*(w!=x?w-x:1),T=w+v,h=x-v,ge=d[d.length-1];if(t.beginPath(),t.moveTo(0,n/2),t.setLineDash([]),d.length===0?(t.beginPath(),t.arc(0,n/2,7,0,2*Math.PI),t.stroke()):d.length===1?(t.fillStyle=e.value.options.lineColor,t.beginPath(),t.arc(0,n/2,7,0,2*Math.PI),t.fill(),t.beginPath(),t.setLineDash([5,5]),t.moveTo(0,n/2),t.lineTo(50,n/2),t.stroke()):(t.setLineDash([]),d.forEach((S,j)=>{const ve=j*(l/d.length),he=n-(S-h)/(T-h)*n;t.lineTo(ve,he)})),t.stroke(),t.font="14px monospace",t.textBaseline="bottom",e.value.options.showTitle&&e.value.options.dataLakeVariableId){const S=s.value.find(j=>j.id===e.value.options.dataLakeVariableId);S&&(C(t,S.name,10,26),t.textBaseline="bottom")}const I=e.value.options.decimalPlaces;C(t,`Current: ${Number(ge).toFixed(I)}`,10,n-10),C(t,`Min: ${Number(x).toFixed(I)}`,10,n-30),C(t,`Max: ${Number(w).toFixed(I)}`,10,n-50)}catch(v){console.error("Error drawing graph:",v)}},d=[];let w=0,x=0;$([k,e],()=>{r.isWidgetVisible(e.value)&&(g(),je(()=>N()))},{deep:!0});const pe=De(y);return $(pe,(t,l)=>{t&&!l&&N()}),(t,l)=>(U(),E(Be,null,[o(e).options.dataLakeVariableId?(U(),E("div",Qe,[c("canvas",{ref_key:"canvasRef",ref:y,width:k.value.width,height:k.value.height},null,8,qe)])):(U(),E("p",Je," Please open the Plotter widget configuration menu to select a variable to be plotted. ")),u(Oe,{modelValue:o(r).widgetManagerVars(o(e).hash).configMenuOpen,"onUpdate:modelValue":l[9]||(l[9]=n=>o(r).widgetManagerVars(o(e).hash).configMenuOpen=n),title:"Plotter config",variant:"text-only"},{content:f(()=>[u(A,null,{default:f(()=>[u(B,{cols:"12"},{default:f(()=>[l[10]||(l[10]=c("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Source",-1)),c("div",Xe,[u($e,{modelValue:o(e).options.dataLakeVariableId,"onUpdate:modelValue":l[0]||(l[0]=n=>o(e).options.dataLakeVariableId=n),items:p.value,"item-title":"name","item-value":"id",label:"Data Lake variable",hint:"Select a variable to be plotted","persistent-hint":"",variant:"outlined",density:"comfortable"},null,8,["modelValue","items"])])]),_:1})]),_:1}),u(A,null,{default:f(()=>[u(B,{cols:"12"},{default:f(()=>[l[13]||(l[13]=c("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Appearance",-1)),c("div",Ze,[u(G,{modelValue:o(e).options.showTitle,"onUpdate:modelValue":l[1]||(l[1]=n=>o(e).options.showTitle=n),label:"Show title","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),u(z,{"close-on-content-click":!1},{activator:f(({props:n})=>[c("div",H(n,{class:"flex cursor-pointer"}),[l[11]||(l[11]=c("span",{class:"mt-3"},"Background color",-1)),c("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:K({backgroundColor:o(e).options.backgroundColor})},null,4)],16)]),default:f(()=>[u(Y,{modelValue:o(e).options.backgroundColor,"onUpdate:modelValue":l[2]||(l[2]=n=>o(e).options.backgroundColor=n),label:"Background","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),u(z,{"close-on-content-click":!1},{activator:f(({props:n})=>[c("div",H(n,{class:"flex cursor-pointer"}),[l[12]||(l[12]=c("span",{class:"mt-3"},"Line color",-1)),c("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:K({backgroundColor:o(e).options.lineColor})},null,4)],16)]),default:f(()=>[u(Y,{modelValue:o(e).options.lineColor,"onUpdate:modelValue":l[3]||(l[3]=n=>o(e).options.lineColor=n),label:"Line","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),u(O,{modelValue:o(e).options.lineThickness,"onUpdate:modelValue":l[4]||(l[4]=n=>o(e).options.lineThickness=n),modelModifiers:{number:!0},type:"number",label:"Line thickness",variant:"outlined",density:"compact",rules:[n=>n>0||"Must be greater than 0"],width:"140px","hide-details":""},null,8,["modelValue","rules"])])]),_:1})]),_:1}),u(A,null,{default:f(()=>[u(B,{cols:"12"},{default:f(()=>[l[14]||(l[14]=c("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Points",-1)),c("div",et,[u(O,{modelValue:o(e).options.decimalPlaces,"onUpdate:modelValue":l[5]||(l[5]=n=>o(e).options.decimalPlaces=n),modelModifiers:{number:!0},type:"number",label:"Decimal places",variant:"outlined",density:"comfortable",rules:[n=>n>=0||"Must be 0 or greater"],hint:"Number of decimal places to be displayed",width:"160px",class:"ml-2"},null,8,["modelValue","rules"]),u(G,{modelValue:o(e).options.limitSamples,"onUpdate:modelValue":l[6]||(l[6]=n=>o(e).options.limitSamples=n),label:"Limit number of samples"},null,8,["modelValue"]),u(O,{modelValue:o(e).options.maxSamples,"onUpdate:modelValue":l[7]||(l[7]=n=>o(e).options.maxSamples=n),modelModifiers:{number:!0},type:"number",label:"Maximum samples",variant:"outlined",density:"comfortable",disabled:!o(e).options.limitSamples,rules:[n=>n>0||"Must be greater than 0"],hint:"Higher values will show more history but may impact performance",width:"220px"},null,8,["modelValue","disabled","rules"])])]),_:1})]),_:1})]),actions:f(()=>[c("div",tt,[u(Ue,{onClick:l[8]||(l[8]=n=>o(r).widgetManagerVars(o(e).hash).configMenuOpen=!1)},{default:f(()=>l[15]||(l[15]=[Ee("Close")])),_:1})])]),_:1},8,["modelValue"])],64))}}),nt=Ae(at,[["__scopeId","data-v-6de81930"]]);export{nt as default};
