import{c as H,t as Q,u as X,e as Y,R as Z,r as f,S as J,T as K,h as m,U as ee,w as te,W as oe,X as le,j as ae,m as i,n as u,q as r,E as c,p as l,P as F,v as h,x as V,z as a,B as C,Q as O,Y as se,Z as ne,G as re,$ as ie,V as ue,a0 as I,a1 as b,a2 as de,a3 as pe,a4 as S,a5 as T,a6 as me,F as ve}from"./index-CYBACqTC.js";const ce={key:0,class:"relative w-[1.5rem] battery-icon"},ge={key:0,class:"absolute text-sm text-white -bottom-[3px] left-[4px] mdi mdi-circle"},we={key:1,class:"absolute text-sm text-yellow-400 -bottom-[3px] left-[4px] mdi mdi-alert-circle"},fe={key:1,class:"relative flex flex-col justify-center items-center h-full w-[1.5rem] battery-icon"},he={key:1,class:"absolute text-sm text-white bottom-0 left-0 mdi mdi-circle"},be={key:2,class:"absolute text-sm text-yellow-400 bottom-0 left-0 mdi mdi-alert-circle"},xe={class:"relative right-0 flex flex-col w-[4rem] select-none text-sm font-semibold leading-4 text-end -mr-2"},ye={class:"w-full"},Ve={class:"flex justify-end gap-x-1 items-center"},Ce={class:"font-mono"},Se={class:"w-full"},Te={key:0,class:"flex justify-end gap-x-1 items-center"},ke={class:"font-mono mt-[2px]"},Me={key:1,class:"flex justify-end gap-x-1 items-center text-yellow-100"},Ie={class:"font-mono mt-[2px]"},_e={class:"absolute top-2 right-2 z-10"},Ue={class:"flex justify-between items-center -mt-1"},Be={class:"flex items-center gap-x-2"},We={class:"flex items-center gap-x-2"},De={class:"flex items-center gap-x-2"},je={class:"flex items-center gap-x-2"},Pe={class:"text-red-500 text-center text-sm w-[full]"},g=500,$e=H({__name:"BatteryIndicator",props:{miniWidget:{}},setup($){var D,j,P;const t=Q($).miniWidget,_={showCurrent:!0,showPower:!0,toggleInterval:1e3},s=X(),k=Y(),z=Z(),x=f(!0),w=f(void 0),y=f(""),M=f(void 0),v=f(t.value.options.toggleInterval??_.toggleInterval);(D=t.value.options).useVoltageToColor??(D.useVoltageToColor=!1),(j=t.value.options).voltageToColorScheme??(j.voltageToColorScheme=Object.assign({},J)),(P=t.value.options).batteryThresholds??(P.batteryThresholds=Object.assign({},K));const d=m(()=>t.value.options.batteryThresholds),L=m(()=>{var n;return((n=s==null?void 0:s.powerSupply)==null?void 0:n.voltage)??null}),N=ee(L,4e3),U=m(()=>{const n=N.value;if(n==null)return"unknown";const{critical:e,low:o,medium:G,high:q}=d.value;return n>=q?"high":n>=G?"medium":n>=o?"low":n>=e||n<e?"critical":"unknown"}),B=m(()=>{const n=U.value;return t.value.options.voltageToColorScheme[n]??"transparent"}),A=m(()=>{var n;return((n=s==null?void 0:s.powerSupply)==null?void 0:n.voltage)===void 0?"--":Math.abs(s.powerSupply.voltage)>=100?s.powerSupply.voltage.toFixed(0):s.powerSupply.voltage.toFixed(1)}),R=m(()=>{var n;return((n=s==null?void 0:s.powerSupply)==null?void 0:n.current)===void 0?"--":Math.abs(s.powerSupply.current)>=100?s.powerSupply.current.toFixed(0):s.powerSupply.current.toFixed(1)}),E=m(()=>s.instantaneousWatts!==void 0?s.instantaneousWatts.toFixed(1):"--"),p=m(()=>{var n;return((n=s==null?void 0:s.powerSupply)==null?void 0:n.remaining)===void 0?-1:Math.abs(s.powerSupply.remaining)>100?100:s.powerSupply.remaining}),W=()=>{(w.value||M.value)&&(clearInterval(w.value),clearTimeout(M.value)),v.value<g?(t.value.options.toggleInterval=g,y.value=`Interval must be at least ${g}ms.`):t.value.options.toggleInterval=v.value,!t.value.options.showCurrent&&!t.value.options.showPower&&(t.value.options.showCurrent=!0,t.value.options.showPower=!0,y.value="At least one of the options must be enabled."),t.value.options.showCurrent&&t.value.options.showPower?w.value=setInterval(()=>{x.value=!x.value},t.value.options.toggleInterval):x.value=t.value.options.showCurrent,M.value=setTimeout(()=>{y.value="",v.value<g&&(v.value=g)},5e3)};return te([()=>t.value.options,v],W,{deep:!0}),oe(()=>{t.value.options=Object.assign({},_,t.value.options),W(),le.registerUsage("Instantaneous Watts")}),ae(()=>{w.value===void 0&&clearInterval(w.value)}),(n,e)=>(u(),i(ve,null,[r(O,{text:`Battery remaining: ${p.value<0?"No Data":p.value+"%"}`},{activator:c(({props:o})=>[l("div",F(o,{class:"flex items-center w-[95px] h-12 text-white justify-center"}),[p.value>=0?(u(),i("div",ce,[e[14]||(e[14]=l("i",{class:"mdi mdi-battery-outline"},null,-1)),l("i",{class:"mdi mdi-battery absolute inset-0 bottom-0 -right-1 text-transparent bg-clip-text",style:V({backgroundImage:`linear-gradient(to top, white ${p.value}%, transparent ${p.value}%)`})},null,4),p.value<0?(u(),i("span",ge)):h("",!0),p.value<0?(u(),i("span",we)):h("",!0)])):(u(),i("div",fe,[l("i",{class:"absolute mdi mdi-battery",style:V({color:a(t).options.useVoltageToColor?B.value:"transparent"})},null,4),U.value==="critical"&&a(t).options.useVoltageToColor?(u(),i("i",{key:0,class:"absolute mdi mdi-battery animate-ping",style:V({color:B.value})},null,4)):h("",!0),e[15]||(e[15]=l("i",{class:"absolute mdi mdi-battery-outline text-[#CCCCCC88]"},null,-1)),p.value<0?(u(),i("span",he)):h("",!0),p.value<0?(u(),i("span",be)):h("",!0)])),l("div",xe,[l("div",ye,[l("div",Ve,[l("span",Ce,C(A.value),1),e[16]||(e[16]=l("div",{class:"w-[15px] mr-[1px] -ml-[1px]"},"V",-1))])]),l("div",Se,[x.value?(u(),i("div",Te,[l("span",ke,C(R.value),1),e[17]||(e[17]=l("div",{class:"w-[15px]"},"A",-1))])):(u(),i("div",Me,[l("span",Ie,C(E.value),1),e[18]||(e[18]=l("div",{class:"w-[15px]"},"W",-1))]))])])],16)]),_:1},8,["text"]),r(me,{modelValue:a(k).miniWidgetManagerVars(a(t).hash).configMenuOpen,"onUpdate:modelValue":e[13]||(e[13]=o=>a(k).miniWidgetManagerVars(a(t).hash).configMenuOpen=o),width:"auto"},{default:c(()=>[r(se,{class:"pa-4 text-white w-[400px]",style:V([{"border-radius":"15px"},a(z).globalGlassMenuStyles])},{default:c(()=>[r(ne,{class:"text-center"},{default:c(()=>e[19]||(e[19]=[re("Battery Indicator Config")])),_:1,__:[19]}),r(ie,{class:"flex flex-col gap-y-4"},{default:c(()=>[l("div",_e,[r(ue,{icon:"",size:"30",variant:"text",class:"text-white text-[22px]","aria-label":"Close",onClick:e[0]||(e[0]=o=>a(k).miniWidgetManagerVars(a(t).hash).configMenuOpen=!1)},{default:c(()=>e[20]||(e[20]=[l("i",{class:"mdi mdi-close"},null,-1)])),_:1,__:[20]})]),r(I,{modelValue:a(t).options.showCurrent,"onUpdate:modelValue":e[1]||(e[1]=o=>a(t).options.showCurrent=o),label:"Show Current","hide-details":"",class:"-mb-5"},null,8,["modelValue"]),r(I,{modelValue:a(t).options.showPower,"onUpdate:modelValue":e[2]||(e[2]=o=>a(t).options.showPower=o),label:"Show Power","hide-details":""},null,8,["modelValue"]),r(b,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=o=>v.value=o),modelModifiers:{number:!0},label:"Toggle Interval (ms)",type:"number",min:g,step:"100",density:"compact",variant:"outlined","hide-details":"",disabled:!a(t).options.showCurrent||!a(t).options.showPower},null,8,["modelValue","disabled"]),r(de,{class:"mt-2"}),l("div",Ue,[r(I,{modelValue:a(t).options.useVoltageToColor,"onUpdate:modelValue":e[4]||(e[4]=o=>a(t).options.useVoltageToColor=o),label:"Use voltage to color scheme","hide-details":"",class:"mr-1"},null,8,["modelValue"]),r(O,{location:"top",text:"Configure these voltage levels according to your battery pack. Defaults are based on Blue Robotics' 4S Li-ion battery pack."},{activator:c(({props:o})=>[r(pe,F(o,{icon:"mdi-information-outline",class:"ml-1 text-yellow-300 cursor-pointer",size:"18"}),null,16)]),_:1})]),l("div",Be,[r(b,{modelValue:d.value.critical,"onUpdate:modelValue":e[5]||(e[5]=o=>d.value.critical=o),modelModifiers:{number:!0},label:"Critical voltage (V)",type:"number",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"]),S(l("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>a(t).options.voltageToColorScheme.critical=o),type:"color",theme:"dark",class:"w-8 h-8 rounded border border-white/30 bg-transparent cursor-pointer"},null,512),[[T,a(t).options.voltageToColorScheme.critical]])]),l("div",We,[r(b,{modelValue:d.value.low,"onUpdate:modelValue":e[7]||(e[7]=o=>d.value.low=o),modelModifiers:{number:!0},label:"Low voltage (V)",type:"number",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"]),S(l("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>a(t).options.voltageToColorScheme.low=o),type:"color",theme:"dark",class:"w-8 h-8 rounded border border-white/30 bg-transparent cursor-pointer"},null,512),[[T,a(t).options.voltageToColorScheme.low]])]),l("div",De,[r(b,{modelValue:d.value.medium,"onUpdate:modelValue":e[9]||(e[9]=o=>d.value.medium=o),modelModifiers:{number:!0},label:"Medium voltage (V)",type:"number",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"]),S(l("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>a(t).options.voltageToColorScheme.medium=o),type:"color",theme:"dark",class:"w-8 h-8 rounded border border-white/30 bg-transparent cursor-pointer"},null,512),[[T,a(t).options.voltageToColorScheme.medium]])]),l("div",je,[r(b,{modelValue:d.value.high,"onUpdate:modelValue":e[11]||(e[11]=o=>d.value.high=o),modelModifiers:{number:!0},label:"High voltage (V)",type:"number",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"]),S(l("input",{"onUpdate:modelValue":e[12]||(e[12]=o=>a(t).options.voltageToColorScheme.high=o),type:"color",theme:"dark",class:"w-8 h-8 rounded border border-white/30 bg-transparent cursor-pointer"},null,512),[[T,a(t).options.voltageToColorScheme.high]])]),l("p",Pe,C(y.value),1)]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}});export{$e as default};
