import{d as J,u as P,a as $,w as c,A as h,b as a,c as K,t as Q,e as X,f as Y,r as f,h as k,o as Z,i as ee,j as te,k as le,l as H,m as A,n as x,p as n,q as g,s as se,v as L,x as re,y as b,z as l,B as w,F as U,C as oe,D as ae,V as j,E as _,G as ne,H as O,I as ie,J as de,_ as ue}from"./index-veoPsH_b.js";const ce=J("vehicle-alerter",()=>{const i=P(),v=$();c(i.statusText,()=>{i.statusText.text&&v.pushAlert(new h(i.statusText.severity,i.statusText.text))}),c(()=>i.mode,()=>v.pushAlert(new h(a.Info,`Vehicle mode changed to ${i.mode}.`))),c(()=>i.isArmed,o=>{const s=o?"armed":"disarmed";v.pushAlert(new h(a.Info,`Vehicle ${s}`))}),c(()=>i.isVehicleOnline,o=>{const s=o?a.Success:a.Error,m=o?"connected":"disconnected";v.pushAlert(new h(s,`Vehicle ${m}`))})}),me={class:"mx-1 overflow-hidden text-xl font-medium text-gray-100 text-ellipsis"},pe=["title"],ve={class:"mx-1 overflow-hidden text-lg font-medium leading-none text-ellipsis"},fe={class:"flex flex-col justify-center mx-1 font-mono text-xs font-semibold leading-3 text-right text-gray-100"},xe={key:0,class:"h-px mx-1 mb-2 bg-slate-50/30"},ge={class:"flex items-start justify-between flex-col -mt-8 mb-6 pl-6"},be=10,he=K({__name:"Alerter",props:{miniWidget:{}},setup(i){var D;const o=Q(i).miniWidget;(D=o.value.options).enableColorCoding??(D.enableColorCoding=!0),ce();const s=$(),m=X(),z=Y({interval:1e3}),F=r=>ae(r,"HH:mm:ss"),d=f(s.alerts[0]),u=f(!1),p=f(s.alerts.length-1),R=k(()=>{switch(d.value.level){case a.Critical:return"border: 2px solid transparent";case a.Error:return"border: 2px solid #dc2626;";case a.Warning:return"border: 2px solid #db9340;";case a.Info:return"border: 2px solid #3b82f655;";case a.Success:return"border: 2px solid #308013;";default:return"border: none;"}}),I=k(()=>o.value.options.enableColorCoding&&d.value.level===a.Critical);let B;Z(()=>{B=setInterval(()=>{const r=new Date(z.value),e=s.alerts.length-1,t=s.alerts[e];if(p.value>=e){if(ee(r,(t==null?void 0:t.time_created)||r)>be){d.value=new h(a.Info,"No recent alerts.");return}d.value=t;return}s.lastSpokenAlertIndex>=p.value&&(p.value++,d.value=s.alerts[p.value])},100)}),te(()=>{clearInterval(B)}),c(()=>s.alerts.length,(r,e)=>{r>e&&d.value.message==="No recent alerts."&&(p.value=r-1,d.value=s.alerts[p.value])});const[V,E]=le(),M=()=>E(!0),C=()=>E(!1),T=f(),y=H(T),W=f(),S=H(W);c(y,(r,e)=>{u.value||(e&&!r&&setTimeout(()=>{!u.value&&!S.value&&!y.value&&C()},250),!V.value&&M())}),c(S,(r,e)=>{u.value||e&&!r&&C()});const q=()=>{const r=!u.value;if(u.value=r,r){M();return}!S.value&&!y.value&&C()},G=k(()=>[...s.sortedAlerts].reverse());return(r,e)=>(x(),A(U,null,[n("div",{ref_key:"currentAlertBar",ref:T,class:b(["flex",{"pointer-events-none":l(m).editingMode}])},[n("div",{class:b(["mx-1 my-1.5 w-[500px] rounded-md",{"alert-border-blink":I.value}]),style:re(l(o).options.enableColorCoding?R.value:"border: none;")},[n("div",{class:b(["flex items-center justify-between p-1 overflow-hidden rounded cursor-pointer select-none whitespace-nowrap",I.value?"bg-[#db151233]":"bg-slate-800/75"])},[n("p",me,w(d.value.message),1)],2),n("div",{ref_key:"expandedAlertsBar",ref:W,class:b(["expanded-alerts-bar absolute w-full p-2 transition-all rounded top-12 max-h-[30vh] overflow-y-auto text-slate-50 scrollbar-hide bg-slate-800/75 select-none flex flex-col",{"opacity-0 invisible":!l(V)}])},[(x(!0),A(U,null,oe(G.value,(t,N)=>(x(),A("div",{key:t.time_created.toISOString()},[n("div",{title:t.message,class:b(["flex items-center justify-between whitespace-nowrap",{"border-[1px] border-[#dc262699] bg-[#dc262622] pa-1":(t.level===l(a).Critical||t.level===l(a).Error)&&l(o).options.enableColorCoding}])},[n("p",ve,w(t.message),1),n("div",fe,[n("p",null,w(F(t.time_created||new Date)),1),n("p",null,w(t.level.toUpperCase()),1)])],10,pe),N!==l(s).alerts.length-1?(x(),A("div",xe)):L("",!0)]))),128))],2)],6),l(V)||u.value?(x(),se(j,{key:0,icon:"mdi-arrow-vertical-lock",variant:"text",color:u.value?"orange ":"white",class:"-mr-8 -ml-4 mt-[2px] bg-transparent",onClick:e[0]||(e[0]=t=>q())},null,8,["color"])):L("",!0)],2),g(de,{modelValue:l(m).miniWidgetManagerVars(l(o).hash).configMenuOpen,"onUpdate:modelValue":e[5]||(e[5]=t=>l(m).miniWidgetManagerVars(l(o).hash).configMenuOpen=t),title:"Alerter options","max-width":"400px",variant:"text-only"},{content:_(()=>[n("div",ge,[g(O,{modelValue:l(o).options.enableColorCoding,"onUpdate:modelValue":e[1]||(e[1]=t=>l(o).options.enableColorCoding=t),"hide-details":"",label:"Enable color coded alerts",color:"white"},null,8,["modelValue"]),g(O,{modelValue:l(s).enableVoiceAlerts,"onUpdate:modelValue":e[2]||(e[2]=t=>l(s).enableVoiceAlerts=t),"hide-details":"",label:"Enable voice alerts",color:"white"},null,8,["modelValue"]),g(ie,{modelValue:l(s).alertVolume,"onUpdate:modelValue":e[3]||(e[3]=t=>l(s).alertVolume=t),min:"0",max:"1",step:"0.05","hide-details":"","thumb-label":"",label:"Alert volume",color:"white",class:"w-[250px] mt-2",disabled:!l(s).enableVoiceAlerts},null,8,["modelValue","disabled"])])]),actions:_(()=>[g(j,{onClick:e[4]||(e[4]=t=>l(m).miniWidgetManagerVars(l(o).hash).configMenuOpen=!1)},{default:_(()=>e[6]||(e[6]=[ne("Close")])),_:1,__:[6]})]),_:1},8,["modelValue"])],64))}}),we=ue(he,[["__scopeId","data-v-de04ddee"]]);export{we as default};
