import{c as $,y as F,J as I,M as H,Y as P,u as J,r as v,aD as U,k as C,w as S,aF as d,aC as E,aJ as N,o as Y,l as j,m as q,n as K,aH as O,aI as n,_ as Q}from"./index-D3oXmRCr.js";import{g as k}from"./index-DaYL4gH5.js";const X=["height","width"],Z=$({__name:"VirtualHorizon",props:{widget:{}},setup(R){const V=F(),A=I(R).widget;H.registerUsage(P.roll),H.registerUsage(P.pitch);const h=J(),L=v(),f=v(),D=v(),{width:G,height:B}=U(),W=C(()=>A.value.size.width*G.value),x=C(()=>A.value.size.height*B.value),p=C(()=>W.value<x.value?W.value:x.value),z=()=>{if(f.value===void 0||f.value===null)return;D.value===void 0&&(D.value=f.value.getContext("2d"));const e=D.value;O(e);const s=.5*p.value,r=.06*p.value,i=.03*s;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${r}px Arial`,e.fillStyle="white",e.lineWidth=i,e.textBaseline="middle";const t=.7*s;e.translate(s,s),e.rotate(n(-90)),e.rotate(n(90)),e.save(),e.strokeStyle="white",e.lineWidth=1.5*i,e.beginPath(),e.arc(0,0,t,0,n(360)),e.stroke(),e.restore(),e.save(),e.rotate(n(l.rollAngleDegrees)),e.beginPath(),e.arc(0,0,t,0,n(360)),e.clip();const b=4,a=b*(l.pitchAngleDegrees/90)*t,_=e.createLinearGradient(0,-t,0,t);_.addColorStop(0,"rgb(69, 144, 190)"),_.addColorStop(1,"rgb(137, 190, 228)"),e.fillStyle=_,e.fillRect(-1.5*t,a,3*t,-3*t);const y=e.createLinearGradient(0,-t,0,t);y.addColorStop(0,"rgb(176, 117, 80)"),y.addColorStop(1,"rgb(200, 149, 98)"),e.fillStyle=y,e.fillRect(-1.5*t,a,3*t,3*t),e.lineWidth=.6*i,e.strokeStyle="white",e.beginPath(),e.moveTo(-.75*t,a),e.lineTo(-.45*t,a),e.lineTo(-.43*t,a+.07*t),e.moveTo(.75*t,a),e.lineTo(.45*t,a),e.lineTo(.43*t,a+.07*t),e.stroke(),e.save(),e.fillStyle="white",e.strokeStyle="white",e.lineWidth=.5*i,e.font=`bold ${r}px Arial`;for(const o of[-10,0,10]){const c=b*Math.abs(o/300)||.15,w=b*(o/90)*t,M=b*((o-5*Math.sign(o))/90)*t;e.beginPath(),e.moveTo(-c*t,w),e.lineTo(+c*t,w),e.moveTo(-.5*c*t,M),e.lineTo(.5*c*t,M),e.stroke(),e.textAlign="right",e.fillText(`${Math.abs(o)}`,-1*(c*t+.3*r),w),e.textAlign="left",e.fillText(`${Math.abs(o)}`,1*(c*t+.3*r),w)}e.restore(),e.restore(),e.save(),e.lineWidth=.8*i,e.rotate(n(l.rollAngleDegrees)),e.beginPath(),e.moveTo(-1*t,0),e.lineTo(-.85*t,0),e.moveTo(.85*t,0),e.lineTo(1*t,0),e.stroke(),e.restore();for(const o of[-60,-45,-30,-20,-10,0,10,20,30,45,60])e.save(),e.rotate(n(o)),e.beginPath(),[-60,-30,30,60].includes(o)?(e.lineWidth=.8*i,e.moveTo(0,-1.2*t),e.lineTo(0,-1*t)):[-20,-10,10,20].includes(o)?(e.lineWidth=.6*i,e.moveTo(0,-1.1*t),e.lineTo(0,-1*t)):[-45,45].includes(o)?(e.lineWidth=.01*i,e.moveTo(0,-1.01*t),e.lineTo(-.05*t,-1.15*t),e.lineTo(.05*t,-1.15*t),e.lineTo(0,-1.01*t)):o===0&&(e.lineWidth=.01*i,e.moveTo(0,-1.01*t),e.lineTo(-.07*t,-1.25*t),e.lineTo(.07*t,-1.25*t),e.lineTo(0,-1.01*t)),e.stroke(),e.fill(),e.restore();e.save(),e.beginPath(),e.rotate(n(90)),e.rotate(n(l.rollAngleDegrees)),e.lineWidth=.01*i,e.fillStyle="rgb(221, 43, 43)",e.moveTo(-1*t,0),e.lineTo(-.8*t,-.08*t),e.lineTo(-.8*t,.08*t),e.lineTo(-1*t,0),e.stroke(),e.fill(),e.restore()},g=v(.01),u=v(.01);let T,m;S(h.attitude,e=>{if(T===void 0||m===void 0){g.value=d(h.attitude.roll),u.value=d(h.attitude.pitch),T=e.roll,m=e.pitch;return}const s=Math.abs(d(e.roll-T)),r=Math.abs(d(e.pitch-m));s>.1&&(T=e.roll,g.value=d(h.attitude.roll)),r>.1&&(m=e.pitch,u.value=d(h.attitude.pitch))});const l=E({pitchAngleDegrees:0,rollAngleDegrees:0});return S(u,()=>{k.to(l,.1,{pitchAngleDegrees:u.value})}),S(g,()=>{k.to(l,.1,{rollAngleDegrees:-1*g.value})}),S([l,W,x],()=>{V.isWidgetVisible(A.value)&&N(()=>z())}),Y(()=>{k.to(l,.1,{pitchAngleDegrees:u.value}),k.to(l,.1,{rollAngleDegrees:-1*g.value}),z()}),(e,s)=>(j(),q("div",{ref_key:"virtualHorizonRoot",ref:L,class:"virtualHorizon"},[K("canvas",{ref_key:"canvasRef",ref:f,height:p.value,width:p.value,class:"rounded-[15%] bg-slate-950/70"},null,8,X)],512))}}),ie=Q(Z,[["__scopeId","data-v-1de2f19a"]]);export{ie as default};
