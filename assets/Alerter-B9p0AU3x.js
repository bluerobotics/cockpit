import{d as G,u as J,a as j,w as u,A as g,b as o,c as P,t as K,e as Q,f as X,r as b,h as S,o as Y,i as Z,j as ee,k as te,l as L,m as h,n as v,p as n,q as f,s as le,v as D,x as se,y as x,z as e,B as w,F as H,C as re,D as oe,V as N,E as _,G as ae,H as U,I as ne,J as ie,_ as de}from"./index-DRDfdZm5.js";const ce=G("vehicle-alerter",()=>{const i=J(),m=j();u(i.statusText,()=>{i.statusText.text&&m.pushAlert(new g(i.statusText.severity,i.statusText.text))}),u(()=>i.mode,()=>m.pushAlert(new g(o.Info,`Vehicle mode changed to ${i.mode}.`))),u(()=>i.isArmed,s=>{const r=s?"armed":"disarmed";m.pushAlert(new g(o.Info,`Vehicle ${r}`))}),u(()=>i.isVehicleOnline,s=>{const r=s?o.Success:o.Error,c=s?"connected":"disconnected";m.pushAlert(new g(r,`Vehicle ${c}`))})}),ue={class:"mx-1 overflow-hidden text-xl font-medium text-gray-100 text-ellipsis"},me=["title"],pe={class:"mx-1 overflow-hidden text-lg font-medium leading-none text-ellipsis"},ve={class:"flex flex-col justify-center mx-1 font-mono text-xs font-semibold leading-3 text-right text-gray-100"},fe={key:0,class:"h-px mx-1 mb-2 bg-slate-50/30"},xe={class:"flex items-start justify-between flex-col -mt-8 mb-6 pl-6"},ge=10,be=P({__name:"Alerter",props:{miniWidget:{}},setup(i){var W;const s=K(i).miniWidget;(W=s.value.options).enableColorCoding??(W.enableColorCoding=!0),ce();const r=j(),c=Q(),O=X({interval:1e3}),$=a=>oe(a,"HH:mm:ss"),p=b(r.alerts[0]),d=b(!1),z=S(()=>{switch(p.value.level){case o.Critical:return"border: 2px solid transparent";case o.Error:return"border: 2px solid #dc2626;";case o.Warning:return"border: 2px solid #db9340;";case o.Info:return"border: 2px solid #3b82f655;";case o.Success:return"border: 2px solid #308013;";default:return"border: none;"}}),k=S(()=>s.value.options.enableColorCoding&&p.value.level===o.Critical);let B;Y(()=>{B=setInterval(()=>{var t;const a=new Date(O.value);if(Z(a,((t=r.alerts.last())==null?void 0:t.time_created)||a)>ge){p.value=new g(o.Info,"No recent alerts.");return}p.value=r.alerts.last()},1e3)}),ee(()=>{clearInterval(B)});const[A,E]=te(),I=()=>E(!0),V=()=>E(!1),M=b(),C=L(M),T=b(),y=L(T);u(C,(a,l)=>{d.value||(l&&!a&&setTimeout(()=>{!d.value&&!y.value&&!C.value&&V()},250),!A.value&&I())}),u(y,(a,l)=>{d.value||l&&!a&&V()});const F=()=>{const a=!d.value;if(d.value=a,a){I();return}!y.value&&!C.value&&V()},R=S(()=>[...r.sortedAlerts].reverse());return(a,l)=>(v(),h(H,null,[n("div",{ref_key:"currentAlertBar",ref:M,class:x(["flex",{"pointer-events-none":e(c).editingMode}])},[n("div",{class:x(["mx-1 my-1.5 w-[500px] rounded-md",{"alert-border-blink":k.value}]),style:se(e(s).options.enableColorCoding?z.value:"border: none;")},[n("div",{class:x(["flex items-center justify-between p-1 overflow-hidden rounded cursor-pointer select-none whitespace-nowrap",k.value?"bg-[#db151233]":"bg-slate-800/75"])},[n("p",ue,w(p.value.message),1)],2),n("div",{ref_key:"expandedAlertsBar",ref:T,class:x(["expanded-alerts-bar absolute w-full p-2 transition-all rounded top-12 max-h-[30vh] overflow-y-auto text-slate-50 scrollbar-hide bg-slate-800/75 select-none flex flex-col",{"opacity-0 invisible":!e(A)}])},[(v(!0),h(H,null,re(R.value,(t,q)=>(v(),h("div",{key:t.time_created.toISOString()},[n("div",{title:t.message,class:x(["flex items-center justify-between whitespace-nowrap",{"border-[1px] border-[#dc262699] bg-[#dc262622] pa-1":(t.level===e(o).Critical||t.level===e(o).Error)&&e(s).options.enableColorCoding}])},[n("p",pe,w(t.message),1),n("div",ve,[n("p",null,w($(t.time_created||new Date)),1),n("p",null,w(t.level.toUpperCase()),1)])],10,me),q!==e(r).alerts.length-1?(v(),h("div",fe)):D("",!0)]))),128))],2)],6),e(A)||d.value?(v(),le(N,{key:0,icon:"mdi-arrow-vertical-lock",variant:"text",color:d.value?"orange ":"white",class:"-mr-8 -ml-4 mt-[2px] bg-transparent",onClick:l[0]||(l[0]=t=>F())},null,8,["color"])):D("",!0)],2),f(ie,{modelValue:e(c).miniWidgetManagerVars(e(s).hash).configMenuOpen,"onUpdate:modelValue":l[5]||(l[5]=t=>e(c).miniWidgetManagerVars(e(s).hash).configMenuOpen=t),title:"Alerter options","max-width":"400px",variant:"text-only"},{content:_(()=>[n("div",xe,[f(U,{modelValue:e(s).options.enableColorCoding,"onUpdate:modelValue":l[1]||(l[1]=t=>e(s).options.enableColorCoding=t),"hide-details":"",label:"Enable color coded alerts",color:"white"},null,8,["modelValue"]),f(U,{modelValue:e(r).enableVoiceAlerts,"onUpdate:modelValue":l[2]||(l[2]=t=>e(r).enableVoiceAlerts=t),"hide-details":"",label:"Enable voice alerts",color:"white"},null,8,["modelValue"]),f(ne,{modelValue:e(r).alertVolume,"onUpdate:modelValue":l[3]||(l[3]=t=>e(r).alertVolume=t),min:"0",max:"1",step:"0.05","hide-details":"","thumb-label":"",label:"Alert volume",color:"white",class:"w-[250px] mt-2",disabled:!e(r).enableVoiceAlerts},null,8,["modelValue","disabled"])])]),actions:_(()=>[f(N,{onClick:l[4]||(l[4]=t=>e(c).miniWidgetManagerVars(e(s).hash).configMenuOpen=!1)},{default:_(()=>l[6]||(l[6]=[ae("Close")])),_:1,__:[6]})]),_:1},8,["modelValue"])],64))}}),we=de(be,[["__scopeId","data-v-cbeab672"]]);export{we as default};
