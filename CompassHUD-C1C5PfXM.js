import{d as H,a4 as O,p as $,q as B,D as G,u as I,a5 as j,v as m,an as q,a9 as J,A as K,G as Q,l as Z,x as N,ap as D,ar as ee,H as ae,o as te,c as oe,a as P,i as l,J as r,T as se,K as ne,b as s,ak as le,N as k,U as ie,at as A,av as re,_ as ue,L as de,as as ce,a3 as he}from"./index-BtyyqwBU.js";import{w as C}from"./index-DxaGCbJO.js";import{g as fe}from"./index-ZORhgBxb.js";import{V as ge,a as pe,b as we,c as ve}from"./VExpansionPanel-CrmZHQP8.js";const me={class:"main"},Ce=["width","height"],Se=H({__name:"CompassHUD",props:{widget:{}},setup(E){const S=O(),L=$();B.registerUsage(G.heading);const T=I(),a=j(E).widget,R=m([["#FFFFFF"],["#FF2D2D"],["#0ADB0ACC"]]),X=e=>{switch(e){case-180:return"S";case-135:return"SW";case-90:return"W";case-45:return"NW";case 0:return"N";case 45:return"NE";case 90:return"E";case 135:return"SE";case 180:return"S";case 225:return"SW";case 270:return"W";case 315:return"NW";case 360:return"N";default:return`${e}°`}},c=q({yawLinesX:{}}),V=[];let x=-180;for(;x<181;)V.push(x),x+=3;J(()=>{Object.keys(a.value.options).length===0&&(a.value.options={showYawValue:!0,hudColor:R.value[0][0],useNegativeRange:!1})}),K(()=>{V.forEach(e=>c.yawLinesX[e]=W(e)),M()});const{width:U}=Q(),u=Z(()=>({width:a.value.size.width*U.value,height:64})),p=m(0);let _;N(T.attitude,e=>{Math.abs(D(e.yaw-(_||0)))>.1&&(_=e.yaw,p.value=D(T.attitude.yaw))});const W=e=>{let o=-(e-p.value||0);return o<-180?o+=360:o>180&&(o-=360),-o},w=m(),b=m(),M=()=>{if(w.value===void 0||w.value===null)return;if(b.value===void 0){console.debug("Canvas context undefined!"),b.value=w.value.getContext("2d");return}const e=b.value;ee(e);const t=.5*u.value.width,o=.5*u.value.height,F=12,d=16,h=10,n=2,z=7;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${F}px Arial`,e.fillStyle="white";for(const[i,y]of Object.entries(c.yawLinesX)){if(y<-90||y>90)continue;const Y=2*t/Math.PI*Math.sin(ce(y)),v=t+Y;if(e.beginPath(),e.moveTo(v,d+n+h+n),e.lineTo(v,o*2-F-n-z),e.lineWidth="1",Number(i)%15===0){e.lineWidth="2",e.lineTo(v,o*2-F-n);let g=Number(i);a.value.options.useNegativeRange||(g=g<0?g+360:g),e.fillText(X(Number(g)),v,o*2-n)}e.stroke()}if(a.value.options.showYawValue){e.font=`bold ${d}px Arial`;let i=Number(p.value);a.value.options.useNegativeRange||(i=i<0?i+360:i),e.fillText(`${i.toFixed(1)}°`,t,d)}e.beginPath(),e.moveTo(t,d+n+h),e.lineTo(t-.5*h,n+d+n),e.lineTo(t+.5*h,n+d+n),e.lineTo(t,d+n+h),e.closePath(),e.fill(),e.globalCompositeOperation="source-in";const f=e.createLinearGradient(0,o,u.value.width,o);f.addColorStop(.18,C(a.value.options.hudColor).alpha(0).toRgbString()),f.addColorStop(.3,C(a.value.options.hudColor).alpha(1).toRgbString()),f.addColorStop(.7,C(a.value.options.hudColor).alpha(1).toRgbString()),f.addColorStop(.82,C(a.value.options.hudColor).alpha(0).toRgbString()),e.fillStyle=f,e.fillRect(0,0,u.value.width,o*2)};return N(p,()=>{V.forEach(e=>{const t=W(e);Math.abs(c.yawLinesX[e]-t)>90?c.yawLinesX[e]=t:fe.to(c.yawLinesX,{duration:2.5,ease:"elastic.out(1.2, 0.5)",[e]:t})})}),N([c,u,a.value.options],()=>{S.isWidgetVisible(a.value)&&ae(()=>M())}),(e,t)=>(te(),oe(de,null,[P("div",me,[P("canvas",{ref_key:"canvasRef",ref:w,width:u.value.width,height:u.value.height},null,8,Ce)]),l(ue,{modelValue:s(S).widgetManagerVars(s(a).hash).configMenuOpen,"onUpdate:modelValue":t[3]||(t[3]=o=>s(S).widgetManagerVars(s(a).hash).configMenuOpen=o),"min-width":"400","max-width":"35%"},{default:r(()=>[l(se,{class:"px-8 pb-6 pt-2",style:ne(s(L).globalGlassMenuStyles)},{default:r(()=>[l(le,{class:"text-center"},{default:r(()=>[k("HUD Compass widget config")]),_:1}),l(ie,null,{default:r(()=>[l(A,{class:"ma-1",label:"Show yaw value",color:s(a).options.showYawValue?"white":void 0,"model-value":s(a).options.showYawValue,"hide-details":"",onChange:t[0]||(t[0]=o=>s(a).options.showYawValue=!s(a).options.showYawValue)},null,8,["color","model-value"]),l(A,{class:"ma-1",label:"Use -180/+180 range",color:s(a).options.useNegativeRange?"white":void 0,"model-value":s(a).options.useNegativeRange,"hide-details":"",onChange:t[1]||(t[1]=o=>s(a).options.useNegativeRange=!s(a).options.useNegativeRange)},null,8,["color","model-value"]),l(ge,null,{default:r(()=>[l(pe,{class:"bg-[#FFFFFF11] text-white mt-2"},{default:r(()=>[l(we,null,{default:r(()=>[k("Color")]),_:1}),l(ve,null,{default:r(()=>[l(re,{modelValue:s(a).options.hudColor,"onUpdate:modelValue":t[2]||(t[2]=o=>s(a).options.hudColor=o),theme:"dark",class:"ma-1 bg-[#FFFFFF11] text-white",swatches:R.value,width:"100%","show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),Ne=he(Se,[["__scopeId","data-v-1a4e4ebe"]]);export{Ne as default};
