import{d as Q,a2 as X,A as Z,p as N,D as W,u as ee,a3 as te,q as m,am as oe,a7 as ae,x as se,C as le,l as $,an as D,v as V,ao as f,ap as ie,aq as u,ag as z,F as ne,o as re,c as he,a as C,i as l,H as c,R as de,I as ue,b as o,aj as ce,L as E,S as pe,ar as R,as as I,at as ve,Y as ge,J as me,$ as fe,a0 as we,a1 as be}from"./index-C4AB-M5N.js";import{g as U}from"./index-ZORhgBxb.js";import{V as xe,a as Ve,b as Ce,c as Fe}from"./VExpansionPanel-Cmd45hMH.js";const Se=g=>(fe("data-v-29e20663"),g=g(),we(),g),Pe={class:"main"},Te=["width","height"],Ae={class:"flex justify-center gap-x-8 mb-4"},De=Se(()=>C("span",{class:"ml-2"},"Distance between pitch lines",-1)),Re=Q({__name:"Attitude",props:{widget:{}},setup(g){const F=X(),B=Z();N.registerUsage(W.roll),N.registerUsage(W.pitch);const w=ee(),t=te(g).widget,b=m(),S=m(),x=m(0),P=m(0),k=[-90,-70,-45,-30,-10,0,10,30,45,70,90],p=oe({rollDegrees:0,pitchLinesHeights:{}}),L=m([["#FFFFFF"],["#FF2D2D"],["#0ADB0ACC"]]);ae(()=>{Object.keys(t.value.options).length===0&&(t.value.options={showCenterAim:!0,showPitchLines:!0,showRollPitchValues:!0,desiredAimRadius:150,pitchHeightFactor:300,hudColor:L.value[0][0]})}),se(()=>{k.forEach(e=>p.pitchLinesHeights[e]=5*e),M()});const{width:O,height:j}=le(),r=$(()=>({width:t.value.size.width*O.value,height:t.value.size.height*j.value})),i=$(()=>D(t.value.options.desiredAimRadius,35,.2*r.value.width));let _,H;V(w.attitude,e=>{const a=Math.abs(f(e.roll-(_||0))),s=Math.abs(f(e.pitch-(H||0)));a>.1&&(_=e.roll,x.value=f(w.attitude.roll)),s>.1&&(H=e.pitch,P.value=f(w.attitude.pitch))});const q=e=>t.value.options.pitchHeightFactor*u(e)/Math.cos(u(e)),M=()=>{if(b.value===void 0||b.value===null)return;if(S.value===void 0){console.debug("Canvas context undefined!"),S.value=b.value.getContext("2d");return}const e=S.value;ie(e);const a=.5*r.value.width,s=.5*r.value.height,G=12,T=22,v=2;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${G}px Arial`,e.fillStyle="white";const h=2*i.value;e.translate(a,s),e.rotate(u(p.rollDegrees));for(const[d,n]of Object.entries(p.pitchLinesHeights)){e.beginPath();const Y=Number(d)===0?1:.7,J=Number(d)===0?[]:[5,2],K=Number(d)===0?3:2;if(e.lineWidth=K,e.setLineDash(J),t.value.options.showPitchLines){const y=h+Y*(a-h);e.moveTo(-y+v,n),e.lineTo(-h,n),e.lineTo(-h+5,n+15),e.fillText(Number(d),-h-4*v,n-3*v),e.moveTo(+y-v,n),e.lineTo(h,n),e.lineTo(h-5,n+15),e.fillText(Number(d),h+4*v,n-3*v),e.stroke()}}if(e.lineWidth=3,e.setLineDash([]),e.font=`bold ${T}px Arial`,t.value.options.showCenterAim&&(e.beginPath(),e.moveTo(-i.value,0),e.lineTo(-1.5*i.value,0),e.stroke(),e.beginPath(),e.arc(0,0,i.value,u(135),u(225)),e.stroke(),e.beginPath(),e.moveTo(i.value,0),e.lineTo(1.5*i.value,0),e.stroke(),e.beginPath(),e.arc(0,0,i.value,u(-45),u(45)),e.stroke()),t.value.options.showRollPitchValues){const d=`r: ${Number(x.value).toFixed(2)}`,n=`p: ${Number(P.value).toFixed(2)}`;e.rotate(u(-p.rollDegrees)),i.value<200?(e.fillText(d,0,D(-1.5*i.value,-.8*s,0)),e.fillText(n,0,D(1.5*i.value,0,.8*s))):(e.textAlign="start",e.fillText(d,-i.value+T,-30),e.fillText(n,-i.value+T,30)),e.stroke()}e.translate(-a,-s),e.globalCompositeOperation="source-in";const A=e.createLinearGradient(0,0,r.value.width,r.value.height);A.addColorStop(0,t.value.options.hudColor),A.addColorStop(1,t.value.options.hudColor),e.fillStyle=A,e.fillRect(0,0,r.value.width,r.value.height)};return V(P,()=>{k.forEach(e=>{const a=-z(q(e-f(w.attitude.pitch)),2);U.to(p.pitchLinesHeights,.1,{[e]:a})})}),V(x,()=>{U.to(p,.1,{rollDegrees:-z(x.value,2)})}),V([p,r,t.value.options],()=>{F.isWidgetVisible(t.value)&&ne(()=>M())}),(e,a)=>(re(),he(me,null,[C("div",Pe,[C("canvas",{ref_key:"canvasRef",ref:b,width:r.value.width,height:r.value.height},null,8,Te)]),l(ge,{modelValue:o(F).widgetManagerVars(o(t).hash).configMenuOpen,"onUpdate:modelValue":a[6]||(a[6]=s=>o(F).widgetManagerVars(o(t).hash).configMenuOpen=s),"min-width":"400","max-width":"45%"},{default:c(()=>[l(de,{class:"pa-4",style:ue([o(B).globalGlassMenuStyles,{"border-radius":"15px"}])},{default:c(()=>[l(ce,{class:"text-center"},{default:c(()=>[E("Attitude widget config")]),_:1}),l(pe,null,{default:c(()=>[C("div",Ae,[l(R,{class:"ma-1",label:"Show roll/pitch values","model-value":o(t).options.showRollPitchValues,color:o(t).options.showRollPitchValues?"white":void 0,"hide-details":"",onChange:a[0]||(a[0]=s=>o(t).options.showRollPitchValues=!o(t).options.showRollPitchValues)},null,8,["model-value","color"]),l(R,{class:"ma-1",label:"Show center aim","model-value":o(t).options.showCenterAim,color:o(t).options.showCenterAim?"white":void 0,"hide-details":"",onChange:a[1]||(a[1]=s=>o(t).options.showCenterAim=!o(t).options.showCenterAim)},null,8,["model-value","color"]),l(R,{class:"ma-1",label:"Show pitch lines","model-value":o(t).options.showPitchLines,color:o(t).options.showPitchLines?"white":void 0,"hide-details":"",onChange:a[2]||(a[2]=s=>o(t).options.showPitchLines=!o(t).options.showPitchLines)},null,8,["model-value","color"])]),De,l(I,{modelValue:o(t).options.pitchHeightFactor,"onUpdate:modelValue":a[3]||(a[3]=s=>o(t).options.pitchHeightFactor=s),label:"Pitch lines gain factor",color:"white",min:1,max:2500,"thumb-label":"",class:"mt-3"},null,8,["modelValue"]),l(I,{modelValue:o(t).options.desiredAimRadius,"onUpdate:modelValue":a[4]||(a[4]=s=>o(t).options.desiredAimRadius=s),label:"Center circle radius",color:"white",min:10,max:300,"thumb-label":""},null,8,["modelValue"]),l(xe,{theme:"dark"},{default:c(()=>[l(Ve,{class:"bg-[#FFFFFF22]"},{default:c(()=>[l(Ce,null,{default:c(()=>[E("Color")]),_:1}),l(Fe,{class:"pa-2"},{default:c(()=>[l(ve,{modelValue:o(t).options.hudColor,"onUpdate:modelValue":a[5]||(a[5]=s=>o(t).options.hudColor=s),class:"ma-1 bg-[#FFFFFF11] text-white",swatches:L.value,"show-swatches":"",width:"100%"},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),Me=be(Re,[["__scopeId","data-v-29e20663"]]);export{Me as default};
