import{by as B,c as T,bb as D,s as o,K as O,a8 as H,J as L,a9 as W,I as G,r as b,L as q,k as y,w as x,ac as J,ad as K,l as c,m,n as s,t as _,F as I,p as C,Q as S,G as r,N as f,V as Q,O as Y,P as X,R as Z,ah as R,a4 as $,a5 as F,W as ee,aj as te,ak as ae,_ as le}from"./index-DU4ycZZa.js";const oe=B("v-banner-text"),d=g=>(te("data-v-db1d9ab5"),g=g(),ae(),g),ne={ref:"videoWidget",class:"video-widget"},se={key:0,class:"no-video-alert"},ie=d(()=>s("span",null,"No video stream selected.",-1)),re=[ie],de={key:1,class:"no-video-alert"},ue=d(()=>s("br",null,null,-1)),ce=d(()=>s("p",null," This can happen if you changed vehicles and the stream name in the new one is different from the former, or if the source is not available at all. ",-1)),me=d(()=>s("br",null,null,-1)),ve=d(()=>s("p",null," Please open this video player configuration and select a new stream from the ones available, or check your source for issues. ",-1)),pe={key:2,class:"no-video-alert"},fe={class:"no-video-alert"},ye=d(()=>s("span",{class:"text-xl font-bold"},"Server status: ",-1)),Se=d(()=>s("br",null,null,-1)),ge=d(()=>s("span",{class:"text-xl font-bold"},"Stream status: ",-1)),he=d(()=>s("br",null,null,-1)),_e={key:3,class:"no-video-alert"},Ve=d(()=>s("p",null,"Loading stream...",-1)),be=[Ve],we={class:"flex-wrap justify-center d-flex ga-5"},xe=T({__name:"VideoPlayer",props:{widget:{}},setup(g){D(l=>({"1dc7ed3a":o(a).options.videoFitStyle,"05151447":E.value}));const M=O(),i=H(),k=L(),{namessAvailableAbstractedStreams:u}=W(i),a=G(g).widget,n=b(),V=b(),v=b(),w=b(!1);q(()=>{const l={videoFitStyle:"cover",flipHorizontally:!1,flipVertically:!1,rotationAngle:0,internalStreamName:void 0};a.value.options=Object.assign({},l,a.value.options),n.value=a.value.options.internalStreamName});const p=y(()=>n.value?i.externalStreamId(n.value):void 0);x(()=>i.streamsCorrespondency,()=>{if(v.value=void 0,!n.value)return;const l=i.externalStreamId(n.value);if(!l)return;const t=i.streamsCorrespondency.find(h=>h.externalId===l);if(!t)return;const e=t.name;n.value!==e&&(n.value=e,a.value.options.internalStreamName=e)},{deep:!0});const P=setInterval(()=>{var l;if(a.value.options.internalStreamName===void 0&&!u.value.isEmpty()&&(a.value.options.internalStreamName=u.value[0],n.value=a.value.options.internalStreamName),p.value!==void 0){const t=i.getMediaStream(p.value);J(t,v.value)||(v.value=t);const e=((l=i.getStreamData(p.value))==null?void 0:l.connected)??!1;e!==w.value&&(w.value=e)}if(!u.value.isEmpty()&&!u.value.includes(n.value)){if(i.lastRenamedStreamName!==""){n.value=i.lastRenamedStreamName;return}n.value=u.value[0]}},1e3);K(()=>clearInterval(P)),x(n,()=>{a.value.options.internalStreamName=n.value,v.value=void 0}),x(v,()=>{!V.value||!v.value||(V.value.srcObject=v.value,V.value.play().then(()=>console.log("[VideoPlayer] Stream is playing")).catch(l=>{const t=`Failed to play stream. Reason: ${l}`;console.error(`[VideoPlayer] ${t}`)}))});const N=l=>{a.value.options.rotationAngle+=l},U=y(()=>`scale(${a.value.options.flipHorizontally?-1:1}, ${a.value.options.flipVertically?-1:1})`),j=y(()=>`rotate(${a.value.options.rotationAngle??0}deg)`),E=y(()=>`${U.value} ${j.value}`),A=y(()=>{var l;return p.value===void 0?"Unknown.":((l=i.getStreamData(p.value))==null?void 0:l.webRtcManager.signallerStatus)??"Unknown."}),z=y(()=>{var t;if(p.value===void 0)return"Unknown.";const l=i.availableIceIps;return!l.isEmpty()&&!l.find(e=>i.allowedIceIps.includes(e))?`Stream is coming from IPs [${l.join(", ")}], which are not in the list of allowed sources
      [${i.allowedIceIps.join(", ")}].\\n Please check your configuration.`:((t=i.getStreamData(p.value))==null?void 0:t.webRtcManager.streamStatus)??"Unknown."});return(l,t)=>(c(),m(I,null,[s("div",ne,[n.value===void 0?(c(),m("div",se,re)):!o(u).isEmpty()&&!o(u).includes(n.value)?(c(),m("div",de,[s("p",null,'The selected stream "'+_(n.value)+'" is not available.',1),s("p",null,"Available ones are: "+_(o(u).map(e=>`"${e}"`).join(", "))+".",1),ue,ce,me,ve])):w.value?(c(),m("div",_e,be)):(c(),m("div",pe,[s("div",fe,[s("p",null,[ye,(c(!0),m(I,null,C(A.value.toString().split("\\n"),(e,h)=>(c(),m("span",{key:h},[S(_(e)+" ",1),Se]))),128))]),s("p",null,[ge,(c(!0),m(I,null,C(z.value.toString().split("\\n"),(e,h)=>(c(),m("span",{key:h},[S(_(e)+" ",1),he]))),128))])])])),s("video",{id:"mainDisplayStream",ref_key:"videoElement",ref:V,muted:"",autoplay:"",playsinline:"",disablePictureInPicture:""}," Your browser does not support the video tag. ",512)],512),r(ee,{modelValue:o(k).widgetManagerVars(o(a).hash).configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=e=>o(k).widgetManagerVars(o(a).hash).configMenuOpen=e),width:"auto"},{default:f(()=>[r(Q,{class:"pa-4 text-white",style:Y([{"border-radius":"15px"},o(M).globalGlassMenuStyles])},{default:f(()=>[r(X,{class:"text-center"},{default:f(()=>[S("Video widget config")]),_:1}),r(Z,{class:"flex flex-col gap-y-4"},{default:f(()=>[r(R,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),label:"Stream name",class:"my-3",items:o(u),"item-title":"name",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue","items"]),r(R,{modelValue:o(a).options.videoFitStyle,"onUpdate:modelValue":t[1]||(t[1]=e=>o(a).options.videoFitStyle=e),label:"Fit style",class:"my-3",items:["cover","fill","contain"],"item-title":"style",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue"]),r(oe,null,{default:f(()=>[S('Saved stream name: "'+_(o(a).options.internalStreamName)+'"',1)]),_:1}),r($,{modelValue:o(a).options.flipHorizontally,"onUpdate:modelValue":t[2]||(t[2]=e=>o(a).options.flipHorizontally=e),class:"my-1",label:"Flip horizontally",color:o(a).options.flipHorizontally?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),r($,{modelValue:o(a).options.flipVertically,"onUpdate:modelValue":t[3]||(t[3]=e=>o(a).options.flipVertically=e),class:"my-1",label:"Flip vertically",color:o(a).options.flipVertically?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),s("div",we,[r(F,{"prepend-icon":"mdi-file-rotate-left",variant:"outlined",onClick:t[4]||(t[4]=e=>N(-90))},{default:f(()=>[S(" Rotate Left")]),_:1}),r(F,{"prepend-icon":"mdi-file-rotate-right",variant:"outlined",onClick:t[5]||(t[5]=e=>N(90))},{default:f(()=>[S(" Rotate Right")]),_:1})])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),Ne=le(xe,[["__scopeId","data-v-db1d9ab5"]]);export{Ne as default};
