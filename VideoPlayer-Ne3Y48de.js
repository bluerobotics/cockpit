import{bB as E,c as T,bf as D,s as l,J as H,P as O,af as G,ah as L,ag as W,r as V,aj as q,k as y,w as x,al as J,V as X,l as u,m as c,n as o,t as h,F as k,p as $,Z as S,G as i,W as m,a4 as Y,X as Z,ar as K,a5 as Q,an as C,aG as F,a2 as M,aa as ee,ad as te,ae,_ as le}from"./index-xH-oGHam.js";const oe=E("v-banner-text"),d=g=>(te("data-v-6d1459df"),g=g(),ae(),g),ne={ref:"videoWidget",class:"video-widget"},se={key:0,class:"no-video-alert"},ie=d(()=>o("span",null,"No video stream selected.",-1)),re=[ie],de={key:1,class:"no-video-alert"},ue=d(()=>o("br",null,null,-1)),ce=d(()=>o("p",null," This can happen if you changed vehicles and the stream name in the new one is different from the former, or if the source is not available at all. ",-1)),pe=d(()=>o("br",null,null,-1)),ve=d(()=>o("p",null," Please open this video player configuration and select a new stream from the ones available, or check your source for issues. ",-1)),me={key:2,class:"no-video-alert"},fe={class:"no-video-alert"},ye=d(()=>o("span",{class:"text-xl font-bold"},"Server status: ",-1)),Se=d(()=>o("br",null,null,-1)),ge=d(()=>o("span",{class:"text-xl font-bold"},"Stream status: ",-1)),he=d(()=>o("br",null,null,-1)),_e={key:3,class:"no-video-alert"},Ve=d(()=>o("p",null,"Loading stream...",-1)),be=[Ve],we={class:"flex-wrap justify-center d-flex ga-5"},xe=T({__name:"VideoPlayer",props:{widget:{}},setup(g){D(n=>({"70fc1c24":l(e).options.videoFitStyle,a8c407dc:A.value}));const P=H(),r=O(),I=G(),{namessAvailableAbstractedStreams:f}=L(r),e=W(g).widget,s=V(),_=V(),p=V(),b=V(!1);q(()=>{const n={videoFitStyle:"cover",flipHorizontally:!1,flipVertically:!1,rotationAngle:0,internalStreamName:void 0};e.value.options=Object.assign({},n,e.value.options),s.value=e.value.options.internalStreamName});const v=y(()=>s.value?r.externalStreamId(s.value):void 0);x(()=>r.streamsCorrespondency,()=>p.value=void 0,{deep:!0});const U=setInterval(()=>{var n;if(e.value.options.internalStreamName===void 0&&!f.value.isEmpty()&&(e.value.options.internalStreamName=f.value[0],s.value=e.value.options.internalStreamName),v.value!==void 0){const t=r.getMediaStream(v.value);J(t,p.value)||(p.value=t);const a=((n=r.getStreamData(v.value))==null?void 0:n.connected)??!1;a!==b.value&&(b.value=a)}},1e3);X(()=>clearInterval(U)),x(s,()=>{e.value.options.internalStreamName=s.value,p.value=void 0}),x(p,()=>{!_.value||!p.value||(_.value.srcObject=p.value,_.value.play().then(()=>console.log("[VideoPlayer] Stream is playing")).catch(n=>{const t=`Failed to play stream. Reason: ${n}`;console.error(`[VideoPlayer] ${t}`)}))});const N=n=>{e.value.options.rotationAngle+=n},j=y(()=>`scale(${e.value.options.flipHorizontally?-1:1}, ${e.value.options.flipVertically?-1:1})`),R=y(()=>`rotate(${e.value.options.rotationAngle??0}deg)`),A=y(()=>`${j.value} ${R.value}`),B=y(()=>{var n;return v.value===void 0?"Unknown.":((n=r.getStreamData(v.value))==null?void 0:n.webRtcManager.signallerStatus)??"Unknown."}),z=y(()=>{var t;if(v.value===void 0)return"Unknown.";const n=r.availableIceIps;return!n.isEmpty()&&!n.find(a=>r.allowedIceIps.includes(a))?`Stream is coming from IPs [${n.join(", ")}], which are not in the list of allowed sources
      [${r.allowedIceIps.join(", ")}].\\n Please check your configuration.`:((t=r.getStreamData(v.value))==null?void 0:t.webRtcManager.streamStatus)??"Unknown."});return(n,t)=>(u(),c(k,null,[o("div",ne,[s.value===void 0?(u(),c("div",se,re)):!l(f).isEmpty()&&!l(f).includes(s.value)?(u(),c("div",de,[o("p",null,'The selected stream "'+h(s.value)+'" is not available.',1),o("p",null,"Available ones are: "+h(l(f).map(a=>`"${a}"`).join(", "))+".",1),ue,ce,pe,ve])):b.value?(u(),c("div",_e,be)):(u(),c("div",me,[o("div",fe,[o("p",null,[ye,(u(!0),c(k,null,$(B.value.toString().split("\\n"),(a,w)=>(u(),c("span",{key:w},[S(h(a)+" ",1),Se]))),128))]),o("p",null,[ge,(u(!0),c(k,null,$(z.value.toString().split("\\n"),(a,w)=>(u(),c("span",{key:w},[S(h(a)+" ",1),he]))),128))])])])),o("video",{id:"mainDisplayStream",ref_key:"videoElement",ref:_,muted:"",autoplay:"",playsinline:"",disablePictureInPicture:""}," Your browser does not support the video tag. ",512)],512),i(ee,{modelValue:l(I).widgetManagerVars(l(e).hash).configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=a=>l(I).widgetManagerVars(l(e).hash).configMenuOpen=a),width:"auto"},{default:m(()=>[i(Y,{class:"pa-4 text-white",style:Z([{"border-radius":"15px"},l(P).globalGlassMenuStyles])},{default:m(()=>[i(K,{class:"text-center"},{default:m(()=>[S("Video widget config")]),_:1}),i(Q,{class:"flex flex-col gap-y-4"},{default:m(()=>[i(C,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=a=>s.value=a),label:"Stream name",class:"my-3",items:l(f),"item-title":"name",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue","items"]),i(C,{modelValue:l(e).options.videoFitStyle,"onUpdate:modelValue":t[1]||(t[1]=a=>l(e).options.videoFitStyle=a),label:"Fit style",class:"my-3",items:["cover","fill","contain"],"item-title":"style",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue"]),i(oe,null,{default:m(()=>[S('Saved stream name: "'+h(l(e).options.internalStreamName)+'"',1)]),_:1}),i(F,{modelValue:l(e).options.flipHorizontally,"onUpdate:modelValue":t[2]||(t[2]=a=>l(e).options.flipHorizontally=a),class:"my-1",label:"Flip horizontally",color:l(e).options.flipHorizontally?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),i(F,{modelValue:l(e).options.flipVertically,"onUpdate:modelValue":t[3]||(t[3]=a=>l(e).options.flipVertically=a),class:"my-1",label:"Flip vertically",color:l(e).options.flipVertically?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),o("div",we,[i(M,{"prepend-icon":"mdi-file-rotate-left",variant:"outlined",onClick:t[4]||(t[4]=a=>N(-90))},{default:m(()=>[S(" Rotate Left")]),_:1}),i(M,{"prepend-icon":"mdi-file-rotate-right",variant:"outlined",onClick:t[5]||(t[5]=a=>N(90))},{default:m(()=>[S(" Rotate Right")]),_:1})])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),Ne=le(xe,[["__scopeId","data-v-6d1459df"]]);export{Ne as default};
