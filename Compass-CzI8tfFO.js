import{d as B,aI as I,m as M,D as P,u as j,p as m,aJ as $,aN as z,x as H,b9 as q,k as F,b0 as L,b1 as l,ba as J,q as A,a$ as T,O as K,ai as X,o as Y,c as G,a as i,h as V,z as Q,aS as Z,b as r,bb as ee,K as te,au as ae,av as se,_ as oe}from"./index-DhJuTBTt.js";import{g as d}from"./index-ZORhgBxb.js";const ne=o=>(ae("data-v-bd381fdb"),o=o(),se(),o),le=["height","width"],ie={class:"w-full h-full"},re={class:"flex flex-col items-center justify-around"},de={class:"flex items-center justify-between w-full my-1"},ce=ne(()=>i("span",{class:"mr-1 text-slate-100"},"Heading style",-1)),ge={class:"w-40"};var R=(o=>(o.NORTH_UP="North Up",o.HEAD_UP="Head Up",o))(R||{});const ue=B({__name:"Compass",props:{widget:{}},setup(o){const U=I();M.registerUsage(P.heading);const y=j(),k=m(),c=m(),b=m(),E={0:"N",45:"NE",90:"E",135:"SE",180:"S",225:"SW",270:"W",315:"NW"},N=Object.values(R),n=$(o).widget;z(()=>{Object.keys(n.value.options).length===0&&(n.value.options={headingStyle:N[0]})}),H(()=>{C(),W()});const{width:_,height:D}=q(k),g=F(()=>_.value<D.value?_.value:D.value),W=()=>{if(c.value===void 0||c.value===null)return;b.value===void 0&&(b.value=c.value.getContext("2d"));const e=b.value;L(e);const t=.5*g.value,s=.13*g.value,p=.03*t;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${s}px Arial`,e.fillStyle="white",e.lineWidth=p,e.textBaseline="middle";const v=.7*t,S=.4*t,x=.55*t;e.translate(t,t),e.font=`bold ${s}px Arial`,e.fillText(`${a.yawAngleDegrees.toFixed(0)}Â°`,.15*s,0),e.rotate(l(-90)),n.value.options.headingStyle=="Head Up"&&e.rotate(l(a.yawAngleDegrees));for(const[w,O]of Object.entries(E))e.save(),e.rotate(l(Number(w))),e.beginPath(),e.moveTo(x,0),e.lineTo(v,0),e.textBaseline="bottom",e.font=`bold ${.7*s}px Arial`,e.translate(v*1.025,0),e.rotate(l(90)),e.fillText(O,0,0),e.stroke(),e.restore();for(const w of J(360))w%9===0&&(e.save(),e.lineWidth=.25*p,e.rotate(l(Number(w))),e.beginPath(),e.moveTo(1.1*x,0),e.lineTo(v,0),e.stroke(),e.restore());e.beginPath(),e.arc(0,0,v,0,l(360)),e.stroke(),n.value.options.headingStyle=="North Up"?e.rotate(l(a.yawAngleDegrees)):e.rotate(-l(a.yawAngleDegrees)),e.beginPath(),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red";const h=.05*t;e.moveTo(S,h),e.lineTo(x-.5*h,0),e.lineTo(S,-h),e.lineTo(S,h),e.closePath(),e.fill(),e.stroke()},u=m(.01);let f;A(y.attitude,e=>{if(f===void 0){u.value=T(y.attitude.yaw),f=e.yaw;return}Math.abs(T(e.yaw-f))>.1&&(f=e.yaw,u.value=T(y.attitude.yaw))});const a=K({yawAngleDegrees:0}),C=()=>{const e=u.value,t=e<0?e+360:e,s=a.yawAngleDegrees>270&&t<90,p=a.yawAngleDegrees<90&&t>270;s?(d.to(a,.05,{yawAngleDegrees:0}),d.fromTo(a,.05,{yawAngleDegrees:0},{yawAngleDegrees:t})):p?(d.to(a,.05,{yawAngleDegrees:360}),d.fromTo(a,.05,{yawAngleDegrees:360},{yawAngleDegrees:t})):d.to(a,.1,{yawAngleDegrees:t})};return A(u,()=>C()),A([a,_,D],()=>{U.isWidgetVisible(n.value)&&X(()=>W())}),(e,t)=>(Y(),G(te,null,[i("div",{ref_key:"compassRoot",ref:k,class:"compass"},[i("canvas",{ref_key:"canvasRef",ref:c,height:g.value,width:g.value,class:"rounded-[15%] bg-slate-950/70"},null,8,le)],512),V(ee,{show:r(n).managerVars.configMenuOpen,"onUpdate:show":t[1]||(t[1]=s=>r(n).managerVars.configMenuOpen=s),class:"w-72"},{default:Q(()=>[i("div",ie,[i("div",re,[i("div",de,[ce,i("div",ge,[V(Z,{modelValue:r(n).options.headingStyle,"onUpdate:modelValue":t[0]||(t[0]=s=>r(n).options.headingStyle=s),options:r(N)},null,8,["modelValue","options"])])])])])]),_:1},8,["show"])],64))}}),he=oe(ue,[["__scopeId","data-v-bd381fdb"]]);export{he as default};
