import{d as N,aF as U,m as $,D as j,u as q,aG as I,p as b,aW as K,k as p,ba as X,aK as J,x as Q,aX as Z,q as Y,aR as k,a_ as ee,af as te,o as ae,c as oe,a as M,h as s,A as r,V as le,B as se,G as W,C as ne,b0 as ie,b as d,b2 as ue,b3 as re,b4 as de,b5 as he,b6 as ce,O as pe,L as ve,aY as fe,_ as ge}from"./index-D0iiEE6n.js";import{w as me}from"./index-DxaGCbJO.js";import{g as y}from"./index-ZORhgBxb.js";const xe={class:"main"},Ve=["width","height"],we=N({__name:"DepthHUD",props:{widget:{}},setup(A){const B=U();$.registerUsage(j.depth);const O=q(),a=I(A).widget,E=b([["#FF2D2D"],["#0ADB0ACC"],["#FFFFFF"]]),n=K({depthLinesY:{},indicatorY:0}),m=b(Array(10).fill(0)),x=p(()=>m.value[m.value.length-1]),R=p(()=>m.value.slice(-10)),L=p(()=>Math.max(...R.value)),f=p(()=>1.3*L.value>10?1.3*L.value:10),V=p(()=>X(0,f.value+1)),z=p(()=>Math.max(...V.value));J(()=>{Object.keys(a.value.options).length===0&&(a.value.options={showDepthValue:!0,hudColor:E.value[2][0]})}),Q(()=>{V.value.forEach(e=>n.depthLinesY[e]=S(e)),P()});const{height:G}=Z(),u=p(()=>({width:128,height:a.value.size.height*G.value}));Y(()=>O.altitude.msl,e=>{const t=-1*fe(e,e,0);Math.abs(t-(x.value||0))>.1&&m.value.push(t)});const S=e=>{const t=e,l=u.value.height/z.value;return k(l*t)},w=b(),_=b(),P=()=>{if(w.value===void 0||w.value===null)return;if(_.value===void 0){console.debug("Canvas context undefined!"),_.value=w.value.getContext("2d");return}const e=_.value,t=u.value.width,l=u.value.height;ee(e);const C=12,h=16,c=10,o=1,H=5,i=10*o;e.textAlign="left",e.textBaseline="middle",e.font=`bold ${C}px Arial`,e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor;let v=[1,5];f.value>25&&(v=[2,10]),f.value>125&&(v=[5,25]),f.value>250&&(v=[10,50]),f.value>500&&(v=[20,100]);for(const[F,g]of Object.entries(n.depthLinesY))Number(F)%v[0]===0&&(e.beginPath(),e.moveTo(t-o-3.3*C-H,g+i),e.lineTo(o+3.9*h+c,g+i),e.lineWidth="1"),Number(F)%v[1]===0&&(e.lineWidth="2",e.moveTo(t-o-3.3*C,g+i),e.lineTo(o+3.9*h+c,g+i),e.fillText(`${F} m`,t-o-3*C,g+i)),e.stroke();const D=Math.max(n.indicatorY,0);e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor,a.value.options.showDepthValue&&(e.textAlign="right",e.font=`bold ${h}px Arial`,e.fillText(`${x.value.toFixed(1)} m`,o+4.3*h-c-o,D+i)),e.beginPath(),e.moveTo(o+4.3*h+o,D+i),e.lineTo(o+4.3*h+o-c,D-c/2+i),e.lineTo(o+4.3*h+o-c,D+c/2+i),e.closePath(),e.fill(),e.globalCompositeOperation="source-in";const T=e.createLinearGradient(t/2,0,t/2,l);T.addColorStop(.95,a.value.options.hudColor),T.addColorStop(1,me(a.value.options.hudColor).alpha(0).toRgbString()),e.fillStyle=T,e.fillRect(0,0,t,l)};return Y(x,()=>{V.value.forEach(t=>{var l;(l=n.depthLinesY)[t]??(l[t]=k(u.value.height+100)),y.to(n.depthLinesY,.5,{[t]:S(t)})}),Object.keys(n.depthLinesY).filter(t=>!V.value.includes(Number(t))).forEach(t=>{y.to(n.depthLinesY,.5,{[t]:k(u.value.height+100)})}),y.to(n,.5,{indicatorY:S(x.value)})}),Y([n,u,a.value.options],()=>{B.isWidgetVisible(a.value)&&te(()=>P())}),(e,t)=>(ae(),oe(ve,null,[M("div",xe,[M("canvas",{ref_key:"canvasRef",ref:w,width:u.value.width,height:u.value.height},null,8,Ve)]),s(pe,{modelValue:d(a).managerVars.configMenuOpen,"onUpdate:modelValue":t[2]||(t[2]=l=>d(a).managerVars.configMenuOpen=l),"min-width":"400","max-width":"35%"},{default:r(()=>[s(le,{class:"pa-2"},{default:r(()=>[s(se,null,{default:r(()=>[W("Depth HUD config")]),_:1}),s(ne,null,{default:r(()=>[s(ie,{class:"ma-1",label:"Show height value","model-value":d(a).options.showDepthValue,color:d(a).options.showDepthValue?"rgb(0, 20, 80)":void 0,"hide-details":"",onChange:t[0]||(t[0]=l=>d(a).options.showDepthValue=!d(a).options.showDepthValue)},null,8,["model-value","color"]),s(ue,null,{default:r(()=>[s(re,null,{default:r(()=>[s(de,null,{default:r(()=>[W("Color")]),_:1}),s(he,null,{default:r(()=>[s(ce,{modelValue:d(a).options.hudColor,"onUpdate:modelValue":t[1]||(t[1]=l=>d(a).options.hudColor=l),class:"ma-2",swatches:E.value,"show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),_e=ge(we,[["__scopeId","data-v-f13c44bf"]]);export{_e as default};
