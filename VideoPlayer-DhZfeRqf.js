import{bG as B,d as z,b0 as P,b as a,p as j,C as A,a4 as D,a6 as E,a5 as O,v as S,a9 as H,ab as L,ac as G,I as K,x,l as v,o as f,c as y,a as o,t as g,i,J as u,T as W,K as Y,al as q,N as V,U as J,ae as N,au as k,R as M,_ as Q,L as X,a1 as Z,a2 as ee,a3 as te}from"./index-Bm_whh5E.js";const ae=B("v-banner-text"),r=p=>(Z("data-v-89458479"),p=p(),ee(),p),oe={ref:"videoWidget",class:"video-widget"},le={key:0,class:"no-video-alert"},se=r(()=>o("span",null,"No video stream selected.",-1)),ne=[se],ie={key:1,class:"no-video-alert"},re=r(()=>o("br",null,null,-1)),de=r(()=>o("p",null," This can happen if you changed vehicles and the stream name in the new one is different from the former, or if the source is not available at all. ",-1)),ue=r(()=>o("br",null,null,-1)),ce=r(()=>o("p",null," Please open this video player configuration and select a new stream from the ones available, or check your source for issues. ",-1)),pe={key:2,class:"no-video-alert"},me={class:"no-video-alert"},ve=r(()=>o("span",{class:"text-xl font-bold"},"Server status: ",-1)),fe=r(()=>o("span",{class:"text-xl font-bold"},"Stream status: ",-1)),ye={key:3,class:"no-video-alert"},ge=r(()=>o("p",null,"Loading stream...",-1)),he=[ge],Se={class:"flex-wrap justify-center d-flex ga-5"},Ve=z({__name:"VideoPlayer",props:{widget:{}},setup(p){P(l=>({"6d6eb657":a(e).options.videoFitStyle,"67b6bc3b":R.value}));const C=j(),m=A(),b=D(),{namesAvailableStreams:d}=E(m),e=O(p).widget,n=S(),h=S(),c=S(),_=S(!1);H(()=>{const l={videoFitStyle:"cover",flipHorizontally:!1,flipVertically:!1,rotationAngle:0,streamName:void 0};e.value.options=Object.assign({},l,e.value.options),n.value=e.value.options.streamName});const U=setInterval(()=>{var s;e.value.options.streamName===void 0&&!d.value.isEmpty()&&(e.value.options.streamName=d.value[0],n.value=e.value.options.streamName,d.value.length>1&&L.fire({title:"Multiple streams detected",text:`You have multiple streams available, so we chose one randomly to start with.
        If you want to change it, please open the widget configuration on the edit-menu.`,icon:"info",confirmButtonText:"OK"}));const l=m.getMediaStream(e.value.options.streamName);G(l,c.value)||(c.value=l);const t=((s=m.getStreamData(e.value.options.streamName))==null?void 0:s.connected)??!1;t!==_.value&&(_.value=t)},1e3);K(()=>clearInterval(U)),x(n,()=>{e.value.options.streamName=n.value,c.value=void 0}),x(c,()=>{!h.value||!c.value||(h.value.srcObject=c.value,h.value.play().then(()=>console.log("[VideoPlayer] Stream is playing")).catch(l=>{const t=`Failed to play stream. Reason: ${l}`;console.error(`[VideoPlayer] ${t}`)}))});const w=l=>{e.value.options.rotationAngle+=l},F=v(()=>`scale(${e.value.options.flipHorizontally?-1:1}, ${e.value.options.flipVertically?-1:1})`),I=v(()=>`rotate(${e.value.options.rotationAngle??0}deg)`),R=v(()=>`${F.value} ${I.value}`),$=v(()=>{var l;return n.value===void 0?"Unknown.":((l=m.getStreamData(n.value))==null?void 0:l.webRtcManager.signallerStatus)??"Unknown."}),T=v(()=>{var l;return n.value===void 0?"Unknown.":((l=m.getStreamData(n.value))==null?void 0:l.webRtcManager.streamStatus)??"Unknown."});return(l,t)=>(f(),y(X,null,[o("div",oe,[n.value===void 0?(f(),y("div",le,ne)):!a(d).isEmpty()&&!a(d).includes(n.value)?(f(),y("div",ie,[o("p",null,'The selected stream "'+g(n.value)+'" is not available.',1),o("p",null,"Available ones are: "+g(a(d).map(s=>`"${s}"`).join(", "))+".",1),re,de,ue,ce])):_.value?(f(),y("div",ye,he)):(f(),y("div",pe,[o("div",me,[o("p",null,[ve,o("span",null,g($.value),1)]),o("p",null,[fe,o("span",null,g(T.value),1)])])])),o("video",{id:"mainDisplayStream",ref_key:"videoElement",ref:h,muted:"",autoplay:"",playsinline:"",disablePictureInPicture:""}," Your browser does not support the video tag. ",512)],512),i(Q,{modelValue:a(b).widgetManagerVars(a(e).hash).configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=s=>a(b).widgetManagerVars(a(e).hash).configMenuOpen=s),width:"auto"},{default:u(()=>[i(W,{class:"pa-4 text-white",style:Y([{"border-radius":"15px"},a(C).globalGlassMenuStyles])},{default:u(()=>[i(q,{class:"text-center"},{default:u(()=>[V("Video widget config")]),_:1}),i(J,{class:"flex flex-col gap-y-4"},{default:u(()=>[i(N,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=s=>n.value=s),label:"Stream name",class:"my-3",items:a(d),"item-title":"name",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue","items"]),i(N,{modelValue:a(e).options.videoFitStyle,"onUpdate:modelValue":t[1]||(t[1]=s=>a(e).options.videoFitStyle=s),label:"Fit style",class:"my-3",items:["cover","fill","contain"],"item-title":"style",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue"]),i(ae,null,{default:u(()=>[V('Saved stream name: "'+g(a(e).options.streamName)+'"',1)]),_:1}),i(k,{modelValue:a(e).options.flipHorizontally,"onUpdate:modelValue":t[2]||(t[2]=s=>a(e).options.flipHorizontally=s),class:"my-1",label:"Flip horizontally",color:a(e).options.flipHorizontally?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),i(k,{modelValue:a(e).options.flipVertically,"onUpdate:modelValue":t[3]||(t[3]=s=>a(e).options.flipVertically=s),class:"my-1",label:"Flip vertically",color:a(e).options.flipVertically?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),o("div",Se,[i(M,{"prepend-icon":"mdi-file-rotate-left",variant:"outlined",onClick:t[4]||(t[4]=s=>w(-90))},{default:u(()=>[V(" Rotate Left")]),_:1}),i(M,{"prepend-icon":"mdi-file-rotate-right",variant:"outlined",onClick:t[5]||(t[5]=s=>w(90))},{default:u(()=>[V(" Rotate Right")]),_:1})])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),xe=te(Ve,[["__scopeId","data-v-89458479"]]);export{xe as default};
