import{d as L,aD as $,aE as G,p as M,D as P,u as B,q as p,b5 as E,l as q,v as x,aZ as g,aX as U,$ as F,x as I,o as N,c as X,a as Z,a_ as j,a$ as a,aq as J}from"./index-LwM1xnc8.js";import{g as A}from"./index-ZORhgBxb.js";const K=["height","width"],O=L({__name:"VirtualHorizon",props:{widget:{}},setup(R){const H=$(),V=G(R).widget;M.registerUsage(P.roll),M.registerUsage(P.pitch);const v=B(),C=p(),r=p(),h=p(),{width:k,height:_}=E(C),T=q(()=>k.value<_.value?k.value:_.value),y=()=>{if(r.value===void 0||r.value===null)return;h.value===void 0&&(h.value=r.value.getContext("2d"));const e=h.value;j(e);const s=.5*T.value,c=.06*T.value,l=.03*s;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${c}px Arial`,e.fillStyle="white",e.lineWidth=l,e.textBaseline="middle";const t=.7*s;e.translate(s,s),e.rotate(a(-90)),e.rotate(a(90)),e.save(),e.strokeStyle="white",e.lineWidth=1.5*l,e.beginPath(),e.arc(0,0,t,0,a(360)),e.stroke(),e.restore(),e.save(),e.rotate(a(-1*i.rollAngleDegrees)),e.beginPath(),e.arc(0,0,t,0,a(360)),e.clip();const S=4,n=S*(i.pitchAngleDegrees/90)*t,w=e.createLinearGradient(0,-t,0,t);w.addColorStop(0,"rgb(69, 144, 190)"),w.addColorStop(1,"rgb(137, 190, 228)"),e.fillStyle=w,e.fillRect(-1.5*t,n,3*t,-3*t);const W=e.createLinearGradient(0,-t,0,t);W.addColorStop(0,"rgb(176, 117, 80)"),W.addColorStop(1,"rgb(200, 149, 98)"),e.fillStyle=W,e.fillRect(-1.5*t,n,3*t,3*t),e.lineWidth=.6*l,e.strokeStyle="white",e.beginPath(),e.moveTo(-.75*t,n),e.lineTo(-.45*t,n),e.lineTo(-.43*t,n+.07*t),e.moveTo(.75*t,n),e.lineTo(.45*t,n),e.lineTo(.43*t,n+.07*t),e.stroke(),e.save(),e.fillStyle="white",e.strokeStyle="white",e.lineWidth=.5*l,e.font=`bold ${c}px Arial`;for(const o of[-10,0,10]){const d=S*Math.abs(o/300)||.15,D=S*(o/90)*t,z=S*((o-5*Math.sign(o))/90)*t;e.beginPath(),e.moveTo(-d*t,D),e.lineTo(+d*t,D),e.moveTo(-.5*d*t,z),e.lineTo(.5*d*t,z),e.stroke(),e.textAlign="right",e.fillText(`${Math.abs(o)}`,-1*(d*t+.3*c),D),e.textAlign="left",e.fillText(`${Math.abs(o)}`,1*(d*t+.3*c),D)}e.restore(),e.restore(),e.save(),e.lineWidth=.8*l,e.rotate(a(-1*i.rollAngleDegrees)),e.beginPath(),e.moveTo(-1*t,0),e.lineTo(-.85*t,0),e.moveTo(.85*t,0),e.lineTo(1*t,0),e.stroke(),e.restore();for(const o of[-60,-45,-30,-20,-10,0,10,20,30,45,60])e.save(),e.rotate(a(o)),e.beginPath(),[-60,-30,30,60].includes(o)?(e.lineWidth=.8*l,e.moveTo(0,-1.2*t),e.lineTo(0,-1*t)):[-20,-10,10,20].includes(o)?(e.lineWidth=.6*l,e.moveTo(0,-1.1*t),e.lineTo(0,-1*t)):[-45,45].includes(o)?(e.lineWidth=.01*l,e.moveTo(0,-1.01*t),e.lineTo(-.05*t,-1.15*t),e.lineTo(.05*t,-1.15*t),e.lineTo(0,-1.01*t)):o===0&&(e.lineWidth=.01*l,e.moveTo(0,-1.01*t),e.lineTo(-.07*t,-1.25*t),e.lineTo(.07*t,-1.25*t),e.lineTo(0,-1.01*t)),e.stroke(),e.fill(),e.restore();e.save(),e.beginPath(),e.rotate(a(90)),e.rotate(a(-1*i.rollAngleDegrees)),e.lineWidth=.01*l,e.fillStyle="rgb(221, 43, 43)",e.moveTo(-1*t,0),e.lineTo(-.8*t,-.08*t),e.lineTo(-.8*t,.08*t),e.lineTo(-1*t,0),e.stroke(),e.fill(),e.restore()},u=p(.01),f=p(.01);let b,m;x(v.attitude,e=>{if(b===void 0||m===void 0){u.value=g(v.attitude.roll),f.value=g(v.attitude.pitch),b=e.roll,m=e.pitch;return}const s=Math.abs(g(e.roll-b)),c=Math.abs(g(e.pitch-m));s>.1&&(b=e.roll,u.value=g(v.attitude.roll)),c>.1&&(m=e.pitch,f.value=g(v.attitude.pitch))});const i=U({pitchAngleDegrees:0,rollAngleDegrees:0});return x(f,()=>{A.to(i,.1,{pitchAngleDegrees:f.value})}),x(u,()=>{A.to(i,.1,{rollAngleDegrees:-1*u.value})}),x([i,k,_],()=>{H.isWidgetVisible(V.value)&&F(()=>y())}),I(()=>{r.value===void 0||r.value===null||(h.value===void 0&&(h.value=r.value.getContext("2d")),A.to(i,.1,{pitchAngleDegrees:f.value}),A.to(i,.1,{rollAngleDegrees:-1*u.value}),y())}),(e,s)=>(N(),X("div",{ref_key:"virtualHorizonRoot",ref:C,class:"virtualHorizon"},[Z("canvas",{ref_key:"canvasRef",ref:r,height:T.value,width:T.value,class:"rounded-[15%] bg-slate-950/70"},null,8,K)],512))}}),te=J(O,[["__scopeId","data-v-fcc20956"]]);export{te as default};
