import{v as ee,I as te,x as ae,y as oe,z as se,A as ne,B as le,C as ie,E as re,F as de,G as Y,H as ue,J as ce,K as ve,L as me,M as fe,N as ge,O as be,f as n,P as he,w as xe,Q as we,R as q,V as T,d as ye,S as pe,T as _e,U as Se,k as h,W as ke,X as Ve,Y as Ce,q as Ne,Z as Re,m as B,i as z,_ as Be,$ as C,a0 as Te,a1 as Me,r as Pe,o as d,c as m,a as c,n as $,b as I,a2 as k,a3 as D,a4 as X,t as H,g as K,h as O,a5 as $e,a6 as Ie,a7 as G,a8 as De,a9 as Oe,aa as We,ab as Ae}from"./index.e70afa68.js";const Fe=ee({bordered:Boolean,color:String,content:[Number,String],dot:Boolean,floating:Boolean,icon:te,inline:Boolean,label:{type:String,default:"$vuetify.badge"},max:[Number,String],modelValue:{type:Boolean,default:!0},offsetX:[Number,String],offsetY:[Number,String],textColor:String,...ae(),...oe({location:"top end"}),...se(),...ne(),...le(),...ie({transition:"scale-rotate-transition"})},"VBadge"),je=re()({name:"VBadge",inheritAttrs:!1,props:Fe(),setup(e,y){const{backgroundColorClasses:u,backgroundColorStyles:W}=de(Y(e,"color")),{roundedClasses:l}=ue(e),{t:a}=ce(),{textColorClasses:x,textColorStyles:N}=ve(Y(e,"textColor")),{themeClasses:R}=me(),{locationStyles:f}=fe(e,!0,s=>{var p,r;return(e.floating?e.dot?2:4:e.dot?8:12)+(["top","bottom"].includes(s)?+((p=e.offsetY)!=null?p:0):["left","right"].includes(s)?+((r=e.offsetX)!=null?r:0):0)});return ge(()=>{const s=Number(e.content),v=!e.max||isNaN(s)?e.content:s<=+e.max?s:`${e.max}+`,[p,r]=be(y.attrs,["aria-atomic","aria-label","aria-live","role","title"]);return n(e.tag,q({class:["v-badge",{"v-badge--bordered":e.bordered,"v-badge--dot":e.dot,"v-badge--floating":e.floating,"v-badge--inline":e.inline},e.class]},r,{style:e.style}),{default:()=>{var g,b;return[n("div",{class:"v-badge__wrapper"},[(b=(g=y.slots).default)==null?void 0:b.call(g),n(he,{transition:e.transition},{default:()=>{var _,V;return[xe(n("span",q({class:["v-badge__badge",R.value,u.value,l.value,x.value],style:[W.value,N.value,e.inline?{}:f.value],"aria-atomic":"true","aria-label":a(e.label,s),"aria-live":"polite",role:"status"},p),[e.dot?void 0:y.slots.badge?(V=(_=y.slots).badge)==null?void 0:V.call(_):e.icon?n(T,{icon:e.icon},null):v]),[[we,e.modelValue]])]}})])]}})}),{}}}),M=e=>(Oe("data-v-583b509c"),e=e(),We(),e),Ee={key:1},Le={class:"text-xs text-white select-none scroll-text"},Ue={key:3,class:"w-16 text-justify text-slate-100"},Ye={key:4,class:"w-16 text-justify text-slate-100"},qe=M(()=>c("div",{class:"text-center text-xs text-white select-none flex-nowrap"},"Processing video...",-1)),ze=[qe],Xe={key:5,class:"flex justify-center w-8"},He={class:"p-6 m-5 bg-white rounded-md"},Ke=M(()=>c("p",{class:"text-xl font-semibold"},"Choose a stream to record",-1)),Ge=M(()=>c("div",{class:"w-auto h-px my-2 bg-grey-lighten-3"},null,-1)),Je={class:"flex items-center"},Qe=M(()=>c("span",null,"Record",-1)),Ze={key:1,class:"w-5 h-5 ml-2 rounded-full bg-red"},et=ye({__name:"MiniVideoRecorder",props:{miniWidget:{}},setup(e){const y=pe(),u=_e(),l=Se(e).miniWidget,a=h(),{namesAvailableStreams:x}=ke(u),N=h(),{isOutside:R}=Ve(N),f=h(!1),s=h(!1),v=h(!1),p=Ce({interval:100}),r=h(),g=h(!1),b=h(0);Ne(async()=>{await _()}),Re(async()=>{Object.keys(l.value.options).length===0&&(l.value.options={streamName:void 0}),a.value=l.value.options.streamName}),B(a,()=>{l.value.options.streamName=a.value,r.value=void 0});const _=async()=>{const o=await u.videoStoringDB.length();b.value=o};function V(o){if(a.value=o,a.value===void 0){C.fire({text:"No stream selected.",icon:"error"});return}if(x.value.includes(a.value))return;const t="The selected stream is not available. Please check its source or select another stream.";throw C.fire({text:t,icon:"error"}),new Error(t)}const J=async()=>{if(w.value){a.value!==void 0&&(u.stopRecording(a.value),g.value=!0);return}if(a.value===void 0){f.value=!0;return}A()},A=()=>{V(a.value),u.startRecording(a.value),f.value=!1},w=z(()=>a.value===void 0?!1:u.isRecording(a.value)),Q=z(()=>{var j,E,L,U;if(a.value===void 0)return"00:00:00";const o=(j=u.getStreamData(a.value))==null?void 0:j.timeRecordingStart;if(o===void 0)return"00:00:00";const t=Be({start:o,end:p.value}),S=((E=t.hours)==null?void 0:E.toFixed(0).length)===1?`0${t.hours}`:t.hours,i=((L=t.minutes)==null?void 0:L.toFixed(0).length)===1?`0${t.minutes}`:t.minutes,P=((U=t.seconds)==null?void 0:U.toFixed(0).length)===1?`0${t.seconds}`:t.seconds;return`${S}:${i}:${P}`}),Z=async o=>{V(o),r.value=void 0,v.value=!0;let t=0;const S=100,i=3e3;for(;v.value&&t<i;)v.value=r.value===void 0||!r.value.active,await new Promise(P=>setTimeout(P,S)),t+=S;if(v.value){C.fire({text:"Could not load media stream.",icon:"error"});return}l.value.options.streamName=o};let F;return y.isRealMiniWidget(l.value)&&(F=setInterval(()=>{if(l.value.options.streamName===void 0&&!x.value.isEmpty()&&(l.value.options.streamName=x.value[0],a.value=l.value.options.streamName,x.value.length>1)){const t=`You have multiple streams available, so we chose one randomly to start with.
          If you want to change it, please open the widget configuration.`;C.fire({title:"Multiple streams detected",text:t,icon:"info",confirmButtonText:"OK"})}const o=u.getMediaStream(l.value.options.streamName);Te(o,r.value)||(r.value=o)},1e3)),Me(()=>clearInterval(F)),B(()=>u.areThereVideosProcessing,o=>{g.value=o,_()}),B(()=>s.value,async o=>{o===!1&&await _()}),B(w,()=>{if(!w.value){window.onbeforeunload=null;return}window.onbeforeunload=()=>{const o=`
      You have a video recording ongoing.
      Remember to stop it before closing Cockpit, or the record will be lost.
    `;return C.fire({text:o,icon:"warning"}),"I hope the user does not click on the leave button."}}),(o,t)=>{const S=Pe("FontAwesomeIcon");return d(),m(X,null,[c("div",{ref_key:"recorderWidget",ref:N,class:$(["flex justify-around px-2 py-1 text-center rounded-lg h-9 align-center bg-slate-800/60",{"w-48":b.value>0,"w-32":b.value<=0}])},[g.value?(d(),m("div",Ee,[n(T,{class:"w-6 h-6 animate-spin",color:"white"},{default:k(()=>[D("mdi-loading")]),_:1})])):(d(),m("div",{key:0,class:$([{"blob red w-5 opacity-100 rounded-sm":w.value,"opacity-30 bg-red-400":I(R)&&!w.value},"w-6 transition-all duration-500 rounded-full aspect-square bg-red-lighten-1 hover:cursor-pointer opacity-70 hover:opacity-90"]),onClick:t[0]||(t[0]=i=>J())},null,2)),w.value?O("",!0):(d(),m(X,{key:2},[a.value?(d(),m("div",{key:0,class:"flex flex-col max-w-[50%] scroll-container transition-all border-blur cursor-pointer",onClick:t[1]||(t[1]=i=>f.value=!0)},[c("div",Le,H(a.value),1)])):(d(),K(S,{key:1,icon:"fa-solid fa-video",class:"h-6 text-slate-100"}))],64)),w.value&&!g.value?(d(),m("div",Ue,H(Q.value),1)):g.value?(d(),m("div",Ye,ze)):O("",!0),b.value>0?(d(),m("div",Xe,[n($e,{vertical:"",class:"h-6"}),n(je,{color:"info",content:b.value,dot:I(R)||s.value,class:"cursor-pointer",onClick:t[3]||(t[3]=i=>s.value=!0)},{default:k(()=>[n(T,{class:"w-6 h-6 text-slate-100 ml-3",onClick:t[2]||(t[2]=i=>s.value=!0)},{default:k(()=>[D(" mdi-video-box ")]),_:1})]),_:1},8,["content","dot"])])):O("",!0)],2),n(G,{modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=i=>f.value=i),width:"auto"},{default:k(()=>[c("div",He,[Ke,Ge,n(Ie,{"model-value":a.value,label:"Stream name",items:I(x),"item-title":"name",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":"","onUpdate:modelValue":Z},null,8,["model-value","items"]),c("div",Je,[c("button",{class:"w-auto p-3 m-2 font-medium transition-all rounded-md shadow-md text-uppercase hover:bg-slate-100",onClick:t[4]||(t[4]=i=>f.value=!1)}," Cancel "),c("button",{class:$(["flex items-center p-3 mx-2 font-medium transition-all rounded-md shadow-md w-fit text-uppercase hover:bg-slate-100",{"bg-slate-200 opacity-30 pointer-events-none":v.value}]),onClick:A},[Qe,v.value?(d(),K(T,{key:0,class:"m-2 animate-spin"},{default:k(()=>[D("mdi-loading")]),_:1})):(d(),m("div",Ze))],2)])])]),_:1},8,["modelValue"]),n(G,{modelValue:s.value,"onUpdate:modelValue":t[6]||(t[6]=i=>s.value=i),width:"900px"},{default:k(()=>[n(De,{"as-video-library":""})]),_:1},8,["modelValue"])],64)}}});const at=Ae(et,[["__scopeId","data-v-583b509c"]]);export{at as default};
