import{d as ee,a2 as te,A as ae,p as $,D as U,u as oe,a3 as le,q as m,am as se,a7 as ie,x as ne,C as re,l as B,an as _,v as f,ao as w,ap as ue,aq as V,ag as k,F as ce,o as de,c as he,a as M,i,H as h,R as pe,I as ve,b as o,aj as ge,L as j,S as me,ar as O,as as I,at as fe,Y as we,J as Ve,a1 as be}from"./index-DCMTW3mg.js";import{g as b}from"./index-ZORhgBxb.js";import{V as xe,a as Ce,b as Fe,c as Te}from"./VExpansionPanel-uZ2fgGgZ.js";const De={class:"main"},Pe=["width","height"],Se={class:"flex justify-center gap-x-8 mb-4"},Ae=ee({__name:"Attitude",props:{widget:{}},setup(q){const D=te(),G=ae();$.registerUsage(U.roll),$.registerUsage(U.pitch);const p=oe(),t=le(q).widget,x=m(),P=m(),C=m(0),F=m(0),T=m(0),S=[-90,-70,-45,-30,-10,0,10,30,45,70,90],s=se({rollDegrees:0,pitchLinesHeights:{},cameraTiltDeg:0,pitchDegrees:0}),y=m([["#FFFFFF"],["#FF2D2D"],["#0ADB0ACC"]]),Y={showCenterAim:!0,showPitchLines:!0,showRollPitchValues:!0,desiredAimRadius:150,hudColor:y.value[0][0],cameraFOV:64};ie(()=>{Object.entries(Y).forEach(([e,a])=>{t.value.options[e]===void 0&&(t.value.options[e]=a)})}),ne(()=>{S.forEach(e=>s.pitchLinesHeights[e]=5*e),H()});const{width:J,height:K}=re(),r=B(()=>({width:t.value.size.width*J.value,height:t.value.size.height*K.value})),n=B(()=>_(t.value.options.desiredAimRadius,35,.2*r.value.width));let N,E;f(p.attitude,e=>{const a=Math.abs(w(e.roll-(N||0))),l=Math.abs(w(e.pitch-(E||0)));a>.1&&(N=e.roll,C.value=w(p.attitude.roll)),l>.1&&(E=e.pitch,F.value=w(p.attitude.pitch))}),f(p.genericVariables,e=>{const a=e.cameraTiltDeg;Math.abs(a-T.value)>.1&&(T.value=a)});const A=e=>{const a=180/t.value.options.cameraFOV;return e/180*a*r.value.height},H=()=>{if(x.value===void 0||x.value===null)return;if(P.value===void 0){console.debug("Canvas context undefined!"),P.value=x.value.getContext("2d");return}const e=P.value;ue(e);const a=.5*r.value.width,l=.5*r.value.height,W=12,R=22,v=2;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${W}px Arial`,e.fillStyle="white";const c=2*n.value;e.translate(a,l),e.rotate(-V(s.rollDegrees));const g=-A(s.cameraTiltDeg+s.pitchDegrees);for(const[d,u]of Object.entries(s.pitchLinesHeights)){e.beginPath();const Q=Number(d)===0?1:.7,X=Number(d)===0?[]:[5,2],Z=Number(d)===0?3:2;if(e.lineWidth=Z,e.setLineDash(X),t.value.options.showPitchLines){const z=c+Q*(a-c);e.moveTo(-z+v,u),e.lineTo(-c,u),e.lineTo(-c+5,u+15),e.fillText(Number(d),-c-4*v,u-3*v),e.moveTo(+z-v,u),e.lineTo(c,u),e.lineTo(c-5,u+15),e.fillText(Number(d),c+4*v,u-3*v),e.stroke()}}if(e.lineWidth=3,e.setLineDash([]),e.font=`bold ${R}px Arial`,t.value.options.showCenterAim&&(e.beginPath(),e.moveTo(-n.value,g),e.lineTo(-1.5*n.value,g),e.stroke(),e.beginPath(),e.arc(0,g,n.value,V(135),V(225)),e.stroke(),e.beginPath(),e.moveTo(n.value,g),e.lineTo(1.5*n.value,g),e.stroke(),e.beginPath(),e.arc(0,g,n.value,V(-45),V(45)),e.stroke()),t.value.options.showRollPitchValues){const d=`r: ${Number(C.value).toFixed(2)}`,u=`p: ${Number(F.value).toFixed(2)}`;e.rotate(V(-s.rollDegrees)),n.value<200?(e.fillText(d,0,_(-1.5*n.value,-.8*l,0)),e.fillText(u,0,_(1.5*n.value,0,.8*l))):(e.textAlign="start",e.fillText(d,-n.value+R,-30),e.fillText(u,-n.value+R,30)),e.stroke()}e.translate(-a,-l),e.globalCompositeOperation="source-in";const L=e.createLinearGradient(0,0,r.value.width,r.value.height);L.addColorStop(0,t.value.options.hudColor),L.addColorStop(1,t.value.options.hudColor),e.fillStyle=L,e.fillRect(0,0,r.value.width,r.value.height)};return f(F,()=>{S.forEach(e=>{const a=-k(A(e+s.cameraTiltDeg-w(p.attitude.pitch)),2);b.to(s.pitchLinesHeights,.1,{[e]:a})}),b.to(s,.1,{pitchDegrees:F.value})}),f(C,()=>{b.to(s,.1,{rollDegrees:-k(C.value,2)})}),f(T,()=>{b.to(s,.1,{cameraTiltDeg:T.value}),S.forEach(e=>{const a=-k(A(e+s.cameraTiltDeg-w(p.attitude.pitch)),2);b.to(s.pitchLinesHeights,.1,{[e]:a})})}),f([s,r,t.value.options],()=>{D.isWidgetVisible(t.value)&&ce(()=>H())}),(e,a)=>(de(),he(Ve,null,[M("div",De,[M("canvas",{ref_key:"canvasRef",ref:x,width:r.value.width,height:r.value.height},null,8,Pe)]),i(we,{modelValue:o(D).widgetManagerVars(o(t).hash).configMenuOpen,"onUpdate:modelValue":a[6]||(a[6]=l=>o(D).widgetManagerVars(o(t).hash).configMenuOpen=l),"min-width":"400","max-width":"45%"},{default:h(()=>[i(pe,{class:"pa-4",style:ve([o(G).globalGlassMenuStyles,{"border-radius":"15px"}])},{default:h(()=>[i(ge,{class:"text-center"},{default:h(()=>[j("Attitude widget config")]),_:1}),i(me,null,{default:h(()=>[M("div",Se,[i(O,{class:"ma-1",label:"Show roll/pitch values","model-value":o(t).options.showRollPitchValues,color:o(t).options.showRollPitchValues?"white":void 0,"hide-details":"",onChange:a[0]||(a[0]=l=>o(t).options.showRollPitchValues=!o(t).options.showRollPitchValues)},null,8,["model-value","color"]),i(O,{class:"ma-1",label:"Show center aim","model-value":o(t).options.showCenterAim,color:o(t).options.showCenterAim?"white":void 0,"hide-details":"",onChange:a[1]||(a[1]=l=>o(t).options.showCenterAim=!o(t).options.showCenterAim)},null,8,["model-value","color"]),i(O,{class:"ma-1",label:"Show pitch lines","model-value":o(t).options.showPitchLines,color:o(t).options.showPitchLines?"white":void 0,"hide-details":"",onChange:a[2]||(a[2]=l=>o(t).options.showPitchLines=!o(t).options.showPitchLines)},null,8,["model-value","color"])]),i(I,{modelValue:o(t).options.cameraFOV,"onUpdate:modelValue":a[3]||(a[3]=l=>o(t).options.cameraFOV=l),color:"white",label:"Camera vertical FOV",min:20,max:180,"thumb-label":""},null,8,["modelValue"]),i(I,{modelValue:o(t).options.desiredAimRadius,"onUpdate:modelValue":a[4]||(a[4]=l=>o(t).options.desiredAimRadius=l),label:"Center circle radius",color:"white",min:10,max:300,"thumb-label":""},null,8,["modelValue"]),i(xe,{theme:"dark"},{default:h(()=>[i(Ce,{class:"bg-[#FFFFFF22]"},{default:h(()=>[i(Fe,null,{default:h(()=>[j("Color")]),_:1}),i(Te,{class:"pa-2"},{default:h(()=>[i(fe,{modelValue:o(t).options.hudColor,"onUpdate:modelValue":a[5]||(a[5]=l=>o(t).options.hudColor=l),class:"ma-1 bg-[#FFFFFF11] text-white",swatches:y.value,"show-swatches":"",width:"100%"},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),Me=be(Ae,[["__scopeId","data-v-893aaf8b"]]);export{Me as default};
