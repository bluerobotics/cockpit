import{d as R,aD as $,p as G,D as j,u as q,aE as I,q as b,aX as Q,l as p,b7 as X,aI as J,x as K,a8 as Z,v as F,aQ as E,a_ as ee,$ as ae,o as te,c as oe,a as M,i as s,a1 as r,ag as le,aU as se,a4 as U,ah as ne,b0 as ie,b as d,b2 as ue,al as re,ab as de,aY as he,aq as ce}from"./index-BESBKmwR.js";import{w as pe}from"./index-DxaGCbJO.js";import{g as k}from"./index-ZORhgBxb.js";import{V as ve,a as fe,b as ge,c as me}from"./VExpansionPanel-BLlFuY8a.js";const xe={class:"main"},Ve=["width","height"],we=R({__name:"DepthHUD",props:{widget:{}},setup(W){const z=$();G.registerUsage(j.depth);const A=q(),t=I(W).widget,y=b([["#FF2D2D"],["#0ADB0ACC"],["#FFFFFF"]]),n=Q({depthLinesY:{},indicatorY:0}),m=b(Array(10).fill(0)),x=p(()=>m.value[m.value.length-1]),B=p(()=>m.value.slice(-10)),P=p(()=>Math.max(...B.value)),f=p(()=>1.3*P.value>10?1.3*P.value:10),V=p(()=>X(0,f.value+1)),H=p(()=>Math.max(...V.value));J(()=>{Object.keys(t.value.options).length===0&&(t.value.options={showDepthValue:!0,hudColor:y.value[2][0]})}),K(()=>{V.value.forEach(e=>n.depthLinesY[e]=S(e)),L()});const{height:N}=Z(),u=p(()=>({width:128,height:t.value.size.height*N.value}));F(()=>A.altitude.msl,e=>{const a=-1*he(e,e,0);Math.abs(a-(x.value||0))>.1&&m.value.push(a)});const S=e=>{const a=e,l=u.value.height/H.value;return E(l*a)},w=b(),T=b(),L=()=>{if(w.value===void 0||w.value===null)return;if(T.value===void 0){console.debug("Canvas context undefined!"),T.value=w.value.getContext("2d");return}const e=T.value,a=u.value.width,l=u.value.height;ee(e);const D=12,h=16,c=10,o=1,O=5,i=10*o;e.textAlign="left",e.textBaseline="middle",e.font=`bold ${D}px Arial`,e.strokeStyle=t.value.options.hudColor,e.fillStyle=t.value.options.hudColor;let v=[1,5];f.value>25&&(v=[2,10]),f.value>125&&(v=[5,25]),f.value>250&&(v=[10,50]),f.value>500&&(v=[20,100]);for(const[Y,g]of Object.entries(n.depthLinesY))Number(Y)%v[0]===0&&(e.beginPath(),e.moveTo(a-o-3.3*D-O,g+i),e.lineTo(o+3.9*h+c,g+i),e.lineWidth="1"),Number(Y)%v[1]===0&&(e.lineWidth="2",e.moveTo(a-o-3.3*D,g+i),e.lineTo(o+3.9*h+c,g+i),e.fillText(`${Y} m`,a-o-3*D,g+i)),e.stroke();const C=Math.max(n.indicatorY,0);e.strokeStyle=t.value.options.hudColor,e.fillStyle=t.value.options.hudColor,t.value.options.showDepthValue&&(e.textAlign="right",e.font=`bold ${h}px Arial`,e.fillText(`${x.value.toFixed(1)} m`,o+4.3*h-c-o,C+i)),e.beginPath(),e.moveTo(o+4.3*h+o,C+i),e.lineTo(o+4.3*h+o-c,C-c/2+i),e.lineTo(o+4.3*h+o-c,C+c/2+i),e.closePath(),e.fill(),e.globalCompositeOperation="source-in";const _=e.createLinearGradient(a/2,0,a/2,l);_.addColorStop(.95,t.value.options.hudColor),_.addColorStop(1,pe(t.value.options.hudColor).alpha(0).toRgbString()),e.fillStyle=_,e.fillRect(0,0,a,l)};return F(x,()=>{V.value.forEach(a=>{var l;(l=n.depthLinesY)[a]??(l[a]=E(u.value.height+100)),k.to(n.depthLinesY,.5,{[a]:S(a)})}),Object.keys(n.depthLinesY).filter(a=>!V.value.includes(Number(a))).forEach(a=>{k.to(n.depthLinesY,.5,{[a]:E(u.value.height+100)})}),k.to(n,.5,{indicatorY:S(x.value)})}),F([n,u,t.value.options],()=>{z.isWidgetVisible(t.value)&&ae(()=>L())}),(e,a)=>(te(),oe(de,null,[M("div",xe,[M("canvas",{ref_key:"canvasRef",ref:w,width:u.value.width,height:u.value.height},null,8,Ve)]),s(re,{modelValue:d(t).managerVars.configMenuOpen,"onUpdate:modelValue":a[2]||(a[2]=l=>d(t).managerVars.configMenuOpen=l),"min-width":"400","max-width":"35%"},{default:r(()=>[s(le,{class:"pa-2"},{default:r(()=>[s(se,null,{default:r(()=>[U("Depth HUD config")]),_:1}),s(ne,null,{default:r(()=>[s(ie,{class:"ma-1",label:"Show height value","model-value":d(t).options.showDepthValue,color:d(t).options.showDepthValue?"rgb(0, 20, 80)":void 0,"hide-details":"",onChange:a[0]||(a[0]=l=>d(t).options.showDepthValue=!d(t).options.showDepthValue)},null,8,["model-value","color"]),s(ve,null,{default:r(()=>[s(fe,null,{default:r(()=>[s(ge,null,{default:r(()=>[U("Color")]),_:1}),s(me,null,{default:r(()=>[s(ue,{modelValue:d(t).options.hudColor,"onUpdate:modelValue":a[1]||(a[1]=l=>d(t).options.hudColor=l),class:"ma-2",swatches:y.value,"show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),_e=ce(we,[["__scopeId","data-v-f13c44bf"]]);export{_e as default};
