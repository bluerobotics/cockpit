import{d as U,am as G,p as $,D as j,u as J,an as q,q as S,aG as I,l as p,aS as K,ar as Q,x as X,C as Z,v as L,az as M,aJ as ee,F as te,o as ae,c as oe,a as H,i as s,H as d,R as le,aD as se,L as z,S as ne,aL as ie,b as n,aN as ue,Y as re,J as de,aH as he,a1 as ce}from"./index-CJuRviIl.js";import{w as pe}from"./index-DxaGCbJO.js";import{g as k}from"./index-ZORhgBxb.js";import{V as ve,a as fe,b as ge,c as me}from"./VExpansionPanel-5d7eYaWr.js";const xe={class:"main"},we=["width","height"],Ve=U({__name:"DepthHUD",props:{widget:{}},setup(N){const b=G();$.registerUsage(j.depth);const R=J(),a=q(N).widget,y=S([["#FF2D2D"],["#0ADB0ACC"],["#FFFFFF"]]),i=I({depthLinesY:{},indicatorY:0}),m=S(Array(10).fill(0)),x=p(()=>m.value[m.value.length-1]),W=p(()=>m.value.slice(-10)),E=p(()=>Math.max(...W.value)),f=p(()=>1.3*E.value>10?1.3*E.value:10),w=p(()=>K(0,f.value+1)),A=p(()=>Math.max(...w.value));Q(()=>{Object.keys(a.value.options).length===0&&(a.value.options={showDepthValue:!0,hudColor:y.value[2][0]})}),X(()=>{w.value.forEach(e=>i.depthLinesY[e]=T(e)),P()});const{height:B}=Z(),r=p(()=>({width:128,height:a.value.size.height*B.value}));L(()=>R.altitude.msl,e=>{const t=-1*he(e,e,0);Math.abs(t-(x.value||0))>.1&&m.value.push(t)});const T=e=>{const t=e,l=r.value.height/A.value;return M(l*t)},V=S(),_=S(),P=()=>{if(V.value===void 0||V.value===null)return;if(_.value===void 0){console.debug("Canvas context undefined!"),_.value=V.value.getContext("2d");return}const e=_.value,t=r.value.width,l=r.value.height;ee(e);const C=12,h=16,c=10,o=1,O=5,u=10*o;e.textAlign="left",e.textBaseline="middle",e.font=`bold ${C}px Arial`,e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor;let v=[1,5];f.value>25&&(v=[2,10]),f.value>125&&(v=[5,25]),f.value>250&&(v=[10,50]),f.value>500&&(v=[20,100]);for(const[Y,g]of Object.entries(i.depthLinesY))Number(Y)%v[0]===0&&(e.beginPath(),e.moveTo(t-o-3.3*C-O,g+u),e.lineTo(o+3.9*h+c,g+u),e.lineWidth="1"),Number(Y)%v[1]===0&&(e.lineWidth="2",e.moveTo(t-o-3.3*C,g+u),e.lineTo(o+3.9*h+c,g+u),e.fillText(`${Y} m`,t-o-3*C,g+u)),e.stroke();const D=Math.max(i.indicatorY,0);e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor,a.value.options.showDepthValue&&(e.textAlign="right",e.font=`bold ${h}px Arial`,e.fillText(`${x.value.toFixed(1)} m`,o+4.3*h-c-o,D+u)),e.beginPath(),e.moveTo(o+4.3*h+o,D+u),e.lineTo(o+4.3*h+o-c,D-c/2+u),e.lineTo(o+4.3*h+o-c,D+c/2+u),e.closePath(),e.fill(),e.globalCompositeOperation="source-in";const F=e.createLinearGradient(t/2,0,t/2,l);F.addColorStop(.95,a.value.options.hudColor),F.addColorStop(1,pe(a.value.options.hudColor).alpha(0).toRgbString()),e.fillStyle=F,e.fillRect(0,0,t,l)};return L(x,()=>{w.value.forEach(t=>{var l;(l=i.depthLinesY)[t]??(l[t]=M(r.value.height+100)),k.to(i.depthLinesY,.5,{[t]:T(t)})}),Object.keys(i.depthLinesY).filter(t=>!w.value.includes(Number(t))).forEach(t=>{k.to(i.depthLinesY,.5,{[t]:M(r.value.height+100)})}),k.to(i,.5,{indicatorY:T(x.value)})}),L([i,r,a.value.options],()=>{b.isWidgetVisible(a.value)&&te(()=>P())}),(e,t)=>(ae(),oe(de,null,[H("div",xe,[H("canvas",{ref_key:"canvasRef",ref:V,width:r.value.width,height:r.value.height},null,8,we)]),s(re,{modelValue:n(b).widgetManagerVars(n(a).hash).configMenuOpen,"onUpdate:modelValue":t[2]||(t[2]=l=>n(b).widgetManagerVars(n(a).hash).configMenuOpen=l),"min-width":"400","max-width":"35%"},{default:d(()=>[s(le,{class:"pa-2"},{default:d(()=>[s(se,null,{default:d(()=>[z("Depth HUD config")]),_:1}),s(ne,null,{default:d(()=>[s(ie,{class:"ma-1",label:"Show height value","model-value":n(a).options.showDepthValue,color:n(a).options.showDepthValue?"rgb(0, 20, 80)":void 0,"hide-details":"",onChange:t[0]||(t[0]=l=>n(a).options.showDepthValue=!n(a).options.showDepthValue)},null,8,["model-value","color"]),s(ve,null,{default:d(()=>[s(fe,null,{default:d(()=>[s(ge,null,{default:d(()=>[z("Color")]),_:1}),s(me,null,{default:d(()=>[s(ue,{modelValue:n(a).options.hudColor,"onUpdate:modelValue":t[1]||(t[1]=l=>n(a).options.hudColor=l),class:"ma-2",swatches:y.value,"show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),_e=ce(Ve,[["__scopeId","data-v-d83eedf3"]]);export{_e as default};
