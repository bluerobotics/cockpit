import{d as V,an as U,q as f,x as B,v as m,o as I,j as $,a as c,U as L,aO as H,aP as z,am as F,p as q,D as G,u as J,ar as K,aQ as Q,l as X,aJ as Y,aK as u,aR as Z,aI as N,aG as ee,F as te,c as ae,i as P,H as se,ay as oe,b as g,J as ne,$ as le,a0 as ie,a1 as re}from"./index-CJuRviIl.js";import{g as h}from"./index-ZORhgBxb.js";const ce=V({__name:"Dialog",props:{show:Boolean},emits:["update:show"],setup(o,{emit:v}){const p=o,w=v,d=U(p).show,n=f(d.value),r=f(),y=f();return B(()=>{r.value.addEventListener("click",a=>{!a.target||a.target instanceof HTMLElement&&!a.target.closest(".action-button")&&a.target.nodeName!=="DIALOG"||(n.value=!1)}),document.addEventListener("keydown",a=>{n.value&&a.key==="Escape"&&(a.preventDefault(),a.stopImmediatePropagation(),n.value=!1)},{passive:!1})}),m(d,()=>n.value=d.value),m(n,()=>{n.value?r.value.showModal():(r.value.setAttribute("closing",""),r.value.addEventListener("animationend",()=>{r.value.removeAttribute("closing"),r.value.close()},{once:!0})),w("update:show",n.value)}),(a,l)=>(I(),$(z,{to:"body"},[c("dialog",{ref_key:"dialogRef",ref:r,class:"modal"},[c("div",L({ref_key:"dialogContentRef",ref:y},a.$attrs,{class:"flex flex-col items-center justify-center w-full h-full p-5 backdrop-blur-sm"}),[H(a.$slots,"default")],16)],512)]))}}),de=o=>(le("data-v-5f53c690"),o=o(),ie(),o),ue=["height","width"],ge={class:"w-full h-full"},fe={class:"flex flex-col items-center justify-around"},ve={class:"flex items-center justify-between w-full my-1"},pe=de(()=>c("span",{class:"mr-1 text-slate-100"},"Heading style",-1)),he={class:"w-40"};var O=(o=>(o.NORTH_UP="North Up",o.HEAD_UP="Head Up",o))(O||{});const me=V({__name:"Compass",props:{widget:{}},setup(o){const v=F();q.registerUsage(G.heading);const p=J(),w=f(),d=f(),n=f(),r={0:"N",45:"NE",90:"E",135:"SE",180:"S",225:"SW",270:"W",315:"NW"},y=Object.values(O),l=U(o).widget;K(()=>{Object.keys(l.value.options).length===0&&(l.value.options={headingStyle:y[0]})}),B(()=>{M(),W()});const{width:T,height:R}=Q(w),_=X(()=>T.value<R.value?T.value:R.value),W=()=>{if(d.value===void 0||d.value===null)return;n.value===void 0&&(n.value=d.value.getContext("2d"));const e=n.value;Y(e);const t=.5*_.value,i=.13*_.value,A=.03*t;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${i}px Arial`,e.fillStyle="white",e.lineWidth=A,e.textBaseline="middle";const S=.7*t,C=.4*t,E=.55*t;e.translate(t,t),e.font=`bold ${i}px Arial`,e.fillText(`${s.yawAngleDegrees.toFixed(0)}Â°`,.15*i,0),e.rotate(u(-90)),l.value.options.headingStyle=="Head Up"&&e.rotate(-u(s.yawAngleDegrees));for(const[k,j]of Object.entries(r))e.save(),e.rotate(u(Number(k))),e.beginPath(),e.moveTo(E,0),e.lineTo(S,0),e.textBaseline="bottom",e.font=`bold ${.7*i}px Arial`,e.translate(S*1.025,0),e.rotate(u(90)),e.fillText(j,0,0),e.stroke(),e.restore();for(const k of Z(360))k%9===0&&(e.save(),e.lineWidth=.25*A,e.rotate(u(Number(k))),e.beginPath(),e.moveTo(1.1*E,0),e.lineTo(S,0),e.stroke(),e.restore());e.beginPath(),e.arc(0,0,S,0,u(360)),e.stroke(),l.value.options.headingStyle=="North Up"?e.rotate(u(s.yawAngleDegrees)):e.rotate(u(s.yawAngleDegrees)),e.beginPath(),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red";const x=.05*t;e.moveTo(C,x),e.lineTo(E-.5*x,0),e.lineTo(C,-x),e.lineTo(C,x),e.closePath(),e.fill(),e.stroke()},D=f(.01);let b;m(p.attitude,e=>{if(b===void 0){D.value=N(p.attitude.yaw),b=e.yaw;return}Math.abs(N(e.yaw-b))>.1&&(b=e.yaw,D.value=N(p.attitude.yaw))});const s=ee({yawAngleDegrees:0}),M=()=>{const e=D.value,t=e<0?e+360:e,i=s.yawAngleDegrees>270&&t<90,A=s.yawAngleDegrees<90&&t>270;i?(h.to(s,.05,{yawAngleDegrees:0}),h.fromTo(s,.05,{yawAngleDegrees:0},{yawAngleDegrees:t})):A?(h.to(s,.05,{yawAngleDegrees:360}),h.fromTo(s,.05,{yawAngleDegrees:360},{yawAngleDegrees:t})):h.to(s,.1,{yawAngleDegrees:t})};return m(D,()=>M()),m([s,T,R],()=>{v.isWidgetVisible(l.value)&&te(()=>W())}),(e,t)=>(I(),ae(ne,null,[c("div",{ref_key:"compassRoot",ref:w,class:"compass"},[c("canvas",{ref_key:"canvasRef",ref:d,height:_.value,width:_.value,class:"rounded-[15%] bg-slate-950/70"},null,8,ue)],512),P(ce,{show:g(v).widgetManagerVars(g(l).hash).configMenuOpen,"onUpdate:show":t[1]||(t[1]=i=>g(v).widgetManagerVars(g(l).hash).configMenuOpen=i),class:"w-72"},{default:se(()=>[c("div",ge,[c("div",fe,[c("div",ve,[pe,c("div",he,[P(oe,{modelValue:g(l).options.headingStyle,"onUpdate:modelValue":t[0]||(t[0]=i=>g(l).options.headingStyle=i),options:g(y)},null,8,["modelValue","options"])])])])])]),_:1},8,["show"])],64))}}),_e=re(me,[["__scopeId","data-v-5f53c690"]]);export{_e as default};
