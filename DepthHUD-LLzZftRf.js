import{d as R,p as j,a4 as J,q as I,D as q,u as K,a5 as Q,v as S,an as X,l as d,aA as Z,z as ee,a9 as te,A as ae,G as oe,x as Y,y as se,ah as P,ar as le,H as ne,o as ie,c as ue,a as z,i as n,J as h,T as re,K as de,b as l,ak as he,N as O,U as ce,at as pe,av as ve,_ as fe,L as ge,a3 as me}from"./index-BtyyqwBU.js";import{w as we}from"./index-DxaGCbJO.js";import{g as k}from"./index-ZORhgBxb.js";import{V as xe,a as Ve,b as Ce,c as De}from"./VExpansionPanel-CrmZHQP8.js";const Se={class:"main"},be=["width","height"],Fe=R({__name:"DepthHUD",props:{widget:{}},setup(H){const b=j(),F=J();I.registerUsage(q.depth);const A=K(),a=Q(H).widget,E=S([["#FF2D2D"],["#0ADB0ACC"],["#FFFFFF"]]),i=X({depthLinesY:{},indicatorY:0}),w=S(Array(10).fill(0)),x=d(()=>w.value[w.value.length-1]),W=d(()=>w.value.slice(-10)),L=d(()=>Math.max(...W.value)),g=d(()=>1.3*L.value>10?1.3*L.value:10),V=d(()=>Z(0,g.value+1)),$=d(()=>Math.max(...V.value)),U=d(()=>ee[b.displayUnitPreferences.distance]);te(()=>{Object.keys(a.value.options).length===0&&(a.value.options={showDepthValue:!0,hudColor:E.value[2][0]})}),ae(()=>{V.value.forEach(e=>i.depthLinesY[e]=T(e)),N()});const{height:B}=oe(),r=d(()=>({width:128,height:a.value.size.height*B.value}));Y(A.altitude,()=>{const e=A.altitude.msl,t=se(-e.value,e.toJSON().unit);if(Math.abs(t.value-(x.value||0))<.1)return;const v=t.to(b.displayUnitPreferences.distance);w.value.push(v.toJSON().value)});const T=e=>{const t=e,s=r.value.height/$.value;return P(s*t)},C=S(),_=S(),N=()=>{if(C.value===void 0||C.value===null)return;if(_.value===void 0){console.debug("Canvas context undefined!"),_.value=C.value.getContext("2d");return}const e=_.value,t=r.value.width,s=r.value.height;le(e);const v=12,c=16,p=10,o=1,G=5,u=10*o;e.textAlign="left",e.textBaseline="middle",e.font=`bold ${v}px Arial`,e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor;let f=[1,5];g.value>25&&(f=[2,10]),g.value>125&&(f=[5,25]),g.value>250&&(f=[10,50]),g.value>500&&(f=[20,100]);for(const[M,m]of Object.entries(i.depthLinesY))Number(M)%f[0]===0&&(e.beginPath(),e.moveTo(t-o-3.3*v-G,m+u),e.lineTo(o+3.9*c+p,m+u),e.lineWidth="1"),Number(M)%f[1]===0&&(e.lineWidth="2",e.moveTo(t-o-3.3*v,m+u),e.lineTo(o+3.9*c+p,m+u),e.fillText(`${M} ${U.value}`,t-o-3*v,m+u)),e.stroke();const D=Math.max(i.indicatorY,0);e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor,a.value.options.showDepthValue&&(e.textAlign="right",e.font=`bold ${c}px Arial`,e.fillText(`${x.value.toFixed(1)} ${U.value}`,o+4.3*c-p-o,D+u)),e.beginPath(),e.moveTo(o+4.3*c+o,D+u),e.lineTo(o+4.3*c+o-p,D-p/2+u),e.lineTo(o+4.3*c+o-p,D+p/2+u),e.closePath(),e.fill(),e.globalCompositeOperation="source-in";const y=e.createLinearGradient(t/2,0,t/2,s);y.addColorStop(.95,a.value.options.hudColor),y.addColorStop(1,we(a.value.options.hudColor).alpha(0).toRgbString()),e.fillStyle=y,e.fillRect(0,0,t,s)};return Y(x,()=>{V.value.forEach(t=>{var s;(s=i.depthLinesY)[t]??(s[t]=P(r.value.height+100)),k.to(i.depthLinesY,.5,{[t]:T(t)})}),Object.keys(i.depthLinesY).filter(t=>!V.value.includes(Number(t))).forEach(t=>{k.to(i.depthLinesY,.5,{[t]:P(r.value.height+100)})}),k.to(i,.5,{indicatorY:T(x.value)})}),Y([i,r,a.value.options],()=>{F.isWidgetVisible(a.value)&&ne(()=>N())}),(e,t)=>(ie(),ue(ge,null,[z("div",Se,[z("canvas",{ref_key:"canvasRef",ref:C,width:r.value.width,height:r.value.height},null,8,be)]),n(fe,{modelValue:l(F).widgetManagerVars(l(a).hash).configMenuOpen,"onUpdate:modelValue":t[2]||(t[2]=s=>l(F).widgetManagerVars(l(a).hash).configMenuOpen=s),"min-width":"400","max-width":"35%"},{default:h(()=>[n(re,{class:"pa-2",style:de(l(b).globalGlassMenuStyles)},{default:h(()=>[n(he,null,{default:h(()=>[O("Depth HUD config")]),_:1}),n(ce,null,{default:h(()=>[n(pe,{class:"ma-1",label:"Show height value","model-value":l(a).options.showDepthValue,color:l(a).options.showDepthValue?"white":void 0,"hide-details":"",onChange:t[0]||(t[0]=s=>l(a).options.showDepthValue=!l(a).options.showDepthValue)},null,8,["model-value","color"]),n(xe,null,{default:h(()=>[n(Ve,{class:"bg-[#FFFFFF22] text-white"},{default:h(()=>[n(Ce,null,{default:h(()=>[O("Color")]),_:1}),n(De,null,{default:h(()=>[n(ve,{modelValue:l(a).options.hudColor,"onUpdate:modelValue":t[1]||(t[1]=s=>l(a).options.hudColor=s),class:"ma-2 text-white bg-[#FFFFFF22]",swatches:E.value,width:"100%","show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),Pe=me(Fe,[["__scopeId","data-v-5fa15baf"]]);export{Pe as default};
