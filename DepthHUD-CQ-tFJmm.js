import{d as G,A as $,a2 as j,p as I,D as q,u as J,a3 as K,q as F,am as Q,l as p,ay as X,a7 as Z,x as ee,C as te,v as Y,ag as M,ap as ae,F as oe,o as se,c as le,a as A,i as n,H as h,R as ne,I as ie,b as l,aj as re,L as z,S as ue,ar as he,at as de,Y as ce,J as pe,an as ve,a1 as fe}from"./index-BdjFolay.js";import{w as ge}from"./index-DxaGCbJO.js";import{g as k}from"./index-ZORhgBxb.js";import{V as me,a as we,b as xe,c as Ve}from"./VExpansionPanel-D5D0XBdR.js";const Ce={class:"main"},De=["width","height"],Fe=G({__name:"DepthHUD",props:{widget:{}},setup(H){const R=$(),S=j();I.registerUsage(q.depth);const W=J(),a=K(H).widget,E=F([["#FF2D2D"],["#0ADB0ACC"],["#FFFFFF"]]),i=Q({depthLinesY:{},indicatorY:0}),m=F(Array(10).fill(0)),w=p(()=>m.value[m.value.length-1]),B=p(()=>m.value.slice(-10)),L=p(()=>Math.max(...B.value)),f=p(()=>1.3*L.value>10?1.3*L.value:10),x=p(()=>X(0,f.value+1)),N=p(()=>Math.max(...x.value));Z(()=>{Object.keys(a.value.options).length===0&&(a.value.options={showDepthValue:!0,hudColor:E.value[2][0]})}),ee(()=>{x.value.forEach(e=>i.depthLinesY[e]=b(e)),P()});const{height:O}=te(),u=p(()=>({width:128,height:a.value.size.height*O.value}));Y(()=>W.altitude.msl,e=>{const t=-1*ve(e,e,0);Math.abs(t-(w.value||0))>.1&&m.value.push(t)});const b=e=>{const t=e,s=u.value.height/N.value;return M(s*t)},V=F(),T=F(),P=()=>{if(V.value===void 0||V.value===null)return;if(T.value===void 0){console.debug("Canvas context undefined!"),T.value=V.value.getContext("2d");return}const e=T.value,t=u.value.width,s=u.value.height;ae(e);const C=12,d=16,c=10,o=1,U=5,r=10*o;e.textAlign="left",e.textBaseline="middle",e.font=`bold ${C}px Arial`,e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor;let v=[1,5];f.value>25&&(v=[2,10]),f.value>125&&(v=[5,25]),f.value>250&&(v=[10,50]),f.value>500&&(v=[20,100]);for(const[y,g]of Object.entries(i.depthLinesY))Number(y)%v[0]===0&&(e.beginPath(),e.moveTo(t-o-3.3*C-U,g+r),e.lineTo(o+3.9*d+c,g+r),e.lineWidth="1"),Number(y)%v[1]===0&&(e.lineWidth="2",e.moveTo(t-o-3.3*C,g+r),e.lineTo(o+3.9*d+c,g+r),e.fillText(`${y} m`,t-o-3*C,g+r)),e.stroke();const D=Math.max(i.indicatorY,0);e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor,a.value.options.showDepthValue&&(e.textAlign="right",e.font=`bold ${d}px Arial`,e.fillText(`${w.value.toFixed(1)} m`,o+4.3*d-c-o,D+r)),e.beginPath(),e.moveTo(o+4.3*d+o,D+r),e.lineTo(o+4.3*d+o-c,D-c/2+r),e.lineTo(o+4.3*d+o-c,D+c/2+r),e.closePath(),e.fill(),e.globalCompositeOperation="source-in";const _=e.createLinearGradient(t/2,0,t/2,s);_.addColorStop(.95,a.value.options.hudColor),_.addColorStop(1,ge(a.value.options.hudColor).alpha(0).toRgbString()),e.fillStyle=_,e.fillRect(0,0,t,s)};return Y(w,()=>{x.value.forEach(t=>{var s;(s=i.depthLinesY)[t]??(s[t]=M(u.value.height+100)),k.to(i.depthLinesY,.5,{[t]:b(t)})}),Object.keys(i.depthLinesY).filter(t=>!x.value.includes(Number(t))).forEach(t=>{k.to(i.depthLinesY,.5,{[t]:M(u.value.height+100)})}),k.to(i,.5,{indicatorY:b(w.value)})}),Y([i,u,a.value.options],()=>{S.isWidgetVisible(a.value)&&oe(()=>P())}),(e,t)=>(se(),le(pe,null,[A("div",Ce,[A("canvas",{ref_key:"canvasRef",ref:V,width:u.value.width,height:u.value.height},null,8,De)]),n(ce,{modelValue:l(S).widgetManagerVars(l(a).hash).configMenuOpen,"onUpdate:modelValue":t[2]||(t[2]=s=>l(S).widgetManagerVars(l(a).hash).configMenuOpen=s),"min-width":"400","max-width":"35%"},{default:h(()=>[n(ne,{class:"pa-2",style:ie(l(R).globalGlassMenuStyles)},{default:h(()=>[n(re,null,{default:h(()=>[z("Depth HUD config")]),_:1}),n(ue,null,{default:h(()=>[n(he,{class:"ma-1",label:"Show height value","model-value":l(a).options.showDepthValue,color:l(a).options.showDepthValue?"white":void 0,"hide-details":"",onChange:t[0]||(t[0]=s=>l(a).options.showDepthValue=!l(a).options.showDepthValue)},null,8,["model-value","color"]),n(me,null,{default:h(()=>[n(we,{class:"bg-[#FFFFFF22] text-white"},{default:h(()=>[n(xe,null,{default:h(()=>[z("Color")]),_:1}),n(Ve,null,{default:h(()=>[n(de,{modelValue:l(a).options.hudColor,"onUpdate:modelValue":t[1]||(t[1]=s=>l(a).options.hudColor=s),class:"ma-2 text-white bg-[#FFFFFF22]",swatches:E.value,width:"100%","show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),Ye=fe(Fe,[["__scopeId","data-v-e5c4a1a7"]]);export{Ye as default};
